<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>Redis主从同步实验 | Yiiong's Blog</title><meta name="author" content="Yiiong"><meta name="copyright" content="Yiiong"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="需求 A：master，不加密（普通端口 6379） B：slave，从 A 同步，不加密（端口 16379），同时监听 TLS 加密端口 16380 C：slave，从 B 同步，通过 TLS（端口 16380）  部署生成自签名TLS证书 使用openssl生成自签名证书mkdir -p certs &amp;&amp; cd certs# 创建 CAopenssl genrsa -out c">
<meta property="og:type" content="article">
<meta property="og:title" content="Redis主从同步实验">
<meta property="og:url" content="http://example.com/2025/12/08/redis/index.html">
<meta property="og:site_name" content="Yiiong&#39;s Blog">
<meta property="og:description" content="需求 A：master，不加密（普通端口 6379） B：slave，从 A 同步，不加密（端口 16379），同时监听 TLS 加密端口 16380 C：slave，从 B 同步，通过 TLS（端口 16380）  部署生成自签名TLS证书 使用openssl生成自签名证书mkdir -p certs &amp;&amp; cd certs# 创建 CAopenssl genrsa -out c">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://example.com/img/ava.jpg">
<meta property="article:published_time" content="2025-12-08T14:55:52.970Z">
<meta property="article:modified_time" content="2025-12-08T14:56:38.436Z">
<meta property="article:author" content="Yiiong">
<meta property="article:tag" content="Redis">
<meta property="article:tag" content="服务器运维">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://example.com/img/ava.jpg"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Redis主从同步实验",
  "url": "http://example.com/2025/12/08/redis/",
  "image": "http://example.com/img/ava.jpg",
  "datePublished": "2025-12-08T14:55:52.970Z",
  "dateModified": "2025-12-08T14:56:38.436Z",
  "author": [
    {
      "@type": "Person",
      "name": "Yiiong",
      "url": "http://example.com"
    }
  ]
}</script><link rel="shortcut icon" href="/img/logo.svg"><link rel="canonical" href="http://example.com/2025/12/08/redis/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css?v=5.5.2"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@7.1.0/css/all.min.css"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!false && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          theme === 'dark' ? activateDarkMode() : theme === 'light' ? activateLightMode() : null
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.json","preload":false,"top_n_per_article":1,"unescape":false,"pagination":{"enable":false,"hitsPerPage":8},"languages":{"hits_empty":"未找到符合您查询的内容：${query}","hits_stats":"共找到 ${hits} 篇文章"}},
  translate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false,"highlightFullpage":false,"highlightMacStyle":"true`"},
  copy: {
    success: '复制成功',
    error: '复制失败',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"limitCount":150,"languages":{"author":"作者: Yiiong","link":"链接: ","source":"来源: Yiiong's Blog","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。"}},
  lightbox: 'FancyBox',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid@4.12.0/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyloadPlugin: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'Redis主从同步实验',
  isHighlightShrink: false,
  isToc: true,
  pageType: 'post'
}</script><link rel="stylesheet" href="/css/universe.css"><meta name="generator" content="Hexo 8.1.1"></head><body><div id="web_bg" style="background: transparent;"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="/img/ava.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data text-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">26</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">14</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">7</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-list"></i><span> 文章</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></li><li><a class="site-page child" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/about"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url(/img/tag.jpg);"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><span class="site-name">Yiiong's Blog</span></a><a class="nav-page-title" href="/"><span class="site-name">Redis主从同步实验</span><span class="site-name"><i class="fa-solid fa-circle-arrow-left"></i><span>  返回首页</span></span></a></span><div id="menus"><div id="search-button"><span class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></span></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-list"></i><span> 文章</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></li><li><a class="site-page child" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/about"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">Redis主从同步实验</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2025-12-08T14:55:52.970Z" title="发表于 2025-12-08 22:55:52">2025-12-08</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2025-12-08T14:56:38.436Z" title="更新于 2025-12-08 22:56:38">2025-12-08</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E6%9C%8D%E5%8A%A1%E5%99%A8%E8%BF%90%E7%BB%B4/">服务器运维</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">浏览量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><h1 id="需求"><a href="#需求" class="headerlink" title="需求"></a>需求</h1><ul>
<li>A：master，不加密（普通端口 6379）</li>
<li>B：slave，从 A 同步，不加密（端口 16379），同时监听 TLS 加密端口 16380</li>
<li>C：slave，从 B 同步，通过 TLS（端口 16380）</li>
</ul>
<h1 id="部署"><a href="#部署" class="headerlink" title="部署"></a>部署</h1><h2 id="生成自签名TLS证书-使用openssl生成自签名证书"><a href="#生成自签名TLS证书-使用openssl生成自签名证书" class="headerlink" title="生成自签名TLS证书 使用openssl生成自签名证书"></a>生成自签名TLS证书 使用openssl生成自签名证书</h2><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">mkdir -p certs &amp;&amp; cd certs</span><br><span class="line"></span><br><span class="line"># 创建 <span class="variable constant_">CA</span></span><br><span class="line">openssl genrsa -out ca.<span class="property">key</span> <span class="number">4096</span></span><br><span class="line">openssl req -x509 -<span class="keyword">new</span> -nodes -key ca.<span class="property">key</span> -sha256 -days <span class="number">3650</span> -out ca.<span class="property">crt</span> -subj <span class="string">&quot;/CN=Redis-CA&quot;</span></span><br><span class="line"></span><br><span class="line"># 创建 server key 和证书签名请求（<span class="variable constant_">CSR</span>）</span><br><span class="line">openssl genrsa -out redis.<span class="property">key</span> <span class="number">2048</span></span><br><span class="line">openssl req -<span class="keyword">new</span> -key redis.<span class="property">key</span> -out redis.<span class="property">csr</span> -subj <span class="string">&quot;/CN=redis-server&quot;</span></span><br><span class="line"></span><br><span class="line"># 使用 <span class="variable constant_">CA</span> 签发 server 证书</span><br><span class="line">openssl x509 -req -<span class="keyword">in</span> redis.<span class="property">csr</span> -<span class="variable constant_">CA</span> ca.<span class="property">crt</span> -<span class="title class_">CAkey</span> ca.<span class="property">key</span> -<span class="title class_">CAcreateserial</span> -out redis.<span class="property">crt</span> -days <span class="number">3650</span> -sha256</span><br><span class="line"></span><br><span class="line"># 权限设置</span><br><span class="line">chmod <span class="number">644</span> redis.<span class="property">crt</span> redis.<span class="property">key</span> ca.<span class="property">crt</span></span><br></pre></td></tr></table></figure>

<p>CA相关证书</p>
<ul>
<li><code>ca.key</code>：CA的私钥，用来签发证书（给redis.crt签名）</li>
<li><code>ca.crt</code>：CA的公钥证书，用来让客户端验证某个证书（比如redis.crt）是不是CA签发的，客户端拿redis.crt来验证时，会用这个公钥解签名。</li>
</ul>
<p>Redis服务器相关证书</p>
<ul>
<li><code>redis.key</code>：Redis 服务端的私钥，用来解密客户端发来的数据、以及在 TLS 握手时证明”我是 Redis 服务端”。</li>
<li><code>redis.csr</code>：证书签名请求（Certificate Signing Request）包含 Redis 服务器的公钥 + 服务器身份信息（域名、组织等），生成 CSR 的目的是交给 CA 签名，生成一个正式证书。</li>
<li><code>redis.crt</code>：Redis 服务器的证书</li>
</ul>
<h2 id="Redis-配置文件"><a href="#Redis-配置文件" class="headerlink" title="Redis 配置文件"></a>Redis 配置文件</h2><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">port <span class="number">6379</span></span><br><span class="line">tls-port <span class="number">6380</span></span><br><span class="line">tls-cert-file /certs/redis.<span class="property">crt</span></span><br><span class="line">tls-key-file /certs/redis.<span class="property">key</span></span><br><span class="line">tls-ca-cert-file /certs/ca.<span class="property">crt</span></span><br><span class="line">tls-auth-clients no</span><br><span class="line"></span><br><span class="line"># 作为slave，同步redis-a</span><br><span class="line">replicaof redis-a <span class="number">6379</span></span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"># 关闭非加密 <span class="variable constant_">TCP</span> 端口</span><br><span class="line">port <span class="number">0</span></span><br><span class="line"></span><br><span class="line">tls-port <span class="number">6380</span></span><br><span class="line">tls-cert-file /certs/redis.<span class="property">crt</span></span><br><span class="line">tls-key-file /certs/redis.<span class="property">key</span></span><br><span class="line">tls-ca-cert-file /certs/ca.<span class="property">crt</span></span><br><span class="line"># 单向<span class="variable constant_">TLS</span></span><br><span class="line">tls-auth-clients no</span><br><span class="line"></span><br><span class="line"># 从加密端口同步 redis-b</span><br><span class="line">replicaof redis-b <span class="number">6380</span></span><br><span class="line"># 允许主从复制也走 <span class="variable constant_">TLS</span> 加密通道</span><br><span class="line">tls-replication yes</span><br></pre></td></tr></table></figure>

<h2 id="docker-compose"><a href="#docker-compose" class="headerlink" title="docker-compose"></a>docker-compose</h2><p>启动三个redis容器</p>
<p>redis-a作为master，暴露容器端口6379到6379</p>
<p>redis-b作为slave，暴露容器端口6379到16379，容器端口6380到16380（TLS）</p>
<p>redis-c作为slave，暴露容器端口6380到26380（TLS）</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="attr">version</span>: <span class="string">&#x27;3.8&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="attr">services</span>:</span><br><span class="line">  redis-<span class="attr">a</span>:</span><br><span class="line">    <span class="attr">image</span>: <span class="attr">redis</span>:latest</span><br><span class="line">    <span class="attr">container_name</span>: redis-a</span><br><span class="line">    <span class="attr">ports</span>:</span><br><span class="line">      - <span class="string">&quot;6379:6379&quot;</span></span><br><span class="line">    <span class="attr">volumes</span>:</span><br><span class="line">      - ./data/redis-<span class="attr">a</span>:/data</span><br><span class="line">    <span class="attr">command</span>: [<span class="string">&quot;redis-server&quot;</span>, <span class="string">&quot;--port&quot;</span>, <span class="string">&quot;6379&quot;</span>]</span><br><span class="line">    <span class="attr">networks</span>:</span><br><span class="line">      - redis-net</span><br><span class="line"></span><br><span class="line">  redis-<span class="attr">b</span>:</span><br><span class="line">    <span class="attr">image</span>: <span class="attr">redis</span>:latest</span><br><span class="line">    <span class="attr">container_name</span>: redis-b</span><br><span class="line">    <span class="attr">ports</span>:</span><br><span class="line">      - <span class="string">&quot;16379:6379&quot;</span></span><br><span class="line">      - <span class="string">&quot;16380:6380&quot;</span></span><br><span class="line">    <span class="attr">volumes</span>:</span><br><span class="line">      - ./data/redis-<span class="attr">b</span>:/data</span><br><span class="line">      - ./<span class="attr">certs</span>:/certs</span><br><span class="line">      - ./redis-b.<span class="property">conf</span>:<span class="regexp">/usr/</span>local/etc/redis/redis.<span class="property">conf</span></span><br><span class="line">    <span class="attr">command</span>: [<span class="string">&quot;redis-server&quot;</span>, <span class="string">&quot;/usr/local/etc/redis/redis.conf&quot;</span>]</span><br><span class="line">    <span class="attr">networks</span>:</span><br><span class="line">      - redis-net</span><br><span class="line">    <span class="attr">depends_on</span>:</span><br><span class="line">      - redis-a</span><br><span class="line"></span><br><span class="line">  redis-<span class="attr">c</span>:</span><br><span class="line">    <span class="attr">image</span>: <span class="attr">redis</span>:latest</span><br><span class="line">    <span class="attr">container_name</span>: redis-c</span><br><span class="line">    <span class="attr">ports</span>:</span><br><span class="line">      - <span class="string">&quot;26380:6380&quot;</span></span><br><span class="line">    <span class="attr">volumes</span>:</span><br><span class="line">      - ./data/redis-<span class="attr">c</span>:/data</span><br><span class="line">      - ./<span class="attr">certs</span>:/certs</span><br><span class="line">      - ./redis-b.<span class="property">conf</span>:<span class="regexp">/usr/</span>local/etc/redis/redis.<span class="property">conf</span></span><br><span class="line">    <span class="attr">command</span>: [<span class="string">&quot;redis-server&quot;</span>, <span class="string">&quot;/usr/local/etc/redis/redis.conf&quot;</span>]</span><br><span class="line">    <span class="attr">networks</span>:</span><br><span class="line">      - redis-net</span><br><span class="line">    <span class="attr">depends_on</span>:</span><br><span class="line">      - redis-b</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="attr">networks</span>:</span><br><span class="line">  redis-<span class="attr">net</span>:</span><br><span class="line">    <span class="attr">driver</span>: bridge</span><br></pre></td></tr></table></figure>

<h1 id="验证"><a href="#验证" class="headerlink" title="验证"></a>验证</h1><h2 id="查看主从状态"><a href="#查看主从状态" class="headerlink" title="查看主从状态"></a>查看主从状态</h2><p>目标：</p>
<ul>
<li>B 是 A 的从节点</li>
<li>C 是 B 的从节点（通过 TLS）</li>
</ul>
<h3 id="查看-Redis-B-是否同步-Redis-A（非-TLS）"><a href="#查看-Redis-B-是否同步-Redis-A（非-TLS）" class="headerlink" title="查看 Redis B 是否同步 Redis A（非 TLS）"></a>查看 Redis B 是否同步 Redis A（非 TLS）</h3><p>可以看到b以a作为master，<code>master_link_status:up</code> 说明同步正常</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">root@<span class="attr">liyixiong01</span>:~/redis# docker exec -it redis-b redis-cli -p <span class="number">6379</span> info replication</span><br><span class="line"># <span class="title class_">Replication</span></span><br><span class="line"><span class="attr">role</span>:slave</span><br><span class="line"><span class="attr">master_host</span>:redis-a</span><br><span class="line"><span class="attr">master_port</span>:<span class="number">6379</span></span><br><span class="line"><span class="attr">master_link_status</span>:up</span><br></pre></td></tr></table></figure>

<h3 id="查看-Redis-C-是否通过-TLS-同步-Redis-B"><a href="#查看-Redis-C-是否通过-TLS-同步-Redis-B" class="headerlink" title="查看 Redis C 是否通过 TLS 同步 Redis B"></a>查看 Redis C 是否通过 TLS 同步 Redis B</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">root@<span class="attr">liyixiong01</span>:~<span class="regexp">/redis# docker exec -it redis-c redis-cli   --tls   --cert /</span>certs/redis.<span class="property">crt</span>   --key /certs/redis.<span class="property">key</span>   --cacert /certs/ca.<span class="property">crt</span>   -p <span class="number">6380</span> info replication</span><br><span class="line"># <span class="title class_">Replication</span></span><br><span class="line"><span class="attr">role</span>:slave</span><br><span class="line"><span class="attr">master_host</span>:redis-b</span><br><span class="line"><span class="attr">master_port</span>:<span class="number">6380</span></span><br><span class="line"><span class="attr">master_link_status</span>:up</span><br></pre></td></tr></table></figure>

<h2 id="验证数据同步链路是否真实工作"><a href="#验证数据同步链路是否真实工作" class="headerlink" title="验证数据同步链路是否真实工作"></a>验证数据同步链路是否真实工作</h2><h3 id="在-Redis-A-写入数据"><a href="#在-Redis-A-写入数据" class="headerlink" title="在 Redis A 写入数据"></a>在 Redis A 写入数据</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">root@<span class="attr">liyixiong01</span>:~/redis# docker exec -it redis-a redis-cli -p <span class="number">6379</span> set hello world</span><br><span class="line"><span class="variable constant_">OK</span></span><br></pre></td></tr></table></figure>

<h3 id="在-Redis-B-查看是否能读到（非TLS）"><a href="#在-Redis-B-查看是否能读到（非TLS）" class="headerlink" title="在 Redis B 查看是否能读到（非TLS）"></a>在 Redis B 查看是否能读到（非TLS）</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">root@<span class="attr">liyixiong01</span>:~/redis# docker exec -it redis-b redis-cli -p <span class="number">6379</span> get hello</span><br><span class="line">\<span class="string">&quot;world&quot;</span></span><br></pre></td></tr></table></figure>

<h3 id="在-Redis-C-查看是否能读到（TLS）"><a href="#在-Redis-C-查看是否能读到（TLS）" class="headerlink" title="在 Redis C 查看是否能读到（TLS）"></a>在 Redis C 查看是否能读到（TLS）</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">root@<span class="attr">liyixiong01</span>:~/redis# docker exec -it redis-c redis-cli \</span><br><span class="line">  --tls \</span><br><span class="line">  --cert /certs/redis.<span class="property">crt</span> \</span><br><span class="line">  --key /certs/redis.<span class="property">key</span> \</span><br><span class="line">  --cacert /certs/ca.<span class="property">crt</span> \</span><br><span class="line">  -p <span class="number">6380</span> get hello</span><br><span class="line"><span class="string">&quot;world&quot;</span></span><br></pre></td></tr></table></figure></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a href="http://example.com">Yiiong</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="http://example.com/2025/12/08/redis/">http://example.com/2025/12/08/redis/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来源 <a href="http://example.com" target="_blank">Yiiong's Blog</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E6%9C%8D%E5%8A%A1%E5%99%A8%E8%BF%90%E7%BB%B4/">服务器运维</a><a class="post-meta__tags" href="/tags/Redis/">Redis</a></div><div class="post-share"><div class="social-share" data-image="/img/ava.jpg" data-sites="facebook,x,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.6/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.6/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related full-width" href="/2025/12/08/%E8%BF%90%E7%BB%B4%E5%B8%B8%E7%94%A8%E5%B7%A5%E5%85%B7/" title="运维常用工具"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-right"><div class="info-1"><div class="info-item-1">下一篇</div><div class="info-item-2">运维常用工具</div></div><div class="info-2"><div class="info-item-1">Harbor Harbor (goharbor.io)  尽管Docker官方提供了公共的镜像仓库DockerHub，但从安全性和稳定性等方面考虑，部署私有镜像仓库是非常有必要的。Harbor是一个由VMware公司开源的企业级的Docker Registry管理项目，是我们搭建私有镜像仓库的不二之选。 整体架构 如上图所示是 Harbor 2.0 的架构图，从上到下可分为代理层、功能层和数据层。  代理层：代理层实质上是一个 Nginx 反向代理，负责接收不同类型的客户端请求，包括浏览器、用户脚本、Docker 等，并根据请求类型和 URI 转发给不同的后端服务进行处理。 功能层： Portal：是一个基于 Argular 的前端应用，提供 Harbor 用户访问的界面。 Core：是 Harbor 中的核心组件，封装了 Harbor 绝大部分的业务逻辑。 JobService：异步任务组件，负责 Harbor 中很多比较耗时的功能，比如 Artifact 复制、扫描、垃圾回收等。 Docker Distribution：Harbor 通过 Distribution 实现 Ar...</div></div></div></a></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><a class="pagination-related" href="/2025/12/08/%E8%BF%90%E7%BB%B4%E5%B8%B8%E7%94%A8%E5%B7%A5%E5%85%B7/" title="运维常用工具"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-12-08</div><div class="info-item-2">运维常用工具</div></div><div class="info-2"><div class="info-item-1">Harbor Harbor (goharbor.io)  尽管Docker官方提供了公共的镜像仓库DockerHub，但从安全性和稳定性等方面考虑，部署私有镜像仓库是非常有必要的。Harbor是一个由VMware公司开源的企业级的Docker Registry管理项目，是我们搭建私有镜像仓库的不二之选。 整体架构 如上图所示是 Harbor 2.0 的架构图，从上到下可分为代理层、功能层和数据层。  代理层：代理层实质上是一个 Nginx 反向代理，负责接收不同类型的客户端请求，包括浏览器、用户脚本、Docker 等，并根据请求类型和 URI 转发给不同的后端服务进行处理。 功能层： Portal：是一个基于 Argular 的前端应用，提供 Harbor 用户访问的界面。 Core：是 Harbor 中的核心组件，封装了 Harbor 绝大部分的业务逻辑。 JobService：异步任务组件，负责 Harbor 中很多比较耗时的功能，比如 Artifact 复制、扫描、垃圾回收等。 Docker Distribution：Harbor 通过 Distribution 实现 Ar...</div></div></div></a><a class="pagination-related" href="/2025/12/08/iManager-%E6%82%A8%E7%9A%84%E7%A7%81%E4%BA%BA%E9%95%9C%E5%83%8F%E7%AE%A1%E5%AE%B6/" title="iManager-您的私人镜像管家"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-12-08</div><div class="info-item-2">iManager-您的私人镜像管家</div></div><div class="info-2"><div class="info-item-1">iManager-您的私人镜像管家尽管Docker官方提供了公共的镜像仓库DockerHub，但从安全性和稳定性等方面考虑，部署私有镜像仓库是非常有必要的。Harbor是一个由VMware公司开源的企业级的Docker Registry管理项目，是我们搭建私有镜像仓库的不二之选。 而自动化一直是运维工作中的重中之重。 Yiiong希望你能够将Harbor与飞书机器人联系起来，方便管理员统一管理镜像，使管理员随时都可以知晓仓库镜像的变动信息，管理员动动手指就可以对仓库里的镜像进行操作等。 前置准备 建议使用服务器搭建Harbor仓库，并且配置好https 申请一个飞书企业账号 可能需要一个域名？  任务友善的用户交互用户肯定需要知道你的机器人都可以干些什么事情吧 用户向机器人发送帮助，机器人返回可以实现的功能列表 当用户发送了一些乱七八糟的信息时，机器人需要做出一定的回复，比如我听不懂捏 Level 0 通知当镜像状态发生改变时，机器人向管理员发起通知 通知内容包括：  镜像状态（Push or Pull or Delete） 镜像名称以及标签 镜像状态改变的日期 镜像状态改变者 ...</div></div></div></a><a class="pagination-related" href="/2025/12/08/Gitlab%20CICD%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/" title="Gitlab CICD学习记录"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-12-08</div><div class="info-item-2">Gitlab CICD学习记录</div></div><div class="info-2"><div class="info-item-1">Gitlab CICD学习记录用Flask在K8s集群编写后端项目编写app.py编写一个最简单的后端项目，命名为app.py，返回hello world! from flask import Flaskapp = Flask(__name__)@app.route(&#x27;/&#x27;)def hello():    return &quot;hello world!&quot;if __name__ == &#x27;__main__&#x27;:    app.run(host=&#x27;0.0.0.0&#x27;, port=8080)  用pipreqs导出依赖文件pip3 install pipreqs  pipreqs . --encoding=utf8 --force   构建Docker镜像编写dockerfile FROM python:3.9WORKDIR /appCOPY requirements.txt .RUN pip install --no-cache-dir -r requirements.txtCOPY . .CMD [&quot;py...</div></div></div></a><a class="pagination-related" href="/2025/12/08/BIND9%20DNS%E6%99%BA%E8%83%BD%E8%A7%A3%E6%9E%90%E5%AE%9E%E9%AA%8C/" title="BIND9 DNS智能解析实验"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-12-08</div><div class="info-item-2">BIND9 DNS智能解析实验</div></div><div class="info-2"><div class="info-item-1">BIND（Berkeley Internet Name Domain）  是全球使用最广泛的 DNS 服务器软件，最初由加州大学伯克利分校开发，目前由 ISC（Internet Systems Consortium）  维护。 BIND9 让一台服务器可以充当 DNS 解析器（递归）或权威服务器（发布域名解析记录） 目标基于bind9的view功能，实现DNS的智能解析。  master和两个slave之间实现主从同步 slave-1和slave-2均提供对www.a.com的解析，其中slave-1解析www至1.1.1.1；slave-2解析www至2.2.2.2  环境容器  bind-master：172.28.0.2 bind-slave-1：172.28.0.3 bind-slave-2：172.28.0.4  zone：a.com 域名：www.a.com  bind-slave-1视图：1.1.1.1 bind-slave-2视图：2.2.2.2  权威NS：ns1.a.com（172.28.0.2） NS：ns2.a.com（172.28.0.3、172.28....</div></div></div></a></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="/img/ava.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">Yiiong</div><div class="author-info-description"></div><div class="site-data"><a href="/archives/"><div class="headline">文章</div><div class="length-num">26</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">14</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">7</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/xxxxxx"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons"><a class="social-icon" href="https://github.com/Beatrueman" target="_blank" title="Github"><i class="fab fa-github" style="color: #24292e;"></i></a><a class="social-icon" href="mailto:yiiong@redrock.team" target="_blank" title="Email"><i class="fas fa-envelope" style="color: #4a7dbe;"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">Study in Redrock SRE!</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E9%9C%80%E6%B1%82"><span class="toc-number">1.</span> <span class="toc-text">需求</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E9%83%A8%E7%BD%B2"><span class="toc-number">2.</span> <span class="toc-text">部署</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%94%9F%E6%88%90%E8%87%AA%E7%AD%BE%E5%90%8DTLS%E8%AF%81%E4%B9%A6-%E4%BD%BF%E7%94%A8openssl%E7%94%9F%E6%88%90%E8%87%AA%E7%AD%BE%E5%90%8D%E8%AF%81%E4%B9%A6"><span class="toc-number">2.1.</span> <span class="toc-text">生成自签名TLS证书 使用openssl生成自签名证书</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Redis-%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="toc-number">2.2.</span> <span class="toc-text">Redis 配置文件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#docker-compose"><span class="toc-number">2.3.</span> <span class="toc-text">docker-compose</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E9%AA%8C%E8%AF%81"><span class="toc-number">3.</span> <span class="toc-text">验证</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9F%A5%E7%9C%8B%E4%B8%BB%E4%BB%8E%E7%8A%B6%E6%80%81"><span class="toc-number">3.1.</span> <span class="toc-text">查看主从状态</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9F%A5%E7%9C%8B-Redis-B-%E6%98%AF%E5%90%A6%E5%90%8C%E6%AD%A5-Redis-A%EF%BC%88%E9%9D%9E-TLS%EF%BC%89"><span class="toc-number">3.1.1.</span> <span class="toc-text">查看 Redis B 是否同步 Redis A（非 TLS）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9F%A5%E7%9C%8B-Redis-C-%E6%98%AF%E5%90%A6%E9%80%9A%E8%BF%87-TLS-%E5%90%8C%E6%AD%A5-Redis-B"><span class="toc-number">3.1.2.</span> <span class="toc-text">查看 Redis C 是否通过 TLS 同步 Redis B</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%AA%8C%E8%AF%81%E6%95%B0%E6%8D%AE%E5%90%8C%E6%AD%A5%E9%93%BE%E8%B7%AF%E6%98%AF%E5%90%A6%E7%9C%9F%E5%AE%9E%E5%B7%A5%E4%BD%9C"><span class="toc-number">3.2.</span> <span class="toc-text">验证数据同步链路是否真实工作</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9C%A8-Redis-A-%E5%86%99%E5%85%A5%E6%95%B0%E6%8D%AE"><span class="toc-number">3.2.1.</span> <span class="toc-text">在 Redis A 写入数据</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9C%A8-Redis-B-%E6%9F%A5%E7%9C%8B%E6%98%AF%E5%90%A6%E8%83%BD%E8%AF%BB%E5%88%B0%EF%BC%88%E9%9D%9ETLS%EF%BC%89"><span class="toc-number">3.2.2.</span> <span class="toc-text">在 Redis B 查看是否能读到（非TLS）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9C%A8-Redis-C-%E6%9F%A5%E7%9C%8B%E6%98%AF%E5%90%A6%E8%83%BD%E8%AF%BB%E5%88%B0%EF%BC%88TLS%EF%BC%89"><span class="toc-number">3.2.3.</span> <span class="toc-text">在 Redis C 查看是否能读到（TLS）</span></a></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/12/08/redis/" title="Redis主从同步实验">Redis主从同步实验</a><time datetime="2025-12-08T14:55:52.970Z" title="发表于 2025-12-08 22:55:52">2025-12-08</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/12/08/%E8%BF%90%E7%BB%B4%E5%B8%B8%E7%94%A8%E5%B7%A5%E5%85%B7/" title="运维常用工具">运维常用工具</a><time datetime="2025-12-08T14:00:22.525Z" title="发表于 2025-12-08 22:00:22">2025-12-08</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/12/08/%E7%AE%97%E6%B3%95%E8%AE%B0%E5%BD%95/" title="算法记录">算法记录</a><time datetime="2025-12-08T14:00:22.521Z" title="发表于 2025-12-08 22:00:22">2025-12-08</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/12/08/%E5%AE%9E%E4%B9%A0%E6%80%BB%E7%BB%93/" title="Baidu实习总结">Baidu实习总结</a><time datetime="2025-12-08T14:00:22.515Z" title="发表于 2025-12-08 22:00:22">2025-12-08</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/12/08/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/" title="数据结构">数据结构</a><time datetime="2025-12-08T14:00:22.515Z" title="发表于 2025-12-08 22:00:22">2025-12-08</time></div></div></div></div></div></div></main><footer id="footer" style="background: transparent;"><div class="footer-other"><div class="footer-copyright"><span class="copyright">&copy;&nbsp;2025 By Yiiong</span><span class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo 8.1.1</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly 5.5.2</a></span></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js?v=5.5.2"></script><script src="/js/main.js?v=5.5.2"></script><script src="/"></script><div class="js-pjax"></div><canvas id="universe"></canvas><script src="/js/universe.js"></script><script id="canvas_nest" defer="defer" color="0,0,255" opacity="0.7" zIndex="-1" count="99" mobile="false" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.6/dist/canvas-nest.min.js"></script><script async data-pjax src="/"></script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><i class="fas fa-spinner fa-pulse" id="loading-status" hidden="hidden"></i><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="text-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据加载中</span></div><div class="local-search-input"><input placeholder="搜索文章" type="text"/></div><hr/><div id="local-search-results"></div><div class="ais-Pagination" id="local-search-pagination" style="display:none;"><ul class="ais-Pagination-list"></ul></div><div id="local-search-stats"></div></div><div id="search-mask"></div><script src="/js/search/local-search.js?v=5.5.2"></script></div></div></body></html>