[{"title":"2022çº¢å²©æ¯WriteUp","url":"/2025/12/08/2022%E7%BA%A2%E5%B2%A9%E6%9D%AFWriteUp/","content":"PWNä¸€å£ä¸€ä¸ªflagé¢˜ç›®ï¼šncä¸€ä¸‹ä¸‹\n\nideaï¼šæ ¹æ®æç¤ºï¼Œncæ˜¯linuxçš„å‘½ä»¤ï¼Œæ‰€ä»¥æœ¬é¢˜éœ€è¦åœ¨linuxç¯å¢ƒæ±‚è§£\n\nstepï¼šæ‰“å¼€Linuxçš„ç»ˆç«¯ï¼Œncæ‰€ç»™çš„ç«¯å£è¾“å…¥ï¼šnc 172.20.14.18 31751å¾—åˆ°ç­”æ¡ˆï¼šredrock&#123;Ech0eCHo-IWaNtF10g_&#125;\n\n\nçŒ«çŒ«flagé¢˜ç›®ï¼šncäºŒä¸‹ä¸‹\n\nidea:æœ¬é¢˜ä¸ä¸Šé¢˜ç±»ä¼¼\n\nstep:ncç«¯å£åæ— å›æ˜¾ï¼Œç»§ç»­è¾“å…¥æŒ‡ä»¤lsåå‡ºç°flagç„¶åcat flagå¾—åˆ°ç­”æ¡ˆ:redrock&#123;SEhLlCAT_IWaNtf1a9_&#125;\n\n\nWebä½ æ˜¯å“ªé‡Œçš„é¢˜ç›®ï¼šhttps://96a84eec-4f7b-45a6-a5bb-224f1064604e.ctf.redrock.team/\n\nidea:è¿›å…¥ç¬¬ä¸€å±‚ç½‘é¡µï¼Œæ˜¾ç¤ºï¼ˆyou must be from https://redrock.teamï¼‰æ²¡ä»€ä¹ˆç ´ç»½ï¼ŒæŒ‰ä¸‹F12,F5åˆ·æ–°ä¸€ä¸‹ï¼Œç‚¹è¿›ç½‘é¡µæ˜¾ç¤ºï¼ˆA word in the http message header is wrong,do you know?ï¼‰ï¼ŒæŒ‰ä¸‹F12å¹¶åˆ·æ–°ä¾ç„¶æ²¡æœ‰ä»€ä¹ˆç ´ç»½ï¼Œäºæ˜¯æƒ³åˆ°ç”¨Burpsuiteè¿›è¡ŒæŠ“åŒ…\n\nstepï¼šæ‰“å¼€burpsuiteï¼Œè¿›è¡ŒæŠ“åŒ…ï¼Œæ ¹æ®é¢˜ç›®çš„æš—ç¤ºï¼ˆä½ æ¥è‡ªå“ªé‡Œï¼‰ï¼Œè”æƒ³åˆ°æ¥è‡ªhttps://redrock.teamäºæ˜¯æ·»åŠ Refererï¼šhttps://redrock.teamåsendæ‰¾åˆ°ç­”æ¡ˆï¼šredrock&#123;we1c0me t0 redr0ck ctf&#125;\n\n\nRemindYourHeadé¢˜ç›®ï¼šhttps://19ab54b4-79ea-469a-b457-f79ca700a343.ctf.redrock.team/\n\nideaï¼šç‚¹å‡»ç½‘é¡µå‘ç°æ˜¯è¢«é»‘äº†çš„ç½‘ç«™ï¼ŒæŒ‰ä¸‹F12å¹¶åˆ·æ–°ï¼Œæ²¡æœ‰ä»€ä¹ˆç ´ç»½äºæ˜¯æƒ³åˆ°æŠ“åŒ…\n\nstepï¼šç”¨BurpsuiteæŠ“åŒ…ï¼Œç›´æ¥æ‰¾åˆ°ç­”æ¡ˆå¾—åˆ°ç­”æ¡ˆï¼šredrock&#123;d95c187c-df9d-463f-80e2-8eea94e73595&#125;\n\n\nMiscç­¾åˆ°é¢˜ç›®ï¼šå¾®ä¿¡å…¬ä¼—å·å…³æ³¨ &quot;é‡é‚®å°å¸®æ‰‹&quot;, å‘é€ &quot;çº¢å²©æ¯CTF&quot;, è·å¾— flag\n\nå¾—åˆ°ç­”æ¡ˆï¼šredrock&#123;020408&#125;\n\n\nå•µå•µçš„é­”æ³•è¯æ°´é¢˜ç›®ï¼šé­”æ³•ä¸–ç•Œé‡Œçš„å°é­”å¥³å•µå•µæ‰¾ä¸åˆ°å¥¹çš„é­”æ³•è¯æ°´äº†ï¼Œå¿«æ¥å¸®å¸®å¥¹ãƒ¾(â€²â–½â€˜)ï¾‰ è¿›å…¥é­”æ³•ä¸–ç•Œéœ€è¦ä¸€ç‚¹ç‚¹é­”åŠ›å‘¢Â° (à¹‘Ë˜ Ë˜à¹‘) â™¥å•µå•µç»™ä½ çš„å°tipsï¼šç”¨docker run &#x27;bobo&#x27; å¯ä»¥çŸ­æš‚çš„æ‰“å¼€è¿›å…¥é­”æ³•ä¸–ç•Œçš„å¤§é—¨ã€æ‹‰å–é•œåƒçš„å’’è¯­ï¼šdocker pull wgyao/redrock-ctf:boboã€‘\n\nidea:æ ¹æ®æç¤ºï¼Œæœ¬é¢˜éœ€è¦ç”¨åˆ°dockerã€‚\n\nstepï¼šè½½ååœ¨cmdå‘½ä»¤è¡Œé‡Œè¾“å…¥docker pull wgyao/redrock-ctf:boboç„¶ååœ¨dockersçš„Imageé‡Œï¼Œæ‰¾åˆ°wgyao/redrock-ctfåç‚¹è¿›ï¼Œå‘ç°ç¬¬21è¡Œå‡ºç°äº†ç­”æ¡ˆç„¶åç‚¹å‡»å³è¾¹Commandå¾—åˆ°ç­”æ¡ˆï¼šredrock&#123;Wit-Sharpening_Potion.&#125;\n\n\n\næµé‡å®¡è®¡é¢˜ç›®ï¼šç‚¹å‡»å°±é€flag\n\nideaï¼šä¸‹è½½é™„ä»¶ï¼Œå‘ç°.pcapngç±»å‹æ–‡ä»¶éœ€è¦ç”¨Wiresharkæ‰“å¼€\n\nstepï¼šç”¨Wiresharkæ‰“å¼€ï¼Œå‘ç°æœ‰çº¿ç´¢ä¸‹é¢æœ‰text/plainï¼Œç„¶åç‚¹è¿›åœ¨æœ€åæ‰¾åˆ°ç­”æ¡ˆï¼šredrock&#123;yyz_is_god&#125;\n\n\n\nCryptoæ¥è‡ªçº¢å²©çš„å¯†æ–‡1é¢˜ç›®ï¼šå¬è¯´è¿™æ˜¯ä¸€æ®µä¸€ç›´æµä¼ åœ¨çº¢å²©çš„å¯†æ–‡ï¼Œæ¯ä¸€ä¸ªè§£å¯†å‡ºè¿™æ®µå¯†æ–‡çš„ä»–/å¥¹éƒ½ä¼šå¼€å¯å±äºè‡ªå·±çš„æ—…ç¨‹ï¼Œä½ èƒ½å¦æˆåŠŸçš„è§£å¯†è¿™æ®µå¯†æ–‡ï¼Ÿå¼€å¯å±äºè‡ªå·±çš„æ—…ç¨‹\n\nideaï¼šä¸‹è½½é™„ä»¶ï¼Œå‘ç°æ˜¯æ•°å­—ï¼Œæƒ³åˆ°ASCII\n\nstepï¼šå¯¹åº”ASCIIè½¬ç å³å¯æ±‚è§£redrock&#123;Welc0me-T0-The-CTF-0f-redrock!!!&#125;\n\næ¥è‡ªçº¢å²©çš„å¯†æ–‡2é¢˜ç›®ï¼šé‚ªæ¶çš„åŠ›é‡å¦„æƒ³å¤ºå–å¯†æ–‡ï¼Œå±éš¾å…³å¤´æ¸…æ°´æ‹¿å‡ºäº†ä¸€æ®µæ™¦æ¶©çš„å’’è¯­ï¼Œåªè¦æˆåŠŸçš„è§£å¯†è¿™æ®µå’’è¯­å°±èƒ½æˆåŠŸçš„é˜»æ­¢é‚ªæ¶çš„Dog&amp;Catï¼Œå¹¶ä¸”å¬è¯´è¿™æ®µå’’è¯­æ˜¯å¼€å¯æ–°å†’é™©çš„é’¥åŒ™ä¹‹ä¸€\n\nideaï¼šä¸‹è½½é™„ä»¶ï¼Œå‘ç°æ˜¯ä¸€ä¸²emojiè¡¨æƒ…ï¼Œåœ¨ç½‘ä¸Šæœç´¢å¯†ç ç±»å‹ï¼ŒæŸ¥åˆ°è¿™æ˜¯base100ç±»å‹ï¼Œè¿›è¡Œè½¬ç ï¼Œæ²¡æœ‰å¾—åˆ°ç­”æ¡ˆï¼Œç»§ç»­å¯»æ‰¾è½¬ç ï¼Œå¤šæ¬¡å°è¯•æ‰¾åˆ°æ˜¯base64ç±»å‹è½¬ç ï¼Œä¾ç„¶æ²¡æœ‰å¾—åˆ°ç­”æ¡ˆï¼Œç»§ç»­å¯»æ‰¾ï¼Œå¤šæ¬¡å°è¯•æ‰¾åˆ°è¿™æ˜¯base32è½¬ç ï¼Œæœ€ç»ˆå¾—åˆ°ç­”æ¡ˆã€‚\n\nstepï¼šå¤šæ¬¡è½¬ç ï¼Œå¾—åˆ°ç­”æ¡ˆredrock&#123;BaSe100_ba5E64_Base32_u_find_me!&#125;\n\n\nä½ å¹²å˜›é¢˜ç›®ï¼šå¬ï¼Œå„ç§åŠ¨ç‰©çš„å«å£°\n\nideaï¼šä¸‹è½½é™„ä»¶ï¼Œæ‰“å¼€æ˜¯ä¸€å †æœ‰è§„å¾‹çš„ä¸­æ–‡ã€‚åœ¨ç½‘ä¸ŠæŸ¥æ‰¾å¯†ç ç±»å‹ï¼Œå‘ç°â€œOokâ€åˆšå¥½å¯ä»¥å’Œâ€œä½ å¹²å˜›â€å¯¹åº”\n\nstepï¼šç”¨wordæ–‡æ¡£å°†â€œä½ å¹²å˜›â€æ¢æˆâ€œOokâ€â€œã€‚â€æ¢æˆâ€œ.â€â€œï¼Ÿâ€ï¼ˆä¸­æ–‡ï¼‰æ¢æˆâ€œ?&quot;ï¼ˆè‹±æ–‡ï¼‰â€œï¼â€ï¼ˆä¸­æ–‡ï¼‰æ¢æˆâ€œ!&quot;ï¼ˆè‹±æ–‡ï¼‰åœ¨åœ¨çº¿Ookè½¬æ¢å·¥å…·è½¬æ¢å‡ºä¸€å †â€œå¥‡æ€ªçš„å«å£°â€æŸ¥æ‰¾å¯†ç ç±»å‹ï¼Œå‘ç°æ˜¯â€œå…½éŸ³è¯‘è€…â€å¯†ç ç±»å‹è¿›è¡Œè½¬æ¢ï¼Œå¾—åˆ°ç­”æ¡ˆï¼šredrock&#123;4re y0u Ok?&#125;\n\n\n\nå¯æƒœæˆ‘å¹´è½»æ— çŸ¥é¢˜ç›®ï¼šä½†æ˜¯æˆ‘æ˜¯å¦‚æ­¤çš„å¹´è½»æ— çŸ¥ï¼Œä¸æ›¾å¬åˆ°å¥¹çš„å¿ƒå£°ã€‚ æ•‘èµä¹‹é“ï¼Œå°±åœ¨å…¶ä¸­ï¼ yveypbl&#123;kfu_h_kvhsq_mpfsq_dse_appjhgx_rhux_xvy_rpfje_spu_dqyvv&#125;\n\nidea:æ ¹æ®æ ¼å¼å¯çŸ¥yveypbl=redrockåœ¨ç½‘ç»œä¸Šå¯»æ‰¾è§£ç ï¼Œæ‰¾åˆ°ä¸€ä¸ªç½‘ç«™https://quipqiup.com/å¯ä»¥è¿›è¡Œè§£ç ï¼Œåˆšå¥½ä¸é¢˜ç›®å¯¹åº”å¾—åˆ°ç­”æ¡ˆï¼šredrock&#123;but i being young and foolish with her would not agree&#125;\n\n\n\nAå’ŒBé¢˜ç›®ï¼šæœ€ç»ˆflagå­—æ¯å‡ä¸ºå°å†™\n\nidea:ä¸‹è½½é™„ä»¶ï¼Œå‘ç°æ˜¯ä¸€å †Aå’ŒBï¼Œå¹¶ä¸”æ˜¯æœ€ç»ˆç­”æ¡ˆçš„æ ¼å¼æƒ³åˆ°åŸ¹æ ¹å¯†ç å¯¹ç…§è½¬æ¢è¡¨è¿›è¡Œæ‰‹åŠ¨è½¬æ¢ï¼Œå¾—åˆ°r&#123;zeyydyyrzzoyzczykz&#125;éšçº¦çœ‹åˆ°æœ‰äº›è§„å¾‹ï¼Œè¿™ä¸²å­—ç¬¦é‡ŒåŒ…å«äº†redrockè¿™æ ·æ’åˆ—r e d r o c k&#123; y y z y z zz y y z z y &#125;å¾—åˆ°ç­”æ¡ˆï¼šredrock&#123;yyzyzzzyyzzy&#125;\n\n\nReversejust_re_ité¢˜ç›®ï¼šTry to submit everything like redrock&#123;...&#125;\n\nideaï¼šå…ˆä¸‹è½½é™„ä»¶ï¼Œç™¾åº¦æœç´¢ï¼Œreverseç±»å‹é¢˜ç›®éœ€è¦ç”¨åˆ°IDA\n\nstep:ç›´æ¥æŠŠé™„ä»¶æ‹–å…¥IDA64ä¸­ï¼ŒæŸ¥æ‰¾å­—ç¬¦ä¸²ï¼Œå¾—åˆ°ç­”æ¡ˆredrock&#123;This_is_fake_flag&#125;\n\n\næ°´æ°´çˆ±å¬æ­Œé¢˜ç›®ï¼šä½ èƒ½çŒœä¸­æˆ‘çš„å¿ƒæ€å—~ Python Message.pyc å°±å¯ä»¥è¿è¡Œï¼\n\nideaï¼šä¸‹è½½é™„ä»¶ï¼Œå‘ç°åç¼€æ˜¯.pycï¼Œç™¾åº¦æœç´¢ï¼Œå‘ç°è¿™ç§æ–‡ä»¶éœ€è¦åç¼–è¯‘ï¼Œåœ¨åœ¨çº¿å·¥å…·ä¸­åç¼–è¯‘å¾—åˆ°åç¼€ä¸º.pyçš„æ–‡ä»¶ï¼Œç”¨VSæ‰“å¼€ã€‚è¿™æ˜¯pythonä»£ç ï¼Œéœ€è¦ä¿®æ”¹äº›ä¸œè¥¿ã€‚å…ˆæŠŠ  æ¸…æ°´å¤§å¸…æ¯” ä¿®æ”¹ï¼Œæ”¹æˆAï¼Œä¿è¯å¯ä»¥è¿è¡Œç»†çœ‹ä»£ç ï¼Œå‘ç°ifè¯­å¥ä¸flagçš„è¾“å‡ºæœ‰å…³ä¿®æ”¹A=checkï¼ˆflagï¼‰ä¸ºA=True\n\nè§‚å¯Ÿæ­¤å¥ï¼ŒçŸ¥é“è¿™è¡Œä»£ç ï¼Œå¦‚æœflagçš„base64åŠ å¯†å’Œzzzç›¸ç­‰ï¼Œåˆ™è¿”å›trueæ‰€ä»¥æŠŠzzzè§£å¯†å°±å¯ä»¥äº†åœ¨ç½‘ä¸Šæœç´¢ï¼Œzzzåçš„è§£ç ç±»å‹ä¸ºURLè¿›è¡Œè§£ç å¾—åˆ°She_bid_me_to_take_love_easy_as_the_leaves_grow_on_the_tree\n\n\nç„¶åè¿è¡Œä»£ç ï¼Œå‡ºç°ä¸‹é¢çš„æƒ…å†µ\n\n\nè¿˜å¯ä»¥è¾“å…¥ä¸œè¥¿ï¼Œäºæ˜¯è¾“å…¥She_bid_me_to_take_love_easy_as_the_leaves_grow_on_the_treeå¾—åˆ°ç­”æ¡ˆï¼šredrock&#123;044d7a01a972dc5882831e89676220c2dc3a3c142e16379a76a45680137a6b55&#125;\n\n\nèµ›åšä¸çœŸé¢˜ç›®ï¼šå–œæ¬¢æˆ‘ HeLang å—ï¼Ÿ\n\nideaï¼šå¹³æ—¶ç½‘ä¸Šå†²æµªï¼ŒçŸ¥é“æœ¬é¢˜ç›®å’Œä½•åŒå­¦æœ‰å…³ä¸‹è½½é™„ä»¶ï¼Œå‘ç°æ˜¯è¡¥å……ä»£ç åœ¨ç½‘ä¸Šæœç´¢è¿™æ®µä»£ç æ˜¯ä½•åŒå­¦åˆ¶ä½œé”®ç›˜æ—¶è¢«ç½‘å‹å‘ç°çš„ä¸€æ®µé”™è¯¯ä»£ç æˆ‘å°è¯•æŠŠé”™è¯¯ä»£ç è¡¥å…¨ï¼Œå‘ç°æˆåŠŸå¾—åˆ°ç­”æ¡ˆï¼redrock&#123;ggg_ding_zhen&#125;\n\n\njmp_or_nopé¢˜ç›®ï¼šä¸‹è½½é™„ä»¶\n\nideaï¼šä¸‹è½½é™„ä»¶åå‘ç°å’Œåæ±‡ç¼–æœ‰å…³ï¼Œæ‹–å…¥dbgï¼ˆ32ï¼‰ä¸­\n\nstep1:æœç´¢å­—ç¬¦ä¸²ï¼Œæ‰¾åˆ°ç›¸å…³ä¿¡æ¯ï¼Œå¯çŸ¥æœ€ç»ˆç­”æ¡ˆæ ¼å¼ä¸ºRedRock&#123;&#125;\n\n\nstep2ï¼šè§‚å¯Ÿå’Œç­”æ¡ˆç›¸å…³éƒ¨åˆ†çš„æ±‡ç¼–è¯­è¨€ï¼Œå¯çŸ¥æœ‰ç›´æ¥è¾“å‡ºflagçš„æ“ä½œï¼Œä½†æ‰“å¼€ç¨‹åºå¹¶ä¸æ˜¾ç¤ºã€‚æ‰€ä»¥åº”è¯¥ä¿®æ”¹æ±‡ç¼–æŒ‡ä»¤ã€‚\n\n\nstep3ï¼šå¯ä»¥çœ‹åˆ°è¿™é‡Œæœ‰cmpè¿›è¡Œäº†åˆ¤æ–­ï¼Œå†ç”¨jaeæŒ‡ä»¤åˆ¤æ–­æ˜¯å¦è·³è·ƒï¼Œå°†å…¶ä¿®æ”¹ã€‚ä»¥ä¸‹åŒç†ã€‚\n\n\nstep4ï¼šæ¥ä¸‹æ¥å°±å¯ä»¥è¿è¡Œäº†æœ€ç»ˆå¾—åˆ°ç­”æ¡ˆï¼šRedRock&#123;jmp_and_nop_is_really_useful&#125;\n\n\n","categories":["Achievements"],"tags":["å®‰å…¨"]},{"title":"EasyBanner","url":"/2025/12/08/EasyBanner/","content":"EasyBanneråŠŸèƒ½ä»‹ç»é€šè¿‡â€‹ â€‹@æœºå™¨äººâ€‹â€‹æ¥è§¦å‘é£ä¹¦æœºå™¨äººå¯¹ç‰¹å®šæœºå™¨è¿œç¨‹å°ç¦æ¶æ„IPï¼Œä¾èµ–äºâ€‹**GitHub - evilsp&#x2F;xdp_banner: ä¸€ä¸ªç®€å•çš„ XDP å°ç¨‹åºï¼Œç”¨äº BAN IP**\n1.å½“æœºå™¨äººæœªè¿æ¥æœåŠ¡å™¨æ—¶ï¼Œæç¤ºå¦‚ä¸‹æ¶ˆæ¯ã€‚\n\n2.å½“æœªå‘ç°è®¿é—®æ¬¡æ•°è¶…è¿‡250æ¬¡çš„IPï¼Œæç¤ºå¦‚ä¸‹æ¶ˆæ¯ã€‚\n\n3.å½“å‘ç°è®¿é—®æ¬¡æ•°è¶…è¿‡250æ¬¡çš„æ¶æ„IPï¼Œç½—åˆ—å‡ºæ¶æ„IPä»¥åŠå¯¹åº”çš„è®¿é—®æ¬¡æ•°ï¼Œå¹¶æ˜¾ç¤ºå°ç¦BANæŒ‰é’®ã€‚\n\nç‚¹å‡»æŒ‰é’®ï¼Œå¯ä»¥å¯¹è¿œç¨‹æœºå™¨è¿›è¡Œå°ç¦æ¶æ„IPï¼Œç„¶åå¡ç‰‡æ›´æ–°ï¼Œæç¤ºå°ç¦å®Œæˆã€‚\n\né€»è¾‘ä»‹ç»æ¥å£ç›®æ ‡æœºå™¨å¼€æ”¾ä¸¤ä¸ªæ¥å£\n\nGET &#x2F;executeï¼šç”¨äºæŸ¥è¯¢æ—¥å¿—é‡Œå½“å‰å°æ—¶å†…è®¿é—®é‡æ’åå‰åçš„IPä»¥åŠå¯¹åº”çš„æ¬¡æ•°ã€‚\nPOST &#x2F;banï¼šç”¨äºæ¥æ”¶éœ€è¦å°ç¦çš„IPï¼Œç„¶åæ‰§è¡Œxdpå°ç¦å‘½ä»¤ã€‚\n\næœºå™¨äººè®¾ç½®ä¸¤ä¸ªæ¥å£\n\nPOST &#x2F;webhookï¼šç”¨æ¥å¤„ç†æ¥æ”¶æ¶ˆæ¯äº‹ä»¶ã€‚\nPOST &#x2F;eventï¼šç”¨æ¥å¤„ç†å¡ç‰‡å›è°ƒ\n\nè¿è¡Œé€»è¾‘ç”¨æˆ·ç»™æœºå™¨äººå‘æ¶ˆæ¯ï¼Œè§¦å‘æ¥æ”¶æ¶ˆæ¯v2.0äº‹ä»¶ï¼Œé£ä¹¦æœåŠ¡å™¨è¿”å›æ¶ˆæ¯ä½“ï¼Œé€šè¿‡æ¶ˆæ¯ä½“é‡ŒmessageBody.Event.Message.Mentionsçš„mention.ID.UserIDæ˜¯å¦ä¸ºç©ºæ¥åˆ¤æ–­ç”¨æˆ·å‘çš„æ¶ˆæ¯æ˜¯å¦ä¸º@æœºå™¨äººï¼Œä¸æ˜¯åˆ™å¿½ç•¥ã€‚\næ˜¯åˆ™å‘é€å¡ç‰‡æ¶ˆæ¯ã€‚è¿™æ—¶è°ƒç”¨ç›®æ ‡æœºå™¨/executeæ¥å£æ¥è·å¾—IPä»¥åŠå¯¹åº”çš„æ¬¡æ•°ï¼Œé€šè¿‡åˆ¤æ–­ ip æ¬¡æ•°ï¼Œå‘é€ä¸åŒçš„æ¨¡æ¿ã€‚\næ²¡æœ‰è¿”å›æ•°æ®ï¼Œåˆ™å‘é€æœªè¿æ¥æœåŠ¡å™¨æ¨¡æ¿ã€‚æœ‰è¿”å›æ•°æ®ä½†æ²¡æœ‰å¤§äº250æ¬¡çš„IPï¼Œè¿”å›æœªæ£€æµ‹åˆ°æ¶æ„IPæ¨¡æ¿ã€‚\næœ‰è¿”å›æ•°æ®ä¸”æœ‰å¤§äº250æ¬¡çš„IPæ—¶ï¼Œè·å–æ‰€æœ‰æ¬¡æ•°å¤§äº250æ¬¡çš„IPä»¥åŠå¯¹åº”çš„æ¬¡æ•°åŠ¨æ€å¡«å……è‡³ JSON æ¨¡æ¿ï¼Œç„¶åå‘é€ã€‚\næ­¤æ—¶ç”¨æˆ·ç‚¹å‡»çº¢è‰²æŒ‰é’®BANï¼Œä¼šè§¦å‘å¡ç‰‡å›ä¼ äº¤äº’äº‹ä»¶ï¼Œæ­¤æ—¶ä¼šå›ä¼ æ•°æ®ã€‚æ¥ä¸‹æ¥å¯¹å›ä¼ æ¶ˆæ¯ä½“è¿›è¡Œä¸€äº›åˆ¤æ–­ï¼š\n\nåˆ¤æ–­event_typeæ˜¯å¦ä¸ºcard.action.trigger\nåˆ¤æ–­action.Tagæ˜¯å¦ä¸ºbutton\nåˆ¤æ–­action.Valueä¸­é”®actionå¯¹åº”çš„å€¼æ˜¯å¦ä¸ºban_ip\n\nå¦‚æœå…¨éƒ¨æ»¡è¶³ï¼Œåˆ™å°†éœ€è¦å°ç¦çš„IPåˆ¶ä½œæˆè¯·æ±‚ä½“ï¼Œå¯¹ç›®æ ‡æœºå™¨POST /banè¿›è¡Œè°ƒç”¨ã€‚\nAPIæˆåŠŸè°ƒç”¨åï¼Œè°ƒç”¨é£ä¹¦æ›´æ–°å¡ç‰‡APIï¼Œå¯¹å¡ç‰‡å†…å®¹è¿›è¡Œæ›´æ–°ã€‚\néƒ¨ç½²ç”³è¯·æœºå™¨äººapp_idä¸app_secretè·å–æ–¹æ³•1.ç”¨ä¼ä¸šè´¦æˆ·ï¼Œåœ¨å¼€å‘è€…åå°ä¸­ï¼Œåˆ›å»ºä¼ä¸šè‡ªå»ºåº”ç”¨\n\n2.æ‰¾åˆ°app_idä¸qpp_secret\n\n3.æ·»åŠ åº”ç”¨èƒ½åŠ›ï¼Œé€‰æ‹©æœºå™¨äºº\n\n4.æ·»åŠ ä»¥ä¸‹æƒé™\nim:message,im:message.group_at_msg,im:message.group_at_msg:readonly,im:message.group_msg,im:message.p2p_msg,im:message.p2p_msg:readonly,im:message:readonly,im:chat:readonly,im:chat,im:message:send_as_bot\n\n\n5.è®¢é˜…æ¥æ”¶æ¶ˆæ¯å’Œå¡ç‰‡å›ä¼ äº¤äº’\nè‹¥è¦ä½¿æœºå™¨äººæœ‰äº’åŠ¨å¯¹è¯åŠŸèƒ½ï¼Œéœ€è¦å¡«å†™è¯·æ±‚é…ç½®åœ°å€ï¼Œå¹¶æ·»åŠ æ¥æ”¶æ¶ˆæ¯v2.0å’Œæ¶ˆæ¯å·²è¯»v2.0äº‹ä»¶\nå¡ç‰‡äº¤äº’éœ€è¦è®¢é˜…å¡ç‰‡å›ä¼ äº¤äº’\n\n\nè£¸æœºéƒ¨ç½²é¦–å…ˆéœ€è¦åœ¨ç›®æ ‡æœºå™¨ä¸Šæ‰§è¡ŒEasyBanner/pkgs/data/app_current.pyï¼Œä¿æŒå…¶ç¨³å®šè¿è¡Œã€‚\næœ€å¥½å°†å…¶åˆ¶ä½œæˆServiceï¼Œä¿è¯åå°æŒä¹…è¿è¡Œã€‚\nè¿™é‡Œæä¾›get_ip.serviceæ–‡ä»¶ä¾›å‚è€ƒã€‚\n[Unit] Description=Get IP Service After=network.target [Service] User=root WorkingDirectory=/root/yiiong/get_ip  # app_current.pyæ‰€åœ¨ç›®å½•Environment=&quot;PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin&quot;ExecStart=/bin/bash -c &#x27;source /root/yiiong/get_ip/venv/bin/activate &amp;&amp; exec python3 app_current.py&#x27;  # è¿è¡ŒPythonç¨‹åºï¼Œæ³¨æ„æ–‡ä»¶è·¯å¾„Restart=always [Install] WantedBy=multi-user.target\n\næˆ–è€…æ‰‹åŠ¨è¿è¡Œ\npython3 ../EasyBanner/pkgs/data/app_current.py\n\nç„¶åä¸‹è½½ä¾èµ–åï¼Œè¿è¡Œmain.go\ngo mod tidygo run main.go\n\nDockeréƒ¨ç½²ç›®æ ‡æœºå™¨çš„APIåªèƒ½è£¸æœºéƒ¨ç½²\nå®¹å™¨å¯åŠ¨\ndocker run -d -p 8080:8080 \\-e APP_ID=cli_a42011585561100d \\ # å¡«å†™é£ä¹¦åº”ç”¨ AppID-e APP_SECRET=AYRFbDlUH8OKxRweuXM47cLLFwRpO12X \\ # å¡«å†™é£ä¹¦åº”ç”¨ AppSecret-e URL=http://172.20.14.2:9521 \\  # å¡«å†™æ£€æµ‹ä¸»æœºåœ°å€-e GIN_MODE=release beatrueman/easybanner:stable\n\nKuberneteséƒ¨ç½²å…ˆåˆ›å»ºSecretè®¾ç½®ç¯å¢ƒå˜é‡\nkubectl create secret generic easybanner-secret \\--from-literal=App_ID=your_AddID \\--from-literal=App_Secret=your_AppSecret \\--from-literal=URL=your_url \\--from-literal=GIN_MODE=release \\ # è®¾ç½®ginä¸ºç”Ÿäº§æ¨¡å¼--namespace=your_namespace\n\nç„¶åapply..&#x2F;deplyç›®å½•ä¸‹çš„deployment.yamlï¼Œservice.yamlã€‚\næ‰€æœ‰æ³¨æ„ä¿®æ”¹å‘½åç©ºé—´ã€‚\nè¿˜æœ‰è¦æ³¨æ„éƒ¨ç½²çš„æœºå™¨äººä¸ç›®æ ‡æœºå™¨æ¥å£çš„é€šä¿¡é—®é¢˜\nkubectl apply deployment.yamlkuectl apply service.yaml# å¦‚æœæœ‰åŸŸåéœ€æ±‚ï¼Œè¿˜å¯ä»¥æ·»åŠ ingressrouteæˆ–è€…ingressï¼Œæ³¨æ„ä¿®æ”¹host# è¿™é‡Œä½¿ç”¨ingressroutekubectl apply -f ingressroute.yaml\n\nç¼ºé™·\næœºå™¨äººå¯èƒ½ä¼šé‡å¤å‘é€æ¶ˆæ¯ã€‚\nå› ä¸ºä¼šå¯¹å¤§æ—¥å¿—æ–‡ä»¶åˆ©ç”¨bashè¿›è¡ŒæŸ¥è¯¢ï¼Œæ‰€ä»¥æ‰§è¡ŒGET /executeé€Ÿåº¦ä¼šæ¯”è¾ƒæ…¢ï¼Œæµ‹è¯•å¤§æ¦‚ä¼šæ¶ˆè€—20så·¦å³ã€‚\nBANæ“ä½œæ¯”è¾ƒæ…¢ï¼Œéœ€è¦ç­‰å¾…ä¸€ä¼šæ‰èƒ½æ›´æ–°å¡ç‰‡ã€‚\n\n","categories":["Achievements"],"tags":["Achievements"]},{"title":"IPBlock-Operator-Plus","url":"/2025/12/08/IPBlock-Operator-Plus/","content":"é¡¹ç›®ç®€ä»‹IPBlock-Operator-Plus æ˜¯ä¸€ä¸ªåŸºäº Kubernetes çš„ Operatorï¼Œæ„å»ºäº†ä¸€ä¸ªæ’ä»¶åŒ–ã€æ¨¡å—åŒ–çš„æ¶æ„ IP å°ç¦ç®¡ç†å¹³å°ã€‚è¯¥é¡¹ç›®é€šè¿‡è‡ªå®šä¹‰èµ„æºï¼ˆIPBlock CRï¼‰å®ç°å¯¹æ¶æ„ IP çš„å£°æ˜å¼ç®¡ç†ï¼Œæ”¯æŒæ‰‹åŠ¨å’Œè‡ªåŠ¨é™æµä¸å°ç¦åŠŸèƒ½ã€‚å…¶æ¶æ„é«˜åº¦å¯æ‰©å±•ï¼Œä¾¿äºé›†æˆå¤šç§è§¦å‘å™¨ï¼ˆTriggerï¼‰å’Œé€šçŸ¥æœºåˆ¶ï¼ˆNotifyï¼‰ï¼Œä»è€Œå®ç°æ™ºèƒ½åŒ–çš„å®‰å…¨é˜²æŠ¤ä¸è¿ç»´ç®¡ç†ã€‚\né¡¹ç›®æ¶æ„æ¶æ„å›¾\n\nIPBlock-Operator-Plus é¡¹ç›®ç”±ä»¥ä¸‹äº”ä¸ªæ ¸å¿ƒæ¨¡å—ç»„æˆï¼š\n\nControllerï¼ˆæ§åˆ¶å™¨ï¼‰\n\nâ€‹\tè´Ÿè´£æ ¸å¿ƒä¸šåŠ¡é€»è¾‘çš„è°ƒåº¦å’Œåè°ƒï¼Œç›‘å¬ Kubernetes ä¸­ IPBlock è‡ªå®šä¹‰èµ„æºçš„å˜åŒ–ï¼Œç»´æŠ¤å’Œç®¡ç†å…¶ç”Ÿå‘½å‘¨æœŸã€‚å®ƒæ˜¯æ•´ä¸ªé¡¹ç›®çš„æ ¸å¿ƒéƒ¨åˆ†ï¼Œåè°ƒå„ä¸ªæ¨¡å—ååŒå·¥ä½œã€‚\n\nEngineï¼ˆå°ç¦åç«¯ï¼‰\nè´Ÿè´£å°ç¦å‘½ä»¤çš„å®é™…æ‰§è¡Œã€‚ç›®å‰æ”¯æŒæ¥å…¥å¤šç§å°ç¦æœºåˆ¶ï¼ˆå¦‚XDPï¼Œiptablesç­‰ï¼‰ã€‚é€šè¿‡æ’ä»¶åŒ–è®¾è®¡ï¼Œä¾¿äºå¿«é€Ÿæ‰©å±•å’Œæ›¿æ¢ä¸åŒçš„å°ç¦æŠ€æœ¯æ–¹æ¡ˆã€‚\n\nNotifyï¼ˆé€šçŸ¥æœºåˆ¶ï¼‰\n\n\nâ€‹\tè´Ÿè´£å°†å°ç¦ã€è§£å°ç­‰äº‹ä»¶ä»¥å¤šç§æ–¹å¼é€šçŸ¥ç»™è¿ç»´äººå‘˜æˆ–å…¶ä»–ç³»ç»Ÿã€‚ç°æ”¯æŒé£ä¹¦é€šçŸ¥æ¸ é“ï¼Œå¼€å‘äººå‘˜å¯é€šè¿‡è‡ªå®šä¹‰æ’ä»¶ï¼ˆå®ç°æ¥å£ï¼‰çµæ´»æ·»åŠ æ›´å¤šé€šçŸ¥æ–¹å¼ã€‚\n\nTriggerï¼ˆè§¦å‘å™¨ï¼‰\näº‹ä»¶è§¦å‘ä¸­å¿ƒï¼Œè´Ÿè´£ç›‘å¬å¤–éƒ¨å‘Šè­¦ç³»ç»Ÿæˆ–ä¸šåŠ¡äº‹ä»¶ï¼ˆå¦‚ Grafana Alertç­‰ï¼‰ï¼Œå¹¶æ ¹æ® Alert ç­–ç•¥è§¦å‘ç›¸å…³å°ç¦æ“ä½œï¼Œè‡ªåŠ¨åˆ›å»º IPBlock CRï¼Œä¸”æ”¯æŒè‡ªåŠ¨è§£å°ã€‚æ¨¡å—è®¾è®¡ä¹Ÿæ–¹ä¾¿å¼€å‘äººå‘˜æ¥å…¥å¤šç§å‘Šè­¦æ¥æºã€‚\n\nPolicyï¼ˆå°ç¦ç­–ç•¥ï¼‰\nå®šä¹‰ IP å°ç¦çš„åˆ¤å®šè§„åˆ™å’Œæ‰§è¡Œç­–ç•¥ã€‚ç°æ”¯æŒç™½åå•æœºåˆ¶ï¼Œä¿éšœäº†å°ç¦è¡Œä¸ºçš„ç²¾å‡†ä¸åˆç†ã€‚\n\n\né¡¹ç›®éƒ¨ç½²ç¯å¢ƒè¦æ±‚\ngo version v1.24.0+\nkubectl version v1.11.3+.\nAccess to a Kubernetes v1.11.3+ cluster.\nPython 3\nMake\n\né¡¹ç›®æ”¯æŒ Helm å’Œ Makeä¸¤ç§éƒ¨ç½²æ–¹å¼\nå°ç¦åç«¯éƒ¨ç½²å°ç¦åç«¯éœ€è¦åœ¨ç›‘æµ‹ç›®æ ‡æœºå™¨ä¸Šæ‰‹åŠ¨æ‰§è¡Œpython3 ../../ipblock-operator/internal/engine/control.py\næœ€å¥½å°†å…¶åˆ¶ä½œæˆServiceï¼Œä¿è¯åå°æŒä¹…è¿è¡Œã€‚\nè¿™é‡Œæä¾›get_ip.serviceæ–‡ä»¶ä¾›å‚è€ƒã€‚\n[Unit] Description=Get IP Service After=network.target [Service] User=root WorkingDirectory=/root/yiiong/get_ip  # control.pyæ‰€åœ¨ç›®å½•Environment=&quot;PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin&quot;ExecStart=/bin/bash -c &#x27;source /root/yiiong/get_ip/venv/bin/activate &amp;&amp; exec python3 control.py&#x27; # è¿è¡ŒPythonç¨‹åºï¼Œæ³¨æ„æ–‡ä»¶è·¯å¾„Restart=always [Install] WantedBy=multi-user.target\n\nHelmé¡¹ç›®çš„helm/ä¸‹å­˜æ”¾äº†IPBlock-Operator-Plusçš„helm chartï¼Œåœ¨å®‰è£…å‰ï¼Œè¯·å…ˆå¡«å†™values.yaml\n# values.yamlimage:  repo: beatrueman/ipblock-operator  tag: &quot;6.0&quot;  pullPolicy: IfNotPresentconfig:  gatewayHost: &quot;&quot;                                    # å°ç¦åç«¯ URL  engine: &quot;&quot;                                         # å¯é€‰: xdp, iptables  whiteList: |\t\t\t\t\t\t\t\t\t\t                   # IP ç™½åå•ï¼Œæ”¯æŒåœ¨ ConfigMapä¸­åŠ¨æ€æ›´æ–°    1.2.3.4  notifyType: &quot;&quot;                                     # å¯é€‰: lark  notifyWebhookURL: &quot;&quot;                               # larkRobot Webhook  notifyTemplate:                                    # larkRobotå‘é€çš„cardæ¶ˆæ¯æ¨¡æ¿    ban: &quot;/templates/lark/ban.json&quot;    resolve: &quot;templates/lark/resolve.json&quot;    common: &quot;/templates/lark/common.json&quot;  triggers:                                          # è§¦å‘å™¨ï¼Œç›®å‰ä»…æ”¯æŒ Grafana    - name: grafana      addr: &quot;:8090&quot;      path: &quot;/trigger/grafana&quot;\n\nå¡«å†™å®Œæˆåï¼Œå®‰è£…helm chartå³å¯\næ³¨æ„éœ€è¦å°†IPblock-Operatoréƒ¨ç½²åœ¨defaultå‘½åç©ºé—´ä¸‹ã€‚\nhelm install ipblock-operator .\n\nMakeåœ¨é›†ç¾¤ä¸Šéƒ¨ç½²å°† CRD å®‰è£…åˆ°é›†ç¾¤ä¸­make install\n\nå°† Manager éƒ¨ç½²åˆ°é›†ç¾¤ä¸­å¡«å†™../../IPBlock-Operator-Plus/config/defaultä¸‹çš„configmap.yaml\n# configmap.yamlapiVersion: v1kind: ConfigMapmetadata:  name: ipblock-operator-configdata:  gatewayHost: &quot;&quot;                                             # å°ç¦åç«¯ URL  engine: &quot;&quot;                                                  # å¯é€‰: xdp, iptables  trigger: |                                                  # è§¦å‘å™¨ï¼Œç›®å‰ä»…æ”¯æŒ Grafana    - name: grafana      addr: &quot;:8090&quot;      path: &quot;/trigger/grafana&quot;  whitelist: |                                                # IP ç™½åå•ï¼Œæ”¯æŒåœ¨ ConfigMapä¸­åŠ¨æ€æ›´æ–°    1.2.3.4  notifyType: &quot;&quot;                                              # å¯é€‰: lark  notifyWebhookURL: &quot;&quot;                                        # larkRobot Webhook  notifyTemplate_ban: &quot;/templates/lark/ban.json&quot;              # larkRobotå‘é€çš„cardæ¶ˆæ¯æ¨¡æ¿ï¼Œè¯·å‹¿æ›´æ”¹è·¯å¾„  notifyTemplate_resolve: &quot;/templates/lark/resolve.json&quot;  notifyTemplate_common: &quot;/templates/lark/common.json&quot;\n\n\næ³¨æ„ï¼š å¦‚æœæ‚¨é‡åˆ° RBAC é”™è¯¯ï¼Œæ‚¨å¯èƒ½éœ€è¦æˆäºˆè‡ªå·± cluster-admin æƒé™æˆ–ä»¥ admin èº«ä»½ç™»å½•ã€‚\n\nmake deploy\n\nåˆ›å»ºæ ·ä¾‹kubectl apply -k config/samples/\n\nå¸è½½ä»é›†ç¾¤ä¸­åˆ é™¤å®ä¾‹ï¼ˆCRsï¼‰kubectl delete ipblock --all\n\nä»é›†ç¾¤ä¸­åˆ é™¤APIï¼ˆCRDsï¼‰make uninstall\n\nä»é›†ç¾¤ä¸­åˆ é™¤æ§åˆ¶å™¨make undeploy\n\né…ç½®é¡¹è¯´æ˜ConfigMap# configmap.yamlapiVersion: v1kind: ConfigMapmetadata:  name: ipblock-operator-configdata:  gatewayHost: &quot;&quot;                                             # å°ç¦åç«¯ URL  engine: &quot;&quot;                                                  # å¯é€‰: xdp, iptables  trigger: |                                                  # è§¦å‘å™¨ï¼Œç›®å‰ä»…æ”¯æŒ Grafana    - name: grafana      addr: &quot;:8090&quot;      path: &quot;/trigger/grafana&quot;  whitelist: |                                                # IP ç™½åå•ï¼Œæ”¯æŒåœ¨ ConfigMapä¸­åŠ¨æ€æ›´æ–°    1.2.3.4  notifyType: &quot;&quot;                                              # å¯é€‰: lark  notifyWebhookURL: &quot;&quot;                                        # larkRobot Webhook  notifyTemplate_ban: &quot;/templates/lark/ban.json&quot;              # larkRobotå‘é€çš„cardæ¶ˆæ¯æ¨¡æ¿ï¼Œè¯·å‹¿æ›´æ”¹è·¯å¾„  notifyTemplate_resolve: &quot;/templates/lark/resolve.json&quot;  notifyTemplate_common: &quot;/templates/lark/common.json&quot;\n\nvalues.yaml# values.yamlimage:  repo: beatrueman/ipblock-operator  tag: &quot;6.0&quot;  pullPolicy: Alwaysconfig:  gatewayHost: &quot;&quot;                                    # å°ç¦åç«¯ URL  engine: &quot;&quot;                                         # å¯é€‰: xdp, iptables  whiteList: |\t\t\t\t\t\t\t\t\t\t                   # IP ç™½åå•ï¼Œæ”¯æŒåœ¨ ConfigMapä¸­åŠ¨æ€æ›´æ–°    1.2.3.4  notifyType: &quot;&quot;                                     # å¯é€‰: lark  notifyWebhookURL: &quot;&quot;                               # larkRobot Webhook  notifyTemplate:                                    # larkRobotå‘é€çš„cardæ¶ˆæ¯æ¨¡æ¿    ban: &quot;/templates/lark/ban.json&quot;    resolve: &quot;templates/lark/resolve.json&quot;    common: &quot;/templates/lark/common.json&quot;  ServiceType: NodePort  triggers:                                          # è§¦å‘å™¨ï¼Œç›®å‰ä»…æ”¯æŒ Grafana    - name: grafana      addr: &quot;:8090&quot;      path: &quot;/trigger/grafana&quot;\n\nTriggeré…ç½®Grafanaå­—æ®µä»‹ç»\n\n\nå­—æ®µ\nè¯´æ˜\nå¿…éœ€\n\n\n\nname\nè§¦å‘å™¨åç§°ï¼Œå½“å‰æ”¯æŒ grafana\næ˜¯\n\n\naddr\nç›‘å¬åœ°å€å’Œç«¯å£ï¼Œä¾‹å¦‚ &quot;:8090&quot;\næ˜¯\n\n\npath\nWebhookè¯·æ±‚è·¯å¾„ï¼Œä¾‹å¦‚ /trigger/grafana\næ˜¯\n\n\nGrafana Alerté…ç½®é…ç½®è”ç»œç‚¹\nå°†é…ç½®å¥½çš„URLå¡«å…¥è”ç»œç‚¹çš„URLä¸­ã€‚\nä¸¾ä¾‹ï¼šhttp://&lt;your-ip&gt;:&lt;NodePort&gt;/trigger/grafanaâ€‹\n\né…ç½®è­¦æŠ¥è§„åˆ™\nè‡ªå®šä¹‰è­¦æŠ¥è§„åˆ™ï¼Œå¹¶é€‰æ‹©è”ç»œç‚¹ä¸ºåˆšæ‰é…ç½®å¥½çš„è”ç»œç‚¹ã€‚\næœ¬ä¾‹ä¸º1minå†…è‹¥è®¿é—®æ¬¡æ•°è¶…è¿‡80ï¼Œåˆ™è§¦å‘è­¦æŠ¥ã€‚\n\nNotigyé…ç½®ç›®å‰ä»…æ”¯æŒé£ä¹¦Larkï¼Œåç»­å°†æ·»åŠ æ›´å¤šï¼Œå¦‚é‚®ä»¶ã€é’‰é’‰ã€ä¼ä¸šå¾®ä¿¡ç­‰ã€‚\nLarkæ·»åŠ è‡ªå®šä¹‰æœºå™¨äººï¼Œå¹¶å°†è·å–åˆ°çš„Webhookåœ°å€å¡«å…¥é…ç½®çš„notifyWebhookURLå³å¯ã€‚\n\nä½¿ç”¨ç¤ºä¾‹åˆ›å»ºä¸€ä¸ª IPBlock èµ„æºapiVersion: ops.yiiong.top/v1kind: IPBlockmetadata:  name: test-ipblockspec:  ip: &quot;1.2.3.4&quot;                       # æ”¯æŒå•IP / CIDRå½¢å¼  reason: &quot;æ¨¡æ‹Ÿå¼‚å¸¸è¯·æ±‚&quot;               # å°ç¦åŸå›   source: &quot;manual&quot;                    # å°ç¦æº  by: &quot;admin&quot;                         # å°ç¦è€…  duration: &quot;10m&quot;                     # å°ç¦æ—¶é•¿ï¼Œå½“å­—æ®µä¸ºç©ºæ—¶ï¼Œæ°¸ä¹…å°ç¦  \n\nCRåˆ›å»ºæˆåŠŸåï¼Œå¦‚æ¥å…¥é£ä¹¦ï¼Œä¼šå‘ç”¨æˆ·å‘èµ·é€šçŸ¥ã€‚\n\nå¯¹IPè§£å°apiVersion: ops.yiiong.top/v1kind: IPBlockmetadata:  name: test-ipblockspec:  ip: &quot;1.2.3.4&quot;                        reason: &quot;æ¨¡æ‹Ÿå¼‚å¸¸è¯·æ±‚&quot;                  source: &quot;manual&quot;                      by: &quot;admin&quot;                           unblock: true                      # è§£å°å­—æ®µ\n\næˆåŠŸåï¼Œé£ä¹¦ä¼šé€šçŸ¥ç”¨æˆ·\n\næ‰‹åŠ¨å¼ºåˆ¶å°ç¦apiVersion: ops.yiiong.top/v1kind: IPBlockmetadata:  name: test-ipblockspec:  ip: &quot;1.2.3.4&quot;                        reason: &quot;æ¨¡æ‹Ÿå¼‚å¸¸è¯·æ±‚&quot;                  source: &quot;manual&quot;                      by: &quot;admin&quot;                           trigger: true                      # é‡å¤å°ç¦\n\nç™½åå•è·³è¿‡å½“åœ¨é…ç½®æ–‡ä»¶ä¸­æŒ‡å®šäº†WhiteListï¼ˆæ”¯æŒå•IP &#x2F; CIDRï¼‰ï¼ŒCRä¼šæ£€æµ‹å°ç¦IPæ˜¯å¦åœ¨ç™½åå•ä¸­ï¼Œå¦‚åœ¨åˆ™è·³è¿‡ã€‚\n","categories":["Kubernetes"],"tags":["Kubernetes","Operator","Achievements"]},{"title":"EasyCreaterâ€”â€”ä¸€ç«™å¼ç®€å†ç”Ÿæˆå™¨","url":"/2025/12/08/EasyCreater/","content":"ç®€ä»‹EasyCreaterâ€”â€”è®©ç®€å†åˆ¶ä½œæ›´é«˜æ•ˆã€æ›´æ™ºèƒ½ï¼\näº§å“ç®€ä»‹\nEasyCreaterï¼Œè®©ç®€å†åˆ¶ä½œæ›´è½»æ¾ï¼Œè®©æ±‚èŒä¹‹è·¯æ›´é¡ºç•…ï¼ ğŸš€âœ¨\n\nEasyCreater æ˜¯ä¸€æ¬¾åœ¨çº¿ç®€å†åˆ¶ä½œå·¥å…·ï¼Œæ—¨åœ¨å¸®åŠ©ç”¨æˆ·ä¸“æ³¨äºå†…å®¹åˆ›ä½œï¼Œè€Œæ— éœ€æ“å¿ƒæ’ç‰ˆå’Œæ ¼å¼ï¼Œè®©ç®€å†åˆ¶ä½œæ›´åŠ é«˜æ•ˆä¾¿æ·ã€‚\nğŸš€ é«˜åº¦è‡ªå®šä¹‰\n\næä¾›æé«˜çš„è‡ªç”±åº¦ï¼Œç”¨æˆ·å¯ä»¥è‡ªç”±è°ƒæ•´ç®€å†ä¾§æ é¢œè‰²ã€å®½åº¦ã€å¤´åƒå½¢çŠ¶ç­‰ï¼Œæ‰“é€ ä¸ªæ€§åŒ–ç®€å†ã€‚\n\nğŸ¤– AI æ™ºèƒ½è¾…åŠ©\n\nå†…ç½® AI å¤§æ¨¡å‹ï¼Œæ— è®ºæ˜¯ä¼˜åŒ–è¡¨è¾¾ã€æ¶¦è‰²å†…å®¹ï¼Œè¿˜æ˜¯è§£å†³å†™ä½œéš¾é¢˜ï¼Œéƒ½å¯ä»¥éšæ—¶å‘ AI å¯»æ±‚å¸®åŠ©ï¼Œè®©ç®€å†æ›´ä¸“ä¸šã€æ›´å‡ºè‰²ã€‚\n\nğŸ“ è‡ªåŠ¨ä¿å­˜è‰ç¨¿\n\nç³»ç»Ÿä¼šè‡ªåŠ¨ä¿å­˜ç”¨æˆ·çš„ç¼–è¾‘å†…å®¹ï¼Œé˜²æ­¢æ•°æ®ä¸¢å¤±ï¼Œç¡®ä¿å†™ä½œè¿‡ç¨‹æ›´å®‰å¿ƒé¡ºç•…ã€‚\n\nğŸ’¡ çµæ„Ÿè¯æ±‡æ¨è\n\nç¼–è¾‘ç•Œé¢ä¾§è¾¹æ æä¾›ä¸°å¯Œçš„çµæ„Ÿè¯æ±‡å’Œå‚è€ƒè¯­å¥ï¼ŒåŠ©åŠ›ç”¨æˆ·ç²¾å‡†è¡¨è¾¾ï¼Œæå‡ç®€å†äº®ç‚¹ã€‚\n\nğŸŒ ç®€å†å¹¿åœºåˆ†äº«\n\nç”¨æˆ·å¯å°†ç®€å†åˆ†äº«è‡³ç®€å†å¹¿åœºï¼Œä¸åŒç”¨æˆ·å¯å¯¹ç®€å†å¹¿åœºä¸Šçš„ç®€å†ç‚¹èµã€‚ç”¨æˆ·å¯ä¸ä»–äººäº¤æµã€å­¦ä¹ ï¼Œå®ç°äº’å¸®äº’åŠ©ï¼Œå…±åŒæå‡æ±‚èŒç«äº‰åŠ›ã€‚\n\nğŸ“Œ æ±‚èŒå¯¼èˆª\n\næä¾›å°±ä¸šç»éªŒèŸèƒä¸“åŒºï¼Œæ•´åˆçŸ¥åé¢è¯•åˆ·é¢˜ç½‘ç«™çš„å¿«æ·å…¥å£ï¼Œå¹¶ç²¾é€‰ç®€å†æ’°å†™å¿…å¤‡è¯å¥ï¼ŒåŠ©åŠ›é«˜æ•ˆæ±‚èŒã€‚\n\nğŸ–¨ ä¸€é”®å¯¼å‡º PDF\n\næ”¯æŒç®€å†å¯¼å‡ºä¸º PDFï¼Œæ–¹ä¾¿æ‰“å°æˆ–åœ¨çº¿æŠ•é€’ï¼Œç¡®ä¿æ ¼å¼ç¾è§‚ã€æ’ç‰ˆæ•´é½ï¼Œè®©æ±‚èŒæ›´é«˜æ•ˆã€‚\n\nğŸ“¥ å¤šæ ¼å¼ç®€å†å¯¼å…¥\n\næ”¯æŒå¯¼å…¥ PDFã€Word åŠå›¾ç‰‡æ ¼å¼çš„ç®€å†ï¼Œå¹¶æä¾›äº‘ç«¯å­˜å‚¨ï¼Œä¾¿æ·ç®¡ç†å·²æœ‰ç®€å†ã€‚æ— è®ºä½•æ—¶ä½•åœ°ï¼Œç”¨æˆ·éƒ½èƒ½éšæ—¶è®¿é—®ã€ç¼–è¾‘å’Œä¼˜åŒ–è‡ªå·±çš„ç®€å†ï¼Œç¡®ä¿æ±‚èŒæ›´é«˜æ•ˆã€æ›´ä»å®¹ã€‚\n\n\né¦–é¡µ\n\nç®€å†åˆ¶ä½œç¼–è¾‘\n\næˆ‘çš„ç®€å†\n\nç®€å†å¹¿åœº\n\né€šè¿‡EasyCreateræ‰€ç”Ÿæˆçš„ç®€å†\n\nAI ç®€å†å†…å®¹ç”Ÿæˆ\n\nAI ç®€å†æ¶¦è‰²\n\nçµæ„Ÿè¯æ±‡\n\nç®€å†ç‚¹èµ\n\næŠ€æœ¯æ¶æ„\nEasyCreaterï¼ŒåŠ©åŠ›é«˜æ•ˆæ±‚èŒï¼Œæä¾›å¼ºå¤§æŠ€æœ¯æ”¯æ’‘ï¼ ğŸš€\n\nEasyCreater é‡‡ç”¨å‰åç«¯åˆ†ç¦»æ¶æ„å¼€å‘ï¼Œæ”¯æŒå¤šç§çµæ´»çš„éƒ¨ç½²æ–¹å¼ï¼ŒåŒ…æ‹¬ Linux æœåŠ¡å™¨ã€Docker Compose åŠ Kubernetesï¼Œç¡®ä¿é«˜æ•ˆç¨³å®šçš„è¿è¡Œã€‚\næ¶æ„å›¾\næŠ€æœ¯æ ˆğŸ’» å‰ç«¯æŠ€æœ¯æ ˆ\n\nVue 3 + Element Plus â€”â€” æä¾›æµç•…çš„ç”¨æˆ·äº¤äº’ä½“éªŒï¼Œç•Œé¢ç®€æ´ç¾è§‚ï¼Œæ“ä½œä¾¿æ·é«˜æ•ˆã€‚\n\nâš™ï¸ åç«¯æŠ€æœ¯æ ˆ\n\nGoï¼ˆGin æ¡†æ¶ + Gormï¼‰  â€”â€” é«˜æ€§èƒ½ Web æ¡†æ¶ Ginï¼Œç»“åˆ Gorm ORMï¼Œé«˜æ•ˆå¤„ç†ä¸šåŠ¡é€»è¾‘ï¼Œæä¾›ç¨³å®šå¯é çš„ API æœåŠ¡ã€‚\n\nğŸ—„ æ•°æ®åº“\n\nMySQL â€”â€” é‡‡ç”¨ MySQL ä½œä¸ºæ ¸å¿ƒæ•°æ®åº“ï¼Œæ”¯æŒé«˜å¹¶å‘æ•°æ®å­˜å‚¨ï¼Œä¿éšœç®€å†æ•°æ®çš„ç¨³å®šå­˜å‚¨ä¸ç®¡ç†ã€‚\nRedis â€” ç”¨äºç¼“å­˜ç®€å†æ•°æ®ï¼Œæ„å»ºé«˜æ•ˆç¨³å®šçš„ AI æµå¼è¾“å‡ºåŸºç¡€è®¾æ–½ã€‚\n\nâ˜ å¯¹è±¡å­˜å‚¨\n\né˜¿é‡Œäº‘ OSS â€”â€” è´Ÿè´£å­˜å‚¨ç®€å†ç¼©ç•¥å›¾å’Œç”¨æˆ·ä¸Šä¼ çš„å·²æœ‰ç®€å†ï¼Œç¡®ä¿æ•°æ®å®‰å…¨ã€è®¿é—®é«˜æ•ˆã€‚\n\nğŸ§  AI æ™ºèƒ½æ”¯æŒ\n\né˜¿é‡Œäº‘é€šä¹‰åƒé—® API â€” æä¾› AI å†…å®¹ä¼˜åŒ–ã€æ™ºèƒ½æ¶¦è‰²åŠå†™ä½œå»ºè®®ï¼Œæ”¯æŒæµå¼è¾“å‡ºï¼Œæ¨¡æ‹ŸçœŸå® AI é—®ç­”ä½“éªŒï¼ŒåŠ©åŠ›ç®€å†æ›´ä¸“ä¸šã€æ›´å‡ºå½©ã€‚\n\nğŸš€ å¤šç§éƒ¨ç½²æ–¹å¼\n\nLinux å•æœºéƒ¨ç½² â€”â€” é€‚ç”¨äºè½»é‡çº§æœåŠ¡å™¨ï¼Œç®€å•æ˜“ç»´æŠ¤ã€‚\nDocker Compose â€”â€” é€šè¿‡å®¹å™¨åŒ–ç®¡ç†ï¼Œå¿«é€Ÿéƒ¨ç½²ï¼Œé™ä½ç¯å¢ƒä¾èµ–ã€‚\nKubernetesï¼ˆK8sï¼‰  â€”â€” é€‚ç”¨äºå¤§è§„æ¨¡åˆ†å¸ƒå¼éƒ¨ç½²ï¼Œå®ç°å¼¹æ€§æ‰©å±•ä¸é«˜å¯ç”¨æ€§ã€‚\n\néƒ¨ç½²å»ºè®®ä½¿ç”¨docker-composeéƒ¨ç½²ï¼Œæ–¹ä¾¿å¿«æ·\nLinuxå•æœºéƒ¨ç½²æœ¬é¡¹ç›®æä¾›äº†ä¸€é”®å¯åŠ¨è„šæœ¬start.sh\nç¯å¢ƒå‡†å¤‡\n\nLinux\nGolang1.23\nNode.js 20\nNginx\nMySQL\né€šä¹‰å¤§æ¨¡å‹_ä¼ä¸šæ‹¥æŠ± AI æ—¶ä»£é¦–é€‰-é˜¿é‡Œäº‘\né˜¿é‡Œäº‘ å¯¹è±¡å­˜å‚¨OSS_\n\nå¦‚ä½•å¼€å§‹ï¼Ÿ\nchmod +x start.sh./start.sh\n\nDocker composeä¸€é”®éƒ¨ç½²æœ¬é¡¹ç›®æ”¯æŒ docker-compose ä¸€é”®éƒ¨ç½²\næ³¨æ„\n\nè¿è¡Œå‰éœ€è¦å¡«å†™ be/config/config.yamlï¼Œå…¶ä¸­MySQL.hostè¯·å¡«å†™ mysqlï¼Œå¦‚æœè¦ä½¿ç”¨å¤–éƒ¨MySQLï¼Œè¯·ä¿®æ”¹ç›¸å…³é…ç½®ã€‚\næŒ‰ç…§å¦‚ä¸‹é…ç½®ï¼Œé¡¹ç›®å¯åŠ¨åï¼Œå‰ç«¯è¿è¡Œåœ¨8080ç«¯å£ï¼Œåç«¯è¿è¡Œåœ¨8888ç«¯å£ã€‚å¦‚æœå¯åŠ¨åæç¤ºç«¯å£å ç”¨ï¼Œè¯·è‡ªè¡Œä¿®æ”¹ç«¯å£ports\n\nversion: &#x27;3&#x27;services:  redis:    image: redis:latest    networks:      - EasyCreater-network      mysql:    image: mysql:latest    # ç¡®ä¿ä¸config.yamlä¸­å¡«å†™çš„ä¿¡æ¯ä¸€è‡´    environment:      MYSQL_ROOT_PASSWORD: 123456      MYSQL_DATABASE: demo      MYSQL_PASSWORD: 123456    networks:      - EasyCreater-network  frontend:    build:      context: ./fe    ports:      - &quot;8080:80&quot;    depends_on:      - backend    networks:      - EasyCreater-network  backend:    build:      context: ./be    ports:      - &quot;8888:8888&quot;    volumes:      - ./be/config/config.yaml:/EasyCreater/config/config.yaml    depends_on:      - mysql      - redis    networks:      - EasyCreater-networknetworks:  EasyCreater-network:    driver: bridge\n\nå¦‚ä½•å¼€å§‹ï¼Ÿ\ndocker-compose up -d\n\nKuberneteséƒ¨ç½²è¯·åˆ‡æ¢è‡³cloudåˆ†æ”¯æŸ¥çœ‹éƒ¨ç½²æ–¹æ³•ã€‚\nCI è‡ªåŠ¨åŒ–æµæ°´çº¿éƒ¨ç½²æ”¯æŒæ·»åŠ äº†ç”¨äºæ‰“åŒ…å’Œæ¨é€é•œåƒçš„Github Action\nä½¿ç”¨æ—¶åœ¨Settings &gt;&gt; Secrets and varibles &gt;&gt; Actionsä¸­æ·»åŠ secrets\nREGISTRY_USERNAMEå’ŒREGISTRY_PASSWORD\n\nå¦‚æœè¦æ¨é€åˆ°ç±»ä¼¼Harborçš„è‡ªå»ºä»“åº“ï¼Œè¯·æ·»åŠ varibles\nIMAGE_REGISTRY_SERVICEï¼šé»˜è®¤ä¸ºdocker.io\nIMAGE_FE_REPOSITORYï¼šé»˜è®¤ä¸ºbeatrueman&#x2F;easycreater-fe\nIMAGE_BE_REPOSITORYï¼šé»˜è®¤ä¸ºbeatrueman&#x2F;easycreater-be\næ¨é€æ—¶è¯·æŒ‡å®štagï¼Œæ ¼å¼ä¸ºv1.0.0ï¼Œç”¨äºæŒ‡å®šé•œåƒç‰ˆæœ¬\ngit tag v1.0.0git push origin v1.0.0\n\næˆ–è€…æ‰‹åŠ¨æŒ‡å®štag\n","categories":["Achievements"],"tags":["Achievements"]},{"title":"Operatorä»‹ç»","url":"/2025/12/08/Operator/","content":"Operatorä¸ºä»€ä¹ˆè¦ç”¨ï¼Ÿå½“K8sä¸­çš„åŸç”Ÿèµ„æºæ— æ³•æ»¡è¶³ä¸šåŠ¡è¦æ±‚æ—¶ï¼Œè¿™æ—¶å€™å°±éœ€è¦Operatoræ¥åˆ›å»ºè‡ªå·±çš„CRDä»¥åŠå¯¹åº”Controllerã€‚åˆ©ç”¨Controllerå®ç°CRDæ‰€éœ€è¦çš„ä¸šåŠ¡é€»è¾‘ã€‚\næ¯”å¦‚ï¼Œæˆ‘ä»¬æƒ³åœ¨Kubernetesä¸­éƒ¨ç½²ä¸€ä¸ªNginxå¹¶è®©å¤–ç•Œå¯ä»¥è®¿é—®åˆ°ï¼Œè¿™æ—¶æˆ‘ä»¬é¦–å…ˆéœ€è¦åˆ›å»ºä¸€ä¸ªDeploymentç”¨æ¥éƒ¨ç½²Nginxï¼Œç„¶ååˆ›å»ºä¸€ä¸ªServiceç”¨æ¥å°†Deploymentçš„Podçš„å®¹å™¨ç«¯å£æ˜ å°„åˆ°ä¸»æœºç«¯å£ã€‚æˆ‘ä»¬è§‰å¾—å¤ªéº»çƒ¦äº†ï¼Œæƒ³è¦åˆ›å»ºä¸€æ¬¡èµ„æºå°±å¯ä»¥åŒæ—¶åŒ…å«Deploymentå’ŒServiceã€‚\næ˜¯ä»€ä¹ˆï¼ŸOperatoræ˜¯ä¸€ç§é€šè¿‡è‡ªå®šä¹‰æ§åˆ¶å™¨ï¼ˆCustomer Controllerï¼‰æ‰©å±•K8s APIçš„æ¨¡å¼ã€‚å®ƒçš„æ ¸å¿ƒæ€æƒ³æ˜¯å°†è¿ç»´çŸ¥è¯†ä»£ç åŒ–ã€‚å…è®¸å¼€å‘è€…å°†åº”ç”¨çš„ç®¡ç†é€»è¾‘ï¼ˆå¦‚éƒ¨ç½²ã€å‡çº§ã€å¤‡ä»½ã€æ¢å¤ï¼‰å°è£…æˆä»£ç ï¼Œä½¿K8sèƒ½å¤Ÿåƒç®¡ç†åŸç”Ÿèµ„æºä¸€æ ·ç®¡ç†å¤æ‚çš„æœ‰çŠ¶æ€åº”ç”¨ï¼ˆå¦‚æ•°æ®åº“ã€æ¶ˆæ¯é˜Ÿåˆ—ï¼‰\nè§£å†³äº†ä»€ä¹ˆï¼Ÿ\nç®¡ç†æœ‰çŠ¶æ€åº”ç”¨çš„å¤æ‚æ€§ï¼šä¾‹å¦‚pgé›†ç¾¤çš„è‡ªåŠ¨æ•…éšœè½¬ç§»ã€redisçš„æ•°æ®æŒä¹…åŒ–\nè‡ªåŠ¨åŒ–è¿ç»´ï¼šé€šè¿‡ä»£ç æ›¿ä»£äººå·¥æ“ä½œ\nç»Ÿä¸€ç”Ÿå‘½å‘¨æœŸç®¡ç†ï¼šæ ‡å‡†åŒ–åº”ç”¨çš„å®‰è£…ã€é…ç½®ã€æ‰©ç¼©å®¹æµç¨‹ç­‰\n\nä»€ä¹ˆæ—¶å€™ç”¨ï¼Ÿ\næ•°æ®åº“ç®¡ç†ï¼šMariaDB Operator\nä¸­é—´ä»¶ç®¡ç†ï¼šKafka Operator\nCI&#x2F;CDå·¥å…·ï¼šArgo CD Operator\n\næ ¸å¿ƒç»„ä»¶Customer Resource Definitionsï¼ˆCRDï¼‰CRDæ˜¯K8sä¸­æ‰©å±•APIèµ„æºçš„æ–¹å¼ã€‚\nController\nèŒè´£ï¼šç›‘å¬èµ„æºçŠ¶æ€å˜åŒ–ã€é©±åŠ¨é›†ç¾¤å‘æœŸæœ›çŠ¶æ€æ”¶æ•›\næ ¸å¿ƒé€»è¾‘ï¼šé€šè¿‡Reconcile()å‡½æ•°å®ç°è°ƒè°å¾ªç¯\n\nReconcile Loopè°ƒè°å¾ªç¯æœºåˆ¶\n\nè·å–èµ„æºçš„å½“å‰çŠ¶æ€\nå¯¹æ¯”å®é™…çŠ¶æ€ï¼ˆé›†ç¾¤ä¸­è¿è¡Œçš„Podæ•°é‡ï¼‰\næ‰§è¡Œæ“ä½œï¼ˆå¢å‡Podï¼‰\næ›´æ–°èµ„æºçŠ¶æ€ï¼ˆstatuså­—æ®µï¼‰\n\nå’ŒHelmå¯¹æ¯”ï¼ŸåŒºåˆ«ä¸åœºæ™¯\n\nHelmï¼šé€‚åˆé™æ€é…ç½®çš„åŒ…ç®¡ç†å·¥å…·ï¼ˆå¦‚ä¸€æ¬¡æ€§éƒ¨ç½²åº”ç”¨ï¼‰\nOperatorï¼šé€‚åˆçš„åŠ¨æ€ã€æŒç»­ç®¡ç†çš„åœºæ™¯ï¼ˆå¦‚è‡ªåŠ¨ä¿®å¤æ•…éšœèŠ‚ç‚¹ï¼‰\n\n","categories":["Kubernetes"],"tags":["Kubernetes","Operator"]},{"title":"BIND9 DNSæ™ºèƒ½è§£æå®éªŒ","url":"/2025/12/08/BIND9%20DNS%E6%99%BA%E8%83%BD%E8%A7%A3%E6%9E%90%E5%AE%9E%E9%AA%8C/","content":"BINDï¼ˆBerkeley Internet Name Domainï¼‰  æ˜¯å…¨çƒä½¿ç”¨æœ€å¹¿æ³›çš„ DNS æœåŠ¡å™¨è½¯ä»¶ï¼Œæœ€åˆç”±åŠ å·å¤§å­¦ä¼¯å…‹åˆ©åˆ†æ ¡å¼€å‘ï¼Œç›®å‰ç”± ISCï¼ˆInternet Systems Consortiumï¼‰  ç»´æŠ¤ã€‚\nBIND9 è®©ä¸€å°æœåŠ¡å™¨å¯ä»¥å……å½“ DNS è§£æå™¨ï¼ˆé€’å½’ï¼‰æˆ–æƒå¨æœåŠ¡å™¨ï¼ˆå‘å¸ƒåŸŸåè§£æè®°å½•ï¼‰\nç›®æ ‡åŸºäºbind9çš„viewåŠŸèƒ½ï¼Œå®ç°DNSçš„æ™ºèƒ½è§£æã€‚\n\nmasterå’Œä¸¤ä¸ªslaveä¹‹é—´å®ç°ä¸»ä»åŒæ­¥\nslave-1å’Œslave-2å‡æä¾›å¯¹www.a.comçš„è§£æï¼Œå…¶ä¸­slave-1è§£æwwwè‡³1.1.1.1ï¼›slave-2è§£æwwwè‡³2.2.2.2\n\nç¯å¢ƒå®¹å™¨\n\nbind-masterï¼š172.28.0.2\nbind-slave-1ï¼š172.28.0.3\nbind-slave-2ï¼š172.28.0.4\n\nzoneï¼ša.com\nåŸŸåï¼šwww.a.com\n\nbind-slave-1è§†å›¾ï¼š1.1.1.1\nbind-slave-2è§†å›¾ï¼š2.2.2.2\n\næƒå¨NSï¼šns1.a.comï¼ˆ172.28.0.2ï¼‰\nNSï¼šns2.a.comï¼ˆ172.28.0.3ã€172.28.0.4ï¼‰\nç›®å½•ç»“æ„root@RainYun-8iZCjURn:/home/bind9-2# tree ..â”œâ”€â”€ docker-compose.ymlâ”œâ”€â”€ masterâ”‚Â Â  â”œâ”€â”€ configâ”‚Â Â  â”‚Â Â  â”œâ”€â”€ named.confâ”‚Â Â  â”‚Â Â  â””â”€â”€ rndc.keyâ”‚Â Â  â””â”€â”€ zonesâ”‚Â Â      â”œâ”€â”€ a.com.zone.1â”‚Â Â      â”œâ”€â”€ a.com.zone.2â”‚Â Â      â””â”€â”€ named.logâ”œâ”€â”€ slave-1â”‚Â Â  â”œâ”€â”€ configâ”‚Â Â  â”‚Â Â  â””â”€â”€ named.confâ”‚Â Â  â””â”€â”€ zonesâ””â”€â”€ slave-2    â”œâ”€â”€ config    â”‚Â Â  â””â”€â”€ named.conf    â””â”€â”€ zones\n\ndocker-compose.ymlversion: &quot;3.9&quot;services:  bind-master:    image: internetsystemsconsortium/bind9:9.18    container_name: bind-master    restart: always    entrypoint: /bin/sh    tty: true    stdin_open: true    ports:      - &quot;253:53/tcp&quot;      - &quot;253:53/udp&quot;    volumes:      - ./master/config:/etc/bind      - ./master/zones:/var/lib/bind    environment:      - TZ=Asia/Shanghai    networks:      bindnet:        ipv4_address: 172.28.0.2  bind-slave-1:    image: internetsystemsconsortium/bind9:9.18    container_name: bind-slave-1    restart: always    ports:      - &quot;153:53/tcp&quot;      - &quot;153:53/udp&quot;    volumes:      - ./slave-1/config:/etc/bind    environment:      - TZ=Asia/Shanghai    depends_on:      - bind-master    networks:      bindnet:        ipv4_address: 172.28.0.3  bind-slave-2:    image: internetsystemsconsortium/bind9:9.18    container_name: bind-slave-2    restart: always    ports:      - &quot;353:53/tcp&quot;      - &quot;353:53/udp&quot;    volumes:      - ./slave-2/config:/etc/bind    environment:      - TZ=Asia/Shanghai    depends_on:      - bind-master    networks:      bindnet:        ipv4_address: 172.28.0.4networks:  bindnet:    driver: bridge    ipam:      config:        - subnet: 172.28.0.0/16\n\né…ç½®masteræ·»åŠ zoneï¼Œé…ç½®ä¸»ä»options &#123;\t// bindå·¥ä½œç›®å½•ï¼Œæ‰€æœ‰zoneæ–‡ä»¶ã€æ—¥å¿—æ–‡ä»¶éƒ½ä¼šåœ¨è¿™ä¸ªç›®å½•ä¸‹æ‰¾    directory &quot;/var/lib/bind&quot;;\t\t// bindç›‘å¬çš„ ipv4 åœ°å€    listen-on &#123; any; &#125;;    listen-on-v6 &#123; any; &#125;;\t// æŒ‡å®šå…è®¸å“ªäº›å®¢æˆ·ç«¯å‘è¯¥æœåŠ¡å™¨å‘èµ·æŸ¥è¯¢ï¼ˆQueryï¼‰ï¼Œå¯¹äºé€’å½’DNSä¸è¦ä½¿ç”¨any    allow-query &#123; any; &#125;;\t\t// æ˜¯å¦å…è®¸é€’å½’æŸ¥è¯¢    recursion no;\t\t// æ§åˆ¶æ˜¯å¦å¯ç”¨DNSSECç­¾åéªŒè¯ï¼Œé€’å½’æœåŠ¡å™¨æ—¶é€‚åˆå¼€å¯ï¼Œæƒå¨ä¸€èˆ¬ä¸ç”¨    dnssec-validation no;    \t// éšè—bindç‰ˆæœ¬å·\tversion &quot;hidden&quot;;&#125;;// å®šä¹‰ IP æºacl &quot;slave1&quot; &#123; 172.28.0.3; &#125;;acl &quot;slave2&quot; &#123; 172.28.0.4; &#125;;// å®šä¹‰è§†å›¾view &quot;view1&quot; &#123;\t// å…è®¸è®¿é—®zoneçš„IPæ¥æº    match-clients &#123; slave1; &#125;;\t    zone &quot;a.com&quot; &#123;        type master;\t\t\t\t// zone fileå­˜å‚¨è·¯å¾„        file &quot;/var/lib/bind/a.com.zone.1&quot;;        \t\t// å…è®¸åŒºåŸŸæ–‡ä»¶ä¼ è¾“çš„IPåœ°å€\t\tallow-transfer &#123; 172.28.0.3; &#125;;\t\t\t\t// zone fileå˜æ›´åä¸»åŠ¨é€šçŸ¥ slave        also-notify &#123; 172.28.0.3; &#125;;    &#125;;&#125;;view &quot;view2&quot; &#123;    match-clients &#123; slave2; &#125;;    zone &quot;a.com&quot; &#123;        type master;        file &quot;/var/lib/bind/a.com.zone.2&quot;;        allow-transfer &#123; 172.28.0.4; &#125;;        also-notify &#123; 172.28.0.4; &#125;;    &#125;;&#125;;\n\næ·»åŠ bind-slave-1è§†å›¾çš„zone file# æ·»åŠ è®°å½•;; BIND Zone File;; $TTL 5 è¡¨ç¤ºè¯¥DNSè¡¨é¡¹åœ¨clientçš„ç¼“å­˜æ—¶é—´ä¸º5s;; Refresh è¡¨ç¤ºslaveä¸masteråŒæ­¥çš„æ—¶é—´; Retry    è¡¨ç¤ºslaveä¸masteræ–­è¿åï¼Œå¤šä¹…è¿›è¡Œé‡è¿æ£€æŸ¥; Expire    è¡¨ç¤ºslaveä¸masteræ–­è¿å¤šä¹…åï¼Œè¯¥åŒºåŸŸå¤±æ•ˆ; Negative Cache TTL è¡¨ç¤ºæŸ¥è¯¢çš„æ•°æ®ä¸å­˜åœ¨æ—¶ï¼Œè¿™ä¸ªå¦å®šçš„å›ç­”åœ¨å…¶ä»–æœåŠ¡å™¨çš„ç¼“å­˜æ—¶é—´; @ä»£è¡¨å½“å‰$ORIGINï¼ˆzoneçš„æ ¹ï¼Œé€šå¸¸æ˜¯zoneæ–‡ä»¶å£°æ˜çš„åŸŸåï¼Œä¾‹å¦‚a.comï¼‰; IN è¡¨ç¤º Internet class; SOAï¼ˆStart Of Authorityï¼‰è®°å½•zoneçš„å…ƒæ•°æ®; Serialå¾ˆå…³é”®ï¼Œç”¨æ¥åˆ¤å®šzoneæ˜¯å¦æ›´æ–°ï¼ˆslaveåªåœ¨masterçš„serialå¢å¤§æ—¶æ‹‰å–æ›´æ–°ï¼‰ï¼Œé€šå¸¸ä¸ºæ—¥æœŸé£æ ¼YYYYMMDDNN; NSå£°æ˜è´Ÿè´£è¯¥zoneçš„æƒå¨name server; æœ«å°¾çš„.è¡¨ç¤ºå®Œæ•´åŸŸåï¼ˆç»å¯¹åç§°ï¼‰ï¼Œå¦‚æœæ²¡æœ‰æœ«å°¾ç‚¹ä¼šè¢«å½“ä½œç›¸å¯¹åç§°ï¼Œè¿½åŠ å½“å‰ $ORIGINï¼šns1 â†’ ns1.a.com.; å¸¸è§çš„å…¶ä»–è®°å½•ï¼šCNAMEã€MXï¼ˆé‚®ç®±ï¼‰ï¼ŒTXTï¼ˆæ–‡æœ¬è®°å½•ï¼‰ã€SRVï¼ˆæœåŠ¡å®šä½è®°å½•ï¼‰ã€PTRï¼ˆåå‘è§£æï¼‰$TTL 1H@   IN  SOA ns1.a.com. admin.a.com. (        2025102304 ; Serial        1H        15M        1W        1H )    IN  NS ns1.a.com.    IN  NS ns2.a.com.ns1 IN  A 172.28.0.2ns2 IN  A 172.28.0.3; slave-1 è§†å›¾wwwå¯¹åº” 1.1.1.1www IN  A 1.1.1.1\n\næ·»åŠ bind-slave-2è§†å›¾çš„zone file$TTL 1H@   IN  SOA ns1.a.com. admin.a.com. (        2025102305 ; Serial        1H        15M        1W        1H )    IN  NS ns1.a.com.    IN  NS ns2.a.com.ns1 IN  A 172.28.0.2ns2 IN  A 172.28.0.4www IN  A 2.2.2.2\n\nslaveoptions &#123;    directory &quot;/var/cache/bind&quot;;    listen-on &#123; any; &#125;;    listen-on-v6 &#123; any; &#125;;    allow-query &#123; any; &#125;;    recursion no;    dnssec-validation no;    version &quot;hidden&quot;;&#125;;zone &quot;a.com&quot; &#123;    type slave;    masters &#123; 172.28.0.2; &#125;;    file &quot;slaves/a.com.zone&quot;;&#125;;logging &#123;    channel default_log &#123;        file &quot;/var/cache/bind/named.log&quot; versions 3 size 5m;        severity info;        print-time yes;    &#125;;    category default &#123; default_log; &#125;;&#125;;\n\néªŒè¯slave-1è§£ædig @172.28.0.3 www.a.com\n\n\nslave-2è§£ædig @172.28.0.4 www.a.com\n\nå¯ä»¥çœ‹åˆ°è§£æè‡³2.2.2.2\n\næ³¨æ„ç‚¹å®¹å™¨é‡å¯å®éªŒé‡‡ç”¨internetsystemsconsortium/bind9:9.18â€‹é•œåƒï¼Œè¯¥é•œåƒçš„entrypointâ€‹ä¸º\n/usr/sbin/named -u bind -f -c /etc/bind/named.conf -L /var/log/bind/default.log\n\nå½“é…ç½®æ–‡ä»¶named.confâ€‹è¯­æ³•å‡ºç°é—®é¢˜æˆ–æ–‡ä»¶æƒé™ä¸æ­£ç¡®æ—¶ï¼Œå®¹å™¨ä¼šé‡å¯ï¼Œä¸”æ—¥å¿—ä¸ä¼šè¾“å‡ºåˆ°æ ‡å‡†è¾“å‡ºä¸Šï¼Œä¹Ÿå°±æ˜¯è¯´é€šè¿‡docker logæ˜¯çœ‹ä¸åˆ°æ—¥å¿—çš„ã€‚\nâ€\nè¿™æ—¶æˆ‘ä»¬å¯ä»¥ä¿®æ”¹entrypointâ€‹ä¸º/bin/shâ€‹ï¼Œæ‰‹åŠ¨è¿›å…¥å®¹å™¨è¿›è¡Œè°ƒè¯•ï¼Œé€šè¿‡namedå‘½ä»¤æ¥å¯åŠ¨æœåŠ¡ã€‚\né…ç½®æ–‡ä»¶æƒé™ä¸æ­£ç¡®22-Oct-2025 12:37:11.678 ---------------------------------------------------- 22-Oct-2025 12:37:11.678 adjusted limit on open files from 1073741816 to 104857622-Oct-2025 12:37:11.678 found 2 CPUs, using 2 worker threads22-Oct-2025 12:37:11.678 using 2 UDP listeners per interface22-Oct-2025 12:37:11.682 DNSSEC algorithms: RSASHA1 NSEC3RSASHA1 RSASHA256 RSASHA512 ECDSAP256SHA256 ECDSAP384SHA384 ED25519 ED44822-Oct-2025 12:37:11.682 DS algorithms: SHA-1 SHA-256 SHA-38422-Oct-2025 12:37:11.682 HMAC algorithms: HMAC-MD5 HMAC-SHA1 HMAC-SHA224 HMAC-SHA256 HMAC-SHA384 HMAC-SHA51222-Oct-2025 12:37:11.682 TKEY mode 2 support (Diffie-Hellman): yes22-Oct-2025 12:37:11.682 TKEY mode 3 support (GSS-API): yes22-Oct-2025 12:37:11.682 the initial working directory is &#x27;/&#x27;22-Oct-2025 12:37:11.682 loading configuration from &#x27;/etc/bind/named.conf&#x27; 22-Oct-2025 12:37:11.686 directory &#x27;/var/lib/bind&#x27; is not writable22-Oct-2025 12:37:11.686 /etc/bind/named.conf:2: parsing failed: permission denied22-Oct-2025 12:37:11.686 loading configuration: permission denied22-Oct-2025 12:37:11.686 exiting (due to fatal error)\n\nè°ƒè¯•ç”¨ï¼Œæœ€ç›´æ¥çš„æ–¹å¼æ˜¯ç»™777\npsï¼šç»™è¿‡755ï¼Œè€Œä¸”æ–‡ä»¶æƒé™å±äºbind:bindï¼Œæˆ‘åœ¨æµ‹è¯•æ—¶è¿˜æ˜¯æ²¡æœ‰å†™æƒé™ã€‚\nrndc reloadå¯†é’¥é—®é¢˜rndcâ€‹ æ˜¯ BIND çš„è¿œç¨‹æ§åˆ¶å·¥å…·ï¼ˆRemote Name Daemon Controlï¼‰\nå¯ä»¥ç”¨æ¥è®©æ­£åœ¨è¿è¡Œçš„ namedâ€‹ï¼š\n\né‡æ–°åŠ è½½é…ç½®æ–‡ä»¶æˆ– zone (rndc reloadâ€‹)\né‡æ–°ç­¾å DNSSEC\næ¸…ç†ç¼“å­˜\nåœæ­¢&#x2F;å¯åŠ¨æœåŠ¡ç­‰\n\nâ€\nå½“ä¿®æ”¹zone fileï¼ˆå¢åŠ æˆ–åˆ é™¤è§£æè®°å½•ï¼‰ã€SOAåºåˆ—å·ï¼ˆSerialï¼‰éœ€è¦è‡ªå¢1\nç„¶åä½¿ç”¨rndc reloadåˆ·æ–°é…ç½®\nå¦‚æœé‡åˆ°\n/ # rndc reload a.com rndc: neither /etc/bind/rndc.conf nor /etc/bind/rndc.key was found\n\néœ€è¦æ·»åŠ rndc.keyâ€‹\ncd /etc/bindrndc-confgen -a -b 512\n\nç„¶åå¯¹ç”Ÿæˆçš„rndc.keyâ€‹èµ‹äºˆæƒé™\nchown bind:bind /etc/bind/rndc.keychmod 600 /etc/bind/rndc.key\n\nç†è®ºèµ‹ä¸Šé¢çš„æƒé™ï¼Œä½†æ˜¯æµ‹è¯•æ—¶ç»å¸¸æç¤ºæ— å†™å…¥æƒé™ï¼Œæ‰€ä»¥å°±ç›´æ¥777äº†\nâ€\n","categories":["æœåŠ¡å™¨è¿ç»´"],"tags":["æœåŠ¡å™¨è¿ç»´","DNS"]},{"title":"Gitlab CICDå­¦ä¹ è®°å½•","url":"/2025/12/08/Gitlab%20CICD%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/","content":"Gitlab CICDå­¦ä¹ è®°å½•ç”¨Flaskåœ¨K8sé›†ç¾¤ç¼–å†™åç«¯é¡¹ç›®ç¼–å†™app.pyç¼–å†™ä¸€ä¸ªæœ€ç®€å•çš„åç«¯é¡¹ç›®ï¼Œå‘½åä¸ºapp.pyï¼Œè¿”å›hello world!\nfrom flask import Flaskapp = Flask(__name__)@app.route(&#x27;/&#x27;)def hello():    return &quot;hello world!&quot;if __name__ == &#x27;__main__&#x27;:    app.run(host=&#x27;0.0.0.0&#x27;, port=8080)\n\nç”¨pipreqså¯¼å‡ºä¾èµ–æ–‡ä»¶pip3 install pipreqs\n\npipreqs . --encoding=utf8 --force\n\n\næ„å»ºDockeré•œåƒç¼–å†™dockerfile\nFROM python:3.9WORKDIR /appCOPY requirements.txt .RUN pip install --no-cache-dir -r requirements.txtCOPY . .CMD [&quot;python&quot;,&quot;app.py&quot;]\n\ndocker build -t beatrueman/ci:2.0 .\n\nä¸Šä¼ é•œåƒ\ndocker push beatrueman/ci:2.0\n\nK8sé›†ç¾¤éƒ¨ç½²åç«¯æœåŠ¡ä½¿ç”¨å‘½ä»¤åˆ›å»ºPodã€‚åˆ›å»ºä¸€ä¸ªåä¸ºflask-hello-worldçš„Podï¼Œå¹¶å°†å®¹å™¨çš„ç«¯å£æ˜ å°„åˆ°ä¸»æœºçš„ç«¯å£8080ã€‚\nkubectl run flask-hello-world --image=beatrueman/ci:2.0 --port=8080 \n\n\nä½¿ç”¨å‘½ä»¤æš´éœ²æœåŠ¡ã€‚ä»¥LoadBalancerç±»å‹åˆ›å»ºæœåŠ¡ï¼Œæ˜ å°„åˆ°Podçš„8080ç«¯å£\nkubectl expose pod flask-hello-world --type=LoadBalancer --port=80 --target-port=8080\n\næŸ¥çœ‹æœåŠ¡\nkubectl get service flask-hello-world\n\n\nå¼€æ”¾32091ç«¯å£ï¼Œè®¿é—®å¤–éƒ¨ip\n\n\næˆåŠŸ\nå®‰è£…runnerè·å–registration-token\nä½¿ç”¨dockerå®‰è£…runnerå®‰è£…docker run -d --name gitlab-runner --restart always \\  -v /srv/gitlab-runner/config:/etc/gitlab-runner \\  -v /var/run/docker.sock:/var/run/docker.sock \\  gitlab/gitlab-runner:latest\n\næ³¨å†Œdocker exec -it gitlab-runner bash\n\ngitlab-runner register \\--non-interactive \\--url &quot;https://gitlab.com/&quot; \\--registration-token &quot;GR1348941F_CsNBNspPP2DccgUVcx&quot; \\ --executor &quot;docker&quot; \\--docker-image ubuntu:22.04 \\--description &quot;docker-runner&quot; \\--maintenance-note &quot;Free-form maintainer notes about this runner&quot; \\--tag-list &quot;docker&quot; \\--run-untagged=&quot;true&quot; \\--locked=&quot;false&quot; \\--access-level=&quot;not_protected&quot;\n\næˆåŠŸ\n\n#ä¸€ç›´æŠŠregistration-tokenå½“æˆrunneré‡Œçš„tokenäº†ï¼Œå¯¼è‡´åé¢ä¸åœæŠ¥é”™#\nä½¿ç”¨helmå®‰è£…runnerï¼ˆå¤±è´¥ï¼‰ä¸‹è½½packageå¹¶è§£å‹helm repo add gitlab https://charts.gitlab.iohelm pull gitlab/gitlab-runnertar -zxvf gitlab-runner-0.53.2.tgz\n\næ–‡ä»¶ç›®å½•å¦‚ä¸‹\n\né…ç½®tokenå¡«å…¥å’Œdockeré‰´æƒapiVersion: v1kind: Secretmetadata:  name: gitlab-runner-secrettype: Opaquedata:# é…ç½®runnerçš„token  runner-registration-token: &quot;R1IxMzQ4OTQxRl9Dc05CTnNwUFAyRGNjZ1VWY3gK&quot; # å°†tokenè½¬ä¸ºbase64åå†™è¿™é‡Œ  runner-token: &quot;&quot;---apiVersion: v1data:# é…ç½®dockerçš„config.json  .dockerconfigjson: &quot;ewogICAgICAgICJhdXRocyI6IHsKICAgICAgICAgICAgICAgICJodHRwczovL2luZGV4LmRvY2tlci5pby92MS8iOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICJhdXRoIjogIlltVmhkSEoxWlcxaGJqcHNlWGd3TXpBNU1UWT0iCiAgICAgICAgICAgICAgICB9CiAgICAgICAgfQp9Cgo=&quot;kind: Secretmetadata:  name: regsecrettype: kubernetes.io/dockerconfigjson\n\nåœ¨values.yamlä¸­åº”ç”¨é…ç½®æ–‡ä»¶gitlabUrl: https://gitlab.com/Beatrueman/test.gitrunners:# åœ¨è¿™é‡ŒæŒ‡å®šæˆ‘ä»¬åˆšåˆšåˆ›å»ºçš„secret  secret: gitlab-runner-secret  imagePullSecrets: regsecret  tags: &quot;k8s&quot;  config: |    [[runners]]      [runners.kubernetes]        namespace = &quot;&#123;&#123;.Release.Namespace&#125;&#125;&quot;        image = &quot;ubuntu:20.04&quot;\n\né•œåƒä¸Šä¼ è‡ªå®šä¹‰kanikoé•œåƒæå‰åœ¨CI&#x2F;CD &gt; Variablesä¸‹è®¾ç½®å¥½å˜é‡\n\nåœ¨/root/kanikoä¸‹ç¼–å†™dockerfileå’Œbuild-upload\n\ndockerfile\nFROM lonewalkerchr/kaniko:debugCOPY ./build-upload /kaniko/build-uploadSHELL [&quot;/busybox/sh&quot;]RUN [&quot;/busybox/chmod&quot;, &quot;a+x&quot;, &quot;/kaniko/build-upload&quot;]\n\nbuild-upload\nprintf &quot;%s&quot; &quot;$&#123;DOCKER_AUTH&#125;&quot; &gt; /kaniko/.docker/config.json/kaniko/executor \\     --force \\     --cache \\     --context &quot;$&#123;CI_PROJECT_DIR&#125;&quot; \\     --dockerfile dockerfile \\     --destination $&#123;destination&#125;\n\næ„å»ºé•œåƒå¹¶ä¸Šä¼ è‡³dockerhub\ndocker build -t beatrueman/kaniko:1.0 .docker push beatrueman/kaniko:1.0\n\nä¸Šä¼ ä»£ç åˆ›å»ºå¹¶é…ç½®.gitlab-ci.yamlæ·»åŠ KUBE_CONFIGå˜é‡ï¼Œå†…å®¹ä¸º~/.kube/configçš„å†…å®¹\n\nåˆ›å»ºå¹¶é…ç½®.gitlab-ci.yaml\nstages:  - build  - deployimagebuilder:  image: beatrueman/ci:kaniko  stage: build  variables:    destination: beatrueman/ci:2.0  script:    - /kaniko/build-uploaddeploy:  image: bitnami/kubectl  stage: deploy  script:    - echo $&#123;KUBE_CONFIG&#125; &gt; kubeconfig    - kubectl run flask-hello-world --image=beatrueman/ci:2.0 --port=8080     - kubectl expose pod flask-hello-world --type=LoadBalancer --port=80 --target-port=8080\n\nä¸Šä¼ åˆ°ä»“åº“git initgit add .git commit -m &quot;first&quot;git remote add origin https://gitlab.com/Beatrueman/test-ci.gitgit push -u origin master\n\n\né—®é¢˜ä¸è§£å†³1.æ„å»ºDockeré•œåƒæ—¶CMDçš„æ—¶å€™å°‘äº†ä¸€ä¸ªåå¼•å·ï¼ŒæŠ˜è…¾äº†åŠå¤©ã€‚#æ„Ÿè°¢ä¸€ä¸‹æ¨é‘«åŒå­¦äº†ï¼Œå¤šäºäº†ä»–çš„æ…§çœ¼ã€‚\n2.å®‰è£…runneræ—¶ç”¨çš„æ˜¯registration-tokenï¼Œä¸æ˜¯åˆ›å»ºrunneræ—¶å€™çš„tokenã€‚\n3.${CI_PROJECT_DIR}å˜é‡æ˜¯è‡ªå¸¦çš„ï¼Œæ˜¯runneré‡Œé¢çš„ä¸€ä¸ªä¸å›ºå®šçš„ä½ç½®ï¼Œå¯ä»¥é€šè¿‡å®ƒæ¥æ‰¾åˆ°ç»å¯¹è·¯å¾„ï¼Œä¸èƒ½è‡ªè¡ŒæŒ‡å®šï¼Œä¸ç„¶ä¼šæ‰¾ä¸åˆ°æ–‡ä»¶å¯¼è‡´æŠ¥é”™ã€‚\n\npip install -i https://pypi.tuna.tsinghua.edu.cn/simple\n\npipå®‰è£…çš„æ—¶å€™ä½¿ç”¨-iæŒ‡å®šé•œåƒæºï¼Œä¸‹è½½é€Ÿåº¦ä¼šæå‡å¾ˆå¤šå¾ˆå¤šã€‚\n5..gitlab-ci.yamlé‡ŒdeployåŠ entrypointè¦†ç›–ã€‚\n\n6..gitlab-ci.yamlé‡Œdeployé˜¶æ®µæ‰§è¡Œkubectlå‘½ä»¤å»ºè®®æ¯æ¡å‘½ä»¤éƒ½åŠ â€“kuboeconfig&#x3D;.&#x2F;kubeconfigï¼Œä¿è¯æ¯æ¡å‘½ä»¤éƒ½æœ‰æƒé™ã€‚\n","categories":["æœåŠ¡å™¨è¿ç»´"],"tags":["æœåŠ¡å™¨è¿ç»´","CICD"]},{"title":"NLPè¯­ä¹‰åŒ¹é…å­¦ä¹ èµ›è®°å½•","url":"/2025/12/08/NLP%E8%AF%AD%E4%B9%89%E5%8C%B9%E9%85%8D%E8%AE%B0%E5%BD%95/","content":"èµ›é¢˜ä»‹ç»èƒŒæ™¯æœ¬æ¬¡é¡¹ç›®æ¥æºäºé˜¿é‡Œäº‘å¤©æ± çš„æ—¥å¸¸å­¦ä¹ èµ›ï¼šã€NLPç³»åˆ—å­¦ä¹ èµ›ã€‘è¯­éŸ³åŠ©æ‰‹ï¼šå¯¹è¯çŸ­æ–‡æœ¬è¯­ä¹‰åŒ¹é…_å­¦ä¹ èµ›_å¤©æ± å¤§èµ›-é˜¿é‡Œäº‘å¤©æ± çš„æ’è¡Œæ¦œ\nèƒŒæ™¯æ˜¯OPPOå…¬å¸æœ‰ä¸€ä¸ªè¯­éŸ³åŠ©æ‰‹ï¼Œè¿™ä¸ªè¯­éŸ³åŠ©æ‰‹éœ€è¦æ ¹æ®å¯¹è¯æ¥è¯†åˆ«æ„å›¾ã€‚èµ›é¢˜è¦æ±‚æ˜¯å‚èµ›é˜Ÿä¼éœ€è¦æ ¹æ®è„±æ•åçš„çŸ­æ–‡æœ¬query-pairï¼Œæ¥é¢„æµ‹ä»–ä»¬æ˜¯å¦å±äºåŒä¸€è¯­ä¹‰ï¼Œæœ€ç»ˆæäº¤ä¸€ä¸ªé¢„æµ‹æ¦‚ç‡æ–‡ä»¶æ¥è¿›è¡Œè¯„æµ‹ã€‚\nç®€å•æ¥è¯´å°±æ˜¯æä¾›äº†ä¸¤å¥è¯ï¼Œéœ€è¦åˆ¤æ–­è¿™ä¸¤å¥è¯æ˜¯ä¸æ˜¯åŒä¸€ä¸ªæ„æ€ï¼ˆè¯­ä¹‰åŒ¹é…ï¼‰ã€‚\næ¯”å¦‚ç”¨ä¸‹é¢çš„å‡ ä¸ªè®­ç»ƒæ ·æœ¬æ¥ä¸¾ä¾‹ï¼š\nè‚–æˆ˜çš„ç²‰ä¸å«ä»€ä¹ˆåå­— è‚–æˆ˜çš„ç²‰ä¸å«ä»€ä¹ˆ 1ç‹è€…è£è€€é‡Œé¢æ‰“é‡è°æœ€å‰å®³ ç‹è€…è£è€€ä»€ä¹ˆè‹±é›„æœ€å¥½ç© 0æˆ‘æƒ³æ¢ä¸ªæ‰‹æœº æˆ‘è¦æ¢æ‰‹æœº 1æˆ‘æ˜¯å¼ ç¿ æˆ‘æƒ³å¼ ç¿ 0ä¸æƒ³ ä¸æƒ³è¯´ 0\n\nå¯ä»¥çœ‹åˆ°æ„æ€å®Œå…¨ä¸åŒçš„ä¸¤å¥è¯ï¼Œæœ€ç»ˆçœŸå€¼æ ‡ç­¾è¾“å‡º0ï¼Œè¡¨ç¤ºä¸åŒ¹é…ã€‚è€Œæ„æ€ç›¸åŒçš„ä¸¤å¥è¯ï¼Œæœ€ç»ˆçœŸå€¼æ ‡ç­¾è¾“å‡º1ã€‚\næäº¤æœ€ç»ˆéœ€è¦æäº¤ä¸€ä»½é¢„æµ‹ç»“æœæ–‡ä»¶ï¼Œç»“æœæ–‡ä»¶ä¸­æ¯è¡Œä¸ºä¸€ä¸ª0-1çš„é¢„æµ‹å€¼ï¼Œä»£è¡¨query-lairè¯­ä¹‰åŒ¹é…çš„æ¦‚ç‡ï¼Œä¸æµ‹è¯•æ•°æ®æ¯è¡Œä¸€ä¸€å¯¹åº”ã€‚\n0.0010.999\n\nè¯„ä¼°\nèµ›é¢˜è§£ææœ¬èµ›é¢˜å±äºè‡ªç„¶è¯­è¨€å¤„ç†ï¼ˆNLPï¼‰é¢†åŸŸçš„æ–‡æœ¬åŒ¹é…&#x2F;è¯­ä¹‰ç›¸ä¼¼åº¦åˆ†ç±»ä»»åŠ¡ã€‚ç»™å®šä¸¤æ®µè„±æ•åçš„çŸ­æ–‡æœ¬ï¼ˆquery-pairï¼‰ï¼Œç³»ç»Ÿéœ€è¦åˆ¤æ–­å®ƒä»¬æ˜¯å¦è¡¨è¾¾ç›¸åŒæˆ–ç›¸è¿‘çš„è¯­ä¹‰ï¼Œå¹¶è¾“å‡ºäºŒåˆ†ç±»ç»“æœã€‚\néš¾ç‚¹ä¸æŒ‘æˆ˜\næ–‡æœ¬è„±æ•ï¼šåŸå§‹è¯è¯­è¢«æ›¿æ¢ä¸ºæ•°å­—IDï¼Œæ¨¡å‹å°±æ— æ³•ç›´æ¥ä½¿ç”¨è¯ä¹‰ä¿¡æ¯ï¼Œåªèƒ½ä»æ•°å­—åºåˆ—ä¸­å­¦ä¹ æ½œåœ¨çš„è¯­ä¹‰æ¨¡å¼ã€‚\nå¦‚æœç›´æ¥æä¾›äº†æ–‡æœ¬ï¼Œé‚£é—®é¢˜éå¸¸ç®€å•ï¼Œç›´æ¥ä½¿ç”¨bert-base-chineseè¿™ç§é¢„è®­ç»ƒä¸­æ–‡æ¨¡å‹å°±èƒ½å¾—åˆ°å¾ˆå¥½çš„ç»“æœï¼Œä½†æ˜¯è¿™ç§è„±æ•æ•°æ®ï¼Œç”±äºä¸çŸ¥é“è¯è¡¨ï¼Œå°±æ— æ³•ä½¿ç”¨å¼€æºçš„é¢„è®­ç»ƒæ¨¡å‹ã€‚\n\nå¥å­æˆå¯¹è¾“å…¥ï¼šä»»åŠ¡éœ€è¦åŒæ—¶ç†è§£ä¸¤æ®µæ–‡æœ¬å¹¶è¿›è¡Œæ¯”è¾ƒï¼Œè€Œä¸ä»…ä»…æ˜¯å•å¥åˆ†ç±»ã€‚\n\næ•°å­—IDåˆ†å¸ƒä¸å‡ï¼šé«˜é¢‘è¯å’Œä½é¢‘è¯çš„æ•°æ®å·®å¼‚å¾ˆå¤§ï¼Œéœ€è¦åˆç†çš„enmeddingåˆå§‹åŒ–ç­–ç•¥ï¼Œé¿å…ä½é¢‘æ•°å­—å½±å“è®­ç»ƒæ•ˆæœ\n\nå¥å­é•¿åº¦å’Œå¤æ‚å…³ç³»ï¼šç®€å•æ¨¡å‹éš¾ä»¥æ•è·è¿œè·ç¦»ä¾èµ–ï¼Œéœ€è¦ä½¿ç”¨èƒ½å¤Ÿå»ºæ¨¡å…¨å±€ä¿¡æ¯çš„ç½‘ç»œç»“æœï¼ˆæ¯”å¦‚Transformerã€BiLSTMç­‰ï¼‰\n\n\næ•°æ®é›†ç»“æ„åˆ†ææä¾›äº†4ä¸ª.tsvæ•°æ®é›†ï¼Œå­¦ä¹ èµ›é‡‡ç”¨gaiic_track3_round1_testB_20210317.tsvâ€‹æ¥åšä¸ºæµ‹è¯•é›†ã€‚\ngaiic_track3_round1_testA_20210228.tsvgaiic_track3_round1_testB_20210317.tsvgaiic_track3_round1_train_20210228.tsv # è®­ç»ƒæ ·æœ¬10ä¸‡gaiic_track3_round2_train_20210407.tsv # å¤èµ›è®­ç»ƒæ ·æœ¬30ä¸‡\n\nå¯¹äºè®­ç»ƒé›†ï¼Œæ¯è¡Œä¸ºä¸€ä¸ªè®­ç»ƒæ ·æœ¬ï¼Œç”±query-pairå’ŒçœŸå€¼ç»„æˆï¼Œæ¯è¡Œæ ¼å¼å¦‚ä¸‹ï¼š\n\nquery-pairæ ¼å¼ï¼šqueryä»¥ä¸­æ–‡ä¸ºä¸»ï¼Œä¸­é—´å¯èƒ½å¸¦æœ‰å°‘é‡è‹±æ–‡å•è¯ï¼ˆå¦‚è‹±æ–‡ç¼©å†™ã€å“ç‰Œè¯ã€è®¾å¤‡å‹å·ç­‰ï¼‰ï¼Œé‡‡ç”¨UTF-8ç¼–ç ï¼Œæœªåˆ†è¯ï¼Œä¸¤ä¸ªqueryä¹‹é—´ä½¿ç”¨\\tåˆ†å‰²ã€‚\nçœŸå€¼ï¼šçœŸå€¼å¯ä¸º0æˆ–1ï¼Œå…¶ä¸­1ä»£è¡¨query-pairè¯­ä¹‰ç›¸åŒ¹é…ï¼Œ0åˆ™ä»£è¡¨ä¸åŒ¹é…ï¼ŒçœŸå€¼ä¸query-pairä¹‹é—´ä¹Ÿç”¨\\tåˆ†å‰²ã€‚\n\n72 29 68 69 70 533 1661 1877\t28 12 347 72 29 369 16\t112 453 317 43 1163 317 59 355 1024\t8 9 1847 6 1163 317 59\t012 19 1162 126 53 66\t12 19 79 389 126 53 66\t1275 552 553 433 881 338 1104 101 202 2343 14825\t995 551 550 1660 2830 1075 662 935\t0421 330 62 12 80 81 82 76\t202 62 12 80 838 76\t1177 455 456 3474 964 1364 55 1364\t133 134 2246\t129 168 12 19 1003 719 23 29 263 276\t29 23 12 115 115 263 16\t1\n\næ–¹æ¡ˆä»‹ç»é’ˆå¯¹ä¸Šè¿°éš¾ç‚¹ï¼Œæœ¬æ–¹æ¡ˆè®¾è®¡å¦‚ä¸‹ï¼š\n\nåŒå¡” Transformer ç¼–ç \n åˆ†åˆ«ç¼–ç ä¸¤æ®µæ–‡æœ¬ï¼Œèƒ½å¤Ÿæ•è·å…¨å±€è¯­ä¹‰ç‰¹å¾ï¼Œè§£å†³å¥å­é•¿åº¦å’Œå¤æ‚å…³ç³»çš„é—®é¢˜ã€‚\n\nå‘é‡èåˆè¿›è¡Œåˆ†ç±»\n å°†ä¸¤æ®µæ–‡æœ¬ç¼–ç å‘é‡è¿›è¡Œèåˆï¼Œå†è¾“å…¥ MLP åˆ†ç±»å™¨ï¼Œå®ç°å¥å­æˆå¯¹åŒ¹é…ã€‚\n\nç»“åˆé¢‘åº¦è¡¨åˆå§‹åŒ– embedding\n é’ˆå¯¹è„±æ•æ•°å­— IDï¼Œé€šè¿‡é«˜é¢‘ ID åˆå§‹åŒ– embeddingï¼Œå¸®åŠ©æ¨¡å‹å¿«é€Ÿå­¦ä¹ æœ‰æ•ˆç‰¹å¾ï¼Œç¼“è§£æ•°æ®ç¨€ç–é—®é¢˜ã€‚\n\nåˆç†è®­ç»ƒç­–ç•¥\n åˆå¹¶è®­ç»ƒé›†ã€åˆ’åˆ†éªŒè¯é›†ã€ä½¿ç”¨æ—©åœæœºåˆ¶å’Œæ‰¹é‡è®­ç»ƒï¼Œå……åˆ†åˆ©ç”¨æ•°æ®å’Œè®¡ç®—èµ„æºï¼Œæé«˜æ¨¡å‹ç¨³å®šæ€§å’Œç²¾åº¦ã€‚\n\n\nåˆ©ç”¨è¿™å¥—æ–¹æ¡ˆï¼Œæœ€ç»ˆåœ¨æ¯”èµ›å¹³å°ä¸Šè·å¾—äº†0.84çš„æœ€ç»ˆæˆç»©\n\nä»£ç ç»“æ„\n# ================= é…ç½® =================config = &#123;    &quot;max_len&quot;: 128,    &quot;batch_size&quot;: 128,    &quot;epochs&quot;: 8,    &quot;lr&quot;: 2e-4,    &quot;device&quot;: &quot;cuda&quot; if torch.cuda.is_available() else &quot;cpu&quot;,    &quot;embed_dim&quot;: 512,    &quot;num_heads&quot;: 8,    &quot;num_layers&quot;: 4,&#125;\n\nå¼ é‡è½¬æ¢ï¼šPairDatasetåŠŸèƒ½ï¼š\n\nè¯»å–å¥å­å¯¹æ•°æ®ï¼ˆq1ï¼Œq2ï¼‰\nå¤„ç†æˆå›ºå®šé•¿åº¦åºåˆ—ï¼ˆpaddingã€æˆªæ–­ï¼‰\nç”Ÿæˆattention mask\n\ninit()æ„é€ q1ã€q2ã€labelä»¥åŠæœ€å¤§åºåˆ—é•¿åº¦max_lenï¼ˆé»˜è®¤ 64ï¼Œæ¯æ¡å¥å­åªä¿ç•™ä¸€åŠé•¿åº¦ï¼Œå› ä¸ºåŒå¡”æ¨¡å‹ä¼šæ‹¼æ¥ä¸¤æ¡å¥å­ï¼Œä¿ç•™ä¸€åŠé•¿åº¦è™½ç„¶æœ‰ä¸¢å¤±ä¿¡æ¯çš„é£é™©ï¼Œä½†æ˜¯è¿™ä¹ˆåšå¯ä»¥ç¡®ä¿ä¸¤æ¡å¥å­ä¿¡æ¯å¯¹ç­‰ï¼Œæé«˜æ˜¾å­˜æ•ˆç‡ï¼Œå› ä¸ºåºåˆ—è¶Šé•¿æ˜¾å­˜å ç”¨è¶Šé«˜ï¼‰\nmax_len &#x3D; q1 + q2 + [CLS&#x2F;SEP&#x2F;padding]\nåºåˆ—å¡«å……å‡½æ•°ï¼špad_seq()åŠŸèƒ½ï¼šä¿è¯æ¯æ¡è¾“å…¥åºåˆ—é•¿åº¦å›ºå®šï¼Œè¿”å›half_len + 2çš„list\n\n[0]ç›¸å½“äº[CLS]tokenï¼Œè¡¨ç¤ºåºåˆ—å¼€å¤´\n\n[1]ç›¸å½“äº[SEP]tokenï¼Œè¡¨ç¤ºåºåˆ—ç»“å°¾\n\n[2]ç›¸å½“äº[PAD]ï¼Œä½œä¸ºå¡«å……ï¼Œä¿æŒå›ºå®šé•¿åº¦\n\n\nè·å–æ ·æœ¬å‡½æ•°ï¼šgetitem()åŠŸèƒ½ï¼šè¿”å›å¯¹åº”æ•°æ®é›†çš„è®­ç»ƒæ ¼å¼ã€‚\n\nå¦‚æœæ˜¯è®­ç»ƒé›†ï¼Œè¿”å›ï¼ˆq1,a1,q2,a2ï¼‰\nå¦‚æœæ˜¯æµ‹è¯•é›†ï¼Œè¿”å›ï¼ˆq1,a1,q2,a2,labelï¼‰\n\nè¿™é‡Œa1,a2è¡¨ç¤ºattention_maskâ€‹ï¼Œ1è¡¨ç¤ºæœ‰æ•ˆtokenï¼Œ0è¡¨ç¤ºpadding tokenâ€‹ã€‚Transformer åœ¨ç¼–ç æ—¶ç”¨ src_key_padding_mask=(attn_mask == 0)â€‹ å±è”½ paddingã€‚\nåŒå¡”Transformerï¼šSiameseTransformerä¸¤æ¡å¥å­åˆ†åˆ«ç»è¿‡ç›¸åŒç¼–ç å™¨ -&gt; å¾—åˆ°å‘é‡ -&gt; èåˆ -&gt; åˆ†ç±»\ninit()self.embedding = nn.Embedding(vocab_size, embed_dim)\n\nåŠŸèƒ½ï¼šä¸ºæ¯ä¸€ä¸ªæ•°å­—IDåˆ›å»ºä¸€ä¸ªéšæœºå‘é‡ï¼ˆé•¿åº¦ä¸º embed_dimâ€‹ï¼‰ï¼Œä¹Ÿå°±æ˜¯ vocab_sizeâ€‹ Ã— embed_dimâ€‹ çš„çŸ©é˜µã€‚ä¹‹åé€šè¿‡ init_embedding_from_freqâ€‹ ç”¨é«˜é¢‘IDå¯¹åº”çš„æ›´æœ‰æ„ä¹‰çš„å‘é‡è¿›è¡Œæ›¿æ¢ï¼Œä»¥å¸®åŠ©æ¨¡å‹æ›´å¿«å­¦åˆ°æœ‰æ•ˆè¯­ä¹‰ã€‚\n\nvocab_sizeï¼šæ•°å­—IDçš„æ€»æ•°é‡\nembed_dimï¼šæ¯ä¸ªtokenè¢«æ˜ å°„çš„å‘é‡ç»´åº¦\n\nencoder_layer = nn.TransformerEncoderLayer(    d_model=embed_dim,  # è¾“å…¥å‘é‡ç»´åº¦    nhead=num_heads,    # å¤šå¤´æ³¨æ„åŠ›çš„å¤´æ•°    dim_feedforward=embed_dim * 4, # å‰é¦ˆç½‘ç»œéšè—å±‚å¤§å°    batch_first=True, # è¾“å…¥ç»´åº¦[batch, seq_len, embed_dim]    dropout=0.1 # é˜²æ­¢è¿‡æ‹Ÿåˆï¼šéšæœºä¸¢å¼ƒéƒ¨åˆ†ç¥ç»å…ƒï¼Œä¹Ÿå°±æ˜¯éšæœºå°†10%çš„ç¥ç»å…ƒè¾“å‡ºç½®ä¸º0)self.encoder = nn.TransformerEncoder(encoder_layer, num_layers=num_layers)\n\nåŠŸèƒ½ï¼šå®šä¹‰Transformerç¼–ç å™¨\nself.mlp = nn.Sequential(    nn.Linear(embed_dim * 2, embed_dim), # ä¸¤ä¸ªå¥å­çš„å‘é‡æ‹¼æ¥ã€è¾“å…¥ 1024 (512*2)ï¼Œè¾“å‡º 512ã€‘    nn.ReLU(), # ReLUæ¿€æ´»å‡½æ•°    nn.Linear(embed_dim, 2) # åˆ†ç±»ï¼šçº¿æ€§å±‚è¾“å‡º2ä¸ªlogitï¼ˆå¯¹åº”0/1ï¼‰ã€è¾“å…¥ 512ï¼Œè¾“å‡º 2 (ç±»åˆ«æ•°)ã€‘)\n\nåŠŸèƒ½ï¼šèåˆä¸¤æ¡å¥å­çš„ç¼–ç å‘é‡å¹¶åšåˆ†ç±»\nencodeåŠŸèƒ½ï¼šæŠŠä¸€å¥è¯ä»æ•°å­—åºåˆ—ç¼–ç æˆå›ºå®šé•¿åº¦å‘é‡\n\nå°†æ•°å­—åºåˆ—è½¬æ¢ä¸ºå‘é‡åºåˆ—emb\næŠŠembç”¨Transformerç¼–ç ï¼Œæç¤ºå…¶åœ¨attm_mask&#x3D;&#x3D;0ä¸å‚ä¸è®¡ç®—ï¼Œè¾“å‡ºä¸ºout\nç„¶åå–outçš„ç¬¬ä¸€ä¸ªtokençš„å‘é‡ä½œä¸ºå¥å­è¡¨ç¤ºï¼ˆä» Transformer è¾“å‡ºçš„ä¸€é•¿ä¸²å‘é‡ä¸­ï¼Œåªå–å‡ºä¸€ä¸ªä»£è¡¨æ•´å¥è¯çš„å‘é‡ï¼‰\n\nforwardåŠŸèƒ½ï¼šæ¨¡å‹å‰å‘ä¼ æ’­\n\nå¯¹q1è¿›è¡Œencodeï¼Œå¾—åˆ°å¥å­å‘é‡v1\nå¯¹q2è¿›è¡Œencodeï¼Œå¾—åˆ°å¥å­å‘é‡v2\nä½¿ç”¨torch.catæ‹¼æ¥ä¸¤ä¸ªå‘é‡\nä½¿ç”¨mlpè¿›è¡Œåˆ†ç±»è¾“å‡º2ä¸ªlogit\n\nè®­ç»ƒï¼štrain\nè®¾ç½®è®­ç»ƒæ¨¡å¼ï¼ˆmodel.train()ï¼‰ã€ä¼˜åŒ–å™¨Adamä¸æŸå¤±å‡½æ•°ï¼ˆäº¤å‰ç†µCrossEntropyLossï¼‰\n\nè®¾ç½®æ—©åœï¼Œå½“è¿ç»­patienceè½®éªŒè¯å‡†ç¡®ç‡æ²¡æœ‰æå‡ï¼Œå°±åœæ­¢è®­ç»ƒï¼Œé™ä½è¿‡æ‹Ÿåˆé£é™©ã€‚\n best_val_aucâ€‹ï¼šè®°å½•éªŒè¯é›†çš„æœ€å¥½auc\n patienceâ€‹ï¼šæ—©åœé˜ˆå€¼ï¼Œå¦‚æœè¿ç»­ patienceâ€‹ è½®éªŒè¯å‡†ç¡®ç‡æ²¡æœ‰æå‡ï¼Œå°±åœæ­¢è®­ç»ƒ\n early_stop_counterâ€‹ï¼šè®°å½•è¿ç»­éªŒè¯æ²¡æœ‰æå‡çš„è½®æ•°\n\nå¼€å§‹epochå¾ªç¯\n æ¯æ¬¡å¾ªç¯éå†è®­ç»ƒé›†çš„æ¯ä¸ªbatchï¼ŒæŠŠæ•°æ®è½¬ç§»åˆ°GPUä¸Š\n æ¥ç€å‰å‘ä¼ æ’­ï¼šlogits = model(...)â€‹ â†’ æ¨¡å‹è¾“å‡ºæ¯ä¸ªç±»åˆ«çš„åˆ†æ•°\n è®¡ç®—æŸå¤±Loss\n æœ€ååå‘ä¼ æ’­ä¸æ¢¯åº¦æ›´æ–°\n\noptimizer.zero_grad()â€‹ æ¸…é™¤ä¸Šä¸€æ­¥æ¢¯åº¦\nloss.backward()â€‹ è®¡ç®—æ¢¯åº¦\noptimizer.step()â€‹ æ›´æ–°æ¨¡å‹å‚æ•°\n\n ç´¯è®¡batchæŸå¤±ï¼Œæ‰“å°è¾“å‡º\n\néªŒè¯é˜¶æ®µï¼šmodel.eval()\n éå†éªŒè¯é›†ï¼Œè®¡ç®—æ¯ä¸€è½®éªŒè¯é›†çš„AUCã€‚\n\næ—©åœåˆ¤æ–­\n å¦‚æœå½“å‰éªŒè¯å‡†ç¡®ç‡æ¯”å†å²æœ€å¥½å€¼é«˜ï¼Œå°±æ›´æ–°best_val_accï¼Œé‡ç½®æ—©åœè®¡æ•°å™¨å¹¶ä¿å­˜å½“å‰æ¨¡å‹ã€‚å¦åˆ™æ—©åœè®¡æ•°å™¨åŠ 1ï¼Œè‹¥è¿ç»­patienceè½®æ²¡æå‡å°±åœæ­¢è®­ç»ƒã€‚\n\n\né¢„æµ‹ï¼špredictéå†æµ‹è¯•é›†ï¼Œè¾“å…¥ä¸¤æ¡å¥å­åŠå…¶attention_maskï¼Œå¾—åˆ°æ¨¡å‹è¾“å‡ºlogitsã€‚\nç„¶åé€šè¿‡softmaxå°†åˆ†æ•°è½¬æ¢ä¸ºæ¦‚ç‡ï¼Œå–æ ‡ç­¾1ï¼ˆåŒ¹é…ï¼‰çš„æ¦‚ç‡ã€‚\né¢‘åº¦è¡¨åˆå§‹åŒ–ï¼šinit_embedding_from_freqä¸ºäº†åº”å¯¹è„±æ•æ–‡æœ¬çš„é—®é¢˜ï¼Œè¿™é‡Œå‚è€ƒäº†è®ºå›ä¸­çš„ä¸€ä½å‚èµ›é€‰æ‰‹çš„æ–¹æ¡ˆï¼šAUC 0.9094 BERTç»å…¸æ–¹æ¡ˆ_å¤©æ± æŠ€æœ¯åœˆ-é˜¿é‡Œäº‘å¤©æ± \nå³è®©è¿™äº›è„±æ•æ•°å­—IDå˜å¾—ç›¸å¯¹æ¥è¯´æœ‰æ„ä¹‰ï¼Œè®©æ¨¡å‹ä¸€å¼€å§‹å°±å¯¹é«˜é¢‘æ•°å­—æœ‰â€åˆç†çš„è¡¨ç¤ºâ€œï¼Œå¸®åŠ©æ¨¡å‹æ›´å¿«å­¦ä¹ è¯­ä¹‰ã€‚\nä¸ºæ­¤ï¼Œæˆ‘ç»Ÿè®¡äº†è®­ç»ƒé›†é‡Œæ‰€æœ‰æ•°å­—IDçš„é¢‘ç‡ï¼Œç„¶åä»https://lingua.mtsu.edu/chinese-computing/statistics/char/list.php?Which=MO&amp;utm_source&#x3D;chatgpt.comä¸­ä¸‹è½½äº†ä¸€ä»½æ±‰å­—é¢‘åº¦è¡¨æ–‡ä»¶ï¼Œå–å‰max_charsä¸ªæœ€å¸¸ç”¨å­—ç¬¦ï¼Œä¿å­˜åœ¨top_charsä¸­ã€‚\næ¥ç€ä¸ºtop_charsç”Ÿæˆéšæœºå‘é‡ï¼ˆchar_vectorsï¼‰ï¼Œæœ€åå°†æœ€é¢‘ç¹å‡ºç°çš„æ•°å­—IDå¯¹åº”çš„embeddingæ›¿æ¢ä¸ºchar_vectorsï¼Œè¿™æ ·é«˜é¢‘IDå°±æœ‰äº†åˆç†çš„è¡¨ç¤ºï¼Œä½é¢‘IDä»ç„¶ä¿æŒéšæœºåˆå§‹åŒ–ã€‚\n\næ•°æ®é›†åˆ’åˆ†æ­£å¼æ¯”èµ›åˆ†ä¸ºäº†åˆèµ›å’Œå¤èµ›ï¼Œæä¾›äº†ä¸¤ä¸ªè®­ç»ƒé›†ã€‚å¯¹äºå­¦ä¹ èµ›ï¼Œæˆ‘å°†ä¸¤ä¸ªè®­ç»ƒé›†åˆå¹¶ä¸ºä¸€ä¸ªå¤§çš„è®­ç»ƒé›†ï¼Œè®­ç»ƒæ ·æœ¬æœ‰10+40wæ¡ã€‚\ndf_train = pd.concat([df_train1, df_train2], ignore_index=True)\n\nè¿™é‡Œæˆ‘åˆ’åˆ†äº†è®­ç»ƒé›†å’ŒéªŒè¯é›†ã€‚å¯¹äºæ•´ä¸ªæ•°æ®é›†ï¼Œ90%ä½œä¸ºè®­ç»ƒé›†ï¼Œ10%ä½œä¸ºéªŒè¯é›†æ¥è¯„ä¼°æ¨¡å‹æ•ˆæœã€è°ƒå‚å’Œæ—©åœã€‚\ndf_tr, df_val = train_test_split(    df_train,     test_size=0.1,     random_state=42,     stratify=df_train[&#x27;label&#x27;] # ä¿æŒæ­£è´Ÿæ ·æœ¬æ¯”ä¾‹ä¸€è‡´ï¼Œé˜²æ­¢éªŒè¯é›†åæ–œï¼Œæé«˜éªŒè¯ç»“æœå¯é æ€§)\n\nç»Ÿè®¡vocab_sizeï¼Œå› ä¸ºEmbeddingå±‚éœ€è¦çŸ¥é“æœ‰å¤šå°‘è¯&#x2F;æ•°å­—IDã€‚åˆšå¼€å§‹æ²¡æœ‰ç»Ÿè®¡è¿™ä¸ªï¼Œå¯¼è‡´IDè¶…è¿‡embeddingè¡Œæ•°å°±ä¼šæŠ¥é”™ï¼šæŸä¸ªç´¢å¼•å€¼è¶…å‡ºäº†ç›®æ ‡å¼ é‡çš„å¤§å°ã€‚\nC:\\cb\\pytorch_1000000000000\\work\\aten\\src\\ATen\\native\\cuda\\Indexing.cu:1290: block: [103,0,0], thread: [60,0,0] Assertion `srcIndex &lt; srcSelectDimSize` failed.C:\\cb\\pytorch_1000000000000\\work\\aten\\src\\ATen\\native\\cuda\\Indexing.cu:1290: block: [103,0,0], thread: [61,0,0] Assertion `srcIndex &lt; srcSelectDimSize` failed.  File &quot;c:\\Users\\bearx\\Desktop\\project\\code\\train\\train.py&quot;, line 154, in &lt;module&gt;    predictions = predict(model, test_loader, device)  File &quot;c:\\Users\\bearx\\Desktop\\project\\code\\train\\train.py&quot;, line 111, in predict    probs = torch.softmax(out, dim=1)[:, 1]  # å–æ¦‚ç‡RuntimeError: CUDA error: device-side assert triggeredCUDA kernel errors might be asynchronously reported at some other API call, so the stacktrace below might be incorrect.For debugging consider passing CUDA_LAUNCH_BLOCKING=1.Compile with `TORCH_USE_CUDA_DSA` to enable device-side assertions.\n\næåˆ†å°è¯•æåˆ†è·¯å¾„ï¼š0.78ï¼ˆBiLSTMï¼‰ &#x3D;&gt; 0.73ï¼ˆBERTï¼‰&#x3D;&gt; 0.77ï¼ˆé¢‘åº¦è¡¨æ˜ å°„+é¢„è®­ç»ƒbase-bert-chineseï¼‰ &#x3D;&gt; 0.84ï¼ˆåŒå¡”Transformerï¼‰\nBiLSTMBiLSTMï¼ˆBidirectional Long Short-Term Memoryï¼‰ï¼šåŒå‘é•¿çŸ­æœŸè®°å¿†ç½‘ç»œæ˜¯ä¸€ç§RNNå˜ä½“ï¼Œèƒ½å¤Ÿå¤„ç†åºåˆ—æ–‡æœ¬æ•°æ®ï¼ˆæ¯”å¦‚æ–‡æœ¬ï¼‰å¹¶æ•è·å‰åä¾èµ–ä¿¡æ¯ã€‚\nå®ƒæ“…é•¿æ•æ‰é•¿è·ç¦»ä¾èµ–ï¼Œç»å¸¸ç”¨äºæ–‡æœ¬åˆ†ç±»ã€å¥å­ç›¸ä¼¼åº¦åŒ¹é…ç­‰NLPä»»åŠ¡ã€‚\nclass BiLSTM(nn.Module):    def __init__(self, vocab_size, embed_dim=128, hidden_dim=128):        super().__init__()        # 1. Embedding å±‚ï¼Œå°†æ•°å­—IDæ˜ å°„ä¸ºå‘é‡        self.embedding = nn.Embedding(vocab_size + 10, embed_dim, padding_idx=0)        # 2. BiLSTM å±‚        # batch_first=True è¡¨ç¤ºè¾“å…¥ shape = (batch, seq_len, embed_dim)        # bidirectional=True è¡¨ç¤ºåŒå‘LSTM        self.lstm = nn.LSTM(embed_dim, hidden_dim, batch_first=True, bidirectional=True)        # 3. å…¨è¿æ¥å±‚ç”¨äºåˆ†ç±»        self.fc = nn.Sequential(            nn.Linear(hidden_dim * 4, 256),  # hidden_dim*4ï¼šä¸¤æ¡å¥å­ * åŒå‘è¾“å‡º            nn.ReLU(),            nn.Dropout(0.3),            nn.Linear(256, 2)  # è¾“å‡º2ç±»        )\t\t\t# å°†æ¯æ¡å¥å­å˜æˆä¸€ä¸ªå›ºå®šé•¿åº¦å‘é‡    def encode(self, x):        x = self.embedding(x)      # è½¬ä¸ºå‘é‡        out, _ = self.lstm(x)      # BiLSTM ç¼–ç         out, _ = torch.max(out, dim=1)  # å–åºåˆ—ç»´åº¦çš„æœ€å¤§å€¼ï¼ˆMax Poolingï¼‰        return out\t\t# å‰å‘ä¼ æ’­\tdef forward(self, q1, q2):        v1 = self.encode(q1)       # ç¼–ç ç¬¬ä¸€æ¡å¥å­        v2 = self.encode(q2)       # ç¼–ç ç¬¬äºŒæ¡å¥å­        x = torch.cat([v1, v2], dim=1)  # æ‹¼æ¥ä¸¤æ¡å¥å­å‘é‡        return self.fc(x)           # åˆ†ç±»è¾“å‡º\n\nåˆ©ç”¨BiLSTMè·å–äº†0.78çš„æˆç»©\n\næ”¾å¼ƒBiLSTMï¼Œé€‰æ‹©Transformerçš„åŸå› ï¼š\n\nå¯¹äºå¾ˆé•¿çš„æ•°å­—IDåºåˆ—ï¼ŒBiLSTMæ•è·å…¨å±€æ¨¡å¼ä¸å¦‚Transformerå¼ºã€‚Transformeré€šè¿‡è‡ªæ³¨æ„åŠ›æœºåˆ¶ï¼Œå¯ä»¥è®©æ¯ä¸ªtokenç›´æ¥ä¸æ‰€æœ‰tokenå»ºç«‹è”ç³»\nBiLSTMå±‚æ•°å°‘ï¼ˆ&quot;embed_dim&quot;: 128â€‹ï¼‰ã€å‚æ•°å°‘ï¼Œè¡¨è¾¾èƒ½åŠ›æœ‰é™ï¼Œéš¾ä»¥å­¦ä¹ åˆ°å¤æ‚çš„è¯­ä¹‰ç»“æ„ã€‚Transformerå¯ä»¥å †å å¤šå±‚encoderï¼Œembed_dimé«˜ï¼ˆ&quot;embed_dim&quot;: 512â€‹ï¼‰\nåœ¨ç›¸åŒçš„æ•°æ®ä¸è®­ç»ƒæµç¨‹ä¸‹ï¼ŒBiLSTM åŒå¡”çš„æœ€ä½³å¾—åˆ†çº¦ä¸º 0.78ï¼Œè€Œ Transformer åŒå¡”å¯ä»¥ç¨³å®šè¾¾åˆ° 0.84ã€‚\n\nBERTåœ¨æœ€åˆå°è¯•ä¸­ï¼Œæˆ‘å°†è„±æ•åçš„æ•°å­— ID åºåˆ—ç›´æ¥è½¬æ¢ä¸º tensor è¾“å…¥ BERTã€‚ä½†è¿™ç§åšæ³•ä¸ BERT çš„è®¾è®¡æœºåˆ¶å®Œå…¨ä¸åŒ¹é…ï¼Œå¯¼è‡´æ¨¡å‹æ€§èƒ½æ˜¾è‘—ä¸‹é™ï¼Œæœ€ç»ˆå‡†ç¡®ç‡åªæœ‰ 0.73ã€‚\nä¸»è¦åŸå› ï¼š\n\nBERTçš„è¯è¡¨æ˜¯åŸºäºä¸­æ–‡å­—ç¬¦å’Œè¯è®­ç»ƒçš„\nBERTæ¥æ”¶çš„ä¸æ˜¯æ•°å­—IDï¼Œè€Œæ˜¯æ±‰å­—ï¼Œå¹¶ä¸”è¯è¡¨ä¸­åŒ…å«ä¸‡ä¸ªtokençš„è¯­ä¹‰åˆ†å¸ƒã€‚ä½†æ˜¯è„±æ•åçš„æ•°å­—IDå¹¶æ²¡æœ‰å‡ºç°åœ¨BERTè¯è¡¨é‡Œï¼Œæ‰€ä»¥æ¨¡å‹æ— æ³•åŒºåˆ†å¥å­ä¹‹é—´çš„å·®å¼‚ã€‚\n\nBERTçš„enbeddingæ˜¯é¢„è®­ç»ƒå¥½çš„ä¸­æ–‡è¯­ä¹‰ç©ºé—´\næ¯”å¦‚å¾ˆå¤šä¸­æ–‡éƒ½æœ‰å›ºå®šè¯­ä¹‰çš„embeddingï¼Œä½†æ•°å­—IDå®Œå…¨ç ´åäº†è¿™ä¸ªæ¨¡å¼ï¼Œä¹Ÿå°±æ˜¯è¯´é¢„è®­ç»ƒåªæ˜¯å…¨éƒ¨å¤±æ•ˆ\n\n\nåœ¨æ„è¯†åˆ°è¿™äº›é—®é¢˜åï¼Œå‚è€ƒäº†è®ºå›é‡Œä¸€ä½å‚èµ›é€‰æ‰‹çš„æ–¹æ¡ˆï¼Œé€‰æ‹©äº†ä¸€ä»½æ±‰å­—é¢‘åº¦è¡¨ï¼Œæ›´æ”¹äº†è¾“å…¥ï¼Œä¹Ÿå°±æ˜¯æŠŠæ•°å­—IDé¢‘ç‡å’Œæ±‰å­—é¢‘åº¦ç»“åˆï¼Œembeddingåè®©æ•°å­—IDæ‹¥æœ‰ä¸€å®šæ„ä¹‰ï¼Œå¹¶ä¸”ä½¿ç”¨bert-base-chineseé¢„è®­ç»ƒæ¨¡å‹ï¼Œæœ€ç»ˆçš„åˆ†æ•°è¾¾åˆ°0.78ã€‚\nä¼˜åŒ–æ€è·¯\nè·‘ä¸€è½®epochè€—æ—¶è¿‡é•¿ï¼ŒåŠ ä¸ŠT4æ˜¾å¡æ˜¯ç§Ÿçš„ï¼ŒæŒ‰æ—¶é—´æ”¶è´¹ã€‚æ‰€ä»¥ç›®å‰ä»…è·‘äº†8ä¸ªepochï¼Œè®­ç»ƒæ—¶éªŒè¯é›†AUCä¸€ç›´åœ¨å‡é«˜ã€‚å…¶å®å¯ä»¥å†å¤šè·‘å‡ ä¸ªepochï¼Œç»“åˆæ—©åœæœºåˆ¶ï¼ŒAUCåº”è¯¥è¿˜èƒ½ç»§ç»­æé«˜ã€‚\næ¨¡å‹èåˆï¼šå°†å¤šä¸ªä¸åŒç±»å‹çš„æ¨¡å‹è¿›è¡Œèåˆï¼Œä¹Ÿå°±æ˜¯è¯´æŠŠå„ä¸ªæ¨¡å‹çš„è¾“å‡ºé¢„æµ‹å€¼åšå¹³å‡æˆ–è€…åŠ æƒå¹³å‡ç­‰ã€‚\nç‰¹å¾èåˆï¼šç›®å‰åªæ˜¯concat(v1,v2)è¾“å…¥ç»™MLPï¼Œå¯ä»¥åŠ å…¥å·®å€¼ï¼ˆv1-v2ï¼‰ä¸ä¹˜ç§¯ï¼ˆv1 * v2ï¼‰å¯èƒ½ä¼šæå‡åˆ¤æ–­åŠ›ã€‚\n\nå¿ƒå¾—ä½“ä¼šä»¥å‰è™½ç„¶ç»å¸¸å¬åˆ° Transformerã€NLP è¿™äº›åè¯ï¼Œä½†å§‹ç»ˆæ²¡æœ‰çœŸæ­£åŠ¨æ‰‹å®è·µè¿‡ã€‚ä¸Šå­¦æœŸçš„æ•°æ®æŒ–æ˜è¯¾ç¨‹çš„O2Oé¢„æµ‹é¡¹ç›®è®©æˆ‘ç¬¬ä¸€æ¬¡æ¥è§¦åˆ°å®Œæ•´çš„æœºå™¨å­¦ä¹ æµç¨‹ï¼Œä¹Ÿæ„Ÿå—åˆ°äº†å®ƒçš„é­…åŠ›ã€‚è€Œè¿™å­¦æœŸé€šè¿‡è¿™ä¸ª NLP çš„å°é¡¹ç›®ï¼Œæˆ‘åˆæ­¥ç†è§£äº†å¤„ç†æ–‡æœ¬ç±»ä»»åŠ¡çš„åŸºæœ¬æ€è·¯ï¼Œä¹Ÿè®¤è¯†äº†å¸¸ç”¨çš„æ¨¡å‹å’Œæ–¹æ³•ã€‚\nè¿™æ¬¡çš„æåˆ†è¿‡ç¨‹ç›¸æ¯”å»å¹´åšO2Oé¢„æµ‹è¦è½»æ¾ä¸€äº›â€”â€”ä¸€æ–¹é¢å¾—ç›Šäº AI çš„å¸®åŠ©ï¼Œå¦ä¸€æ–¹é¢è®ºå›é‡Œå¤§ä½¬ä»¬çš„â€œç‚¹æ‹¨â€ä¹Ÿéå¸¸å…³é”®ã€‚æ•´ä½“æåˆ†è¿˜ç®—é¡ºåˆ©ï¼Œè™½ç„¶ä¸­é—´ä¹Ÿé‡åˆ°ä¸€äº›æ›²æŠ˜ã€‚å°¤å…¶æ˜¯ä» 0.78 æå‡åˆ° 0.84 è¿™æ®µï¼Œæˆ‘ç¬¬ä¸€æ¬¡çœŸæ­£æ„Ÿå—åˆ° Transformer çš„å¼ºå¤§ï¼Œä¹Ÿæ·±åˆ»æ„è¯†åˆ°æ˜¾å¡å¯¹æ·±åº¦å­¦ä¹ å®éªŒçš„é‡è¦æ€§ã€‚åœ¨é‚£ä¸ªé˜¶æ®µï¼Œæˆ‘å¸¸å¸¸è§‰å¾—åšæœºå™¨å­¦ä¹ åƒæ˜¯åœ¨åšâ€œé»‘ç›’æµ‹è¯•â€ï¼Œä¹Ÿéš¾æ€ªå¾ˆå¤šäººè¯´æ˜¯åœ¨â€œç‚¼ä¸¹â€â€”â€”è®­ç»ƒä¸€æ¬¡ç»“æœå‡ºæ¥åï¼Œå¦‚æœæƒ³ç»§ç»­æå‡ï¼Œä½ å¿…é¡»åŒæ—¶è€ƒè™‘æ¨¡å‹ç»“æ„ã€å‚æ•°ã€æ•°æ®ã€é¢„å¤„ç†ç­‰å¤šä¸ªå› ç´ ï¼Œè€Œä¸”ä¸€æ—¶å¾ˆéš¾åˆ¤æ–­é—®é¢˜ç©¶ç«Ÿå‡ºåœ¨å“ªé‡Œã€‚ä¹Ÿå¯èƒ½æ˜¯å› ä¸ºç›®å‰èƒ½åŠ›æœ‰é™ï¼Œæåˆ†çš„æ–¹å‘å¸¸å¸¸æ²¡æœ‰ç‰¹åˆ«æ˜ç¡®çš„æ€è·¯ã€‚\nè¿™æ¬¡çš„ NLP å®è·µå…¶å®åªæ˜¯å¯¹ Transformerã€BERTã€BiLSTM è¿™äº›ç»å…¸æ¨¡å‹æœ‰äº†ä¸€ä¸ªåˆæ­¥è®¤è¯†ï¼Œå®ƒä»¬å†…éƒ¨çš„å…·ä½“æœºåˆ¶å’Œç»†èŠ‚æˆ‘è¿˜æ²¡å®Œå…¨æŒæ¡ã€‚ä¸è¿‡è¿™æ¬¡çš„ä½“éªŒæ¿€èµ·äº†æˆ‘ç»§ç»­æ·±å…¥å­¦ä¹ çš„å…´è¶£ï¼Œæœªæ¥å¦‚æœæœ‰æœºä¼šï¼Œæˆ‘å¸Œæœ›èƒ½å¤Ÿç³»ç»Ÿåœ°ç†è§£è¿™äº›æ¨¡å‹èƒŒåçš„åŸç†ã€‚\nâ€\n","categories":["æœºå™¨å­¦ä¹ "],"tags":["æœºå™¨å­¦ä¹ "]},{"title":"K8så®è·µè®°å½•","url":"/2025/12/08/K8s%E5%AE%9E%E8%B7%B5%E8%AE%B0%E5%BD%95/","content":"K8så®è·µè®°å½•Level 01.åœ¨èŠ‚ç‚¹ä¸Šåˆ›å»ºä¸€ä¸ªæŒä¹…åŒ–ç›®å½•mkdir -p /data/nginx/logs #åˆ›å»ºå¤šçº§ç›®å½•chmod 777 /data/nginx/logs #ä¸ºç³»ç»Ÿä¸Šçš„æ¯ä¸ªäººæä¾›è¯»ã€å†™å’Œæ‰§è¡Œæƒé™\n\n\n2.åˆ›å»ºä¸€ä¸ªnginx podï¼Œå¹¶åœ¨å…¶ä¸­é…ç½®ä¸€ä¸ªå­˜å‚¨å·æ¥å°†æŒä¹…åŒ–ç›®å½•æŒ‚è½½åˆ°Podçš„/var/log/nginxç›®å½•ä¸­ã€‚apiVersion: v1kind: Podmetadata:  name: nginxspec:  volumes:  - name: nginx-logs    hostPath:      path: /data/nginx/logs  containers:  - name: nginx    image: nginx    volumeMounts:    - name: nginx-logs      mountPath: /var/log/nginx\n\n\n\n3.é…ç½®nginxæ—¥å¿—ä¿å­˜åˆ°æŒ‡å®šçš„ç›®å½•åœ¨nginxé…ç½®æ–‡ä»¶nginx.confä¸­æ·»åŠ ä»¥ä¸‹é…ç½®,å°†nginxè®¿é—®æ—¥å¿—ä¿å­˜åˆ°/var/log/nginx/access.logæ–‡ä»¶ä¸­\n```nginxhttp &#123;    access_log /var/log/nginx/access.log main;&#125;```\n\n\n4.éªŒè¯æ—¥å¿—æŒä¹…åŒ–å¤–éƒ¨è®¿é—®nginxï¼Œåœ¨/data/nginx/logs/access.logä¸­ä¿å­˜äº†è®¿é—®è®°å½•\n\n\nè¿›å…¥å®¹å™¨å†…éƒ¨ï¼Œæ£€æŸ¥æ—¥å¿—æ˜¯å¦ä¿å­˜åœ¨/var/log/nginx/access.logä¸­\nkubectl exec -it nginx bashtail /var/log/nginx/access.log\n\n\næˆåŠŸè®°å½•\nLevel 1å®‰è£…NFSæœåŠ¡ç«¯1.åœ¨ä¸»æœºä¸Šå®‰è£…NFSæœåŠ¡å™¨yum install -y nfs-utils rpcbind\n\n\n2.åˆ›å»ºNFSå…±äº«ç›®å½•å¹¶è®¾ç½®æƒé™mkdir -p /opt/nfs_logschmod 777 /opt/nfs_logs\n\n\n3.ç¼–è¾‘/etc/exportsæ–‡ä»¶ï¼Œæ·»åŠ NFSå…±äº«ç›®å½•/opt/nfs_logs *(rw,sync,no_subtree_check,no_root_squash)#rwä»£è¡¨è¯»å†™è®¿é—®ï¼Œsyncä»£è¡¨æ‰€æœ‰æ•°æ®åœ¨è¯·æ±‚æ—¶å†™å…¥å…±äº«ï¼Œno_subtree_checkä»£è¡¨ä¸æ£€æŸ¥çˆ¶ç›®å½•æƒé™ï¼Œno_root_squashä»£è¡¨root ç”¨æˆ·å…·æœ‰æ ¹ç›®å½•çš„å®Œå…¨ç®¡ç†è®¿é—®æƒé™\n\n\n4.é‡å¯NFSæœåŠ¡å™¨å¹¶æ£€æŸ¥é…ç½®ç»“æœsystemctl enable rpcbindsystemctl enable nfs-serversystemctl start rpcbindsystemctl start nfs-serverexportfs -rexportfs\n\n\n\né…ç½®åŸºäºNFSçš„æŒä¹…å·1.åˆ›å»ºæŒä¹…å·ç¼–å†™pv.yaml\napiVersion: v1kind: PersistentVolumemetadata:  name: nfs-pv-logsspec:  capacity:    storage: 5Gi  accessModes:    - ReadWriteOnce  storageClassName: nfs  nfs:    server: 172.23.0.239    path: /opt/nfs_logs\n\n\n2.åˆ›å»ºæŒä¹…å·å£°æ˜ç¼–å†™pvc.yaml\napiVersion: v1kind: PersistentVolumeClaimmetadata:  name: nfs-pvc-logsspec:  accessModes:    - ReadWriteOnce  resources:    requests:      storage: 5Gi  storageClassName: nfs\n\n\n3.å°†PVCå’ŒPVç»‘å®škubectl patch pvc nfs-pvc-logs -p &#x27;&#123;&quot;spec&quot;:&#123;&quot;volumeName&quot;:&quot;nfs-pv-logs&quot;&#125;&#125;&#x27;\n\n\n\nå°†æŒä¹…å·å£°æ˜æŒ‚è½½åˆ°nginxå®¹å™¨ç¼–å†™nginx-pv.yaml\napiVersion: v1kind: Podmetadata:  name: nginx-pvspec:  containers:  - name: nginx    image: nginx    ports:      - containerPort: 80        name: nginx-server    volumeMounts:    - name: nfs-pvc-logs      mountPath: /var/log/nginx  volumes:  - name: nfs-pvc-logs    persistentVolumeClaim:      claimName: nfs-pvc-logs\n\n\néªŒè¯æ˜¯å¦å­˜å‚¨æ—¥å¿—å¤–éƒ¨è®¿é—®nginxï¼Œåœ¨/opt/nfs_logs/access.logæŸ¥çœ‹æ—¥å¿—\n\næˆåŠŸè®°å½•\né‡åˆ°çš„é—®é¢˜ï¼ˆæ„Ÿè°¢æ¨é‘«åŒå­¦ï¼‰\n#ç¼–å†™pv.yamlæ—¶å€™ï¼Œè¦æŠŠnfs# serverçš„ipåœ°å€å†™åˆ°NFSæœåŠ¡å™¨çš„ç§ç½‘ip\nå†™æˆå…¬ç½‘ipï¼Œæœ€ååˆ›å»ºpodçš„æ—¶å€™ï¼ŒpodçŠ¶æ€ä¸€ç›´æ˜¯ContainerCreatingï¼Œè¶…æ—¶äº†\nç”¨kubectl describeå‡ºç°ä»¥ä¸‹æŠ¥é”™\n\nç¿»è¯‘ï¼š\næŒ‚è½½å‘½ä»¤ï¼šæŒ‚è½½\nè£…è½½å‚æ•°ï¼š-t nfs 8.130.111.175:&#x2F;opt&#x2F;nfs_logs&#x2F;var&#x2F;lib&#x2F;kubelet&#x2F;pods&#x2F;d0abb5e10c87-490f-85dd-be3d00478462&#x2F;volumes&#x2F;kubernetes.io~nfs&#x2F;nfs pv-logs\nè¾“å‡ºï¼šmount.nfs:è¿æ¥è¶…æ—¶\nè­¦å‘Šå¤±è´¥mount 13mï¼ˆx3è¶…è¿‡18mï¼‰kubeletæ— æ³•è¿æ¥æˆ–è£…è½½å·ï¼šæœªå®‰è£…çš„å·&#x3D;[nfs pvc logs]ï¼Œæœªè¿æ¥çš„å·&#x3D;[nfs pvc logs kube-api-access-6wfbh]ï¼šç­‰å¾…æ¡ä»¶è¶…æ—¶\n#è¿˜æœ‰ä¸€ä¸ªå°±æ˜¯æœåŠ¡å™¨å¥½å¡ï¼Œé‡å¯äº†å¥½å¤šéğŸ˜­ğŸ˜­ğŸ˜­#\nLevel 2æ€è·¯:\n(å‰æ)åœ¨NFSæœåŠ¡å™¨ä¸Šåˆ›å»ºå¥½å…±äº«ç›®å½•\n1.ä¸ºmysqlåˆ›å»ºPVå’ŒPVCå¹¶ç»‘å®š\n2.åˆ›å»ºmysqlçš„Deploymentå’ŒService\n3.åˆ›å»ºwordpressçš„Deploymentå’ŒService\nå‚è€ƒ: Kubernetes(k8s)1.6.0éƒ¨ç½² WordPressä»¥åŠhpaå’Œæ»šåŠ¨æ›´æ–°æµ‹è¯•_k8séƒ¨ç½²wordpress_ç¨‹åºçŒ¿ï¼ˆæ”»åŸç‹®ï¼‰çš„åšå®¢-CSDNåšå®¢\nåˆ›å»ºå‘½åç©ºé—´kubectl create namespace wordpress\n\n\néƒ¨ç½²MySQL1.åˆ›å»ºMySQLçš„PVå’ŒPVCå¹¶ç»‘å®šç¼–å†™mysql-pv.yaml\napiVersion: v1kind: PersistentVolumemetadata:  name: mysql-pv  namespace: wordpressspec:  capacity:    storage: 1Gi  accessModes:    - ReadWriteOnce  persistentVolumeReclaimPolicy: Recycle  nfs:    path: /root/data/nfs/pv #å…±äº«ç›®å½•    server: 124.221.233.12 #nfsæœåŠ¡å™¨\n\nç¼–å†™mysql-pvc.yaml\napiVersion: v1kind: PersistentVolumeClaimmetadata:  name: mysqlpvc  namespace: wordpressspec:  accessModes:    - ReadWriteOnce  volumeName: mysql-pv  resources:    requests:      storage: 1Gi\n\n\n2.åˆ›å»ºMySQLçš„Deploymentç¼–å†™mysql-deploy.yaml\napiVersion: apps/v1kind: Deploymentmetadata:  name: mysql-deploy  namespace: wordpress  labels:    apps: mysqlspec:  selector:    matchLabels:      app: mysql  template:    metadata:      labels:        app: mysql    spec:      containers:      - name: mysql        image: mysql:5.6        imagePullPolicy: IfNotPresent        ports:        - containerPort: 3306          name: dbport        env:        - name: MYSQL_ROOT_PASSWORD          value: rootPassWord        - name: MYSQL_DATABASE          value: wordpress        - name: MYSQL_USER          value: wordpress        - name: MYSQL_PASSWORD          value: wordpress        volumeMounts:        - name: db-pv          mountPath: /var/lib/mysql      volumes:      - name: db-pv        persistentVolumeClaim:          claimName: mysqlpvc\n\n\n3.åˆ›å»ºMySQLçš„Serviceç¼–å†™mysql-service-yaml\napiVersion: v1kind: Servicemetadata:  name: mysql  namespace: wordpressspec:  selector:    app: mysql  ports:  - name: mysqlport    protocol: TCP    port: 3306    targetPort: 3306\n\n\néƒ¨ç½²WordPress1.åˆ›å»ºWordPressçš„Deploymentç¼–å†™wordpress-deploy.yaml\napiVersion: apps/v1kind: Deploymentmetadata:  name: wordpress-deploy  namespace: wordpress  labels:    app: wordpressspec:  selector:    matchLabels:      app: wordpress  strategy:    type: RollingUpdate    rollingUpdate:      maxSurge: 50%      maxUnavailable: 0  template:    metadata:      labels:        app: wordpress    spec:      containers:      - name: wordpress        image: wordpress        imagePullPolicy: IfNotPresent        ports:        - containerPort: 80          name: wdport        env:        - name: WORDPRESS_DB_HOST          value: mysql:3306        - name: WORDPRESS_DB_USER          value: wordpress        - name: WORDPRESS_DB_PASSWORD\n\n\n2.åˆ›å»ºWordPressçš„Serviceç¼–å†™wordpress-service.yaml\napiVersion: v1kind: Servicemetadata:  name: wordpress  namespace: wordpressspec:  type: NodePort  selector:    app: wordpress  ports:  - name: wordpressport    protocol: TCP    port: 80    targetPort: wdport\n\n\nè®¿é—®(å¤±è´¥)è®¿é—®http://124.221.233.12:31585\n\né‡åˆ°çš„é—®é¢˜\nä¸€åˆ‡éƒ½æ˜¯Runningä½†æ˜¯è¿˜æ˜¯è®¿é—®ä¸äº†\nLevel 6å‚è€ƒ:Helm:ä½¿ç”¨helméƒ¨ç½²nginx_helm éƒ¨ç½²nginx_zJayLiaoçš„åšå®¢-CSDNåšå®¢\nâ€‹        Helm templates ä¸­çš„è¯­æ³• - klvchen - åšå®¢å›­ (cnblogs.com)\nâ€‹        Helm | Docs\nå®‰è£…helmwget https://download.osichina.net/tools/k8s/helm/helm-v3.3.1-linux-amd64.tar.gz cd /opt/helm/tar zxvf helm-v3.3.1-linux-amd64.tar.gzcp helm /usr/local/binchmod a+x /usr/local/bin/helm\n\n\nåˆ›å»ºé…ç½®æ–‡ä»¶å’Œç›®å½•\nChart.yamlChart ä»£è¡¨ç€ Helm åŒ…ã€‚å®ƒåŒ…å«åœ¨ Kubernetes é›†ç¾¤å†…éƒ¨è¿è¡Œåº”ç”¨ç¨‹åºï¼Œå·¥å…·æˆ–æœåŠ¡æ‰€éœ€çš„æ‰€æœ‰èµ„æºå®šä¹‰ã€‚ä½ å¯ä»¥æŠŠå®ƒçœ‹ä½œæ˜¯ Homebrew formulaï¼Œapt dpkgï¼Œæˆ– yum rpm åœ¨Kubernetes ä¸­çš„ç­‰ä»·ç‰©ã€‚\nè¿™é‡Œå®šä¹‰äº†chartçš„åŸºæœ¬ä¿¡æ¯\napiVersion: v2name: nginxdescription: A Helm chart for deploying Nginxversion: 0.1.0\n\nvalues.yamlvalues.yamlç”¨äºå®šä¹‰NginxæœåŠ¡çš„å„ç§é…ç½®é€‰é¡¹ï¼Œå¦‚éƒ¨ç½²Podçš„å‰¯æœ¬æ•°ã€å®¹å™¨çš„é•œåƒã€ç«¯å£å·ã€å·çš„æŒ‚è½½ç­‰ç­‰ã€‚ä½¿ç”¨values.yamlæ–‡ä»¶ï¼Œç”¨æˆ·å¯ä»¥è½»æ¾çµæ´»åœ°é…ç½®å¹¶å®šåˆ¶NginxæœåŠ¡çš„å„ç§å‚æ•°ï¼Œä»¥æ»¡è¶³ä»–ä»¬åœ¨ä¸åŒç¯å¢ƒä¸­çš„éœ€æ±‚ï¼Œåœ¨ä¸åŒé›†ç¾¤ä¸Šéƒ¨ç½²NginxæœåŠ¡ï¼Œè€Œæ— éœ€é‡æ–°ç¼–å†™Helm Chartçš„æ¨¡æ¿æ–‡ä»¶ã€‚\nç›¸å½“äºå®šä¹‰äº†ä¸€äº›å˜é‡ï¼Œå¯ä»¥åœ¨åé¢çš„æ–‡ä»¶ä¸­è¿›è¡Œå¼•ç”¨ã€‚\né•œåƒæ‹‰å–ç­–ç•¥pullpolicy\n\nreplicaCount: 1 #Podå‰¯æœ¬æ•°image: #å®¹å™¨é•œåƒ  repository: nginx   tag: latest  pullPolicy: IfNotPresent #é•œåƒæ‹‰å–ç­–ç•¥ä¸ºIFNotPresentservice:  type: ClusterIP #serviceçš„ç±»å‹  port: 80\n\ndeployment.yamldeployment.yamlæ˜¯ç”¨æ¥å®šä¹‰Nginxçš„éƒ¨ç½²èµ„æºçš„æ–‡ä»¶ï¼Œå®ƒæè¿°äº†Nginxçš„å‰¯æœ¬æ•°ï¼Œå®¹å™¨é•œåƒï¼Œç«¯å£æ˜ å°„ï¼Œç¯å¢ƒå˜é‡ï¼Œå¥åº·æ£€æŸ¥ç­‰ä¿¡æ¯.å®ƒè¿˜å¯ä»¥æŒ‡å®šNginxçš„æœåŠ¡ç±»å‹ï¼Œè´Ÿè½½å‡è¡¡å™¨ï¼Œå®‰å…¨ç»„ç­‰ã€‚\nå’Œå¹³å¸¸æ™®é€šçš„deploymentåŸºæœ¬ç›¸ä¼¼ã€‚\napiVersion: apps/v1kind: Deploymentmetadata:  name: &#123;&#123; include &quot;nginx.fullname&quot; . &#125;&#125; #å¼•ç”¨æ¨¡æ¿ï¼Œæ ¼å¼ï¼š&#123;&#123; include &quot;æ¨¡ç‰ˆåå­—&quot; ä½œç”¨åŸŸ&#125;&#125;  labels:    app: &#123;&#123; include &quot;nginx.name&quot; . &#125;&#125;spec:  replicas: &#123;&#123; .Values.replicaCount &#125;&#125; #Valuesä»£è¡¨çš„å°±æ˜¯values.yamlå®šä¹‰çš„å‚æ•°ï¼Œé€šè¿‡.Valueså¯ä»¥å¼•ç”¨ä»»æ„å‚æ•°  selector:    matchLabels:      app: &#123;&#123; include &quot;nginx.name&quot; . &#125;&#125;  template:    metadata:      labels:        app: &#123;&#123; include &quot;nginx.name&quot; . &#125;&#125;    spec:      containers:        - name: nginx          image: &#123;&#123; .Values.image.repository &#125;&#125;:&#123;&#123; .Values.image.tag &#125;&#125;          imagePullPolicy: &#123;&#123; .Values.image.pullPolicy &#125;&#125;          ports:            - name: http              containerPort: 80\n\nservice.yamlapiVersion: v1kind: Servicemetadata:  name: &#123;&#123; include &quot;nginx.fullname&quot; . &#125;&#125;  labels:    app: &#123;&#123; include &quot;nginx.name&quot; . &#125;&#125;spec:  type: &#123;&#123; .Values.service.type &#125;&#125;  ports:    - name: http      port: &#123;&#123; .Values.service.port &#125;&#125;      targetPort: http  selector:    app: &#123;&#123; include &quot;nginx.name&quot; . &#125;&#125;\n\n_helpers.tplæ‰©å±•åæ˜¯.tplå¯ç”¨äºç”Ÿæˆéæ ¼å¼åŒ–å†…å®¹çš„æ¨¡æ¿æ–‡ä»¶\nå®šä¹‰çš„æ¨¡æ¿(åœ¨&#123;&#123; define &#125;&#125;å‘½ä»¤ä¸­å®šä¹‰çš„æ¨¡æ¿)æ˜¯å¯å…¨å±€è®¿é—®çš„ã€‚è¿™å°±æ„å‘³ç€chartå’Œæ‰€æœ‰çš„å­chartéƒ½å¯ä»¥è®¿é—®ç”¨&#123;&#123; define &#125;&#125;åˆ›å»ºçš„æ‰€æœ‰æ¨¡æ¿ã€‚\nRelease æ˜¯è¿è¡Œåœ¨ Kubernetes é›†ç¾¤ä¸­çš„ chart çš„å®ä¾‹ã€‚ä¸€ä¸ª chart é€šå¸¸å¯ä»¥åœ¨åŒä¸€ä¸ªé›†ç¾¤ä¸­å®‰è£…å¤šæ¬¡ã€‚æ¯ä¸€æ¬¡å®‰è£…éƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„ releaseã€‚ä»¥ MySQL chartä¸ºä¾‹ï¼Œå¦‚æœä½ æƒ³åœ¨ä½ çš„é›†ç¾¤ä¸­è¿è¡Œä¸¤ä¸ªæ•°æ®åº“ï¼Œä½ å¯ä»¥å®‰è£…è¯¥chartä¸¤æ¬¡ã€‚æ¯ä¸€ä¸ªæ•°æ®åº“éƒ½ä¼šæ‹¥æœ‰å®ƒè‡ªå·±çš„ release å’Œ release nameã€‚\n&#123;&#123;/* è¿”å›éƒ¨ç½²åç§° */&#125;&#125;&#123;&#123;- define &quot;nginx.fullname&quot; -&#125;&#125;&#123;&#123;- printf &quot;%s-%s&quot; .Release.Name &quot;nginx&quot; -&#125;&#125;&#123;&#123;- end -&#125;&#125;&#123;&#123;/* è¿”å›åº”ç”¨åç§° */&#125;&#125;&#123;&#123;- define &quot;nginx.name&quot; -&#125;&#125;&#123;&#123;- &quot;nginx&quot; -&#125;&#125;&#123;&#123;- end -&#125;&#125;\n\néªŒè¯(å¤±è´¥)helm package nginx #æ‰“åŒ…helm install nginx ./nginx-0.1.0.tgz #å®‰è£…\n\né‡åˆ°çš„é—®é¢˜å½“ç”¨helmæ‰“åŒ…æ—¶æŠ¥é”™\nhelm package nginxError: validation: chart.metadata is required\n\nLevel 7å‚è€ƒ:åœ¨ Kubernetes å®‰è£… KubeSphere | KubeSphere Documents\nâ€‹         å®‰è£… Kuboard v3 - å†…å»ºç”¨æˆ·åº“ | Kuboard\nâ€‹         Kuboard-Spray å›¾å½¢åŒ–å·¥å…·å®‰è£…kubernetesé›†ç¾¤_kuberneteså›¾å½¢åŒ–å·¥å…·_ä¸€åªæ‡’æƒ°çš„çŒ¿çš„åšå®¢-CSDNåšå®¢\néƒ¨ç½²KubeSphere(å¤±è´¥)æœ€å°åŒ–å®‰è£…\nkubectl apply -f https://raw.githubusercontent.com/kubesphere/ks-installer/v2.1.1/kubesphere-minimal.yaml\n\næŸ¥çœ‹PodçŠ¶æ€\nkubectl get pod --all-namespaces\n\n\nç”¨Kuboard-Sprayå®‰è£…K8så¹¶éƒ¨ç½²Kuboard1.å®‰è£…docker-ce yum-config-manager \\&gt;     --add-repo \\&gt;     https://download.docker.com/linux/centos/docker-ce.repoyum updateyum install docker-ce\n\n2.å®‰è£…Kuboard-Spraydocker run -d \\  --privileged \\  --restart=unless-stopped \\  --name=kuboard-spray \\  -p 80:80/tcp \\  -v /var/run/docker.sock:/var/run/docker.sock \\  -v ~/kuboard-spray-data:/data \\  eipwork/kuboard-spray:latest-amd64\n\n\nå®‰è£…å®Œæˆåè®¿é—®https://8.130.175.111,ç”¨æˆ·å`admin`,é»˜è®¤å¯†ç  Kuboard123ï¼Œå³å¯ç™»å½• Kuboard-Spray ç•Œé¢ã€‚\n\n3.ä¸‹è½½èµ„æºåŒ…\n4.åˆ›å»ºé›†ç¾¤å¹¶é€‰æ‹©å„è‡ªçš„è§’è‰²\n5.å®‰è£…K8sé›†ç¾¤\nå®‰è£…æˆåŠŸ\n6.éƒ¨ç½²Kuboarddocker run -d \\  --restart=unless-stopped \\  --name=kuboard \\  -p 80:80/tcp \\  -p 10081:10081/tcp \\  -e KUBOARD_ENDPOINT=&quot;http://10.0.4.12:80&quot; \\  -e KUBOARD_AGENT_SERVER_TCP_PORT=&quot;10081&quot; \\  -v /root/kuboard-data:/data \\  eipwork/kuboard:v3\n\nè®¿é—®http://124.221.233.12/:80\n\n\næˆåŠŸ\né‡åˆ°çš„é—®é¢˜éƒ¨ç½²KubeSphereæ—¶æŠ¥é”™\nkubectl logs -n kubesphere-system $(kubectl get pod -n kubesphere-system -l app=ks-install -o jsonpath=&#x27;&#123;.items[0].metadata.name&#125;&#x27;) -f\n\n\næç¤ºç‰ˆæœ¬ä¸æ”¯æŒ\nkubectl version\n\n\nç‰ˆæœ¬æ˜¯v1.25.0,æŒ‰ç…§å®˜æ–¹æ–‡æ¡£æç¤ºåº”è¯¥æ˜¯å¯ä»¥çš„\n\nä¸çŸ¥é“ä¸ºå•¥\n","categories":["Kubernetes"],"tags":["Kubernetes"]},{"title":"iManager-æ‚¨çš„ç§äººé•œåƒç®¡å®¶","url":"/2025/12/08/iManager-%E6%82%A8%E7%9A%84%E7%A7%81%E4%BA%BA%E9%95%9C%E5%83%8F%E7%AE%A1%E5%AE%B6/","content":"iManager-æ‚¨çš„ç§äººé•œåƒç®¡å®¶å°½ç®¡Dockerå®˜æ–¹æä¾›äº†å…¬å…±çš„é•œåƒä»“åº“DockerHubï¼Œä½†ä»å®‰å…¨æ€§å’Œç¨³å®šæ€§ç­‰æ–¹é¢è€ƒè™‘ï¼Œéƒ¨ç½²ç§æœ‰é•œåƒä»“åº“æ˜¯éå¸¸æœ‰å¿…è¦çš„ã€‚Harboræ˜¯ä¸€ä¸ªç”±VMwareå…¬å¸å¼€æºçš„ä¼ä¸šçº§çš„Docker Registryç®¡ç†é¡¹ç›®ï¼Œæ˜¯æˆ‘ä»¬æ­å»ºç§æœ‰é•œåƒä»“åº“çš„ä¸äºŒä¹‹é€‰ã€‚\nè€Œè‡ªåŠ¨åŒ–ä¸€ç›´æ˜¯è¿ç»´å·¥ä½œä¸­çš„é‡ä¸­ä¹‹é‡ã€‚\nYiiongå¸Œæœ›ä½ èƒ½å¤Ÿå°†Harborä¸é£ä¹¦æœºå™¨äººè”ç³»èµ·æ¥ï¼Œæ–¹ä¾¿ç®¡ç†å‘˜ç»Ÿä¸€ç®¡ç†é•œåƒï¼Œä½¿ç®¡ç†å‘˜éšæ—¶éƒ½å¯ä»¥çŸ¥æ™“ä»“åº“é•œåƒçš„å˜åŠ¨ä¿¡æ¯ï¼Œç®¡ç†å‘˜åŠ¨åŠ¨æ‰‹æŒ‡å°±å¯ä»¥å¯¹ä»“åº“é‡Œçš„é•œåƒè¿›è¡Œæ“ä½œç­‰ã€‚\nå‰ç½®å‡†å¤‡\nå»ºè®®ä½¿ç”¨æœåŠ¡å™¨æ­å»ºHarborä»“åº“ï¼Œå¹¶ä¸”é…ç½®å¥½https\nç”³è¯·ä¸€ä¸ªé£ä¹¦ä¼ä¸šè´¦å·\nå¯èƒ½éœ€è¦ä¸€ä¸ªåŸŸåï¼Ÿ\n\nä»»åŠ¡å‹å–„çš„ç”¨æˆ·äº¤äº’ç”¨æˆ·è‚¯å®šéœ€è¦çŸ¥é“ä½ çš„æœºå™¨äººéƒ½å¯ä»¥å¹²äº›ä»€ä¹ˆäº‹æƒ…å§\nç”¨æˆ·å‘æœºå™¨äººå‘é€å¸®åŠ©ï¼Œæœºå™¨äººè¿”å›å¯ä»¥å®ç°çš„åŠŸèƒ½åˆ—è¡¨\nå½“ç”¨æˆ·å‘é€äº†ä¸€äº›ä¹±ä¸ƒå…«ç³Ÿçš„ä¿¡æ¯æ—¶ï¼Œæœºå™¨äººéœ€è¦åšå‡ºä¸€å®šçš„å›å¤ï¼Œæ¯”å¦‚æˆ‘å¬ä¸æ‡‚æ\nLevel 0 é€šçŸ¥å½“é•œåƒçŠ¶æ€å‘ç”Ÿæ”¹å˜æ—¶ï¼Œæœºå™¨äººå‘ç®¡ç†å‘˜å‘èµ·é€šçŸ¥\né€šçŸ¥å†…å®¹åŒ…æ‹¬ï¼š\n\né•œåƒçŠ¶æ€ï¼ˆPush or Pull or Deleteï¼‰\né•œåƒåç§°ä»¥åŠæ ‡ç­¾\né•œåƒçŠ¶æ€æ”¹å˜çš„æ—¥æœŸ\né•œåƒçŠ¶æ€æ”¹å˜è€…\n\nLevel 1 ç®€å•æŸ¥è¯¢ç®¡ç†å‘˜å‘æœºå™¨äººå‘é€æŸ¥è¯¢é¡¹ç›®ï¼Œæœºå™¨äººè¿”å›æ‰€æœ‰é¡¹ç›®çš„åç§°ã€æ‰€å±è€…ä»¥åŠè®¿é—®çº§åˆ«\nç®¡ç†å‘˜å‘æœºå™¨äººå‘é€æŸ¥è¯¢ä»“åº“ï¼Œæœºå™¨äººè¿”å›æ‰€æœ‰ä»“åº“çš„åç§°ã€åˆ›å»ºæ—¶é—´ä»¥åŠæ›´æ–°æ—¶é—´\nLevel 2 é•œåƒç®¡ç†åœ¨æˆ‘ä»¬çš„å›¢é˜Ÿå¼€å‘è¿‡ç¨‹ä¸­ï¼Œéš¾å…ä¼šå‡ºç°å¤šæ¬¡æ¨é€é•œåƒä½†é•œåƒæµ‹è¯•ä¸é€šè¿‡çš„æƒ…å†µï¼Œ\nYiiongå¸Œæœ›å½“é•œåƒè¢«ä»¥PushçŠ¶æ€æ¨é€æ—¶ï¼Œé€šçŸ¥å†…å®¹ä¸­æ–°å¢åŠ ä¸€ä¸ªè¶…é“¾æ¥æŒ‰é’®ï¼Œç‚¹å‡»è¿™ä¸ªæŒ‰é’®å³å¯åˆ é™¤è¿™ä¸ªé•œåƒ\nå¦ä¸€ç§æ–¹å¼æ˜¯ï¼Œå‘æœºå™¨äººå‘é€åˆ é™¤é•œåƒï¼šé•œåƒåï¼Œå³å¯åˆ é™¤æŸä¸ªé•œåƒ\nLevel 3 ç”¨æˆ·ç®¡ç†æˆ‘ä»¬çš„æ•´ä¸ªä»“åº“ä¸å¯èƒ½åªæœ‰ä¸€ä¸ªç®¡ç†å‘˜ç”¨æˆ·ï¼Œç®¡ç†å‘˜ç»å¸¸éœ€è¦ä¸ºä¸åŒçš„æˆå‘˜åˆ›å»ºä¸åŒçš„ç”¨æˆ·\nYiiongå¸Œæœ›ç®¡ç†å‘˜å‘æœºå™¨äººå‘é€åˆ›å»ºç”¨æˆ·ï¼šç”¨æˆ·å-å¯†ç -é‚®ç®±å³å¯åˆ›å»ºä¸€ä¸ªæ–°ç”¨æˆ·\nå¹¶ä¸”å¯ä»¥å°†ç‰¹å®šç”¨æˆ·ä»¥å¼€å‘è€…èº«ä»½åŠ å…¥åˆ°ç‰¹å®šé¡¹ç›®çš„æˆå‘˜ä¸­\nLevel 4 æ‰“åŒ…ç¼–å†™Dockerfileï¼Œå°†ä½ çš„æ‰€æœ‰æ–‡ä»¶ç”¨Dockeræ‰“åŒ…åˆ¶ä½œæˆé•œåƒï¼Œä½¿å…¶ä»–ç”¨æˆ·å¡«å…¥ä¸€äº›å¿…è¦çš„ä¿¡æ¯å°±å¯ä»¥æ„‰å¿«åœ°ä½¿ç”¨ä½ çš„ä½œå“è¾£ï¼\nåŠ åˆ†é¡¹\nå‘æŒ¥ä½ çš„å¥‡æ€å¦™æƒ³ï¼Œå®ç°ä¸€äº›æ„æƒ³ä¸åˆ°çš„åŠŸèƒ½\nä½¿ç”¨Kuberneteså®Œæˆå¿…è¦çš„å†…ç½‘ç©¿é€\nä½¿ç”¨UptimeKumaç›‘æ§ä½ çš„ä»“åº“ï¼Œå½“å‡ºç°é—®é¢˜æ—¶é€šè¿‡æœºå™¨äººè¿”å›ä¸€äº›å¿…è¦ä¿¡æ¯\né£ä¹¦å¼€æ”¾å¹³å°æä¾›äº†ä¸€ç§ç¾è§‚çš„â€å¡ç‰‡å¼â€œæ¶ˆæ¯ï¼Œä½¿ç”¨å®ƒçš„è¯ç­”è¾©çš„æ—¶å€™ä¸€å®šå¾ˆæ½‡æ´’å•Š\n\n","categories":["æœåŠ¡å™¨è¿ç»´"],"tags":["æœåŠ¡å™¨è¿ç»´"]},{"title":"O2Oç”¨æˆ·ä¼˜æƒ åˆ¸é¢„æµ‹è®°å½•","url":"/2025/12/08/O2O%E7%94%A8%E6%88%B7%E4%BC%98%E6%83%A0%E5%88%B8%E9%A2%84%E6%B5%8B%E8%AE%B0%E5%BD%95/","content":"æ•°æ®æŒ–æ˜æ±‡æŠ¥å¤§å®¶å¥½ï¼Œä»Šå¤©ç”±æˆ‘å‘å¤§å®¶æ±‡æŠ¥ä¸€ä¸‹æˆ‘ä»¬ç»„çš„é¡¹ç›®ã€‚æˆ‘ä»¬ç»„åšçš„é¡¹ç›®é¢˜ç›®æ˜¯ï¼šåŸºäºXGBoostæ¨¡å‹çš„O2Oç”¨æˆ·ä¼˜æƒ åˆ¸ä½¿ç”¨è¡Œä¸ºåˆ†æä¸é¢„æµ‹æ–¹æ³•ç ”ç©¶ã€‚ç›¸ä¿¡ä¸€äº›åŒå­¦åº”è¯¥å¯¹è¿™ä¸ªé¢˜ç›®å¾ˆç†Ÿæ‚‰ï¼Œå› ä¸ºè¿™ä¸ªé¢˜ç›®æ¥æºäºCSAæ•°æ®å·¥ç¨‹å®è·µçš„è€ƒæ ¸ä»»åŠ¡ã€‚ä¹‹æ‰€ä»¥é€‰æ‹©è¿™ä¸ªé¢˜ç›®ï¼Œä¸€æ–¹é¢æ˜¯å› ä¸ºå®ƒæ¶µç›–äº†è®¸å¤šæˆ‘ä»¬åœ¨æ•°æ®æŒ–æ˜è¯¾ç¨‹ä¸­å­¦ä¹ è¿‡çš„æœºå™¨å­¦ä¹ ç›¸å…³çŸ¥è¯†ç‚¹ï¼Œå¦ä¸€æ–¹é¢ä¹Ÿæ˜¯å› ä¸ºæˆ‘åœ¨è¿™ä¸ªé¡¹ç›®ä¸ŠæŠ•å…¥äº†å¤§é‡æ—¶é—´å’Œç²¾åŠ›ï¼Œå¹¶ä»ä¸­çœŸæ­£è·å¾—äº†ä¸€äº›å®è´¨æ€§çš„æ”¶è·ã€‚\nå› æ­¤ï¼Œæˆ‘å¸Œæœ›å€Ÿæ­¤æœºä¼šå‘å¤§å®¶åˆ†äº«æˆ‘çš„å­¦ä¹ æˆæœå’Œä¸€äº›å¿ƒå¾—ä½“ä¼šã€‚\nä¸‹é¢æˆ‘ä¼šä»è¿™å‡ ä¸ªæ–¹é¢æ¥å…·ä½“å±•å¼€æ•´ä¸ªé¡¹ç›®æµç¨‹ï¼Œæœ€åè¿˜ä¼šè®²è®²K-Meansçš„ä»£ç å®ç°ã€‚\né¡¹ç›®ä»‹ç»é¦–å…ˆæ˜¯é¡¹ç›®ä»‹ç»ã€‚\nå¯èƒ½å¾ˆå¤šåŒå­¦ä¸çŸ¥é“O2Oæ˜¯åšä»€ä¹ˆçš„ï¼Œè¿™é‡Œæˆ‘å¯¹O2Oåšä¸€ä¸ªè§£é‡Šã€‚O2Oæ˜¯â€œOnline to Offlineâ€çš„ç¼©å†™ï¼Œå®ƒæ˜¯ä¸€ç§å•†ä¸šæ¨¡å¼ï¼ŒæŒ‡çš„æ˜¯é€šè¿‡çº¿ä¸Šå¹³å°å°†ç”¨æˆ·å¼•å¯¼åˆ°çº¿ä¸‹å®ä½“åº—è¿›è¡Œæ¶ˆè´¹çš„æ–¹å¼ã€‚æ¯”å¦‚ç¾å›¢å¤–å–å°±é‡‡ç”¨çš„è¿™ç§æ¨¡å¼ï¼Œä¹Ÿå°±æ˜¯ç”¨æˆ·çº¿ä¸Šå…ˆä¸‹å•ï¼Œå•†å®¶çº¿ä¸‹åˆ¶ä½œå¹¶ä¸”é€é¤è¿™ç§ã€‚\né‚£æˆ‘ä»¬ä¸ºä»€ä¹ˆè¦å¯¹ä¼˜æƒ åˆ¸è¿›è¡Œé¢„æµ‹å‘¢ï¼Ÿå› ä¸ºä¼˜æƒ åˆ¸æ˜¯O2Oçš„ä¸€ç§é‡è¦è¥é”€æ‰‹æ®µï¼Œåæ˜ åˆ°æˆ‘ä»¬çš„ç”Ÿæ´»ä¸Šä¹Ÿæ˜¯ï¼Œå“ªä¸ªå•†å®¶å‘ä¼˜æƒ åˆ¸æˆ‘ä»¬å°±æ¯”è¾ƒå–œæ¬¢å»è¿™ä¸ªå•†å®¶å»æ¶ˆè´¹ã€‚ä½†æ˜¯å‘ä¼˜æƒ åˆ¸ä¹Ÿä¸èƒ½éšä¾¿å‘ï¼Œè¦æ ¹æ®ç”¨æˆ·çš„å–œå¥½å‘ï¼Œä¸ªæ€§åŒ–åœ°å‘ï¼Œè¿™æ ·æ‰èƒ½å¸å¼•æ›´å¤šçš„ç”¨æˆ·æ¥ä¿ƒè¿›æ¶ˆè´¹ã€‚\næ¥ä¸‹æ¥æ˜¯æ ·æœ¬æ¥æºã€‚\né‚£æ•´ä¸ªé¡¹ç›®æ˜¯åœ¨åšä»€ä¹ˆï¼Ÿå°±æ˜¯å›´ç»•ç”¨æˆ·è¿‡å»æ€ä¹ˆé¢†å–ã€æ¶ˆè´¹ä¼˜æƒ åˆ¸ï¼Œæå–ä¸€äº›å…³é”®ç‰¹å¾ï¼Œæœ€åé¢„æµ‹ç”¨æˆ·åœ¨æœªæ¥ä¼šæ€ä¹ˆæ¶ˆè´¹ä¼˜æƒ åˆ¸ã€‚\næœ€åçš„è¯„æµ‹ç›®æ ‡æ˜¯é¢„æµ‹æŠ•æ”¾çš„ä¼˜æƒ åˆ¸æ˜¯å¦æ ¸é”€ï¼Œæˆ‘ä»¬ä½¿ç”¨ä¼˜æƒ åˆ¸æ ¸é”€çš„å¹³å‡AUCæ¥ä½œä¸ºè¯„åˆ†æ ‡å‡†ã€‚\nè¿™é‡Œç®€å•ä»‹ç»ä¸€ä¸‹AUCï¼Œä»‹ç»AUCå¾—å…ˆçŸ¥é“ROCæ˜¯ä»€ä¹ˆï¼ŒROCçºµè½´æ˜¯â€œçœŸæ­£ä¾‹ç‡TPRâ€ï¼Œæ¨ªè½´æ˜¯â€œå‡æ­£ä¾‹ç‡FPRâ€ã€‚AUCå°±æ˜¯ROCæ›²çº¿ä¸‹çš„é¢ç§¯ã€‚\n\n\næ•´ä¸ªO2Oä¼˜æƒ åˆ¸é¢„æµ‹åˆ†ä¸ºäº†å¦‚ä¸Šçš„å…­ä¸ªæ­¥éª¤\nå¯¹äºç‰¹å¾å·¥ç¨‹ï¼Œæˆ‘ä»…è€ƒè™‘äº†çº¿ä¸‹æ•°æ®é›†ï¼Œä¸»è¦ä»å†å²åŒºé—´å’Œæ ‡ç­¾åŒºé—´ä¸¤ä¸ªéƒ¨åˆ†è¿›è¡Œè€ƒè™‘ï¼Œæå–ç”¨æˆ·ï¼ˆUserï¼‰ã€å•†å®¶ï¼ˆMerchantï¼‰ã€ä¼˜æƒ åˆ¸ï¼ˆCouponï¼‰ï¼ŒåŒæ—¶ç»“åˆä¸€äº›äº¤äº’ç‰¹å¾ï¼Œæœ€åè¿˜å°†å°‘é‡è´¡çŒ®åº¦é«˜çš„ç‰¹å¾è¿›è¡Œæ’åˆ—ç»„åˆæ„é€ æ–°çš„ç‰¹å¾ã€‚\nç‰¹å¾æå–å®Œæ¯•åï¼Œä½¿ç”¨XGBoostæ¨¡å‹é¢„æµ‹ä¼˜æƒ åˆ¸ä½¿ç”¨æ¦‚ç‡ï¼Œè°ƒå‚å¾—åˆ°æœ€ä¼˜è§£ã€‚\næœ€åæˆ‘å°†ç‰¹å¾çš„é‡è¦æ€§è¿›è¡Œè¾“å‡ºï¼Œå¹¶ä¸”é€šè¿‡ä¸€ä¸ªè‡ªå®šä¹‰çš„aucå‡½æ•°æ¥æ¨¡æ‹Ÿæ¯”èµ›çš„aucç»“æœï¼Œè¾…åŠ©è¯„åˆ¤æ¨¡å‹ã€‚\næ•°æ®å¤„ç†é¦–å…ˆæˆ‘å…ˆæŸ¥çœ‹äº†å±æ€§åˆ—æœ‰å“ªäº›ã€‚å·¦ä¾§æ˜¯æ¯”èµ›å®˜æ–¹æä¾›çš„é¢„æµ‹æ ·æœ¬çš„å±æ€§åˆ—è¯´æ˜ï¼Œå¯¹äºé¢†å–è¡Œä¸ºï¼Œå¤šäº†ä¸€ä¸ªDateåˆ—ç”¨äºè®°å½•ç”¨æˆ·ä»€ä¹ˆæ—¶å€™æ ¸é”€äº†ä¼˜æƒ åˆ¸ã€‚\næ¥ä¸‹æ¥æˆ‘å¯¹æ•°æ®è¿›è¡Œä¸€ä¸ªæ•´ä½“é¢„è§ˆã€‚å…·ä½“å°±æ˜¯è¿›è¡Œä¸€äº›è®¡æ•°ï¼Œçœ‹çœ‹æœ‰å¤šå°‘æ¡è®°å½•ï¼Œç»Ÿè®¡ä¸‹æœ€æ—©æœ€æ™šçš„é¢†å–æ—¶é—´ã€‚\næ¥ç€ç»“åˆisnull()å’Œany()å¯¹æ•°æ®è¿›è¡Œç¼ºå¤±å€¼çš„æ£€æŸ¥ã€‚å¯ä»¥çœ‹åˆ°distanceå­˜åœ¨ç¼ºå¤±å€¼ã€‚\nç„¶åå¯¹æ•°æ®è¿›è¡Œé¢„å¤„ç†ã€‚ä¸»è¦åšäº†å¦‚ä¸Šè¿™äº›äº‹æƒ…ã€‚ç©ºè·ç¦»ç¼ºå¤±æˆ‘ç”¨-1æ¥è¿›è¡Œç®€å•çš„å¡«å……ã€‚åœ¨æå–ç‰¹å¾å‰ä¹Ÿè¦å¯¹æ•°æ®è¿›è¡Œä¸€ä¸ªé¢„å¤„ç†ã€‚\nâ€\né¢„å¤„ç†å®Œæ¯•åå°±å¯ä»¥å¯¹æ•°æ®è¿›è¡Œå¯è§†åŒ–äº†ã€‚è¿™é‡Œæˆ‘ä½¿ç”¨pyechartsç”Ÿæˆäº†å¦‚ä¸Šå‡ ä¸ªç»Ÿè®¡å›¾ã€‚æ¯ä¸ªç»Ÿè®¡å›¾å…¶å®å¯ä»¥åˆ†æå‡ºä¸€äº›ç”¨æˆ·åå¥½è¡Œä¸ºã€‚å°±æ‹¿ç”¨æˆ·æ¶ˆè´¹è·ç¦»ç»Ÿè®¡æ¥è¯´ï¼Œå¤§éƒ¨åˆ†ç”¨æˆ·çš„æ¶ˆè´¹è·ç¦»ä¸º0ï¼Œå³é¢†åˆ¸åç›´æ¥åœ¨é¢†å–åœ°ç‚¹æ¶ˆè´¹çš„ç”¨æˆ·æœ€å¤šï¼Œæ•°é‡ä¸º43867ã€‚è¯´æ˜å¾ˆå¤šç”¨æˆ·æ›´å€¾å‘äºåœ¨é¢†å–ä¼˜æƒ åˆ¸çš„é—¨åº—å†…ç›´æ¥ä½¿ç”¨ï¼Œè€Œä¸ä¼šå»å…¶ä»–æ›´è¿œçš„åœ°æ–¹æ¶ˆè´¹ã€‚éšç€è·ç¦»çš„å¢åŠ ï¼Œé¢†å–ç”¨æˆ·æ•°é‡é€æ¸å‡å°‘ã€‚è¯´æ˜å¤§å¤šæ•°ç”¨æˆ·æ›´å€¾å‘äºåœ¨è¾ƒè¿‘çš„èŒƒå›´å†…æ¶ˆè´¹ã€‚\nåœ¨ 10km æ—¶å‡ºç°å¼‚å¸¸é«˜å³°ï¼Œæ¨æµ‹æœ‰ä»¥ä¸‹åŸå› ï¼š\n\nç‰¹å®šå•†åœˆæˆ–é—¨åº— åœ¨ 10km ä½ç½®ï¼Œæœ‰å¤§é‡ç”¨æˆ·å‰å¾€ã€‚\nç”¨æˆ·è¯¯å·®ï¼šæ•°æ®é‡‡é›†æ—¶ï¼Œéƒ¨åˆ† 10km ä»¥ä¸Šçš„ç”¨æˆ·è¢«å½’ä¸º 10km\n\nâ€\nç”±äºæœ€ç»ˆçš„ç›®æ ‡æ˜¯è¦ç¡®å®šä¼˜æƒ åˆ¸æ˜¯å¦åœ¨15å¤©å†…è¦è¢«æ ¸é”€ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦å¯¹æ•°æ®è¿›è¡Œæ‰“æ ‡ã€‚å…·ä½“æ‰“æ ‡æ–¹å¼å°±æ˜¯æ–°åŠ labelåˆ—ï¼Œç®—ä¸€ä¸‹dateä¸date_receivedçš„å·®ï¼Œå¦‚æœåœ¨15å¤©å†…å°±è¯´æ˜æ ¸é”€ç‡ï¼Œè®°å½•ä¸º1ï¼Œå¦åˆ™ä¸º0ã€‚\nâ€\nç”±äºæ•°æ®æœ‰æ˜æ˜¾çš„æ—¶é—´æ€§ï¼Œæ‰€ä»¥å¯ä»¥é‡‡ç”¨æ—¶é—´çª—å£åˆ’åˆ†æ³•æ¥åˆ’åˆ†æ•°æ®é›†ã€‚è¿™ç§åˆ’åˆ†æ–¹æ³•æŠŠæ¯ä¸ªæ•°æ®é›†åˆ’åˆ†ä¸ºå†å²åŒºé—´ã€ä¸­é—´åŒºé—´å’Œæ ‡ç­¾åŒºé—´ã€‚å†å²åŒºé—´ä¸Šå­˜åœ¨ç”¨æˆ·è¿‡å¾€é¢†åˆ¸è¡Œä¸ºï¼Œä¸­é—´åŒºé—´ä½œä¸ºä¸€ä¸ªç¼“å†²ï¼Œå¢åŠ æ—¶é—´éš”ç¦»ï¼Œé¿å…æ•°æ®æ³„éœ²ï¼Œæ ‡ç­¾åŒºé—´åˆ™ç”¨æ¥æ¨¡æ‹ŸçœŸå®çš„ç›®æ ‡ï¼Œç”¨æ¥é¢„æµ‹ç”¨æˆ·æœªæ¥æ˜¯å¦æ ¸é”€ä¼˜æƒ åˆ¸ã€‚\nç‰¹å¾å·¥ç¨‹æ•´ä¸ªç‰¹å¾å·¥ç¨‹ä¸€å…±æå–äº†111ä¸ªç‰¹å¾ï¼Œåˆ†ä¸ºä¸‰ä¸ªéƒ¨åˆ†ã€‚æ¯ä¸ªéƒ¨åˆ†æå–çš„ç‰¹å¾å¯¹è±¡éƒ½ç±»ä¼¼ï¼Œä¹Ÿå°±æ˜¯ç”¨æˆ·ã€å•†å®¶ã€ä»¥åŠä¸€äº›äº¤äº’ç‰¹å¾ã€‚\nå¯¹äºäº¤å‰ç‰¹å¾ï¼Œä¸»è¦é€»è¾‘æ˜¯é€šè¿‡ä¸¤å±‚å¾ªç¯ï¼Œéå†ä¼ å…¥çš„éœ€è¦è¿›è¡Œäº¤å‰ç»„åˆçš„é«˜è´¡çŒ®åº¦ç‰¹å¾åˆ—ï¼Œä¸¤ä¸¤ç»„åˆï¼Œæ„é€ äº¤å‰ç‰¹å¾ã€‚\nè¿™é‡Œç®€å•è¯´ä¸‹ç‰¹å¾æ˜¯æ€ä¹ˆæå–çš„ï¼šä½¿ç”¨çš„æ˜¯pivot_table()é€è§†è¡¨æˆ–è€…groupby()ï¼ŒæŒ‰ç…§ä¸€ä¸ªåˆ†ç»„é”®ï¼Œåœ¨cntåˆ—æˆ–è€…å…¶ä»–åˆ—åº”ç”¨ä¸€ä¸ªæ–¹æ³•ï¼Œä¹Ÿå°±æ˜¯aggfuncï¼Œæœ€åæŠŠç»“æœé‡å‘½åæˆç‰¹å¾åï¼Œæœ€ååˆå¹¶è¿›ä¸»ç‰¹å¾è¡¨ã€‚å¦‚æœæœ‰ç¼ºå¤±å€¼ï¼Œå°±è¡¥å……ä¸º0.\näº¤å‰ç‰¹å¾ä¸å†èµ˜è¿°ã€‚\nâ€\nç‰¹å¾æå–å¥½ä»¥åï¼Œæˆ‘ä»¬æŠŠæ‰€æœ‰æå–å‡ºçš„ç‰¹å¾åˆå¹¶åˆ°å†å²åŒºé—´ä¸Šï¼Œç„¶åå»é™¤å…¬å…±åˆ—ï¼Œæœ€åä½¿ç”¨concat()åˆå¹¶è¿›æ•°æ®é›†ã€‚\næ¥ç€å¯¹æ•°æ®é›†è¿›è¡Œä¿®æ­£ï¼š\nå¯¹äºè®­ç»ƒé›†å’ŒéªŒè¯é›†ï¼Œå°†ä¸éœ€è¦è®­ç»ƒçš„æ•°æ®åˆ—ä½¿ç”¨drop()æ–¹æ³•åˆ é™¤ï¼Œå¹¶å°†labelæ”¾åœ¨æœ€åã€‚åŒæ—¶åŠ å…¥äº¤å‰ç‰¹å¾ã€‚\nå¯¹äºæµ‹è¯•é›†ï¼Œé™¤äº†åˆ é™¤ä¸éœ€è¦çš„åˆ—ï¼Œæˆ‘è¿˜å°†æ•°æ®æŸäº›åˆ—è½¬ä¸ºintå‹ï¼Œä¾¿äº xgboost è¯†åˆ«ã€‚åŒæ ·åœ°ä¹ŸåŠ å…¥äº¤å‰ç‰¹å¾ã€‚\næ¨¡å‹æ„å»ºä¸è¯„ä¼°æ¨¡å‹æ„å»ºçš„è¯ä¸»è¦æ˜¯è¿™å‡ ä¸ªæ­¥éª¤ã€‚\né¦–å…ˆå¾—ä¿®æ­£ä¸‹æ•°æ®é›†ï¼Œå› ä¸ºxgboostéœ€è¦æ•°å€¼å‹ç‰¹å¾æ•°æ®ï¼Œè€ŒUser_idã€Coupon_idä¸æ˜¯è®­ç»ƒæ•°æ®çš„ä¸€éƒ¨åˆ†ï¼Œå®ƒä»¬ä¸èƒ½æä¾›æœ‰ç”¨çš„ä¿¡æ¯ï¼Œå› æ­¤éœ€è¦åˆ é™¤ã€‚å¦ä¸€æ–¹é¢ï¼Œå¦‚æœå°†labelä¼ å…¥ï¼Œæ¨¡å‹å¯èƒ½ä¼šé€šè¿‡ç›®æ ‡å˜é‡ç›´æ¥çŒœæµ‹ç»“æœï¼Œè¿™æ ·ä¼šå¯¼è‡´æ¨¡å‹è®­ç»ƒæ—¶çš„â€œæ•°æ®æ³„æ¼â€é—®é¢˜ï¼Œä»è€Œå½±å“æ¨¡å‹çš„æ³›åŒ–èƒ½åŠ›ã€‚\næœ€åæˆ‘ä»¬å¾—åˆ°è®­ç»ƒé›†ã€éªŒè¯é›†å’Œæµ‹è¯•é›†ã€‚ç›‘æ§è®­ç»ƒé›†å’ŒéªŒè¯é›†ï¼Œå¼€å§‹è®­ç»ƒï¼Œæœ€åæŒ‰ç…§æ¯”èµ›è¦æ±‚è¾“å‡ºcsvã€‚\nâ€\nä¸‹é¢è®²ä¸‹xgboostçš„å‚æ•°ã€‚å·¦å›¾çš„è¿™äº›å‚æ•°å¯ä»¥åˆ†ä¸ºå¦‚ä¸Š6ç±»ã€‚è¿™äº›å‚æ•°å°±ä¸ä¸€ä¸€å±•å¼€è¯´äº†ï¼Œæˆ‘è®¤ä¸ºå€¼å¾—å…³æ³¨çš„æ˜¯etaå­¦ä¹ ç‡ï¼ˆè¶Šå°è®­ç»ƒè¶Šæ…¢ä½†ç¨³å®šï¼‰ã€max_depthæ ‘çš„æœ€å¤§æ·±åº¦ã€æœ€å°æŸå¤±å‡½æ•°ä¸‹é™å€¼ï¼ˆæ§åˆ¶èŠ‚ç‚¹æ˜¯å¦åˆ†è£‚ï¼‰gammaå’ŒL2 æ­£åˆ™åŒ–æƒé‡ï¼ˆå¯¹å¶å­æƒé‡çš„æƒ©ç½šï¼‰lambdaï¼šå¤§äº†å¯ä»¥é˜²æ­¢è¿‡æ‹Ÿåˆã€‚\nâ€\nä¸‹é¢è®²è®²æˆ‘çš„æåˆ†æ›²çº¿\næ•´ä¸ªæåˆ†è¿‡ç¨‹å‡ºç°äº†4æ¬¡ç“¶é¢ˆã€‚\nä»0.58åˆ°0.61ï¼šåœ¨baselineçš„åŸºç¡€ä¸Šï¼Œæ·»åŠ æ›´å¤šç‰¹å¾ï¼ŒåŒ…æ‹¬å†å²åŒºé—´å’Œæ ‡ç­¾åŒºé—´ã€‚\nä»0.61åˆ°0.71ï¼šå¾—ç›Šäºç”¨æˆ·æ ‡ç­¾åŒºé—´çš„leakageï¼Œè®©AUCæ•´æ•´æé«˜äº†0.1\n\nleakageæ˜¯ä¸€ç§æ•°æ®æ³„éœ²ï¼Œæ¯”å¦‚æ ‡ç­¾åŒºé—´ä¸Šå¯ä»¥å‡ºç°è¿™ç§æƒ…å†µï¼Œå°±æ˜¯ç”¨æˆ·åœ¨7æœˆ10æ—¥é¢†å–äº†ä¼˜æƒ åˆ¸ï¼Œè€Œåœ¨14å·ï¼Œ16å·åˆé¢†å–äº†åŒä¸€ç§ä¼˜æƒ åˆ¸ï¼Œè¯´æ˜7æœˆ10å·é¢†å–çš„ä¼˜æƒ åˆ¸è¢«æ ¸é”€çš„å¯èƒ½æ€§å¾ˆå¤§ã€‚ä½†æ˜¯å®é™…ç”Ÿäº§ç”Ÿæ´»ä¸­æ˜¯è·å–ä¸åˆ°è¿™ç§ç‰¹å¾çš„ã€‚\n\nä»0.71åˆ°0.74ï¼šæŒ–æ˜äº†ç”¨æˆ·æ ‡ç­¾åŒºé—´ä¸Šçš„æ›´å¤šç‰¹å¾ï¼Œå…¶ä¸­7å¤©å†…ç”¨æˆ·æ˜¯å¦å¤šæ¬¡é¢†å–åŒä¸€ä¼˜æƒ åˆ¸è´¡çŒ®æœ€å¤§ã€‚\nä»0.74åˆ°0.78ï¼šåœ¨ç”¨æˆ·æ ‡ç­¾åŒºé—´ä¸Šç»§ç»­æŒ–æ˜ä¸æ—¶é—´å¼ºç›¸å…³çš„ç‰¹å¾ã€‚å…¶ä¸­15å¤©ã€30å¤©å†…çš„é¢†åˆ¸æ¬¡æ•°çš„è´¡çŒ®æœ€å¤§ã€‚\nâ€\nä¸ºäº†æ–¹ä¾¿çŸ¥é“ç‰¹å¾çš„é‡è¦æ€§ï¼Œæˆ‘åˆ©ç”¨get_score()æ–¹æ³•å¯¹æ‰€æœ‰ç‰¹å¾è¿›è¡Œgainé‡è¦æ€§è¯„åˆ†ï¼Œæœ€åæŒ‰è´¡çŒ®åº¦æ’åºï¼Œæ–¹ä¾¿å‰ªé™¤è´¡çŒ®åº¦ä½çš„ç‰¹å¾ã€‚\nâ€\næˆ‘è¿˜åˆ©ç”¨äº†éªŒè¯é›†ï¼Œå¹¶ä¸”æ­é…early_stop_roundsè®©æ¨¡å‹æå‰æ”¶æ•›ï¼Œç¡®å®šæœ€ä½³è®­ç»ƒè½®æ•°ã€‚å¯ä»¥çœ‹åˆ°åœ¨1000æ¬¡è®­ç»ƒè½®æ•°çš„å‰æä¸‹ï¼Œæ¨¡å‹åœ¨846è½®æ€§èƒ½ä¸å†æå‡ï¼Œå®ç°æ—©åœï¼Œé¿å…äº†è¿‡æ‹Ÿåˆã€‚\nâ€\nå¯¹äºAUCçš„æå‡ï¼Œæˆ‘è¿˜åšè¿‡ä¸€äº›å°è¯•ã€‚\n1ã€å°è¯•ä½¿ç”¨LightGBMå’ŒXGBoostæ¨¡å‹èåˆï¼ŒåŠ æƒè¾“å‡ºç»“æœã€‚ä½†æ˜¯AUCåè€Œæ²¡æœ‰XGBoostå•ç‹¬è®­ç»ƒçš„AUCé«˜ï¼Œé‚ä»…ä½¿ç”¨XGBoostã€‚\n2ã€XGBoostè°ƒæ•´å‚æ•°é™·å…¥ç“¶é¢ˆï¼Œå‡ ä¹æ‰€æœ‰å‚æ•°çš„å¾®è°ƒéƒ½ä¼šå¯¼è‡´ AUC æŒ‡æ ‡ä¸‹é™ï¼Œæ¨¡å‹æ•ˆæœåè€Œå˜å·®ã€‚æœ€ç»ˆæˆ‘æ”¾å¼ƒäº†é€šè¿‡è°ƒå‚æå‡AUC çš„æ–¹å‘ï¼Œè½¬è€Œä»ç‰¹å¾å·¥ç¨‹è§’åº¦ä¼˜åŒ–æ¨¡å‹è¡¨ç°ã€‚\n3ã€æˆ‘è¿˜å°è¯•è¿‡åˆå¹¶è¿‡çº¿ä¸Šæ•°æ®é›†ï¼Œä½†æ˜¯ä¼šå‡ºç°å¤§é‡ç¼ºå¤±å€¼ï¼Œç”šè‡³é€ æˆâ€œæ•°æ®æ³„éœ²â€ã€‚å¯¼è‡´AUCä¸¥é‡ä¸‹é™ã€‚\nâ€\nâ€\nK-Means\nå‚æ•°xä»£è¡¨æ•°æ®é›†ã€kä»£è¡¨ç°‡çš„æ•°é‡ã€iterä»£è¡¨æœ€å¤§è¿­ä»£æ¬¡æ•°ã€tolä»£è¡¨ç°‡ä¸­å¿ƒçš„å®¹å¿è¯¯å·®èŒƒå›´ã€‚\næ•´ä¸ªå‡½æ•°ä¸»è¦åˆ†ä¸º4æ­¥ã€‚\né¦–å…ˆä½¿ç”¨random.sample()æ–¹æ³•ï¼Œä»æ•°æ®é›†xä¸­ï¼Œéšæœºé€‰å–kä¸ªç‚¹ä½œä¸ºåˆå§‹ç°‡ä¸­å¿ƒã€‚\næ¥ç€åˆå§‹åŒ–ä¸€ä¸ªæ ‡ç­¾åˆ—è¡¨ï¼Œå…¨éƒ¨å³ä¸ºNoneã€‚ç„¶ååˆ©ç”¨get_distanceåˆ†åˆ«è®¡ç®—æ¯ä¸ªç‚¹åˆ°åˆå§‹ç°‡ä¸­å¿ƒçš„è·ç¦»ï¼Œå°†æ‰€æœ‰è·ç¦»ä¸­æœ€å°çš„ä¸€ä¸ªä¿å­˜åœ¨æ–°æ ‡ç­¾åˆ—è¡¨ä¸­ï¼Œç„¶åä¸æ–­è¿­ä»£ï¼Œç›´åˆ°æ–°æ—§æ ‡ç­¾å®Œå…¨ç›¸åŒã€‚ç„¶åæ›´æ–°ç°‡ä¸­å¿ƒï¼Œæ›´æ–°æ–¹æ³•æ˜¯è®¡ç®—æ¯ä¸ªç°‡ä¸­æ‰€æœ‰ç‚¹çš„å‡å€¼ä½œä¸ºæ–°çš„ç°‡ä¸­å¿ƒã€‚å…·ä½“ç®—æ³•æ˜¯åˆå§‹åŒ–ä¸€ä¸ªä¸­å¿ƒåˆ—è¡¨ç”¨æ¥ä¿å­˜æ–°çš„ç°‡ä¸­å¿ƒã€‚ç„¶åè·å–å½“å‰ç°‡ä¸­æ‰€æœ‰çš„ç‚¹ï¼Œæ¥ç€è®¡ç®—è¿™äº›ç‚¹æ¨ªçºµåæ ‡çš„å‡å€¼ï¼ŒæŠŠè®¡ç®—ç»“æœä¿å­˜åœ¨ä¸­å¿ƒåˆ—è¡¨ä¸­ã€‚åˆ©ç”¨allclose()æ–¹æ³•åˆ¤æ–­æ–°çš„ç°‡ä¸­å¿ƒä¸åŸæ¥ç°‡ä¸­å¿ƒä¹‹é—´çš„è¯¯å·®æ˜¯å¦ä¸å¤§äºtolï¼Œæ»¡è¶³æ¡ä»¶å°±ç»ˆæ­¢è¿­ä»£ã€‚\næœ€åè¿”å›ç°‡ä¸­å¿ƒä¸è·ç¦»æ•°ç»„ã€‚\nâ€\næœ€åè¯´ä¸‹å¿ƒå¾—ä½“ä¼š\nåœ¨ä¸Šè¿™é—¨è¯¾ä¹‹å‰ï¼Œæˆ‘ä¸€ç›´ä¸“æ³¨äºäº‘åŸç”Ÿå®¹å™¨åŒ–é¢†åŸŸï¼Œå¯¹æœºå™¨å­¦ä¹ ã€äººå·¥æ™ºèƒ½çš„è®¤è¯†ä¹Ÿä»…ä»…åœç•™åœ¨â€œé—®é—®AIé—®é¢˜é˜¶æ®µâ€ï¼Œä»æ¥æ²¡æœ‰æ·±å…¥ç ”ç©¶è¿‡èƒŒåçš„å®ç°æœºåˆ¶ã€‚è¿™æ¬¡çš„O2Oä¼˜æƒ åˆ¸é¢„æµ‹é¡¹ç›®è®©æˆ‘æ·±åˆ»ä½“ä¼šåˆ°äº†æ•°æ®æŒ–æ˜å’Œæœºå™¨å­¦ä¹ çš„é­…åŠ›ï¼Œæœ€è®©æˆ‘æŒ¯å¥‹çš„æ˜¯æˆ‘çš„æåˆ†å†ç¨‹ï¼Œå…¶ä¸­ï¼Œå—åˆ° wepe æç¤ºçš„ leakage ç‰¹å¾å¯å‘ï¼Œæˆ‘æˆåŠŸå°† AUC æå‡äº†æ•´æ•´ 0.1ã€‚\nåœ¨ä» 0.71 åˆ° 0.78 çš„å…³é”®é˜¶æ®µï¼Œæˆ‘è®°å¾—ä»å‘¨äº”åˆ°å‘¨æ—¥æˆ‘çœ‹äº†æ•´æ•´3å¤©ï¼Œå°è¯•äº†å¤šç§æ–¹æ³•ï¼ŒåŒ…æ‹¬åˆå¹¶çº¿ä¸Šç‰¹å¾ã€æ„é€ äº¤å‰ç‰¹å¾ã€ç½‘æ ¼æœç´¢å‚æ•°è°ƒä¼˜å’Œæ¨¡å‹èåˆç­‰ï¼Œä½†æ•ˆæœéƒ½ä¸æ˜¾è‘—ã€‚è¿™ä¸€åº¦è®©æˆ‘æ€€ç–‘è‡ªå·±çš„æ–¹å‘ï¼Œç”šè‡³å¼€å§‹è§‰å¾—æœºå™¨å­¦ä¹ å°±æ˜¯ä¸€åœºâ€œé»‘ç›’æµ‹è¯•â€ã€‚ä¸ºæ­¤ï¼Œæˆ‘ä¸»åŠ¨å¯»æ±‚å­¦é•¿çš„æŒ‡å¯¼ï¼Œå¹¶æŸ¥é˜…å¤§é‡åšå®¢å’Œå¤§æ¨¡å‹çš„å»ºè®®ï¼Œæœ€ç»ˆæ„è¯†åˆ°é—®é¢˜å‡ºåœ¨ç‰¹å¾å·¥ç¨‹ä¸Šè¿˜ä¸å¤Ÿæ·±å…¥ã€‚\né€šè¿‡ä¸æ–­å°è¯•ä¸è°ƒæ•´ï¼Œæˆ‘é€æ­¥è§£å†³äº†ä¸€éƒ¨åˆ†é—®é¢˜ï¼Œä½†ä¹Ÿæ„è¯†åˆ°è‡ªèº«æŠ€æœ¯èƒ½åŠ›ä»æœ‰ä¸è¶³ï¼Œå¯¹æŸäº›é—®é¢˜çš„æ ¹æºä»æœªå®Œå…¨ç†è§£ï¼Œå°šæœªæ‰¾åˆ°æœ‰æ•ˆçš„è§£å†³æ–¹æ¡ˆã€‚ç›®å‰æ¨¡å‹çš„AUCè¾¾åˆ°äº† 0.78ï¼Œä»æœ‰è¿›ä¸€æ­¥æå‡çš„ç©ºé—´ï¼Œæ¯”å¦‚åŠ å…¥ç”¨æˆ·çº¿ä¸Šè¡Œä¸ºç‰¹å¾ã€é’ˆå¯¹æ€§è°ƒæ•´æ¨¡å‹å‚æ•°ã€æŒ–æ˜ä¸æ˜ŸæœŸç›¸å…³çš„æ—¶é—´ç‰¹å¾ç­‰ã€‚\nè¯´åˆ°æœ€åï¼Œå…¶å®æ•°æ®æŒ–æ˜æŒºæœ‰è¶£çš„ï¼Œç‰¹åˆ«æ˜¯ä½ å¯ä»¥ä»ä¸€å †é™æ€çš„æ•°æ®é‡Œï¼Œå‘ç°ä¸€äº›æœ‰æ„æ€çš„ä¸œè¥¿ï¼Œè¿™ä¹Ÿè®¸å°±æ˜¯å¤§æ•°æ®çš„é­…åŠ›ã€‚\n","categories":["æœºå™¨å­¦ä¹ "],"tags":["æœºå™¨å­¦ä¹ "]},{"title":"wasm-plugin-github action","url":"/2025/12/08/wasm-plugin-github%20action/","content":"åŠŸèƒ½æè¿°åŠŸèƒ½ï¼šæ·»åŠ äº†åˆ©ç”¨ GitHub Actions æ¥è‡ªåŠ¨å®Œæˆç›¸åº”çš„é•œåƒæ„å»ºå’Œå‘å¸ƒå·¥ä½œçš„Workflowã€‚æ”¯æŒé€šè¿‡push tagå’Œæ‰‹åŠ¨è§¦å‘ä¸¤ç§æ–¹å¼ã€‚åŒæ—¶ä¹Ÿéµå¾ªä½¿ç”¨orasæ‰“åŒ…å·¥å…·ã€‚ç‰¹ç‚¹ï¼šå®Œå…¨æŒ‰ç…§Wasm æ’ä»¶é•œåƒè§„èŒƒè¿›è¡Œé•œåƒæ‰“åŒ…ã€‚\næ›´æ–°ï¼š\n\næ·»åŠ äº†æŸ¥æ‰¾æ–‡ä»¶çš„é€»è¾‘ï¼Œä¼šåœ¨æ’ä»¶ç›®å½•ä¸­æŸ¥æ‰¾spec.yamlâ€‹ã€README.mdâ€‹å’ŒREADME-{lang}.mdâ€‹ä¸‰ä¸ªæ–‡ä»¶ï¼Œæœ‰åˆ™åœ¨æ‰“åŒ…æ¨é€é•œåƒæ—¶è®¾ç½®ç›¸åº”çš„media typeâ€‹ã€‚\nä¿®æ”¹äº†reviewåå­˜åœ¨çš„é—®é¢˜ã€‚\nä¿®æ”¹äº†builderâ€‹å®¹å™¨çš„å¯åŠ¨å‘½ä»¤ä¸º docker run -itd --name builder xxx /bin/bashâ€‹ï¼Œä¹‹å‰ä½¿ç”¨sleep 99999â€‹æ˜¯å¸Œæœ›å®¹å™¨ä¿æŒåå°æŒç»­è¿è¡Œï¼Œè¿™æ ·åªé€‚åˆæµ‹è¯•å®¹å™¨ï¼Œä¸é€‚åˆåœ¨ç”Ÿäº§ç¯å¢ƒä¸­ä½¿ç”¨ã€‚\né‡æ–°æäº¤PRâ€‹æ˜¯å› ä¸ºé”™è¯¯åœ°æäº¤äº†ä¸€äº›æ²¡ç”¨çš„commitâ€‹ï¼Œä¸å¤ªä¼šåˆ é™¤ï¼Œæ‹…å¿ƒç ´åä»“åº“å¹¶ä¸”ä¸ºäº†ä¿æŒPRâ€‹æ•´æ´æ‰€ä»¥é‡æ–°æäº¤ã€‚\n\n1.å‡†å¤‡å·¥ä½œæ·»åŠ Repository Secretså’Œ Repository variablesã€‚â€‹â€‹2.é€šè¿‡push tagâ€‹è§¦å‘ï¼Œå…ˆæŸ¥æ‰¾ç›¸å…³æ–‡ä»¶ï¼Œç„¶åå°†ç‰¹å®šçš„æ’ä»¶æ‰“åŒ…æˆé•œåƒå¹¶æ¨é€è‡³æŒ‡å®šä»“åº“ã€‚â€‹\n\nâ€‹3.äººå·¥è§¦å‘ï¼ŒæŒ‡å®šæ’ä»¶åå’Œç‰ˆæœ¬å·â€‹\næœ¬æ¬¡è´¡çŒ®å€ŸåŠ©äº†é€šä¹‰çµç ä»¥åŠé€šä¹‰åƒé—®ã€‚â€‹â€‹â€‹â€‹\nâ€\néªŒè¯\nçº æ­£äº†æ‰“åŒ…å®¹å™¨çš„TinyGOâ€‹ç‰ˆæœ¬ä¸º0.28.1â€‹ï¼Œç¡®ä¿é•œåƒå¯ç”¨ã€‚\nä¿®æ”¹äº†ç¼–è¯‘å‘½ä»¤ä¸ºtinygo build -o ./plugin.wasm -scheduler=none -target=wasi -gc=custom -tags=&#39;custommalloc nottinygc_finalizer&#39; ./main.goâ€‹ï¼Œç¡®ä¿plugin.wasmâ€‹å¯ç”¨ã€‚\nä¿®æ”¹push_commandâ€‹ï¼Œæœ€åè®¾ç½®plugin.tar.gzâ€‹çš„media typeâ€‹ï¼Œç¡®ä¿å…¶ä½äºé•œåƒæœ€åä¸€å±‚ã€‚\n\néªŒè¯\nç¯å¢ƒä»‹ç»\n\nKuberneteséƒ¨ç½²Higressï¼ŒGatewayä½äº32459ç«¯å£ã€‚\nhigress.yiiong.topâ€‹è§£æè‡³æœåŠ¡å™¨ã€‚\nKuberneteséƒ¨ç½²äº†ä¸€ä¸ªNginxæµ‹è¯•æœåŠ¡ï¼Œå¢åŠ ä¸€ä¸ªhello.htmlâ€‹ï¼Œè®¿é—®ä¼šè¿”å›Hello World!â€‹\nå¢åŠ ä¸€ä¸ªingressâ€‹\n\n\n\nç»Github Actionâ€‹æ‰“åŒ…å‡ºé•œåƒã€‚\n\né€”å¾„ä¸€ï¼šé€šè¿‡é…ç½®æ¸…å•éƒ¨ç½²æ‰“åŒ…å¥½çš„request-blockâ€‹æ’ä»¶ï¼Œæ‹’ç»è®¿é—®/hello.htmlâ€‹ï¼Œå¯ä»¥çœ‹åˆ°æˆåŠŸè¢«æ‹’ç»è®¿é—®ã€‚\n\né€”å¾„äºŒï¼šé€šè¿‡æ§åˆ¶å°æ–°å¢æ’ä»¶ï¼ŒåŒæ ·å¯ä»¥æ‹’ç»è®¿é—®ã€‚\n\n\n\n\nGithub Actionname: Build and Push Wasm Plugin Imageon:  push:    tags:    - &quot;wasm-go-*-v*.*.*&quot; # åŒ¹é… wasm-go-&#123;pluginName&#125;-vX.Y.Z æ ¼å¼çš„æ ‡ç­¾  workflow_dispatch:    inputs:      plugin_name:        description: &#x27;Name of the plugin&#x27;        required: true        type: string      version:        description: &#x27;Version of the plugin (optional, without leading v)&#x27;        required: false        type: stringjobs:  build-and-push-image:    runs-on: ubuntu-latest    environment:      name: image-registry-msg    env:      IMAGE_REGISTRY_SERVICE: $&#123;&#123; vars.IMAGE_REGISTRY_SERVICE || &#x27;higress-registry.cn-hangzhou.cr.aliyuncs.com&#x27; &#125;&#125;      IMAGE_REPOSITORY: $&#123;&#123; vars.IMAGE_REPOSITORY || &#x27;plugins&#x27; &#125;&#125;      GO_VERSION: 1.19      TINYGO_VERSION: 0.28.1      ORAS_VERSION: 1.0.0    steps:      - name: Set plugin_name and version from inputs or ref_name        id: set_vars        run: |          if [[ &quot;$&#123;&#123; github.event_name &#125;&#125;&quot; == &quot;workflow_dispatch&quot; ]]; then            plugin_name=&quot;$&#123;&#123; github.event.inputs.plugin_name &#125;&#125;&quot;            version=&quot;$&#123;&#123; github.event.inputs.version &#125;&#125;&quot;          else            ref_name=$&#123;&#123; github.ref_name &#125;&#125;            plugin_name=$&#123;ref_name#*-*-&#125; # åˆ é™¤æ’ä»¶åå‰é¢çš„å­—æ®µ(wasm-go-)            plugin_name=$&#123;plugin_name%-*&#125; # åˆ é™¤æ’ä»¶ååé¢çš„å­—æ®µ(-vX.Y.Z)            version=$(echo &quot;$ref_name&quot; | awk -F&#x27;v&#x27; &#x27;&#123;print $2&#125;&#x27;)          fi          echo &quot;PLUGIN_NAME=$plugin_name&quot; &gt;&gt; $GITHUB_ENV          echo &quot;VERSION=$version&quot; &gt;&gt; $GITHUB_ENV      - name: Checkout code        uses: actions/checkout@v3      - name: File Check        run: |           workspace=$&#123;&#123; github.workspace &#125;&#125;/plugins/wasm-go/extensions/$&#123;PLUGIN_NAME&#125;          push_command=&quot;./plugin.tar.gz:application/vnd.oci.image.layer.v1.tar+gzip&quot;          # æŸ¥æ‰¾spec.yaml          if [ -f &quot;$&#123;workspace&#125;/spec.yaml&quot; ]; then            echo &quot;spec.yaml exists&quot;            push_command=&quot;./spec.yaml:application/vnd.module.wasm.spec.v1+yaml $push_command &quot;          fi          # æŸ¥æ‰¾README.md          if [ -f &quot;$&#123;workspace&#125;/README.md&quot; ];then              echo &quot;README.md exists&quot;              push_command=&quot;./README.md:application/vnd.module.wasm.doc.v1+markdown $push_command &quot;          fi                  # æŸ¥æ‰¾README_&#123;lang&#125;.md          for file in $&#123;workspace&#125;/README_*.md; do            if [ -f &quot;$file&quot; ]; then              file_name=$(basename $file)              echo &quot;$file_name exists&quot;              lang=$(basename $file | sed &#x27;s/README_//; s/.md//&#x27;)              push_command=&quot;./$file_name:application/vnd.module.wasm.doc.v1.$lang+markdown $push_command &quot;            fi          done          echo &quot;PUSH_COMMAND=\\&quot;$push_command\\&quot;&quot; &gt;&gt; $GITHUB_ENV            - name: Run a wasm-go-builder        env:           PLUGIN_NAME: $&#123;&#123; env.PLUGIN_NAME &#125;&#125;          BUILDER_IMAGE: higress-registry.cn-hangzhou.cr.aliyuncs.com/plugins/wasm-go-builder:go$&#123;&#123; env.GO_VERSION &#125;&#125;-tinygo$&#123;&#123; env.TINYGO_VERSION &#125;&#125;-oras$&#123;&#123; env.ORAS_VERSION &#125;&#125;        run: |          docker run -itd --name builder -v $&#123;&#123; github.workspace &#125;&#125;:/workspace -e PLUGIN_NAME=$&#123;&#123; env.PLUGIN_NAME &#125;&#125; --rm $&#123;&#123; env.BUILDER_IMAGE &#125;&#125; /bin/bash      - name: Build Image and Push        run: |                  push_command=$&#123;&#123; env.PUSH_COMMAND &#125;&#125;          push_command=$&#123;push_command#\\&quot;&#125;          push_command=$&#123;push_command%\\&quot;&#125; # åˆ é™¤PUSH_COMMANDä¸­çš„åŒå¼•å·ï¼Œç¡®ä¿oras pushæ­£å¸¸è§£æ          command=&quot;          cd /workspace/plugins/wasm-go/extensions/$&#123;PLUGIN_NAME&#125;          go mod tidy          tinygo build -o ./plugin.wasm -scheduler=none -target=wasi -gc=custom -tags=&#x27;custommalloc nottinygc_finalizer&#x27; ./main.go          tar czvf plugin.tar.gz plugin.wasm          echo $&#123;&#123; secrets.REGISTRY_PASSWORD &#125;&#125; | oras login -u $&#123;&#123; secrets.REGISTRY_USERNAME &#125;&#125; --password-stdin $&#123;&#123; env.IMAGE_REGISTRY_SERVICE &#125;&#125;          oras push $&#123;IMAGE_REGISTRY_SERVICE&#125;/$&#123;IMAGE_REPOSITORY&#125;:$&#123;VERSION&#125; $&#123;push_command&#125;          &quot;          docker exec builder bash -c &quot;$command&quot;\n","categories":["Achievements"],"tags":["CICD"]},{"title":"Baiduå®ä¹ æ€»ç»“","url":"/2025/12/08/%E5%AE%9E%E4%B9%A0%E6%80%BB%E7%BB%93/","content":"æ—¶é—´è¿‡å¾—çœŸå¿«ï¼Œä¸çŸ¥ä¸è§‰ä¸­ï¼ŒçŸ­æš‚åˆæ¼«é•¿çš„ä¸‰ä¸ªå¤šæœˆåŒ—æ¼‚å®ä¹ ç”Ÿæ´»å°±è¦ç”»ä¸Šå¥å·äº†ã€‚å‘¨å›´çš„ä¸€åˆ‡å¥½åƒéƒ½çŸ¥é“æˆ‘è¦å‡†å¤‡ç¦»å¼€äº†ï¼šæ´—æ¾¡çš„è‚¥çš‚åˆšå¥½å¿«ç”¨å®Œäº†ã€æ´—é¢å¥¶ä¹Ÿæ˜¯ã€è·¯è¾¹çš„é“¶ææ ‘ä¹Ÿéƒ½è½å…‰äº†å¶å­â€¦â€¦è¯´å®è¯ï¼ŒçœŸèˆä¸å¾—ç»“æŸå®ä¹ ã€‚\nè¿™æ®µæ—¶é—´é‡Œï¼Œåšäº†ä¸€äº›äº‹ã€è®¤è¯†äº†ä¸€äº›äººï¼Œä½“éªŒäº†ä¸€æ®µéš¾å¿˜çš„åŒ—æ¼‚æ—¶å…‰ï¼Œè‡ªå·±ä¹Ÿæˆé•¿äº†è®¸å¤šã€‚\nå¾ˆå¹¸è¿è‡ªå·±åœ¨å®ä¹ æœŸé—´é‡åˆ°äº†ç‰¹åˆ«å¥½çš„mentorã€leaderå’Œååˆ†å“è¶Šçš„å›¢é˜Ÿï¼Œè¿˜æœ‰æˆ‘çš„å‡ ä¸ªâ€œå®ä¹ æ­å­â€ã€‚çœŸå¸Œæœ›è‡ªå·±ä»¥åå·¥ä½œäº†ä¹Ÿèƒ½é‡åˆ°å’Œä»–ä»¬ä¸€æ ·å¥½çš„äººï¼Œä¹Ÿå¸Œæœ›è‡ªå·±ä»¥åèƒ½åƒä»–ä»¬ä¸€æ ·ä¼˜ç§€ã€‚\næˆé•¿ç¯‡å›æƒ³èµ·è¿™æ®µå®ä¹ ç»å†ï¼Œæ„Ÿè§‰è‡ªå·±æ˜¯å¹¸è¿çš„ï¼Œèƒ½æ¥ç™¾åº¦è¿™æ ·çš„äº’è”ç½‘å¤§å‚æˆ‘è§‰å¾—å¹¶ä¸æ˜¯è‡ªå·±çš„å®åŠ›æœ‰å¤šå¼ºï¼Œæ›´å¤šçš„æ˜¯è¿æ°”ã€‚\nç¬¬ä¸€æ¬¡æ¥åˆ°ä¸­å…³æ‘è½¯ä»¶å›­ï¼Œè¿™é‡Œéå¸ƒç€å¹³æ—¶è€³ç†Ÿèƒ½è¯¦çš„äº’è”ç½‘å…¬å¸ï¼Œä»€ä¹ˆè…¾è®¯ã€å¿«æ‰‹ã€æ»´æ»´â€¦â€¦ç®€ç›´å°±æ˜¯ä¸­å›½äº’è”ç½‘çš„â€œåå­—è·¯å£â€ã€‚\næœ‰æ—¶å€™ä¸Šä¸‹ç­ï¼Œçœ‹åˆ°ç™¾åº¦ç§‘æŠ€å›­ä¸Šçš„â€œç†ŠæŒâ€å¤§logoï¼Œå¿ƒé‡Œæ€»æ˜¯ä¼šæ„Ÿå¹ï¼šåŸæ¥æˆ‘ä¹Ÿèƒ½åœ¨è¿™é‡Œå®ä¹ å•Šã€‚\nâ€‹\nä¸ªäººèƒ½åŠ›è¿™ä¸‰ä¸ªå¤šæœˆï¼Œæˆ‘æƒ³ç‰¹åˆ«æ„Ÿè°¢æˆ‘çš„mentoræ°å“¥ã€‚\nåˆšå¼€å§‹çš„ä¸€ä¸ªæœˆé‡Œï¼Œæˆ‘ç»å¸¸ä¼šåšä¸€äº›åâ€œè¿è¥â€çš„å·¥ä½œï¼šæ¯”å¦‚è·Ÿè¿›æ•…éšœæ”¹è¿›è¿›åº¦ã€å½•å…¥èµ„æºä¿¡æ¯ç­‰ç­‰ï¼Œæˆ‘æ€»è§‰å¾—è‡ªå·±æ˜¯â€œå¹²æ‚æ´»â€çš„ã€‚å…¶å®è¿™æ®µæ—¶é—´çš„ç›®çš„ä¸»è¦æ˜¯ä¸ºäº†ç†Ÿæ‚‰å·¥ä½œæµç¨‹ã€‚åˆ°ç°åœ¨ï¼Œæˆ‘å·²ç»èƒ½æ¯”è¾ƒç†Ÿç»ƒçš„ä½¿ç”¨å›¢é˜Ÿçš„è¿ç»´å¹³å°ï¼Œç‰¹åˆ«æ˜¯åŸºäºbusiness formçš„ä½ä»£ç åŠŸèƒ½åˆ¶ä½œä¸€äº›Grafanaæ“ä½œé¢æ¿ï¼Œæˆ‘ç”šè‡³åœ¨å³å°†ç¦»èŒçš„è¿™æ®µæ—¶é—´é‡Œèƒ½å¤Ÿå‡ ä¹ç‹¬ç«‹å¯¹æ¥ä¸€ä¸ªå•†é‡‡ä»£ç å®¡æŸ¥å¹³å°çš„è¿ç»´å·¥ä½œï¼ŒçœŸçš„æ„Ÿè§‰è¶Šå¹²è¶Šæœ‰å…´è¶£ã€‚\né™¤äº†åˆ†é…ä»»åŠ¡ï¼Œmtç»å¸¸ä¼šç»™æˆ‘ä¸€äº›â€œèŒåœºé“ç†â€å’Œå¿ƒé‡Œè¯ã€‚æœ‰ä¸€ä¸¤æ¬¡æˆ‘åœ¨å·¥ä½œä¸Šå‡ºäº†å·®é”™ï¼Œæ°å“¥æ²¡æœ‰æ‰¹è¯„æˆ‘ï¼Œè€Œæ˜¯çº æ­£ï¼Œé»˜è®¤ä»¥â€œç»éªŒä¸è¶³â€æ¥åŒ…å®¹æˆ‘ã€‚æ°å“¥å¯¹å¾…ä»»ä½•äº‹éƒ½æ˜¯ç²¾ç›Šæ±‚ç²¾çš„ï¼Œåˆšæ¥çš„ä¸€ä¸ªæœˆæ°å“¥ç»å¸¸ä¼šè®©åˆ¶ä½œä¸€äº›ç›‘æ§å›¾é¢æ¿ï¼Œå½“æ—¶æˆ‘åšå¥½é¢æ¿äº¤ä»˜ç»™æ°å“¥ï¼Œæ°å“¥æ€»æ˜¯â€œä¸æ»¡æ„â€ï¼Œç„¶åä¿®æ”¹å¾ˆå¤šï¼Œå¯¼è‡´æˆ‘æœ‰äº›â€œç ´é˜²â€ã€‚åæ¥æˆ‘æ˜ç™½ï¼Œåœ¨èŒåœºé‡Œçš„äº‹æ— å·¨ç»†å…¶å®æ˜¯å¯¹è‡ªå·±çš„ä¸€ç§è‡ªä¿ï¼Œå› ä¸ºåšäº‹é©¬è™ï¼Œå¾€å¾€å‡ºé—®é¢˜æ—¶è‡ªå·±ä¼šâ€œèƒŒé”…â€ã€‚\nå¦å¤–æ°å“¥ä¹Ÿç»å¸¸å‘Šè¯‰æˆ‘åšäº‹è¦æœ‰é€»è¾‘æ€§ï¼Œè¦åŸ¹å…»è‡ªå·±çš„æ€ç»´èƒ½åŠ›ã€‚AIæ—¶ä»£ï¼Œæ™®é€šäººåœ¨æŠ€æœ¯ä¸Šå·²ç»ä¸åˆ†ä¸Šä¸‹ï¼Œæœ€é‡è¦çš„æ˜¯åšä¸€ä»¶äº‹è¦æœ‰è‡ªå·±çš„æ€è·¯ï¼Œè¦æœ‰è‡ªå·±çš„é€»è¾‘ã€‚å°±åƒäººäººéƒ½èƒ½ç”¨AIï¼Œä½†æ˜¯ç”¨çš„å¥½ä¸å¥½å¾—çœ‹promptæ˜¯ä»€ä¹ˆã€‚\nSREæ€ç»´SREæ€ç»´çš„åŸ¹å…»ï¼Œæˆ‘æƒ³ç‰¹åˆ«æ„Ÿè°¢æˆ‘çš„leaderã€‚\næœ‰æ¬¡å¶ç„¶çš„æœºä¼šç¿»åˆ°äº†leaderçš„blogï¼Œleaderçš„SREè¿ç»´ä¹‹è·¯å¯ä»¥ç”¨â€œä¼ å¥‡â€æ¥å½¢å®¹ã€‚ä»–åœ¨ä¸Šå®¶å…¬å¸ï¼Œåšåˆ°äº†å…¨å…¬å¸ä¸€å·è¿ç»´ï¼Œå„ç§å¥–æ‹¿äº†ä¸ªéã€‚ç°åœ¨æˆ‘æ‰€å¤„çš„å›¢é˜Ÿä¹Ÿæ˜¯ä»–ä¸€æ‰‹å¸¦èµ·æ¥çš„ï¼Œåœ¨å»å¹´è¿˜æ‹¿åˆ°äº†â€œå“è¶Šå›¢é˜Ÿâ€çš„è£èª‰ç§°å·ã€‚ï¼ˆæˆ‘ä»¥åä¹Ÿè¦åƒä»–ä¸€æ ·ä¼˜ç§€å“‡ï¼‰\nleaderåœ¨SREè¿ç»´é¢†åŸŸé¢‡æœ‰é€ è¯£ï¼Œåœ¨å›¢é˜Ÿçš„çŸ¥è¯†åº“é‡Œï¼Œæˆ‘å­¦åˆ°äº†å¾ˆå¤šã€‚ç‰¹åˆ«æ˜¯åœ¨å˜æ›´ç®¡ç†ã€æ•…éšœç®¡ç†ã€èµ„æºç›˜ç‚¹ç®¡ç†ä»¥åŠå„ç§åˆ¶åº¦è§„èŒƒã€‚æˆ‘è§‰å¾—å¾ˆå¤šåœ°æ–¹éƒ½æ˜¯ç½‘æ ¡å¯ä»¥å‚è€ƒçš„ã€‚æˆ‘è®¤ä¸ºæœ€å€¼å¾—å­¦ä¹ çš„æ˜¯å˜æ›´ç®¡ç†å’Œèµ„æºç›˜ç‚¹ç®¡ç†ã€‚å¯¹äºå˜æ›´ç®¡ç†ï¼Œå›¢é˜Ÿå¯¹å˜æ›´æœ‰ç€ä¸¥æ ¼çš„è§„èŒƒï¼Œè¦æ±‚æ¯åœ¨CDå¹³å°ä¸Šå‘å¸ƒï¼Œéƒ½éœ€è¦æœ‰å¯¹åº”çš„å˜æ›´å•ã€‚è¿™æ–¹é¢æˆ‘ä¹Ÿå‚ä¸äº†å˜æ›´åˆè§„å®¡æŸ¥çš„è‡ªåŠ¨åŒ–åˆ¤åˆ«ä»»åŠ¡ï¼Œä¸è¿‡å› ä¸ºä¸åˆè§„æƒ…å†µç§ç±»å¤ªå¤šï¼Œè‡ªå·±èƒ½åŠ›æœ‰é™ï¼ˆå¤ªèœï¼‰ï¼Œè¿™å—æœ€ç»ˆæ²¡æœ‰å®Œç¾å®ç°â€¦â€¦\nè¿˜æœ‰å°±æ˜¯èµ„æºç›˜ç‚¹ç®¡ç†ï¼Œå›¢é˜ŸæŠŠæ‰€å±èµ„æºåˆ†ä¸ºäº†ç³»ç»Ÿã€æ¨¡å—å’Œç»„ä»¶ä¸‰ç±»ï¼Œç„¶åå°†åˆ†ç±»æƒ…å†µå±•ç¤ºåœ¨è‡ªç ”è¿ç»´å¹³å°æŠ¤èˆªï¼ˆGrafanaï¼‰ï¼Œæˆ‘è§‰å¾—åšèµ„æºç›˜ç‚¹æ˜¯ååˆ†æœ‰å¿…è¦çš„ï¼Œå› ä¸ºèº«ä¸ºè¿ç»´ï¼Œä½ å¿…é¡»è¦çŸ¥é“è‡ªå·±è¿ç»´äº†ä»€ä¹ˆã€‚\nç™½å±åŒ–ä¹Ÿæ˜¯ä¸€ä¸ªå€¼å¾—å­¦ä¹ çš„åœ°æ–¹ã€‚å›¢é˜Ÿä¼šå†™ä¸€äº›å¸¦å‚æ•°çš„è‡ªåŠ¨åŒ–pyæˆ–shellè„šæœ¬ï¼Œæ”¾åœ¨gitä¸Šï¼Œåˆ©ç”¨Jenkinsæ¥å®ç°è„šæœ¬æ‰§è¡Œã€‚Jenkinsåªéœ€è¦è®¾ç½®å¥½ä¸€äº›å‚æ•°ï¼ŒSREåªå…³æ³¨å‚æ•°å€¼å°±å¯ä»¥ï¼Œç„¶åä¸€é”®å°±èƒ½æ‰§è¡Œè„šæœ¬ã€‚\næœ€æœ‰æ„æ€çš„æ˜¯å›¢é˜Ÿè‡ªç ”çš„è¿ç»´å¹³å°â€”â€”æŠ¤èˆªå¹³å°ã€‚å®ƒæ˜¯å¯¹Grafanaçš„äºŒæ¬¡å¼€å‘ï¼Œå›¢é˜ŸæŠŠå®ƒçœŸçš„æ˜¯ç©åˆ°äº†æè‡´ï¼Œå®ƒä¸ä»…æœ‰åŸºç¡€çš„å¯è§‚æµ‹ç›‘æ§å›¾ã€å‘Šè­¦èƒ½åŠ›ï¼Œè¿˜å¯ä»¥å®ç°ä½ä»£ç åŠŸèƒ½ï¼ˆbusiness tableæ’ä»¶ã€infinityæ’ä»¶ï¼‰ï¼Œå˜æ›´ç®¡ç†å°±æ˜¯å®Œå…¨åœ¨æŠ¤èˆªå¹³å°ä¸Šå®ç°çš„ã€‚SREåªéœ€è¦ç‚¹ç‚¹ç‚¹å°±å¯ä»¥å®ç°å¯¹æ•°æ®åº“çš„å¢åˆ æŸ¥æ”¹åŠŸèƒ½ï¼Œæ‰©å±•æ€§ç‰¹åˆ«å¼ºã€‚æˆ‘åœ¨å®ä¹ æœŸé—´å°±åšäº†å¾ˆå¤šç›‘æ§å›¾ï¼Œè¿˜æœ‰åŸºäºbusiness formçš„æ“ä½œè¡¨å•ç­‰ç­‰ã€‚\nå¦å¤–åœ¨å®ä¹ ä¸­æˆ‘å‘ç°ï¼Œåœ¨å…¬å¸é‡Œï¼Œä¸šåŠ¡æ˜¯ç¬¬ä¸€ï¼Œä¸‹æ¥æ‰æ˜¯æŠ€æœ¯ã€‚ä¸€ç§æŠ€æœ¯ï¼Œåªæœ‰æŠŠå®ƒäº§å“åŒ–ã€ä¸šåŠ¡åŒ–åï¼Œæ‰èƒ½å‘æŒ¥å‡ºå®ƒçš„ä»·å€¼ã€‚çœ‹è¿‡leaderçš„blogï¼Œä»–å°±æ˜¯ä¸€ä¸ªå–„äºæŠŠæŠ€æœ¯äº§å“åŒ–çš„â€œå¤§ç‰›â€ï¼Œä»–åœ¨é«˜ä¸­æ—¶å°±èƒ½é€šè¿‡å½“ç«™é•¿æ¥å®ç°ç›ˆåˆ©ã€‚æˆ‘æƒ³å¯¹äºä¸€ä¸ªç¨‹åºå‘˜æ¥è¯´ï¼Œè¦æƒ³åœ¨å…¬å¸é‡Œå¹²çš„æ›´å¥½ï¼Œå°±å¿…é¡»è¦å®ç°ä»æŠ€æœ¯åˆ°äº§å“æˆ–ç®¡ç†çš„è½¬å˜ã€‚\næœ€åæ˜¯SREçš„ç²¾é«“â€”â€”ç¨³å®šæ€§ã€‚å›¢é˜Ÿæ‰€æœ‰çš„ä»»åŠ¡éƒ½æ˜¯ä¸ºäº†ç»´æŠ¤ç¨³å®šæ€§ï¼Œç¨³å®šæ€§æ„è¯†æ˜¯SREå¿…é¡»æ‰€æ‹¥æœ‰çš„ã€‚åœ¨è¿™é‡Œï¼Œæˆ‘çŸ¥é“äº†å‘ç”Ÿæ•…éšœç¬¬ä¸€æ—¶é—´åº”è¯¥å…ˆæ­¢æŸï¼Œç„¶åé€šå‘Šï¼Œæœ€åå†æ’æŸ¥ã€‚å¹¶ä¸”æ¯æ¬¡æ•…éšœåï¼Œå¿…é¡»è¦å¼€å±•å¤ç›˜å·¥ä½œï¼Œå†™CaseStudyã€‚å·¥ä½æ—è¿˜å¼ è´´äº†â€œç¨³å®šæ€§å†›è§„â€ï¼Œå‡ æ¡ç¨³å®šæ€§ä¿éšœæ“ä½œå·²ç»æ·±æ·±åˆ»åœ¨æˆ‘çš„æ½œæ„è¯†é‡Œã€‚\nè™½ç„¶æ•´ä¸ªå®ä¹ è¿‡ç¨‹ä¸­æ²¡æœ‰å¤ªå¤šçš„debugç»å†ï¼Œä½†æ˜¯æˆ‘è§‰å¾—è¿™äº›åˆ¶åº¦è§„èŒƒçš„å®è´µç»éªŒæœ‰æ—¶å€™æ¯”debugæ›´æœ‰ä»·å€¼ã€‚\nç¯å¢ƒç¯‡å…¬å¸ç¯å¢ƒã€ç¦åˆ©éƒ½ç‰¹åˆ«å¥½ã€‚\nå·¥ä½œï¼šæˆ‘åœ¨ç™¾åº¦ç§‘æŠ€å›­å®ä¹ ï¼Œè¿™é‡Œä¸€å…±5æ ‹æ¥¼ï¼Œæ˜¯ç™¾åº¦æ–°ä¿®çš„å·¥åŒºã€‚å›­åŒºå°±åƒä¸€ä¸ªâ€œå¤§å­¦â€ä¸€æ ·ï¼Œå„ç§è®¾æ–½æ ·æ ·ä¿±å…¨ï¼šå¥èº«æˆ¿ã€ä¹’ä¹“çƒé¦†ã€é£Ÿå ‚ã€è¶…å¸‚ã€ç†å‘é¦†ã€å’–å•¡é¦†ä»€ä¹ˆéƒ½æœ‰ã€‚å·¥ä½œä¹‹å¤–è¿˜ä¼šç»å¸¸ä¸¾åŠä¸€äº›æ´»åŠ¨ï¼Œå¾ˆä¸°å¯Œã€‚\né¥®é£Ÿï¼šç™¾åº¦çš„é£Ÿå ‚æŒºå¥½åƒçš„ï¼Œä»·æ ¼ç›¸è¾ƒé‡åº†èƒ½è´µç‚¹ï¼Œä¸€é¡¿é¥­15åˆ°20å·¦å³ã€‚ç§ç±»å¾ˆå¤šï¼Œè€Œä¸”ä¼šå®šæœŸå‡ºæ–°å“ï¼Œåˆ°ç°åœ¨æˆ‘è¿˜æ²¡åœ¨å…¬å¸ç‚¹è¿‡å¤–å–ã€‚æ—©é¤æ˜¯å…è´¹çš„ï¼Œé¸¡è›‹åŒ…å­é¦„é¥¨éƒ½æœ‰ï¼Œä¸è¿‡æ—©é¤ä¸æ€ä¹ˆå˜èŠ±æ ·ï¼Œåƒå¤šäº†è¿˜æ˜¯æœ‰ç‚¹ä¹å‘³ã€‚\nâ€‹â€‹â€‹â€‹â€‹\nç¦åˆ©ï¼šå…¬å¸æ¯å¤©ä¸‹åˆéƒ½ä¼šæä¾›ä¸‹åˆèŒ¶ï¼šæ°´æœæˆ–è€…é…¸å¥¶ï¼Œæ¯å±‚å·¥åŒºä¹Ÿæœ‰èŒ¶æ°´é—´ï¼Œæœ‰å…è´¹çš„å’–å•¡ï¼ŒèŒ¶é¥®ç­‰ç­‰ã€‚å†…éƒ¨çš„é›¶å”®æŸœå–çš„ä¸œè¥¿ä¹Ÿæ¯”è¾ƒä¾¿å®œï¼Œä¸€å¬å¯ä¹ä¸åˆ°2å…ƒã€‚å®ä¹ è¿™æ®µæ—¶é—´æˆ‘è¿˜ç¬¬ä¸€æ¬¡æ¥è§¦äº†å¥èº«ï¼Œç¬¬ä¸€æ¬¡è¿›å¥èº«æˆ¿è¿˜åšäº†å¥½å‡ å¤©çš„å¿ƒç†å»ºè®¾ã€‚å¥èº«æˆæœçš„è¯ç®—æ˜¯æœ‰ç‚¹ç—•è¿¹ï¼Œä¸»è¦æˆ‘ä¹Ÿæ˜¯å¥èº«ç©ç©ï¼Œæ²¡æœ‰ç‰¹åˆ«focusã€‚\nâ€‹â€‹â€‹\nåœ¨å…¬å¸ä¹Ÿåº¦è¿‡äº†è‡ªå·±çš„22å²ç”Ÿæ—¥ï¼Œæ”¶åˆ°äº†ä¸“å±ç”Ÿæ—¥ç”Ÿè‚–å°åº¦ç†Šã€‚\nâ€‹\nè¿˜æœ‰ä¸­ç§‹ç¤¼åŒ…\nâ€‹\n1024ç¨‹åºå‘˜èŠ‚è¿™å¤©è¿˜æŠ½åˆ°äº†å¤§å¥–ï¼š0.1gé‡‘å¸\nâ€‹\nç”Ÿæ´»ç¯‡å…¶å®æˆ‘ä¸­è€ƒå®Œçš„æš‘å‡æ¥è¿‡ä¸€æ¬¡åŒ—äº¬ï¼Œå½“æ—¶æ˜¯å’Œå¦ˆå¦ˆä¸€èµ·æ¥æ—…æ¸¸çš„ã€‚æ²¡æƒ³åˆ°2025å¹´æˆ‘è¿˜èƒ½å†æ¬¡æ¥åˆ°åŒ—äº¬ï¼Œä¸è¿‡è¿™æ¬¡æ˜¯ä»¥â€œæ‰“å·¥äººâ€èº«ä»½æ¥çš„ï¼Œæˆ‘ç§°è¿™æ¬¡ç»å†æ˜¯â€œåŒ—æ¼‚â€ã€‚\nä½æˆ‘åœ¨åŒ—äº¬æ˜Œå¹³åŒºæ²™æ²³é«˜æ•™å›­ä½ï¼Œè¿™é‡Œè™½è¯´æœ‰ç‚¹è¿œï¼Œä½†æ˜¯äº¤é€šè¿˜ç®—ä¾¿åˆ©ï¼Œæœ‰â€œç‰›é©¬â€ä¸“çº¿â€”â€”æ˜Œå¹³çº¿ã€‚æˆ‘è®°å¾—ç¬¬ä¸€å¤©å»ä¸Šç­ï¼Œä¸çŸ¥é“æ²™æ²³é«˜æ•™å›­è¿™ç«™æœ‰ç©ºè½¦ï¼Œç¡¬æ˜¯æŒ¤ä¸Šäº†æ‘©è‚©æ¥è¸µçš„æ—©é«˜å³°ã€‚æ˜Œå¹³çº¿æ—¶åˆ»éƒ½æ˜¯æ»¡çš„ï¼Œæ— è®ºæ˜¯å·¥ä½œæ—¥è¿˜æ˜¯å‘¨å…­å‘¨å¤©ã€‚ä¸‹ç­çš„è¯ï¼Œå…¬å¸ä¹Ÿæœ‰ä¸“é—¨å¼€åˆ°å°åŒºé—¨å£çš„ç­è½¦ï¼ŒæŒºå¥½ã€‚\næˆ‘ç§Ÿçš„è¿™ä¸ªåœ°æ–¹ç®—æ˜¯â€œåŒ—æ¼‚äººâ€çš„æœ€å¥½å½’å®¿ï¼Œç‰¹åˆ«æ˜¯åœ¨è¥¿äºŒæ——ä¸Šç­çš„æ‰“å·¥äººã€‚è¿™é‡Œæˆ¿ç§Ÿä¾¿å®œï¼Œè€Œä¸”è¿˜æ˜¯å•é—´ï¼Œè¿˜å¸¦ç‹¬ç«‹å«æµ´ï¼Œä¸€ä¸ªäººä½çš„è¯å¾ˆèˆ’æœã€‚å‘¨å›´åŸºç¡€ç”Ÿæ´»è®¾æ–½éƒ½æœ‰ï¼Œä»€ä¹ˆè¶…å¸‚å‘€ã€å°é¥­é¦†çš„éƒ½æœ‰ã€‚ä¸»è¦è¿™é‡Œæœ‰å¾ˆå¤šæ‰€å¤§å­¦ï¼Œç›¸æ¯”å¯†äº‘ã€æˆ¿å±±ï¼Œè¿™é‡Œç®—åŒ—äº¬åŸå†…äº†ã€‚ï¼ˆå…¶å®å°±æ˜¯éƒŠåŒºï¼‰ã€‚\nç©å®ä¹ è¿™æ®µæ—¶é—´ä¹Ÿå»äº†ä¸€äº›åœ°æ–¹èµ°èµ°ã€‚\nå®ä¹ æœŸé—´åˆšå¥½ç¢°ä¸Šä¹ä¸‰é˜…å…µï¼Œåœ¨å¤©å®‰é—¨å°åœºå‰ä¸€å¤©ï¼Œæˆ‘ç‰¹æ„éª‘äº†ä¸ªå…±äº«å•è½¦ä»å¤©å®‰é—¨å‰ç»è¿‡ã€‚ç‰¹åˆ«å®ä¼Ÿï¼Œé•¿å®‰è¡—ç‰¹åˆ«å®½ï¼Œéª‘è½¦æœ‰ç§â€œè¸å®â€çš„æ„Ÿè§‰ã€‚\n\nå»äº†é¼“æ¥¼ã€ä»€åˆ¹æµ·é‚£ä¸€ç‰‡ï¼Œå°äº†å°åŒ…å­ç‚’è‚å’Œè±†æ±ï¼Œä¸å¾—ä¸è¯´è±†æ±ç¡®å®éš¾å–ï¼Œä¸€è‚¡å˜è´¨çš„é…¸å‘³ã€‚é¼“æ¥¼ç®—ä¸ªæ‰“å¡çš„åœ°æ–¹ï¼ŒæŒºå‡ºç‰‡ã€‚ä»€åˆ¹æµ·é£æ™¯ä¹Ÿä¸é”™ï¼Œé€‚åˆæ•£æ­¥ã€‚\n\nå»äº†å›½è´¸ä¸‰é‡Œå±¯é‚£ç‰‡ï¼Œè¿™é‡Œæ˜¯åŒ—äº¬CBDï¼Œéå¸ƒé«˜æ¥¼ï¼Œæ¥¼é«˜åˆ°ä»°è„–çœ‹çœ‹ä¸åˆ°é¡¶ã€‚æˆ‘å½“æ—¶ä¸€ä¸ªäººå»ï¼Œæ‹¿ä¸€æ¯å’–å•¡ï¼Œåœ¨è¡—åŒºèµ°èµ°ï¼Œè¿˜æœ‰ç§éƒ½å¸‚ç™½é¢†çš„æ„Ÿè§‰ã€‚\nâ€‹\nå»äº†åŒ—äº¬åŠ¨ç‰©å›­ï¼Œçœ‹äº†å¿ƒå¿ƒå¿µå¿µçš„â€œè¥¿ç›´é—¨ä¸‰å¤ªå­â€â€”â€”èŒå…°ï¼Œå¤ªå¯çˆ±äº†ã€‚åŒ—äº¬çš„ç§‹å¤©ä¹Ÿç‰¹åˆ«ç¾ï¼Œæ ‘ä¸Šä¸€ç‰‡çº¢é»„ç»¿ï¼Œåƒæ°´å½©ç”»ä¸€æ ·ã€‚\nâ€‹\nå“¦å›½åº†è¿˜å»äº†å¤©æ´¥ï¼Œæ„Ÿå—äº†æ¾å¼›çš„å¤©æ´¥æ–‡åŒ–ï¼Œå»äº†æ¸¤æµ·è¾¹ï¼Œç¬¬ä¸€æ¬¡çœ‹æµ·ğŸ‘€\nâ€‹\nTODOä¸ªäººè§„åˆ’å…¶å®åˆ°ç°åœ¨è¿˜æ²¡å†³å®šå¥½è¦è€ƒç ”è¿˜æ˜¯è¦å°±ä¸šï¼Œè¿™æ®µå®ä¹ çš„ç›®çš„ä¸ä»…æ˜¯ä¸ºäº†æŠŠè‡ªå·±åœ¨å¤§ä¸€å¤§äºŒå­¦åˆ°çš„è¿ç»´çŸ¥è¯†åšä¸€ä¸ªå®æˆ˜åº”ç”¨ï¼Œæ›´å¤šçš„å…¶å®æ˜¯ç»™è‡ªå·±ç•™ä¸€ä¸ªâ€œä¿åº•â€ï¼Œä¸‡ä¸€è€ƒç ”å¤±è´¥äº†è¿˜èƒ½æœ‰æ®µå®ä¹ ç»å†ï¼Œå°±ä¸šä¸è‡³äºâ€œé›¶åŸºç¡€â€ã€‚\nè¯´å®è¯å…¶å®è¿˜æ˜¯å¾ˆæƒ³å†æ‰¾ä¸€æ®µå®ä¹ ï¼Œå› ä¸ºåœ¨å®ä¹ çš„æ—¶å€™çœŸçš„æ˜¯åœ¨åšè‡ªå·±å–œæ¬¢çš„äº‹æƒ…ï¼Œè€Œä¸”å¯¹äºå®ä¹ ç”Ÿè€Œè¨€ï¼Œå…¬å¸å…¶å®å°±åƒä¸ªå¤§å­¦ä¸€æ ·ï¼Œæ²¡æœ‰æ­£èŒçš„å‹åŠ›ï¼Œè¿˜å¯ä»¥äº«å—åˆ°å…¬å¸çš„ç¦åˆ©ï¼Œå¹¶ä¸”æœ‰å·¥èµ„æ‹¿ï¼Œå¾ˆä¸é”™ã€‚å”‰ï¼Œä½†æ˜¯æˆ‘å›å»ä¹‹åè¿˜æ˜¯å¾—å¥½å¥½æ²‰æ·€ï¼Œæ„Ÿè§‰è‡ªå·±èƒ½åŠ›è¿˜æ˜¯ä¸å¤Ÿã€‚ä¸‹ä¸€æ®µå®ä¹ å¾ˆæƒ³å»è…¾è®¯æˆ–è€…å­—èŠ‚ï¼Œçœ‹ä¸Šå¤©å®‰æ’å§â€¦â€¦\nä»£ç èƒ½åŠ›è¯´å®è¯è¿˜æ˜¯å¾—æå‡è‡ªå·±çš„ä»£ç èƒ½åŠ›ï¼Œç‰¹åˆ«æ˜¯Goè¯­è¨€ã€‚ç°åœ¨è¿˜æ˜¯æ¯”è¾ƒä¾èµ–AIï¼Œå¥½åœ¨æˆ‘èƒ½çŸ¥é“æ€ä¹ˆè®©AIå®ç°æˆ‘çš„éœ€æ±‚ï¼ŒAIå†™çš„æˆ‘èƒ½çŸ¥é“å“ªé‡Œéœ€è¦å“ªé‡Œä¸éœ€è¦ã€‚ä¸è¿‡æ‰“é“è¿˜éœ€è‡ªèº«ç¡¬ï¼Œå›å»æˆ‘è¿˜æ˜¯è¦å¥½å¥½å­¦ä¸‹Goè¯­è¨€ã€‚\nè¿˜æœ‰ä¸€ä¸ªæ˜¯Shellè„šæœ¬èƒ½åŠ›ï¼Œè¿™ä¸ªå¯¹äºæˆ‘ä»¬å¹²è¿ç»´è¿™è¡Œæ¥è¯´æ˜¯å¿…ä¸å¯å°‘ã€‚åœ¨å®ä¹ è¿‡ç¨‹ä¸­ç¡®å®æ„Ÿå—åˆ°äº†ï¼Œå¾ˆå¤šåœºæ™¯éƒ½éœ€è¦è¿™ä¸ªå·¥å…·æ¥æé«˜æ•ˆç‡ã€‚\nè¿ç»´æ–¹é¢ç¬¬ä¸€ä¸ªæ˜¯ä¸­é—´ä»¶çš„è¿ç»´å­¦ä¹ ã€‚åœ¨å®ä¹ ä¹‹å‰ï¼Œåªæ˜¯æ¥è§¦è¿‡MySQLï¼Œpgè¿™ç±»æ•°æ®åº“çš„è¿ç»´ï¼Œç”šè‡³Rediséƒ½åªæ˜¯ä¼šæ­å»ºéƒ¨ç½²ã€‚å®ä¹ æ—¶å‘ç°ï¼Œä½œä¸ºè¿ç»´ï¼Œæœ‰å¾ˆå¤šä¸­é—´ä»¶éƒ½éœ€è¦å­¦ä¹ ï¼Œåƒä»€ä¹ˆKafkaã€esã€etcdã€prometheusç­‰ç­‰ã€‚\nç¬¬äºŒä¸ªæ˜¯K8sã€‚ç°åœ¨è¿˜æ˜¯ä»…ä»…ä¼šç”¨K8sï¼Œæœ‰æ—¶é—´ç¡®å®è¦å­¦å­¦K8sçš„åº•å±‚åŸç†ï¼Œç‰¹åˆ«æ˜¯å„ä¸ªç»„ä»¶çš„å·¥ä½œåŸç†ã€‚\nç¬¬ä¸‰ä¸ªæ˜¯ç½‘ç»œã€‚è®¡ç®—æœºç½‘ç»œå¯¹äºè¿ç»´æ¥è¯´ååˆ†é‡è¦ï¼Œè¿™æ–¹é¢ä¹Ÿä¸€ç›´æ˜¯æˆ‘çš„å¼±ç‚¹ã€‚æœ‰æœºä¼šä¸€å®šè¦å¥½å¥½æå‡ä¸€ä¸‹ç½‘ç»œdebugèƒ½åŠ›ã€‚\næœ€åä¸€ä¸ªæ˜¯eBPFå’ŒLinuxå†…æ ¸ã€‚ä¸€ç›´è¯´æƒ³å­¦å­¦Linux Kernelï¼Œä½†æ˜¯æ€»æ˜¯æç½®äº†ã€‚è¿˜æœ‰eBPFä¹Ÿæ˜¯ï¼Œæœªæ¥æ‰“ç®—ç”¨eBPFåšä¸€ä¸ªé™æµå·¥å…·ï¼Œç„¶åä½œä¸ºæ’ä»¶æ¥å…¥æˆ‘çš„IPBlockã€‚\nâ€\nâ€\n","categories":["Blogs"],"tags":["Blogs"]},{"title":"å­˜å‚¨ä¸é…ç½®","url":"/2025/12/08/%E5%AD%98%E5%82%A8%E4%B8%8E%E9%85%8D%E7%BD%AE/","content":"å­˜å‚¨æŒä¹…åŒ–Podæ˜¯ç”±å¤šä¸ªå®¹å™¨ç»„æˆçš„ï¼Œåœ¨äº†è§£Podçš„æ–‡ä»¶ç³»ç»Ÿç»“æ„æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥å…ˆçœ‹çœ‹ä¸€ä¸ªDockerå®¹å™¨æ˜¯å¦‚ä½•è¢«åˆ¶ä½œçš„ã€‚\nå®¹å™¨æ ¹æ®é•œåƒå¯åŠ¨ã€‚æˆ‘ä»¬åœ¨Dockerfileä¸­çš„æ¯ä¸€æ¡RUNå‘½ä»¤ï¼Œä¼šç”Ÿæˆä¸€å±‚ä¸€å±‚çš„é•œåƒå±‚ï¼Œè¿™äº›é•œåƒå±‚ä»ä¸‹å‘ä¸Šä»¥æ ˆçš„å½¢å¼ç»„æˆäº†ä¸€ä¸ªé•œåƒã€‚è€Œå®¹å™¨å’Œé•œåƒéƒ½æ˜¯ç”±å¤šä¸ªå±‚ç»„æˆçš„ï¼Œä»–ä»¬ä¹‹é—´æœ€å¤§çš„åŒºåˆ«å°±æ˜¯å®¹å™¨çš„æœ€ä¸Šé¢çš„ä¸€å±‚æ˜¯è¯»å†™å±‚ï¼Œå«åšå®¹å™¨å±‚ã€‚ä½†é•œåƒçš„æ‰€æœ‰å±‚éƒ½æ˜¯åªè¯»å±‚ï¼Œå«åšé•œåƒå±‚ã€‚\nå®¹å™¨å¯åŠ¨åï¼ŒDockerä¼šåœ¨å®¹å™¨ä½¿ç”¨çš„é•œåƒä¸Šæ·»åŠ ä¸€ä¸ªå®¹å™¨å±‚ã€‚å®¹å™¨è¿è¡Œæ—¶ï¼Œæ‰€æœ‰å’Œæ•°æ®å˜åŒ–ç›¸å…³çš„æ“ä½œéƒ½æ˜¯åœ¨è¿™ä¸ªè¯»å†™å±‚ä¸­å®Œæˆçš„ï¼Œå¦‚æ–°å»ºæ–‡ä»¶ï¼Œä¿®æ”¹æ–‡ä»¶ç­‰ã€‚åˆ é™¤å®¹å™¨æ—¶ï¼ŒDockeråŒæ—¶ä¼šåˆ é™¤è¿™ä¸ªå®¹å™¨å±‚ã€‚\næ¯ä¸ªå®¹å™¨è¿è¡Œæ—¶ï¼Œéƒ½æœ‰è‡ªå·±çš„å®¹å™¨å±‚ï¼Œå¹¶åœ¨å®¹å™¨å±‚ä¸­ä¿å­˜å®¹å™¨è¿è¡Œç›¸å…³çš„æ•°æ®ã€‚å®¹å™¨å±‚ä¹‹ä¸‹çš„æ‰€æœ‰é•œåƒå±‚éƒ½æ˜¯åªè¯»çš„ï¼Œå› æ­¤å¤šä¸ªå®¹å™¨å¯ä»¥å…±äº«åŒä¸€ä¸ªé•œåƒã€‚\n\nPodä¸­æœ‰è‹¥å¹²ä¸ªå®¹å™¨ï¼Œæ¯ä¸ªå®¹å™¨çš„æ–‡ä»¶ç³»ç»Ÿéƒ½æ˜¯ç‹¬ç«‹ä¸”ä¸€æ¬¡æ€§çš„ã€‚å½“å®¹å™¨å› ä¸ºæŸäº›åŸå› é‡å¯æ—¶ï¼ˆå´©æºƒã€è°ƒåº¦ç­‰æƒ…å†µï¼‰ï¼Œå®¹å™¨å±‚å°±ä¼šè¢«é”€æ¯å¹¶é‡æ–°åˆ›å»ºã€‚\nå‡å¦‚æˆ‘ä»¬è¿è¡Œäº†ä¸€ä¸ªMySQLçš„Podï¼Œå¦‚æœä½ æ²¡æœ‰å¯¹å®ƒåšæŒä¹…åŒ–å­˜å‚¨ï¼Œä¸€æ—¦è¿™ä¸ªPodå› ä¸ºæŸäº›åŸå› è¢«é”€æ¯ï¼Œé‚£ä¹ˆè¿™ä¸ªPodé‡Œçš„æ•°æ®å°±ä¼šå…¨éƒ¨ä¸¢å¤±ï¼Œç„¶åå·¥ä½œè´Ÿè½½å°±ä¼šå¦èµ·ä¸€ä¸ªå…¨æ–°çš„MySQLçš„Podï¼Œè¿™ä¸ªPodæ˜¯ä¸€å¹²äºŒå‡€çš„ï¼ŒåŸæ¥Podçš„æ•°æ®ä¸ä¼šè¢«ä¿ç•™ä¹Ÿä¸ä¼šè¢«æ¢å¤ï¼Œ~~è¿™æ ·ä½ å°±å¾—è·‘è·¯äº†~~~\nå› æ­¤ï¼Œå¯¹æ•°æ®çš„æŒä¹…åŒ–æ˜¯éå¸¸æœ‰å¿…è¦çš„ï¼\nå­˜å‚¨å·Volumeå­˜å‚¨ | Kubernetes\nVolume çš„ç”Ÿå‘½å‘¨æœŸç‹¬ç«‹äºå®¹å™¨ï¼ŒPod ä¸­çš„å®¹å™¨å¯èƒ½è¢«é”€æ¯å’Œé‡å»ºï¼Œä½† Volume ä¼šè¢«ä¿ç•™ã€‚\nåœ¨Dockerä¸­ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡-vå‚æ•°æ¥æŒ‡å®šæŒ‚è½½ç›®å½•ã€‚è€Œåœ¨K8sä¸­ï¼Œæˆ‘ä»¬éœ€è¦é€šè¿‡å®šä¹‰å­˜å‚¨å·ï¼ˆVolumeï¼‰æ¥æ»¡è¶³æ•°æ®æŒä¹…åŒ–çš„éœ€æ±‚ã€‚\nKubernetesæ”¯æŒå¾ˆå¤šç±»å‹çš„å·ã€‚åŒä¸€ä¸ªpodä¹Ÿå¯ä»¥æŒ‚è½½å¤šä¸ªå¤šç§ä¸åŒç±»å‹çš„å·ã€‚\n\næ€»ä½“æ¥çœ‹å¯ä»¥åˆ†ä¸ºå››å¤§ç±»ï¼š\n\næœ¬åœ°å·ï¼šhostPath-ç›´æ¥æŒ‚è½½åˆ°å®¿ä¸»æœºæ–‡ä»¶ç±»å‹ã€emptyDir-æ•°æ®çš„å­˜å‚¨å–å†³äºå®¿ä¸»æœºæ‰€ä½¿ç”¨çš„ä»‹è´¨ï¼Œæ¯”å¦‚ç£ç›˜æˆ– SSD æˆ–ç½‘ç»œå­˜å‚¨ã€‚ï¼ˆè¿™ç§å·çš„æ•°æ®ç›´æ¥ä¿å­˜åœ¨å®¿ä¸»æœºçš„æœ¬åœ°ç£ç›˜ä¸Šï¼Œå¹¶ä¸”Podåªèƒ½åœ¨è¯¥ç‰¹å®šèŠ‚ç‚¹ä¸Šè®¿é—®è¿™äº›æ•°æ®ï¼‰\nç½‘ç»œæ•°æ®å·ï¼šæ¯”å¦‚Nfsã€ClusterFsã€Cephï¼Œè¿™äº›éƒ½æ˜¯å¤–éƒ¨çš„å­˜å‚¨éƒ½å¯ä»¥æŒ‚è½½åˆ°k8sä¸Šã€‚\näº‘ç›˜ï¼šäº‘æœåŠ¡å•†è‡ªè¡Œæä¾›çš„å­˜å‚¨æ–¹æ¡ˆã€‚\nK8sçš„è‡ªèº«èµ„æºï¼šæ¯”å¦‚Secretã€ConfigMapç­‰ã€‚\n\nemptyDirç”¨äºå­˜å‚¨ä¸´æ—¶æ•°æ®çš„ç®€å•ç©ºç›®å½•ã€‚\nå·¥ä½œæµç¨‹ï¼š\nå½“ Pod è¢«åˆ†æ´¾åˆ°æŸä¸ª Node ä¸Šæ—¶ï¼ŒemptyDir å·ä¼šè¢«è‡ªåŠ¨åˆ›å»ºåœ¨è¯¥Podä¸­ï¼Œå¹¶ä¸”åœ¨ Pod åœ¨è¯¥èŠ‚ç‚¹ä¸Šè¿è¡ŒæœŸé—´ï¼Œå·ä¸€ç›´å­˜åœ¨ã€‚å½“ Pod å› ä¸ºæŸäº›åŸå› è¢«ä»èŠ‚ç‚¹ä¸Šåˆ é™¤æ—¶ï¼ŒemptyDir å·ä¸­çš„æ•°æ®ä¹Ÿä¼šè¢«æ°¸ä¹…åˆ é™¤ã€‚ä½†æ˜¯å®¹å™¨å´©æºƒå¹¶ä¸ä¼šå¯¼è‡´ Pod è¢«ä»èŠ‚ç‚¹ä¸Šç§»é™¤ï¼Œå› æ­¤å®¹å™¨å´©æºƒæœŸé—´ emptyDir å·ä¸­çš„æ•°æ®æ˜¯å®‰å…¨çš„ã€‚\nç”¨é€”ï¼š\n\nä¸´æ—¶ç©ºé—´ï¼Œä¾‹å¦‚ç”¨äºæŸäº›åº”ç”¨ç¨‹åºè¿è¡Œæ—¶æ‰€éœ€è¦çš„ä¸´æ—¶ç›®å½•ï¼Œä¸”æ— éœ€æ°¸ä¹…ä¿ç•™\nåŒä¸€ä¸ªPodä¸­çš„ ä¸€ä¸ªå®¹å™¨éœ€è¦ä»å¦ä¸€ä¸ªå®¹å™¨ä¸­è·å–æ•°æ®çš„ç›®å½•ï¼ˆå¤šå®¹å™¨å…±äº«ç›®å½•ï¼‰\n\nç¼ºç‚¹ï¼š\nemptyDirä¸èƒ½æä¾›æ•°æ®æŒä¹…åŒ–ï¼Œä¹Ÿæ— æ³•è·¨èŠ‚ç‚¹åŒæ­¥æ•°æ®ï¼Œæ‰€ä»¥ä»…åœ¨å®¹å™¨ä¸´æ—¶å­˜æ”¾æ•°æ®æ—¶ä½¿ç”¨å®ƒã€‚\nemptyDirå­˜å‚¨å·çš„é…ç½®ç¤ºä¾‹ï¼š\nspec:  volumes:  - name: volume1    emptyDir: &#123;&#125;  - name: volume2    emptyDir:      medium: Memory      sizeLimit: 100Mi\n\n\nmedium\nä½œä¸ºå·æ¥ä½¿â½¤çš„emptyDiræ˜¯åœ¨æ‰¿è½½Podçš„â¼¯ä½œèŠ‚ç‚¹çš„å®é™…ç£ç›˜ä¸Šåˆ›å»ºçš„ï¼Œ å› æ­¤å…¶æ€§èƒ½å–å†³äºèŠ‚ç‚¹çš„ç£ç›˜ç±»å‹ã€‚å¦‚æœéœ€è¦é«˜é€Ÿçš„è¯»å†™æ€§èƒ½ï¼Œæˆ‘ä»¬å¯ä»¥é€šçŸ¥Kubernetesåœ¨tmpfsâ½‚ä»¶ç³»ç»Ÿï¼ˆå‚¨å­˜åœ¨å†…å­˜â½½â¾®ç¡¬ç›˜ï¼‰ä¸Šåˆ›å»ºemptyDirã€‚å› æ­¤ï¼Œå°†emptyDirçš„mediumè®¾ç½®ä¸ºMemoryã€‚\n\nsizeLimit\nå¯ä»¥é™åˆ¶emptyDirè¢«å®¹å™¨å¡«å……çš„å¤§å°ï¼Œåˆ™å¡«å†™æ­¤é¡¹ã€‚å¦‚ï¼š100Miï¼Œ20Giã€‚æ­¤é¡¹åœ¨å¤§å¤šæ•°å·ä¸­æ˜¯é€šç”¨çš„ã€‚\n\n\nemptyDirå·æ˜¯æœ€ç®€å•çš„å·ç±»å‹ï¼Œå…¶ä»–ç±»å‹çš„å·éƒ½æ˜¯åœ¨å®ƒçš„åŸºç¡€ä¸Šæ„å»ºçš„ï¼Œåœ¨åˆ›å»ºç©ºâ½¬å½•åï¼Œå…¶ä»–ç±»å‹çš„å·ä¼šâ½¤æ•°æ®å¡«å……å®ƒã€‚\nhostPath â½¤äºå°†â½¬å½•ä»â¼¯ä½œèŠ‚ç‚¹çš„â½‚ä»¶ç³»ç»ŸæŒ‚è½½åˆ°Podä¸­ã€‚\nå·¥ä½œæµç¨‹ï¼š\nå°±æ˜¯å°†å·¥ä½œèŠ‚ç‚¹ä¸­çš„ä¸€ä¸ªå®é™…ç›®å½•æŒ‚è½½è¿›Podä¸­ï¼Œä»¥ä¾›å®¹å™¨ä½¿ç”¨ï¼Œæä¾›å¯¹ä¸»æœºä¸Šæ–‡ä»¶çš„è®¿é—®ã€‚å®ƒå¯ä»¥ä¿è¯æ•°æ®çš„æŒä¹…åŒ–ï¼Œå³ä½¿Podè¢«é”€æ¯äº†ï¼Œæ•°æ®ä¹Ÿä»ç„¶åœ¨å·¥ä½œèŠ‚ç‚¹ä¸Šã€‚å®ƒå’Œæˆ‘ä»¬åœ¨docker runæ—¶çš„-vå‚æ•°å¾ˆç±»ä¼¼ã€‚\nç”¨é€”ï¼š\n\nå¦‚æœPodéœ€è¦ä½¿ç”¨Nodeä¸Šçš„æŸäº›ä¸œè¥¿æ—¶ï¼Œæ¯”å¦‚æŸå®¹å™¨éœ€è¦è®¿é—®Docker,å¯ä½¿ç”¨hostPath æŒ‚è½½å®¿ä¸»æœºèŠ‚ç‚¹çš„/var/lib/docker(Dockerçš„å·¥ä½œç›®å½•)\næŸäº›ç³»ç»Ÿçº§åˆ«çš„Podï¼ˆé€šå¸¸ç”±DaemonSetç®¡ç†ï¼Œä¾‹å¦‚DDNSï¼‰ç¡®å®éœ€è¦è¯»å–èŠ‚ç‚¹çš„â½‚ä»¶æˆ–ä½¿â½¤èŠ‚ç‚¹â½‚ä»¶ç³»ç»Ÿæ¥è®¿é—®èŠ‚ç‚¹è®¾å¤‡\n\n\nDaemonSetä¼šåœ¨æ¯ä¸ªèŠ‚ç‚¹ä¸Šéƒ½è¿è¡Œä¸€ä¸ªæŒ‡å®šçš„çš„Podå®ä¾‹ï¼Œæ— è®ºèŠ‚ç‚¹æ˜¯ä»€ä¹ˆæ—¶å€™åŠ å…¥æˆ–ç¦»å¼€é›†ç¾¤ã€‚\n\nç¼ºç‚¹ï¼š\n\nä»…æä¾›äº†å•èŠ‚ç‚¹çš„æ•°æ®æŒä¹…åŒ–ï¼Œä¸æä¾›è·¨èŠ‚ç‚¹çš„æ•°æ®åŒæ­¥ã€‚ä¸€èˆ¬ä¸å»ºè®®ä½¿ç”¨è¿™ç§å­˜å‚¨æ–¹å¼ï¼ˆé™¤éæ˜¯å•èŠ‚ç‚¹ï¼‰ï¼Œå› ä¸ºå½“Podè¢«è°ƒåº¦åˆ°å¦ä¸€ä¸ªNodeä¸Šæ—¶ï¼Œå®ƒä¼šæ‰¾ä¸åˆ°æ•°æ®ã€‚è€Œä¸”ç†è®ºä¸Šâ¼¤å¤šæ•°Podåº”è¯¥å¿½ç•¥å®ƒä»¬çš„ä¸»æœºèŠ‚ç‚¹ï¼Œå› æ­¤å®ƒä»¬ä¸åº”è¯¥è®¿é—®èŠ‚ç‚¹â½‚ä»¶ç³»ç»Ÿä¸Šçš„ä»»ä½•â½‚ä»¶ã€‚\nå­˜åœ¨å®‰å…¨é£é™©ï¼Œå¯èƒ½ä¼šæš´éœ²ç‰¹æƒç³»ç»Ÿå‡­æ®ï¼ˆä¾‹å¦‚ Kubeletï¼‰æˆ–ç‰¹æƒ APIï¼ˆä¾‹å¦‚å®¹å™¨è¿è¡Œæ—¶å¥—æ¥å­—ï¼‰ï¼Œå¯ç”¨äºå®¹å™¨é€ƒé€¸æˆ–æ”»å‡»é›†ç¾¤çš„å…¶ä»–éƒ¨åˆ†ã€‚å› æ­¤åº”è¯¥å°½é‡é¿å…ä½¿ç”¨hostPathï¼Œå¦‚ç¡®éœ€ä½¿ç”¨ï¼Œä¹Ÿåº”è¯¥é™åˆ¶å®ƒçš„èŒƒå›´åªåˆ°æ‰€éœ€çš„æ–‡ä»¶æˆ–ç›®å½•ï¼Œå¹¶ä¸”ä»¥åªè¯»çš„æ–¹å¼(readOnly: true)æŒ‚è½½ã€‚\n\nhostPathå­˜å‚¨å·çš„é…ç½®ç¤ºä¾‹ï¼š\nspec:  volumes:  - name: hostpath-volume    hostPath:      path: /path/to/node # æŒ‡å®šæŒ‚è½½ç›®å½•      type: DirectoryOrCreate\n\n\nå®ä¾‹æ¼”ç¤ºï¼šä½¿ç”¨hostPathå®ç°Nginxçš„æ—¥å¿—æŒä¹…åŒ–\næŒ‡å®šä¸¤ä¸ªå®¹å™¨ï¼šNginxå’ŒBusyBoxã€‚\nNginxç”¨äºç”Ÿæˆæ—¥å¿—ï¼Œå¹¶ä¸”å°†åä¸º logs-volume çš„å·æŒ‚è½½åˆ°å®¹å™¨çš„ /var/log/nginx ç›®å½•ã€‚\nBusyBoxç”¨æ¥è¯æ˜å®¹å™¨ä¹‹é—´çš„æ•°æ®å¯ä»¥å®ç°å…±äº«ï¼Œå®ƒå°†åä¸º logs-volume çš„å·æŒ‚è½½åˆ°å®¹å™¨çš„ /logs ç›®å½•ã€‚\næœ€åå®šä¹‰äº†åä¸º logs-volume çš„å·ï¼Œé€šè¿‡ hostPath æŒ‡å®šäº†å®ƒåœ¨å®¿ä¸»æœºä¸Šçš„è·¯å¾„ä¸º /home/logsã€‚\napiVersion: v1kind: Podmetadata:  name: volume-hostpath  namespace: lesson-demospec:  containers:  - name: nginx    image: reg.redrock.team/library/nginx:latest    ports:    - containerPort: 80    volumeMounts:    - name: logs-volume      mountPath: /var/log/nginx  - name: busybox    image: busybox:1.30    command: [&quot;/bin/sh&quot;,&quot;-c&quot;,&quot;tail -f /logs/access.log&quot;]    volumeMounts:    - name: logs-volume      mountPath: /logs  volumes:  - name: logs-volume    hostPath:      path: /home/logs      type: DirectoryOrCreate\n\næŸ¥çœ‹èµ„æºï¼ŒPodè¢«è°ƒåº¦åœ¨master3ä¸Šã€‚\n\nå¯ä»¥çœ‹åˆ°master3ä¸Šå·²ç»è‡ªåŠ¨ç”Ÿæˆäº†/home/logsç›®å½•ï¼Œå¹¶ä¸”æŒ‚è½½äº†/var/log/nginxé‡Œçš„å†…å®¹ã€‚\n\nè¿ç»­è®¿é—®ä¸‰æ¬¡Podï¼Œè®¿é—®è¢«æˆåŠŸè®°å½•åˆ°äº†/home/logs/access.logä¸­ã€‚\n\nè¿›å…¥busyboxçš„å®¹å™¨ä¸­ï¼ŒæŸ¥çœ‹busybox/logs/access.logä¸­çš„å†…å®¹ï¼Œå‘ç°å·²ç»è®°å½•äº†ä¸‰æ¡è®¿é—®è®°å½•ã€‚è¯´æ˜ä¸åŒå®¹å™¨ä¹‹é—´å¯ä»¥å…±äº«æ•°æ®å¹¶è¿›è¡Œç›¸äº’äº¤äº’ã€‚\n\næ­¤æ—¶åˆ é™¤Podåï¼Œå‘ç°æ•°æ®ä»ç„¶å­˜åœ¨ã€‚\n\n\nNFSå¯ä»¥é€šè¿‡ç½‘ç»œï¼Œè®©ä¸åŒçš„æœºå™¨ã€ä¸åŒçš„æ“ä½œç³»ç»Ÿå¯ä»¥å…±äº«å½¼æ­¤çš„æ–‡ä»¶ã€‚\nå½“è¿â¾åœ¨â¼€ä¸ªPodä¸­çš„åº”â½¤ç¨‹åºéœ€è¦å°†æ•°æ®ä¿å­˜åˆ°ç£ç›˜ä¸Šï¼Œå¹¶ä¸”å³ä½¿è¯¥Podé‡æ–°è°ƒåº¦åˆ°å¦â¼€ä¸ªèŠ‚ç‚¹æ—¶ä¹Ÿè¦æ±‚å…·æœ‰ç›¸åŒçš„æ•°æ®å¯â½¤ã€‚è¿™å°±ä¸èƒ½ä½¿â½¤åˆ°â½¬å‰ä¸ºâ½Œæˆ‘ä»¬æåˆ°çš„ä»»ä½•ä¸€ç§å·ç±»å‹ï¼Œç”±äºè¿™äº›æ•°æ®éœ€è¦å¯ä»¥ä»ä»»ä½•é›†ç¾¤èŠ‚ç‚¹è®¿é—®ï¼Œ å› æ­¤å¿…é¡»å°†å…¶å­˜å‚¨åœ¨æŸç§ç±»å‹çš„â½¹ç»œå­˜å‚¨NASï¼ˆNetwork Attached Storageï¼‰ä¸­ã€‚\nå·¥ä½œæµç¨‹ï¼š\nNFSæœåŠ¡å™¨å¯ä»¥è®©è®¡ç®—æœºå°†ç½‘ç»œä¸­çš„NFSæœåŠ¡å™¨å…±äº«çš„ç›®å½•æŒ‚è½½åˆ°æœ¬åœ°ç«¯çš„æ–‡ä»¶ç³»ç»Ÿä¸­ï¼Œè€Œåœ¨æœ¬åœ°ç«¯çš„ç³»ç»Ÿä¸­æ¥çœ‹ï¼Œé‚£ä¸ªè¿œç¨‹ä¸»æœºçš„ç›®å½•å°±å¥½åƒæ˜¯è‡ªå·±çš„ä¸€ä¸ªç£ç›˜åˆ†åŒºä¸€æ ·ï¼Œåœ¨ä½¿ç”¨ä¸Šç›¸å½“ä¾¿åˆ©ã€‚\nç”¨é€”ï¼š\nä¸€èˆ¬åšæ•°æ®çš„å…±äº«å­˜å‚¨ï¼Œä¿è¯å¤šä¸ªèŠ‚ç‚¹æä¾›ä¸€è‡´æ€§çš„ç¨‹åºã€‚\nç¼ºç‚¹ï¼š\n\nå®¹æ˜“å‘ç”Ÿå•ç‚¹æ•…éšœï¼ŒServeræœºå®•æœºäº†åæ‰€æœ‰å®¢æˆ·ç«¯éƒ½ä¸èƒ½è®¿é—®\nåœ¨é«˜å¹¶å‘ä¸‹NFSæ€§èƒ½æœ‰é™\nå®¢æˆ·ç«¯æ— ç”¨æˆ·è®¤è¯æœºåˆ¶ï¼Œä¸”æ•°æ®æ˜¯é€šè¿‡æ˜æ–‡ä¼ é€ï¼Œå®‰å…¨æ€§ä¸€èˆ¬ï¼ˆä¸€èˆ¬å»ºè®®åœ¨å±€åŸŸç½‘å†…ä½¿ç”¨ï¼‰\nNFSçš„æ•°æ®æ˜¯æ˜æ–‡çš„ï¼Œå¯¹æ•°æ®å®Œæ•´æ€§ä¸åšéªŒè¯\n\nä¸ºäº†å¤šèŠ‚ç‚¹æ•°æ®åŒæ­¥åŠæŒä¹…åŒ–ï¼Œç›®å‰å·²æœ‰æ›´ä¼˜çš„cephfsæ–¹æ¡ˆï¼Œå®ƒä¹Ÿæ˜¯ä¸€ç§ç½‘ç»œæ–‡ä»¶ç³»ç»Ÿã€‚å¦‚æœä½ åœ¨å„å¤§äº‘å¹³å°è´­ä¹°Kuberneteså®¹å™¨æœåŠ¡ï¼Œä»–ä»¬ä¹Ÿä¼šæä¾›æ›´åº•å±‚çš„æ•°æ®åŒæ­¥å·åŠæ’ä»¶ï¼Œè¿™äº›å·å¯æŒ‚è½½åˆ°å®¹å™¨ä¸­ï¼Œä¹Ÿå¯å¸è½½ä¸‹æ¥å¤ç”¨ã€‚ä½†æ˜¯ç”±äºNFSæ˜¯æœ€ç®€å•çš„å¤šèŠ‚ç‚¹æ•°æ®åŒæ­¥åŠæŒä¹…åŒ–æ–¹æ¡ˆï¼Œæˆ‘ä»¬ä½¿ç”¨å®ƒæ¥æ¼”ç¤ºã€‚\nNFSæœåŠ¡ç«¯çš„å®‰è£…ä¸é…ç½®ï¼ˆDebianç³»ï¼‰\nå®‰è£…NFSæœåŠ¡ç«¯\napt updateapt install nfs-kernel-server\n\nåˆ›å»ºä¸€ä¸ªNFSå…±äº«ç›®å½•\nmkdir -p /root/nfs\n\nä¿®æ”¹/etc/exportsæ–‡ä»¶ï¼ˆè¿™ä¸ªæ–‡ä»¶åŒ…å«äº†NFS æœåŠ¡å™¨å…±äº«çš„ç›®å½•ï¼‰ï¼Œç¼–è¾‘å†…å®¹ä¸ºï¼š\n/root/nfs/ *(insecure,rw,sync,no_subtree_check,no_root_squash)# rwä»£è¡¨è¯»å†™è®¿é—®ï¼Œsyncä»£è¡¨æ‰€æœ‰æ•°æ®åœ¨è¯·æ±‚æ—¶å†™å…¥å…±äº«ï¼Œno_subtree_checkä»£è¡¨ä¸æ£€æŸ¥çˆ¶ç›®å½•æƒé™ï¼Œno_root_squashä»£è¡¨rootç”¨æˆ·å…·æœ‰æ ¹ç›®å½•çš„å®Œå…¨ç®¡ç†è®¿é—®æƒé™\n\nä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å¯åŠ¨NFSæœåŠ¡å™¨\nsystemctl enable rpcbindsystemctl enable nfs-serversystemctl start rpcbindsystemctl start nfs-serverexportfs -r # é‡æ–°å¯¼å…¥é…ç½®æ–‡ä»¶exportfs\n\n\né…ç½®å®ŒNFSåæˆ‘ä»¬å°±å¯ä»¥åœ¨Kubernetesä¸­ä½¿ç”¨å®ƒäº†ã€‚\nNFSå­˜å‚¨å·çš„é…ç½®ç¤ºä¾‹ï¼š\nspec:  volumes:  - name: nfs-volume    nfs:      server: 172.20.14.180      path: /root/nfs\n\næŒä¹…å·å’ŒæŒä¹…å·å£°æ˜ä»¥ä¸Šçš„å­˜å‚¨æ–¹æ¡ˆçœ‹èµ·æ¥ååˆ†ä¸é”™ï¼Œä½†åˆ°â½¬å‰ä¸ºâ½Œï¼Œæˆ‘ä»¬æ¢ç´¢è¿‡çš„æ‰€æœ‰æŒä¹…å·ç±»å‹éƒ½è¦æ±‚Podçš„å¼€å‘â¼ˆå‘˜äº†è§£é›†ç¾¤ä¸­å¯â½¤çš„çœŸå®â½¹ç»œå­˜å‚¨çš„åŸºç¡€ç»“æ„ã€‚ä¾‹å¦‚ï¼Œè¦åˆ›å»ºâ½€æŒNFSåè®®çš„å·ï¼Œå¼€å‘â¼ˆå‘˜å¿…é¡»çŸ¥é“NFSèŠ‚ç‚¹æ‰€åœ¨çš„å®é™…æœåŠ¡å™¨ã€‚è¿™å¯¹å¼€å‘äººå‘˜å¾ˆä¸å‹å¥½ï¼Œå› ä¸ºä»–ä»¬åº”è¯¥ä¸“æ³¨äºå¼€å‘è€Œä¸æ˜¯éƒ¨ç½²ã€‚è€Œä¸”å°†è¿™ç§æ¶‰åŠåŸºç¡€è®¾æ–½ç±»å‹çš„ä¿¡æ¯å¡åˆ°â¼€ä¸ªPodè®¾ç½®ä¸­ï¼Œæ„å‘³ç€Podè®¾ç½®ä¸ç‰¹å®šçš„Kubernetesé›†ç¾¤æœ‰å¾ˆâ¼¤è€¦åˆåº¦ã€‚è¿™å°±ä¸èƒ½åœ¨å¦â¼€ä¸ªPodä¸­ä½¿â½¤ç›¸åŒçš„è®¾ç½®äº†ã€‚æ‰€ä»¥ä½¿â½¤è¿™æ ·çš„å·å¹¶ä¸æ˜¯åœ¨Podä¸­é™„åŠ æŒä¹…åŒ–å­˜å‚¨çš„æœ€ä½³å®è·µã€‚\nåœ¨ç†æƒ³æƒ…å†µä¸‹ï¼Œåœ¨Kubernetesä¸Šéƒ¨ç½²åº”ç”¨ç¨‹åºçš„å¼€å‘äººå‘˜æ˜¯åº”è¯¥ä¸éœ€è¦çŸ¥é“é›†ç¾¤æä¾›äº†ä»€ä¹ˆå­˜å‚¨æŠ€æœ¯ï¼Œä¸åŸºç¡€è®¾æ–½ç›¸å…³çš„äº¤äº’æ‰æ˜¯é›†ç¾¤ç®¡ç†å‘˜è¯¥åšçš„äº‹æƒ…ã€‚å½“å¼€å‘â¼ˆå‘˜éœ€è¦â¼€å®šæ•°é‡çš„æŒä¹…åŒ–å­˜å‚¨æ¥è¿›â¾åº”â½¤æ—¶ï¼Œå¯ä»¥å‘Kubernetesè¯·æ±‚ï¼Œå°±åƒåœ¨åˆ›å»ºPodæ—¶å¯ä»¥è¯·æ±‚CPUã€å†…å­˜å’Œå…¶ä»–èµ„æºâ¼€æ ·ã€‚é›†ç¾¤ç®¡ç†å‘˜å¯ä»¥å¯¹é›†ç¾¤è¿›â¾é…ç½®è®©å…¶å¯ä»¥ä¸ºåº”â½¤ç¨‹åºæä¾›æ‰€éœ€çš„æœåŠ¡ã€‚\nä»€ä¹ˆæ˜¯æŒä¹…å·å’ŒæŒä¹…å·å£°æ˜ï¼Ÿä¸ºäº†è§£å†³ä¸Šé¢å‡ºç°çš„é—®é¢˜ï¼ŒK8sç»™å‡ºäº†ä¸€ç§è§£å†³æ–¹æ¡ˆï¼šæŒä¹…å·PersistentVolume ï¼ˆPVï¼‰å’Œ æŒä¹…å·å£°æ˜PersistentVolumeClaimï¼ˆPVCï¼‰\nPersistentVolume (PV) æ˜¯å¤–éƒ¨å­˜å‚¨ç³»ç»Ÿä¸­çš„ä¸€å—å­˜å‚¨ç©ºé—´ï¼Œç”±ç®¡ç†å‘˜åˆ›å»ºå’Œç»´æŠ¤ã€‚ä¸ Volume ä¸€æ ·ï¼ŒPV å…·æœ‰æŒä¹…æ€§ï¼Œç”Ÿå‘½å‘¨æœŸç‹¬ç«‹äº Podã€‚\nPersistentVolumeClaim (PVC) æ˜¯å¯¹ PV çš„ç”³è¯· (Claim)ã€‚PVC é€šå¸¸ç”±æ™®é€šç”¨æˆ·åˆ›å»ºå’Œç»´æŠ¤ã€‚éœ€è¦ä¸º Pod åˆ†é…å­˜å‚¨èµ„æºæ—¶ï¼Œç”¨æˆ·å¯ä»¥åˆ›å»ºä¸€ä¸ª PVCï¼ŒæŒ‡æ˜å­˜å‚¨èµ„æºçš„å®¹é‡å¤§å°å’Œè®¿é—®æ¨¡å¼ï¼ˆæ¯”å¦‚åªè¯»ï¼‰ç­‰ä¿¡æ¯ï¼ŒKubernetes ä¼šæŸ¥æ‰¾å¹¶æä¾›æ»¡è¶³æ¡ä»¶çš„ PVã€‚\næœ‰äº† PersistentVolumeClaimï¼Œç”¨æˆ·åªéœ€è¦å‘Šè¯‰ Kubernetes éœ€è¦ä»€ä¹ˆæ ·çš„å­˜å‚¨èµ„æºï¼Œè€Œä¸å¿…å…³å¿ƒçœŸæ­£çš„ç©ºé—´ä»å“ªé‡Œåˆ†é…ï¼Œå¦‚ä½•è®¿é—®ç­‰åº•å±‚ç»†èŠ‚ä¿¡æ¯ã€‚è¿™äº›éœ€è¦æä¾›å­˜å‚¨çš„åº•å±‚ä¿¡æ¯äº¤ç»™ç®¡ç†å‘˜æ¥å¤„ç†ï¼Œåªæœ‰ç®¡ç†å‘˜æ‰åº”è¯¥å…³å¿ƒåˆ›å»º PersistentVolume çš„ç»†èŠ‚ä¿¡æ¯ã€‚\næŒä¹…å·ï¼ˆPVï¼‰ç°åœ¨ï¼Œä¸ºäº†ä½¿å¼€å‘äººå‘˜ä¸ç”¨å…³å¿ƒé›†ç¾¤ä¸Šçš„å­˜å‚¨èµ„æºçš„å…·ä½“ç»†èŠ‚ï¼Œæˆ‘ä»¬é¦–å…ˆå……å½“é›†ç¾¤ç®¡ç†å‘˜æ¥é…ç½®æŒä¹…å·ã€‚ä¹‹åï¼Œæˆ‘ä»¬å†å……å½“å¼€å‘äººå‘˜ï¼Œæ¥ä½¿ç”¨æŒä¹…å·å®Œæˆå¼€å‘ã€‚\nå¦‚ä½•ç”³è¯·ä¸€ä¸ªPVå‘¢ï¼Ÿ\nåœ¨åˆ›å»ºæŒä¹…å·æ—¶ï¼Œç®¡ç†å‘˜éœ€è¦å‘Šè¯‰Kuberneteså…¶å¯¹åº”çš„å®¹é‡éœ€æ±‚ï¼Œä»¥åŠå®ƒæ˜¯å¦å¯ä»¥ç”±å•ä¸ªèŠ‚ç‚¹æˆ–å¤šä¸ªèŠ‚ç‚¹åŒæ—¶è¯»å–æˆ–å†™â¼Šã€‚ç®¡ç†å‘˜è¿˜éœ€è¦å‘Šè¯‰Kuberneteså½“æŒä¹…å·å£°æ˜çš„ç»‘å®šè¢«åˆ é™¤æ—¶å¦‚ä½•å¤„ç†PersistentVolumeã€‚æœ€åï¼Œç®¡ç†å‘˜éœ€è¦æŒ‡å®šæŒä¹…å·â½€æŒçš„å®é™…å­˜å‚¨ç±»å‹ã€ä½ç½®å’Œå…¶ä»–å±æ€§ã€‚\næŒä¹…å·çš„é…ç½®ç¤ºä¾‹ï¼š\napiVersion: v1kind: PersistentVolumemetadata:  name: nfs-pvspec:  capacity:    storage: 5Gi  accessModes:    - ReadWriteOnce  persistentVolumeReclaimPolicy: Retain  nfs:    server: 172.20.14.180    path: /root/nfs\n\né…ç½®é¡¹ï¼š\n\nCapacityï¼šæŒ‡å®š PV çš„å®¹é‡\naccessModesï¼šæŒ‡å®šè®¿é—®æ¨¡å¼ä¸º ReadWriteOnceï¼Œæ”¯æŒçš„è®¿é—®æ¨¡å¼æœ‰ï¼š\nReadWriteOnceï¼šè¯»å†™æƒé™ï¼Œå¹¶ä¸”åªèƒ½è¢«å•ä¸ªNodeæŒ‚è½½ã€‚\nReadOnlyMany ï¼šåªè¯»æƒé™ï¼Œå…è®¸è¢«å¤šä¸ªNodeæŒ‚è½½ã€‚\nReadWriteManyï¼šè¯»å†™æƒé™ï¼Œå…è®¸è¢«å¤šä¸ªNodeæŒ‚è½½ã€‚\n\n\npersistentVolumeReclaimPolicyï¼šæŒ‡å®šå½“ PV çš„å›æ”¶ç­–ç•¥ä¸º Recycleï¼Œæ”¯æŒçš„ç­–ç•¥æœ‰ï¼š\nRetainï¼šéœ€è¦ç®¡ç†å‘˜æ‰‹å·¥å›æ”¶\nRecycleï¼šæ¸…é™¤ PV ä¸­çš„æ•°æ®å¹¶ä½¿PVé‡æ–°å¯ç”¨ï¼Œæ•ˆæœç›¸å½“äºæ‰§è¡Œ rm -rf &#x2F;path&#x2F;*ï¼ˆå°†è¢«å¼ƒç”¨ï¼‰\nDeleteï¼šåˆ é™¤å­˜å‚¨èµ„æºå¹¶åˆ é™¤PV\n\n\n\nä½¿ç”¨è¯¥å‘½ä»¤æŸ¥çœ‹PVã€‚æ³¨æ„PVä¸å±äºä»»ä½•ä¸€ä¸ªå‘½åç©ºé—´ï¼Œå®ƒè·ŸèŠ‚ç‚¹â¼€æ ·æ˜¯é›†ç¾¤å±‚â¾¯çš„èµ„æºã€‚\nkubectl get pv\n\n\næ­¤æ—¶çš„PVæ²¡æœ‰è¢«ä»»ä½•PVCç»‘å®šï¼Œå› æ­¤å®ƒçš„çŠ¶æ€æ˜¯Availableå¯ç”¨çŠ¶æ€ã€‚\næŒä¹…å·å£°æ˜ï¼ˆPVCï¼‰ç°åœ¨æˆ‘ä»¬æ‰®æ¼”å¼€å‘äººå‘˜æ¥ä½¿ç”¨ä¹‹å‰åˆ›å»ºçš„æŒä¹…å·æ¥å¼€å‘åº”ç”¨ã€‚\næˆ‘ä»¬ç°åœ¨éœ€è¦ä½¿ç”¨åˆšæ‰åˆ›å»ºçš„PVï¼Œè¿™ä¸ªPVæ˜¯ä¸èƒ½åƒå­˜å‚¨å·é‚£æ ·ç›´æ¥åœ¨Podä½¿ç”¨çš„ï¼Œæˆ‘ä»¬å¾—å…ˆåˆ›å»ºä¸€ä¸ªæŒä¹…å·å£°æ˜ï¼Œå‘Šè¯‰Kubernetesæˆ‘ä»¬ç°åœ¨éœ€è¦ä¸€ä¸ªPVï¼ŒKubernetesä¼šæ ¹æ®è¿™ä¸ªæ¸…å•ï¼ˆPVCï¼‰æ¥å¯»æ‰¾ä¸€ä¸ªåˆé€‚çš„PVã€‚\næŒä¹…å·å£°æ˜çš„é…ç½®å®ä¾‹ï¼š\napiVersion: v1kind: PersistentVolumeClaimmetadata:  name: nfs-pvc  namespaceï¼šspec:  accessModes:    - ReadWriteOnce  resources:    requests:      storage: 5Gi  storageClassName: &quot;&quot; # ä¸‹ä¸€éƒ¨åˆ†å°†è¯¦è¿°\n\nå½“åˆ›å»ºå¥½å£°æ˜ï¼ŒKuberneteså°±ä¼šè‡ªåŠ¨æ‰¾åˆ°é€‚å½“çš„æŒä¹…å·å¹¶å°†å…¶ç»‘å®šåˆ°å£°æ˜ï¼ŒæŒä¹…å·çš„å®¹é‡å¿…é¡»â¾œå¤Ÿâ¼¤ä»¥æ»¡â¾œå£°æ˜çš„éœ€æ±‚ï¼Œå¹¶ä¸”å·çš„è®¿é—®æ¨¡å¼å¿…é¡»åŒ…å«å£°æ˜ä¸­æŒ‡å®šçš„è®¿é—®æ¨¡å¼ã€‚åœ¨è¯¥â½°ä¾‹ä¸­ï¼Œå£°æ˜è¯·æ±‚5Gçš„å­˜å‚¨ç©ºé—´å’ŒReadWriteOnceè®¿é—®æ¨¡å¼ã€‚ä¹‹å‰åˆ›å»ºçš„æŒä¹…å·ç¬¦åˆåˆšåˆšå£°æ˜ä¸­çš„è¿™ä¸¤ä¸ªæ¡ä»¶ï¼Œæ‰€ä»¥å®ƒè¢«ç»‘å®šåˆ°å¯¹åº”çš„å£°æ˜ä¸­ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡æ£€æŸ¥å£°æ˜æ¥æŸ¥çœ‹ã€‚\nåˆ›å¥½æŒä¹…å·å£°æ˜ä¹‹åï¼Œä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æŸ¥çœ‹æ‰€æœ‰æŒä¹…å·å£°æ˜ï¼š\nkubectl get pvc\n\nè®¿é—®æ¨¡å¼çš„ç®€å†™å«ä¹‰ï¼š\n\nRWOï¼ˆReadWriteOnceï¼‰ï¼šä»…å…è®¸å•ä¸ªèŠ‚ç‚¹æŒ‚è½½è¯»å†™ã€‚\nROXï¼ˆReadOnlyManyï¼‰ï¼šå…è®¸å¤šä¸ªèŠ‚ç‚¹æŒ‚è½½åªè¯»ã€‚\nRWXï¼ˆReadWriteManyï¼‰ï¼šå…è®¸å¤šä¸ªèŠ‚ç‚¹æŒ‚è½½è¯»å†™è¿™ä¸ªå·ã€‚\n\n\nPVä¸PVCå·²ç»æˆåŠŸç»‘å®šï¼ˆBoundï¼‰\nPVæ˜¾â½°è¢«ç»‘å®šåœ¨default&#x2F;nfs-pvcçš„PVCä¸Šï¼Œè¿™ä¸ªdefaultéƒ¨åˆ†æ˜¯PVCæ‰€åœ¨çš„å‘½åç©ºé—´ï¼ˆåœ¨é»˜è®¤å‘½åç©ºé—´ä¸­åˆ›å»ºçš„å£°æ˜ï¼‰ï¼Œæˆ‘ä»¬ä¹‹å‰æœ‰æåˆ°è¿‡PVæ˜¯é›†ç¾¤èŒƒå›´çš„ï¼Œå› æ­¤ä¸èƒ½åœ¨ç‰¹å®šçš„å‘½åç©ºé—´ä¸­åˆ›å»ºï¼Œä½†æ˜¯PVCåˆåªèƒ½åœ¨ç‰¹å®šçš„å‘½åç©ºé—´åˆ›å»ºï¼Œæ‰€ä»¥PVå’ŒPVCåªèƒ½è¢«åŒâ¼€å‘½åç©ºé—´å†…çš„Podåˆ›å»ºä½¿â½¤ã€‚\nåœ¨Podä¸­ä½¿ç”¨æŒä¹…å·å£°æ˜è¦åœ¨Podä¸­ä½¿â½¤æŒä¹…å·ï¼Œéœ€è¦åœ¨Podçš„å·ä¸­å¼•â½¤æŒä¹…å·å£°æ˜åç§°ã€‚\napiVersion: v1kind: Podmetadata:  name: databasespec:  volumes:  - name: data    persistentVolumeClaim:      claimName: nfs-pvc  containers:  - image: busybox:latest    name: database    command: [&quot;sleep&quot;]    args: [&quot;999999&quot;]    volumeMounts:    - name: data      mountPath: /var/db\n\næˆ‘ä»¬è¿›å…¥å®¹å™¨ï¼Œåœ¨/var/dbä¸‹æ–°å¢ä¸€ä¸ªæ–‡ä»¶ï¼Œç„¶åé€€å‡ºå®¹å™¨ï¼Œå‘ç°nfså…±äº«ç›®å½•/root/nfsä¹Ÿæ–°å¢äº†åŒæ ·çš„æ–‡ä»¶ã€‚\n\nè¯´æ˜Podå·²ç»æˆåŠŸä½¿ç”¨äº†è¿™ä¸ªæŒä¹…å·ã€‚\nå›æ”¶æŒä¹…å·åˆ é™¤Podå’ŒPVCåï¼ŒPVçš„çŠ¶æ€ä¸ºReleasedï¼Œä¸åƒä¹‹å‰çš„Available\n\næ­¤æ—¶æˆ‘ä»¬å†æ¬¡applyåˆšæ‰åˆ é™¤çš„PVCï¼Œæ­¤æ—¶çš„PVCçš„çŠ¶æ€ä¸ºPendingï¼ŒPVå¹¶æ²¡æœ‰å’ŒPVCæˆåŠŸç»‘å®šã€‚\n\nè¿™æ˜¯å› ä¸ºä¹‹å‰å·²ç»ä½¿â½¤è¿‡è¿™ä¸ªå·ï¼Œæ‰€ä»¥å®ƒå¯èƒ½åŒ…å«å‰â¼€ä¸ªå£°æ˜â¼ˆçš„æ•°æ®ï¼Œå¦‚æœé›†ç¾¤ç®¡ç†å‘˜è¿˜æ²¡æ¥å¾—åŠæ¸…ç†ï¼Œé‚£ä¹ˆå°±ä¸åº”è¯¥å°†è¿™ä¸ªå·ç»‘å®šåˆ°å…¨æ–°çš„å£°æ˜ä¸­ã€‚\næ ¹æ®å›æ”¶ç­–ç•¥è¿›è¡Œå›æ”¶\n\næ‰‹åŠ¨å›æ”¶æŒä¹…å·\né€šè¿‡å°†persistentVolumeReclaimPolicyè®¾ç½®ä¸ºRetainä»â½½é€šçŸ¥åˆ°Kubernetesï¼Œæˆ‘ä»¬å¸Œæœ›åœ¨åˆ›å»ºæŒä¹…å·åå°†å…¶æŒä¹…åŒ–ï¼Œè®©Kuberneteså¯ä»¥åœ¨æŒä¹…å·ä»æŒä¹…å·å£°æ˜ä¸­é‡Šæ”¾åä»ç„¶èƒ½ä¿ç•™å®ƒçš„å·å’Œæ•°æ®å†…å®¹ã€‚â¼¿åŠ¨å›æ”¶æŒä¹…å·å¹¶ä½¿å…¶æ¢å¤å¯â½¤çš„â½…æ³•æ˜¯åˆ é™¤å’Œé‡æ–°åˆ›å»ºæŒä¹…å·èµ„æºã€‚å½“è¿™æ ·æ“ä½œæ—¶ï¼Œä½ å°†å†³å®šå¦‚ä½•å¤„ç†åº•å±‚å­˜å‚¨ä¸­çš„â½‚ä»¶ï¼šå¯ä»¥åˆ é™¤è¿™äº›â½‚ä»¶ï¼Œä¹Ÿå¯ä»¥å¦¥å–„ä¿å­˜æˆ–è€…å¤â½¤å®ƒä»¬ã€‚\n\nè‡ªåŠ¨å›æ”¶æŒä¹…å·\nå­˜åœ¨ä¸¤ç§å…¶ä»–å¯â¾çš„å›æ”¶ç­–ç•¥ï¼šRecycleå’ŒDeleteã€‚\nç¬¬â¼€ç§Recycleåˆ é™¤å·çš„å†…å®¹å¹¶ä½¿å·å¯â½¤äºå†æ¬¡å£°æ˜ï¼Œé€šè¿‡è¿™ç§â½…å¼ï¼ŒæŒä¹…å·å¯ä»¥è¢«ä¸åŒçš„æŒä¹…å·å£°æ˜å’ŒPodåå¤ä½¿â½¤ã€‚æ­¤å›æ”¶ç­–ç•¥å³å°†è¢«å¼ƒç”¨ï¼Œä¸å»ºè®®ä½¿ç”¨ã€‚\nâ½½å¦â¼€ç§Deleteç­–ç•¥åˆ é™¤åº•å±‚å­˜å‚¨åŠPVã€‚\n\n\nå¹¶ä¸æ˜¯æ‰€æœ‰ç±»å‹çš„æŒä¹…å·éƒ½æ”¯æŒè¿™ä¸‰ç§å›æ”¶ç­–ç•¥ï¼Œåœ¨åˆ›å»ºæŒä¹…å·ä¹‹å‰ï¼Œâ¼€å®šè¦æ£€æŸ¥å·ä¸­æ‰€â½¤åˆ°çš„ç‰¹å®šåº•å±‚å­˜å‚¨â½€æŒä»€ä¹ˆå›æ”¶ç­–ç•¥ã€‚\næŒä¹…å·çš„åŠ¨æ€é…ç½®â€”â€”å­˜å‚¨ç±»ï¼ˆStorageClassï¼‰åˆ°ç›®å‰ä¸ºæ­¢ï¼Œé›†ç¾¤ç®¡ç†å‘˜ä»ç„¶éœ€è¦æŒ‰ç…§å¼€å‘äººå‘˜çš„éœ€æ±‚æ¥æ‰‹åŠ¨é…ç½®æŒä¹…å·ã€‚å³æ¯å‡ºç°ä¸€ä¸ªæŒä¹…å·å£°æ˜ï¼Œå°±éœ€è¦ä¸€ä¸ªå¯¹åº”çš„æŒä¹…å·ã€‚è¿™æ ·åšè¿˜æ˜¯æœ‰äº›éº»çƒ¦ï¼Œè¿˜å¥½Kuberneteså¯ä»¥é€šè¿‡åŠ¨æ€é…ç½®æŒä¹…å·æ¥è‡ªåŠ¨æ‰§è¡Œä»»åŠ¡ã€‚\né›†ç¾¤ç®¡ç†å‘˜å¯ä»¥åˆ›å»ºä¸€ä¸ªæŒä¹…å·é…ç½®ï¼Œå¹¶ä¸”å®šä¹‰ä¸€ä¸ªæˆ–å¤šä¸ªå­˜å‚¨ç±»å¯¹è±¡ï¼ˆStorageClassï¼‰ï¼Œè¿™æ ·å¼€å‘äººå‘˜å°±å¯ä»¥åœ¨å…¶æŒä¹…å·å£°æ˜ä¸­å¼•ç”¨å­˜å‚¨ç±»ï¼ŒK8så°†æ ¹æ®æŒä¹…å·å£°æ˜åŠ¨æ€åˆ†é…ä¸€ä¸ªç¬¦åˆè¦æ±‚çš„æŒä¹…å·ã€‚\nä¸ç®¡ç†å‘˜é¢„å…ˆæä¾›â¼€ç»„æŒä¹…å·ä¸åŒçš„æ˜¯ï¼ŒåŠ¨æ€é…ç½®æŒä¹…å·éœ€è¦å®šä¹‰è‹¥å¹²ä¸ªStorageClassï¼Œå¹¶å…è®¸ç³»ç»Ÿåœ¨æ¯æ¬¡é€šè¿‡æŒä¹…å·å£°æ˜è¯·æ±‚æ—¶åˆ›å»ºâ¼€ä¸ªæ–°çš„æŒä¹…å·ã€‚\nå­˜å‚¨ç±»ä¸æŒä¹…å·ç±»ä¼¼ï¼Œå®ƒä¹Ÿæ˜¯ä¸€ç§é›†ç¾¤èµ„æºã€‚\nåˆ›å»ºä¸€ä¸ªå­˜å‚¨ç±»å¦‚æœä½ çš„é›†ç¾¤éƒ¨ç½²åœ¨äº‘æœåŠ¡æä¾›å•†ä¸Šï¼Œä¸€èˆ¬äº‘æœåŠ¡æä¾›å•†ä¼šæä¾›å¥½StorageClassèµ„æºï¼Œåœ¨ä½¿ç”¨æ—¶åªéœ€è¦æŒ‡å®šSCçš„åç§°ï¼ˆstorageClassNameï¼‰å³å¯ã€‚ä½†æˆ‘ä»¬çš„é›†ç¾¤éƒ¨ç½²åœ¨æœ¬åœ°ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦æ‰‹åŠ¨åˆ›å»ºä¸€ä¸ªæˆ–å¤šä¸ªStorageClassèµ„æºï¼Œç„¶åæ‰èƒ½åˆ›å»ºæ–°çš„æŒä¹…å·ã€‚\nhelmåˆ›å»ºstorageClassèµ„æº\næˆ‘ä»¬åœ¨è¿™é‡Œå®‰è£…longhorn\nLonghorn | Documentationâ€‹Longhorn | Documentation\nlonghornæ˜¯ä¸€ä¸ªè½»é‡çº§ä¸”åŠŸèƒ½å¼ºå¤§çš„äº‘åŸç”Ÿ Kubernetes åˆ†å¸ƒå¼å­˜å‚¨å¹³å°ï¼Œå¯ä»¥åœ¨ä»»æ„åŸºç¡€è®¾æ–½ä¸Šè¿è¡Œã€‚\nå®ƒæœ‰ä»¥ä¸‹çš„ä¼˜ç‚¹ï¼š\n\nå¯ä»¥åˆ›å»ºè·¨é›†ç¾¤ç¾éš¾æ¢å¤å·ï¼Œä»¥ä¾¿å¯ä»¥ä»ç¬¬äºŒä¸ª Kubernetes é›†ç¾¤ä¸­çš„å¤‡ä»½ä¸­å¿«é€Ÿæ¢å¤ä¸» Kubernetes é›†ç¾¤ä¸­çš„æ•°æ®\nè·¨å¤šä¸ªèŠ‚ç‚¹å’Œæ•°æ®ä¸­å¿ƒå¤åˆ¶å—å­˜å‚¨ä»¥æé«˜å¯ç”¨æ€§\nå°†å¤‡ä»½æ•°æ®å­˜å‚¨åœ¨ NFS æˆ– AWS S3 ç­‰å¤–éƒ¨å­˜å‚¨ä¸­ï¼Œç„¶åä»å¤‡ä»½ä¸­è¿˜åŸå·ç­‰ç­‰\n\né¦–å…ˆå®‰è£…open-iscsiã€‚longhornä¾èµ–æ­¤åè®®ã€‚iSCSI æ˜¯ä¸€ç§è¿œç¨‹å­˜å‚¨åè®®ï¼Œå…è®¸åœ¨ IP ç½‘ç»œä¸Šé€šè¿‡æ ‡å‡†ä»¥å¤ªç½‘è¿æ¥è®¿é—®å­˜å‚¨èµ„æºã€‚å’ŒNFSå¾ˆç±»ä¼¼ï¼Œéƒ½æ˜¯ä¸€ç§è¿œç¨‹è®¿é—®å­˜å‚¨æ•°æ®çš„ç½‘ç»œåè®®ã€‚\napt install open-iscsi\n\nç„¶åä½¿ç”¨helmå®‰è£…\nhelm repo add longhorn https://charts.longhorn.iohelm repo updatekubectl create ns longhornhelm install longhorn longhorn/longhorn -n longhorn\n\n\nåˆ é™¤æ—¶å‚ç…§å¦‚ä¸‹æ–¹æ³•ï¼Œä¸è¦ç›´æ¥helm uninstall\n\nUninstall Longhorn - ã€ŠLonghorn v1.4.1 Documentationã€‹ - ä¹¦æ ˆç½‘ Â· BookStack\n\nä½¿ç”¨å­˜å‚¨ç±»åˆ›å»ºå¥½StorageClassèµ„æºåï¼Œæˆ‘ä»¬åœ¨PVCä¸­ç›´æ¥æŒ‡å®šstorageClassèµ„æºåç§°å³å¯ï¼ŒK8så°±ä¼šè‡ªåŠ¨ä¸ºæˆ‘ä»¬åˆ†é…ä¸€ä¸ªç¬¦åˆè¦æ±‚çš„PVã€‚\napiVersion: v1kind: PersistentVolumeClaimmetadata:  name: pvc-testspec:  storageClassName: longhorn # æŒ‡å®šstorageClassçš„åç§°  accessModes:    - ReadWriteMany  resources:    requests:      storage: 1Gi\n\napplyåstorageClassä¸ºæˆ‘ä»¬è‡ªåŠ¨åˆ†é…äº†ä¸€ä¸ªPV\n\nåŠ¨æ€é…ç½®çš„æŒä¹…å·å…¶å®¹é‡å’Œè®¿é—®æ¨¡å¼æ˜¯åœ¨PVCä¸­æ‰€è¦æ±‚çš„ã€‚å®ƒçš„å›æ”¶ç­–ç•¥æ˜¯Deleteï¼Œè¿™æ„å‘³ç€å½“PVCè¢«åˆ é™¤æ—¶ï¼ŒPVä¹Ÿå°†è¢«åˆ é™¤ã€‚\né›†ç¾¤ç®¡ç†å‘˜å¯ä»¥åˆ›å»ºå…·æœ‰ä¸åŒæ€§èƒ½æˆ–å…¶ä»–ç‰¹æ€§çš„å¤šä¸ªå­˜å‚¨ç±»ï¼Œç„¶åç ”å‘â¼ˆå‘˜å†å†³å®šå¯¹åº”æ¯â¼€ä¸ªå£°æ˜æœ€é€‚åˆçš„å­˜å‚¨ç±»ã€‚\nå­˜å‚¨ç±»çš„å¥½å¤„åœ¨äºï¼Œå£°æ˜æ˜¯é€šè¿‡åç§°å¼•â½¤å®ƒä»¬çš„ã€‚å› æ­¤ï¼Œåªè¦StorageClassåç§°åœ¨æ‰€æœ‰è¿™äº›åç§°ä¸­ç›¸åŒï¼ŒPVCå®šä¹‰ä¾¿å¯è·¨ä¸åŒé›†ç¾¤ç§»æ¤ã€‚\nä¸æŒ‡å®šå­˜å‚¨ç±»çš„åŠ¨æ€é…ç½®æˆ‘ä»¬åœ¨ç”¨NFSåˆ›å»ºstorageClassèµ„æºæ—¶æŒ‡å®šäº†å®ƒä¸ºé»˜è®¤çš„å­˜å‚¨ç±»ï¼Œå½“æˆ‘ä»¬åˆ›å»ºPVCæ—¶ï¼Œå¦‚æœä¸æŒ‡å®šstorageClassNameï¼Œå®ƒå°±ä¼šé»˜è®¤ä½¿ç”¨ä½ è®¾ç½®ä¸ºé»˜è®¤çš„ï¼ˆdefaultï¼‰ä½œä¸ºå­˜å‚¨ç±»ã€‚\nå¦‚æœæˆ‘ä»¬éœ€è¦æ‰‹åŠ¨åˆ›å»ºPVï¼Œä¸ä½¿ç”¨å­˜å‚¨ç±»ï¼Œæˆ‘ä»¬åªéœ€è¦æŠŠstorageClassName: &quot;&quot;è®¾ç½®ä¸ºç©ºå­—ç¬¦å³å¯ã€‚\né…ç½®å‘å®¹å™¨å†…ä¼ é€’å‘½ä»¤è¡Œä¸å‚æ•°æ¯ä¸ªåº”ç”¨ç¨‹åºéƒ½æ˜¯å¯æ‰§è¡Œç¨‹åºæ–‡ä»¶ï¼Œä¾‹å¦‚Nginxã€Tomcatã€MySQLç­‰ï¼Œä½†æˆ‘ä»¬ä½¿ç”¨ä¸­ï¼Œé€šå¸¸ä¸ä¼šé€šè¿‡é»˜è®¤çš„é…ç½®å‚æ•°æ¥è¿è¡Œåº”ç”¨ï¼Œä¸€èˆ¬éƒ½éœ€è¦è‡ªå®šä¹‰ç¬¦åˆæˆ‘ä»¬åœºæ™¯çš„é…ç½®ï¼Œé‚£ä¹ˆå°±éœ€è¦å®šä¹‰é…ç½®æ–‡ä»¶æ¥å®Œæˆã€‚é‚£æˆ‘ä»¬çš„åº”ç”¨è¿è¡Œåœ¨å®¹å™¨ä¸­ï¼Œåº”è¯¥å¦‚ä½•å®šä¹‰é…ç½®ä¿¡æ¯å‘¢ï¼Ÿ\nDockerå®¹å™¨ä¸­çš„å‘½ä»¤è¡Œä¸å‚æ•°çš„ä¼ é€’å‘å®¹å™¨å‘½ä»¤ä¼ é€’å‚æ•°\næ¯”å¦‚Dockerfileä¸­çš„CMDä¸ENTRYPOINTæŒ‡ä»¤ã€‚\nENTRYPOINT æŒ‡ä»¤ç”¨äºè®¾ç½®å®¹å™¨å¯åŠ¨æ—¶è¦æ‰§è¡Œçš„é»˜è®¤å‘½ä»¤æˆ–ç¨‹åºï¼Œè€Œ CMD æŒ‡ä»¤ç”¨äºä¸º ENTRYPOINT æä¾›é»˜è®¤å‚æ•°ã€‚å½“åŒæ—¶å­˜åœ¨ ENTRYPOINT å’Œ CMD æŒ‡ä»¤æ—¶ï¼ŒCMD ä¸­çš„å†…å®¹ä¼šè¢«è§£é‡Šä¸ºè¦†ç›– ENTRYPOINT æŒ‡å®šç¨‹åºçš„é»˜è®¤å‚æ•°ã€‚\næ¯”å¦‚è¿™ä¸ªDockerfileã€‚ENTRYPOINT æŒ‡å®šäº†åœ¨å®¹å™¨å¯åŠ¨æ—¶è¦è¿è¡Œçš„å‘½ä»¤ï¼Œå³ echo &quot;Hello,&quot;ï¼Œè€Œ CMD æŒ‡å®šäº†ä½œä¸ºå‚æ•°ä¼ é€’ç»™ ENTRYPOINT æŒ‡å®šçš„ç¨‹åºçš„é»˜è®¤å‚æ•°ï¼Œå³ &quot;world&quot;ã€‚å› æ­¤ï¼Œå½“ä½ å¯åŠ¨è¿™ä¸ªå®¹å™¨æ—¶ï¼Œå®ƒä¼šæ‰“å°å‡º &quot;Hello, world&quot;ã€‚\nFROM ubuntuENTRYPOINT [&quot;echo&quot;, &quot;Hello,&quot;]CMD [&quot;world&quot;]\n\nä½†å¦‚æœä½ åœ¨è¿è¡Œå®¹å™¨æ—¶è¦†ç›–äº†CMDæ—¶ï¼Œé‚£ä¹ˆCMD [&quot;world&quot;]ä¸­çš„worldä¼šè¢«æ¢ä½good morningï¼Œå®¹å™¨æœ€åä¼šæ‰“å°å‡º&quot;Hello, good morning&quot;\n# æ·»åŠ å‚æ•°docker run &lt;image&gt; &lt;arguments&gt;docker run my-image good morning\n\nè¿™æ ·å¯ä»¥æ–¹ä¾¿ç”¨æˆ·çµæ´»åœ°æ›´æ”¹å‚æ•°ï¼Œä»è€Œæ— éœ€æ›´æ”¹Dockerfileã€‚\nå°†å®šä¹‰å¥½çš„é…ç½®æ–‡ä»¶åµŒå…¥é•œåƒæ–‡ä»¶ä¸­\nä½ å¯ä»¥æå‰æŠŠé…ç½®æ–‡ä»¶å†™å¥½ï¼Œç„¶åCOPYæˆ–ADDåœ¨å®¹å™¨çš„æŒ‡å®šä½ç½®ã€‚æˆ–è€…ä½ ä¹Ÿå¯ä»¥é€šè¿‡RUNæŒ‡ä»¤æ­é…echoã€sedä¹‹ç±»çš„å‘½ä»¤åŒæ ·å‘é…ç½®æ–‡ä»¶ä¸­å†™å…¥æŒ‡å®šå‚æ•°ä»¥è¾¾åˆ°æ›´æ”¹é…ç½®æ–‡ä»¶çš„æ•ˆæœã€‚\né€šè¿‡ç¯å¢ƒå˜é‡(Environment Variables)ä¼ é€’é…ç½®æ•°æ®\né€šè¿‡ç¯å¢ƒå˜é‡ä¸ºå®¹å™¨æä¾›é…ç½®ä¿¡æ¯æ˜¯æœ€å¸¸è§çš„ä½¿ç”¨æ–¹å¼ï¼Œä¾‹å¦‚ï¼Œä½¿ç”¨MySQLå®˜æ–¹æä¾›çš„é•œåƒæ–‡ä»¶å¯åŠ¨MySQLå®¹å™¨æ—¶ä½¿ç”¨çš„MYSQL_ROOT_PASSWORDç¯å¢ƒå˜é‡ï¼Œå®ƒç”¨äºä¸ºMYSQLæœåŠ¡å™¨çš„rootç”¨æˆ·è®¾ç½®ç™»é™†å¯†ç ã€‚\nä½ å¯ä»¥åœ¨docker runæ—¶é€šè¿‡-eå‚æ•°å‘ç¯å¢ƒå˜é‡ä¼ å€¼å³èƒ½å®ç°åº”ç”¨é…ç½®ã€‚\nåŸºäºDockerå·ä¼ é€é…ç½®æ–‡ä»¶\nä½ ä¹Ÿå¯ä»¥äº‹å…ˆå°†é…ç½®æ–‡ä»¶æ”¾ç½®äºå®¿ä¸»æœºä¹‹ä¸Šçš„æŸä¸ªè·¯å¾„ä¸­ï¼Œè€Œååœ¨å¯åŠ¨å®¹å™¨æ—¶å°†å…¶æŒ‚è½½è¿›å®¹å™¨é‡Œã€‚ä½†è¿™ä¹Ÿä¾èµ–äºç”¨æˆ·éœ€è¦äº‹å…ˆå°†é…ç½®æ•°æ®æä¾›åœ¨å®¿ä¸»æœºä¸Šçš„ç‰¹å®šè·¯å¾„ä¸‹ï¼Œè€Œä¸”åœ¨å¤šä¸»æœºæ¨¡å‹ä¸­ï¼Œè‹¥å®¹å™¨å­˜åœ¨è¢«è°ƒåº¦è‡³ä»»ä¸€ä¸»æœºè¿è¡Œçš„å¯èƒ½æ€§æ—¶ï¼Œç”¨æˆ·è¿˜éœ€è¦å°†é…ç½®å…±äº«åˆ°ä»»ä¸€å®¿ä¸»æœºæ¥ç¡®ä¿å®¹å™¨èƒ½å¤Ÿæ­£å¸¸åœ°è·å–åˆ°å®ƒä»¬ã€‚\nåœ¨Kubernetesä¸­è¦†å†™å‘½ä»¤è¡Œä¸å‚æ•°åœ¨Kubernetesä¸­å®šä¹‰å®¹å™¨æ—¶ï¼Œé•œåƒçš„ENTRYPOINTå’ŒCMDå‡å¯ä»¥è¢«è¦†ç›–ï¼Œä»…éœ€åœ¨å®¹å™¨å®šä¹‰ä¸­åˆ†åˆ«è®¾ç½®å±æ€§commandå’Œargsçš„å€¼ã€‚\nç¤ºä¾‹ï¼š\napiVersion: v1kind: Podmetadata:  name: testspec:  containers:  - image: alpine:latest    name: test    command: [&quot;sleep&quot;]    args: [&quot;999999&quot;]\n\nç»â¼¤å¤šæ•°æƒ…å†µä¸‹ï¼Œåªéœ€è¦è®¾ç½®â¾ƒå®šä¹‰å‚æ•°ã€‚å‘½ä»¤â¼€èˆ¬å¾ˆå°‘è¢«è¦†ç›–ï¼Œé™¤â¾®é’ˆå¯¹â¼€äº›æœªå®šä¹‰ENTRYPOINTçš„é€šâ½¤é•œåƒï¼Œä¾‹å¦‚busyboxã€‚\næ³¨æ„ commandå’Œargså­—æ®µåœ¨podåˆ›å»ºåâ½†æ³•è¢«ä¿®æ”¹ã€‚\nå¦‚æœä½ æƒ³ä¼ é€’å¤šä¸ªå‚æ•°ï¼Œargsæ˜¯ä¸€ä¸ªåˆ—è¡¨ï¼Œåœ¨è¿™ä¸ªåˆ—è¡¨ä¸­æŒ‡å®šå¤šä¸ªå­—ç¬¦ä¸²å³å¯ã€‚\nargs: [&quot;1&quot;,&quot;2&quot;,&quot;3&quot;]\n\n\nå¯ä»¥çœ‹åˆ°å…¶çˆ¶è¿›ç¨‹ï¼ˆPIDä¸º1ï¼‰ä¸ºæˆ‘ä»¬æŒ‡å®šçš„å‘½ä»¤ä¸å‚æ•°\nä¸ºå®¹å™¨è®¾ç½®ç¯å¢ƒå˜é‡åœ¨Kubernetesä¸­ä½¿ç”¨é•œåƒå¯åŠ¨å®¹å™¨æ—¶ï¼Œå¯ä»¥åœ¨Podèµ„æºæˆ–Podæ¨¡ç‰ˆèµ„æºä¸ºå®¹å™¨é…ç½®ä½¿ç”¨envå‚æ•°æ¥å®šä¹‰æ‰€ä½¿ç”¨çš„ç¯å¢ƒå˜é‡åˆ—è¡¨ã€‚\napiVersion: v1kind: Podmetadata:  name: mysqlspec:  containers:  - name: mysql    image: mysql:5.7    env:      - name: MYSQL_ROOT_PASSWORD # é€šè¿‡envæŒ‡å®šäº†rootç”¨æˆ·çš„å¯†ç         value: &quot;redrock&quot; \n\nConfigMap\nKubernetesä¹‹ConfigMapè¯¦è§£åŠå®è·µ - çŸ¥ä¹ (zhihu.com)\nConfigMaps | Kubernetes\n\nä¸ºä»€ä¹ˆè¦å¼•å…¥ConfigMapï¼Ÿ\nå¦‚æœä¸€å°æœåŠ¡å™¨ä¸Šéƒ¨ç½²å¤šä¸ªæœåŠ¡ï¼šnginxã€tomcatã€apacheç­‰ï¼Œé‚£ä¹ˆè¿™äº›é…ç½®éƒ½å­˜åœ¨è¿™ä¸ªèŠ‚ç‚¹ä¸Šã€‚å¦‚æœæœ‰ä¸€ä¸ªæœåŠ¡å‡ºç°é—®é¢˜ï¼Œéœ€è¦ä¿®æ”¹é…ç½®æ–‡ä»¶ï¼Œæ¯å°ç‰©ç†èŠ‚ç‚¹ä¸Šçš„é…ç½®éƒ½éœ€è¦ä¿®æ”¹ï¼Œè¿™ç§æ–¹å¼è‚¯å®šæ»¡è¶³ä¸äº†çº¿ä¸Šå¤§æ‰¹é‡çš„é…ç½®å˜æ›´è¦æ±‚ã€‚æ‰€ä»¥ï¼ŒK8s ä¸­å¼•å…¥äº† ConfigMapèµ„æºå¯¹è±¡ï¼Œå¯ä»¥å½“æˆ Volume æŒ‚è½½åˆ° Pod ä¸­ï¼Œå®ç°ç»Ÿä¸€çš„é…ç½®ç®¡ç†ã€‚ç®€å•æ¥è¯´ï¼Œä¸€ä¸ªConfigMapå¯¹è±¡å°±æ˜¯ä¸€ç³»åˆ—é…ç½®æ•°æ®çš„é›†åˆï¼Œè¿™äº›æ•°æ®å¯â€œæ³¨å…¥â€åˆ°Podå¯¹è±¡ä¸­ï¼Œå¹¶ä¸ºå®¹å™¨åº”ç”¨æ‰€ä½¿ç”¨ï¼Œæ³¨å…¥æ–¹å¼æœ‰æŒ‚è½½ä¸ºå­˜å‚¨å·å’Œä¼ é€’ä¸ºç¯å¢ƒå˜é‡ä¸¤ç§ã€‚\nä¼˜ç‚¹ï¼šå°†é…ç½®å­˜æ”¾åœ¨ç‹¬â½´çš„èµ„æºå¯¹è±¡ä¸­æœ‰åŠ©äºåœ¨ä¸åŒç¯å¢ƒï¼ˆå¼€å‘ã€æµ‹è¯•ã€è´¨é‡ä¿éšœå’Œâ½£äº§ç­‰ï¼‰ä¸‹æ‹¥æœ‰å¤šä»½åŒåé…ç½®æ¸…å•ã€‚Podæ˜¯é€šè¿‡åç§°å¼•â½¤ConfigMapçš„ï¼Œå› æ­¤å¯ä»¥åœ¨å¤šç¯å¢ƒä¸‹ä½¿â½¤ç›¸åŒçš„Podå®šä¹‰æè¿°ï¼ŒåŒæ—¶ä¿æŒä¸åŒçš„é…ç½®å€¼ä»¥é€‚åº”ä¸åŒç¯å¢ƒã€‚\nConfigMapæ˜¯åç§°ç©ºé—´çº§çš„èµ„æºï¼Œå› æ­¤å¼•ç”¨å®ƒçš„Podå¿…é¡»å¤„äºåŒä¸€åç§°ç©ºé—´ä¸­ã€‚\n\nåˆ›å»ºConfigMapå‘½ä»¤\nkubectl create configmap &lt;map-name&gt; &lt;data-source&gt;\n\n&lt;map-name&gt;ä¸ºConfigMapå¯¹è±¡çš„åç§°ï¼Œ&lt;data-source&gt;æ˜¯æ•°æ®æºã€‚æ•°æ®æºå¯ä»¥æ˜¯é”®å€¼å¯¹ç±»å‹çš„æ•°æ®ï¼Œä¹Ÿå¯ä»¥æŒ‡å®šæ–‡ä»¶æˆ–ç›®å½•æ¥è·å–ã€‚\né€šè¿‡é”®å€¼åˆ›å»ºåˆ›å»ºä¸€ä¸ªåä¸ºmysql-configçš„ConfigMapï¼Œé”®å€¼å¯¹ç¬¬ä¸€ä¸ªkeyä¸ºmysql_ipå€¼ä¸º1.2.3.4 é”®å€¼å¯¹ç¬¬äºŒä¸ªkeyä¸ºmysql_portå€¼ä¸º3306\nkubectl create configmap mysql-config \\--from-literal=mysql_ip=1.2.3.4 --from-literal=mysql_port=3306\n\n\né€šè¿‡æ–‡ä»¶åˆ›å»ºå‘½ä»¤\nkubectl create configmap &lt;configmap_name&gt; --from-file=&lt;[key=]source&gt;\n\né…ç½®æ–‡ä»¶ä»¥é”®å€¼å¯¹å½¢å¼å†™å…¥\nmysql-config.yaml\nmysql_ip: 1.2.3.4mysql_port: 3306\n\nkubectl create configmap mysql-config --from-file=./mysql-config.yaml\n\n\né€šè¿‡ç›®å½•åˆ›å»ºå½“é…ç½®æ–‡ä»¶æ•°é‡è¾ƒå¤šæ—¶ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨--from-fileé€‰é¡¹åæ‰€è·Ÿçš„è·¯å¾„æŒ‡å‘ä¸€ä¸ªç›®å½•è·¯å¾„å°±èƒ½æŠŠç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶ä¸€åŒåˆ›å»ºåŒä¸€ä¸ª ConfigMap èµ„æºä¸­ã€‚\nå‘½ä»¤\nkubectl create configmap &lt;configmap_name&gt; --from-file=&lt;path-to-directory&gt;\n\nä¾‹å¦‚\nls /data/configs/nginx/conf.d/myserver.conf  myserver-gzip.cfg  myserver-status.cfgkubectl create configmap nginx-config-files --from-file=/data/configs/nginx/conf.d/\n\nè¿™ç§æƒ…å†µä¸‹ï¼Œkubectlä¼šä¸ºâ½‚ä»¶å¤¹ä¸­çš„æ¯ä¸ªâ½‚ä»¶å•ç‹¬åˆ›å»ºæ¡â½¬ã€‚\nå½“ä»æ–‡ä»¶åˆ›å»ºConfigMapæ—¶ï¼Œæ‰€æœ‰æ¡â½¬ç¬¬â¼€â¾æœ€åçš„ç®¡é“ç¬¦å·è¡¨â½°åç»­çš„æ¡â½¬å€¼æ˜¯å¤šâ¾å­—â¾¯é‡ã€‚ï¼ˆå­—é¢é‡æ˜¯ä¸€ç§åœ¨ ConfigMap ä¸­ç›´æ¥æŒ‡å®šé”®å’Œå€¼çš„æ–¹å¼ï¼‰\n\nç›´æ¥é€šè¿‡èµ„æºé…ç½®æ¸…å•åˆ›å»ºapiVersion: v1kind: ConfigMapmetadata:  name: mysql-configdata:  mysql_ip: 1.2.3.4  mysql_port: 3306\n\nå‘Podä¸­ä¼ é€’ConfigMapä½œä¸ºç¯å¢ƒå˜é‡æ ¼å¼\nvalueFrom:  configMapKeyRef:     key: # è¦å¼•ç”¨ConfigMapå¯¹è±¡ä¸­æŸé”®çš„é”®å    name: # è¦å¼•ç”¨çš„ConfigMapå¯¹è±¡çš„åç§°    optional: # ç”¨äºä¸ºå½“å‰Podèµ„æºæŒ‡æ˜æ­¤å¼•ç”¨æ˜¯å¦ä¸ºå¯é€‰\n\nåˆ›å»ºä¸€ä¸ªConfigMap\nkubectl create configmap mysql-config --from-literal=mysql_password=redrock\n\nvalueFromå•ä¸€æ˜ å°„apiVersion: v1kind: Podmetadata:  name: mysqlspec:  containers:  - name: mysql    image: mysql:5.7    env:      - name: MYSQL_ROOT_PASSWORD # é€šè¿‡envæŒ‡å®šäº†rootç”¨æˆ·çš„å¯†ç         valueFrom:  \t\t  configMapKeyRef:   \t\t  \tname: mysql-config\t\t# è¦å¼•ç”¨çš„ConfigMapå¯¹è±¡çš„åç§°    \t\tkey: mysql_password\t\t# è¦å¼•ç”¨ConfigMapå¯¹è±¡ä¸­æŸé”®çš„é”®å    \t   #optional: \t\t\t\t# ç”¨äºä¸ºå½“å‰Podèµ„æºæŒ‡æ˜æ­¤å¼•ç”¨æ˜¯å¦ä¸ºå¯é€‰ã€‚å½“å€¼ä¸ºtrueæ—¶ï¼Œå³ä½¿ConfigMapä¸å­˜åœ¨ï¼Œå®¹å™¨ä¹Ÿå¯ä»¥æ­£å¸¸å¯åŠ¨\n\nenvFromå…¨éƒ¨æ˜ å°„å¦‚æœConfigMapåŒ…å«ä¸å°‘æ¡â½¬ï¼ŒKubernetesæä¾›äº†æš´éœ²ConfigMapçš„æ‰€æœ‰æ¡â½¬ä½œä¸ºç¯å¢ƒå˜é‡çš„â¼¿æ®µã€‚\napiVersion: v1kind: Podmetadata:  name: mysqlspec:  containers:  - name: mysql    image: mysql:5.7    envFrom:    - prefix: HTCPG_ # ç»™é”®åŠ å‰ç¼€å¯ä»¥é¿å…ä»å¤šä¸ªConfigMapå¼•å…¥é”®å€¼æ•°æ®æ—¶äº§ç”Ÿé”®keyé‡å(åç§°å†²çª)çš„é—®é¢˜      configMapKeyRef:         name: mysql-config  # CMèµ„æºåç§°\n\nä½ ä¹Ÿå¯ä»¥å‘commandå’Œargså­—æ®µä¸­å¼•ç”¨ç¯å¢ƒå˜é‡ï¼Œä½¿ç”¨$(VAR_NAME)çš„æ ¼å¼\n......command: [&quot;mysql&quot;]args: [&quot;-u&quot;,&quot;root&quot;,&quot;-p&quot;,&quot;$(MYSQL_ROOT_PASSWORD)&quot;]\n\nä»¥ConfigMapå­˜å‚¨å·å½¢å¼æŒ‚è½½Podè¯»å–é…ç½®æ–‡ä»¶ç¯å¢ƒå˜é‡æˆ–è€…å‘½ä»¤â¾å‚æ•°å€¼ä½œä¸ºé…ç½®å€¼é€šå¸¸é€‚â½¤äºå˜é‡å€¼è¾ƒçŸ­çš„åœºæ™¯ã€‚ç”±äºConfigMapä¸­å¯ä»¥åŒ…å«å®Œæ•´çš„é…ç½®â½‚ä»¶å†…å®¹ï¼Œå½“ä½ æƒ³è¦å°†å…¶æš´éœ²ç»™å®¹å™¨æ—¶ï¼Œå¯ä»¥å€ŸåŠ©å‰â¾¯ç« èŠ‚æåˆ°è¿‡çš„â¼€ç§ç§°ä¸ºconfigMapå·çš„ç‰¹æ®Šå·æ ¼å¼ã€‚\nConfigMapå·ä¼šå°†ConfigMapä¸­çš„æ¯ä¸ªæ¡â½¬å‡æš´éœ²æˆâ¼€ä¸ªâ½‚ä»¶ã€‚è¿â¾åœ¨å®¹å™¨ä¸­çš„è¿›ç¨‹å¯é€šè¿‡è¯»å–â½‚ä»¶å†…å®¹è·å¾—å¯¹åº”çš„æ¡â½¬å€¼ã€‚è¿™ç§â½…æ³•ä¸»è¦é€‚â½¤äºä¼ é€’è¾ƒâ¼¤çš„é…ç½®â½‚ä»¶ç»™å®¹å™¨ã€‚\nå…ˆåˆ›å»ºä¸€ä¸ªcm\nkubectl create cm stu-config --from-file=/root/class3/cm-volume --from-literal=country=China\n\n\napiVersion: v1kind: Podmetadata:  name: stu-mountspec:  volumes:    - name: config-volume      configMap: # configMapå½¢å¼å­˜å‚¨å·        name: stu-config  containers:    - name: test-container      image: busybox      command: [ &quot;/bin/sh&quot;, &quot;-c&quot;, &quot;sleep 1000000&quot; ]      volumeMounts:        - name: config-volume          mountPath: /data/config\n\n\nConfigMapçš„æ‰€æœ‰æ¡ç›®éƒ½ä»¥æ–‡ä»¶çš„å½¢å¼æŒ‚è½½è¿›äº†Podä¸­\nå¦‚æœåªæƒ³è¦ConfigMapçš„éƒ¨åˆ†å†…å®¹ï¼Œå¹¶è‡ªå®šä¹‰æ–‡ä»¶åï¼Œå¯é€šè¿‡itemsæ¥é…ç½®ï¼Œå¦‚ä¸‹ï¼š\napiVersion: v1kind: Podmetadata:  name: stu-mountspec:  volumes:    - name: config-volume      configMap:        name: stu-config        items: # å¼•ç”¨éƒ¨åˆ†å†…å®¹          - key: Tom.yaml             path: tom.yaml # è‡ªå®šä¹‰æ–‡ä»¶å          - key: Mary.yaml            path: mary.yaml  containers:    - name: test-container      image: busybox      command: [ &quot;/bin/sh&quot;, &quot;-c&quot;, &quot;sleep 1000000&quot; ]      volumeMounts:        - name: config-volume          mountPath: /data/config\n\nè¦æ³¨æ„æŒ‚è½½æŸâ¼€â½‚ä»¶å¤¹ä¼šéšè—è¯¥â½‚ä»¶å¤¹ä¸­å·²å­˜åœ¨çš„â½‚ä»¶ã€‚å¦‚æœæŒ‚è½½â½‚ä»¶å¤¹æ˜¯&#x2F;etcï¼Œè¯¥â½‚ä»¶å¤¹é€šå¸¸åŒ…å«ä¸å°‘é‡è¦â½‚ä»¶ã€‚ç”±äº&#x2F;etcä¸‹çš„æ‰€æœ‰â½‚ä»¶ä¸å­˜åœ¨ï¼Œå®¹å™¨æâ¼¤å¯èƒ½ä¼šæŸåã€‚å¦‚æœä½ å¸Œæœ›æ·»åŠ â½‚ä»¶â¾„æŸä¸ªâ½‚ä»¶å¤¹å¦‚&#x2F;etcï¼Œç»ä¸èƒ½é‡‡â½¤è¿™ç§â½…æ³•ã€‚\nå¦‚ä½•èƒ½æŒ‚è½½ConfigMapå¯¹åº”â½‚ä»¶â¾„ç°æœ‰â½‚ä»¶å¤¹çš„åŒæ—¶ä¸ä¼šéšè—ç°æœ‰â½‚ä»¶ï¼ŸvolumeMounté¢å¤–çš„subPathå­—æ®µå¯ä»¥è¢«â½¤ä½œæŒ‚è½½å·ä¸­çš„æŸä¸ªç‹¬â½´â½‚ä»¶æˆ–è€…æ˜¯â½‚ä»¶å¤¹ï¼Œâ½†é¡»æŒ‚è½½å®Œæ•´å·ã€‚æŒ‚è½½ä»»æ„â¼€ç§å·æ—¶å‡å¯ä»¥ä½¿â½¤subPathå±æ€§ã€‚å¯ä»¥é€‰æ‹©æŒ‚è½½éƒ¨åˆ†å·â½½ä¸æ˜¯æŒ‚è½½å®Œæ•´çš„å·ã€‚\nåœ¨&#x2F;etcä¸‹å¢åŠ ä¸€ä¸ªTom.yamlï¼Œè€Œä¸æ˜¯æŠŠå…¨éƒ¨è¦†ç›–æ‰&#x2F;etc\napiVersion: v1kind: Podmetadata:  name: stu-mount-1spec:  volumes:    - name: config-volume      configMap:        name: stu-config  containers:    - name: test-container      image: busybox      command: [ &quot;/bin/sh&quot;, &quot;-c&quot;, &quot;sleep 1000000&quot; ]      volumeMounts:        - name: config-volume          mountPath: /etc/Tom.yaml          subPath: Tom.yaml\n\n\nConfigMapçš„æ›´æ–°æ›´æ–°ConfigMapä¹‹åConfigMapå·ä¸­å¯¹åº”â½‚ä»¶çš„æ›´æ–°å¯èƒ½è€—è´¹æ•°åˆ†é’Ÿã€‚å¦‚æœä½¿ç”¨ç¯å¢ƒå˜é‡çš„æ–¹æ³•ï¼Œè¿™äº›å€¼å°†ä¸ä¼šæ›´æ–°ï¼›å¦‚æœåœ¨ConfigMapå·ä¸­ä½¿ç”¨äº†subPathå±æ€§ï¼Œåˆ™è¿™äº›æ–‡ä»¶ä¹Ÿä¸ä¼šæ›´æ–°ã€‚åœ¨ä½¿ç”¨æ—¶éœ€è¦æ³¨æ„è¿™ä¸€ç‚¹ï¼Œå¿…è¦æ—¶æ‰‹åŠ¨é‡å¯Podã€‚\nSecretåˆ°â½¬å‰ä¸ºâ½Œä¼ é€’ç»™å®¹å™¨çš„æ‰€æœ‰ä¿¡æ¯éƒ½æ˜¯â½è¾ƒå¸¸è§„çš„â¾®æ•æ„Ÿæ•°æ®ã€‚ç„¶â½½é…ç½®é€šå¸¸ä¼šåŒ…å«â¼€äº›æ•æ„Ÿæ•°æ®ï¼Œå¦‚è¯ä¹¦å’Œç§é’¥ï¼Œéœ€è¦ç¡®ä¿å…¶å®‰å…¨æ€§ã€‚ä¸ºäº†å­˜å‚¨ä¸åˆ†å‘æ­¤ç±»ä¿¡æ¯ï¼ŒKubernetesæä¾›äº†â¼€ç§ç§°ä¸ºSecretçš„å•ç‹¬èµ„æºå¯¹è±¡ç”¨æ¥ä¼ é€’æ•æ„Ÿé…ç½®ã€‚\nSecretç»“æ„ä¸ConfigMapç±»ä¼¼ï¼Œå‡æ˜¯é”®&#x2F;å€¼å¯¹çš„æ˜ å°„ï¼Œä½†Secretä¸“é—¨ç”¨äºä¿å­˜æœºå¯†æ•°æ®ã€‚Secretçš„ä½¿â½¤â½…æ³•ä¹Ÿä¸ConfigMapç›¸åŒï¼Œå¯ä»¥å°†Secretæ¡â½¬ä½œä¸ºç¯å¢ƒå˜é‡ä¼ é€’ç»™å®¹å™¨ï¼Œæˆ–å°†Secretæ¡â½¬æš´éœ²ä¸ºå·ä¸­çš„â½‚ä»¶ã€‚\nKubernetesé€šè¿‡ä»…ä»…å°†Secretåˆ†å‘åˆ°éœ€è¦è®¿é—®Secretçš„podæ‰€åœ¨çš„æœºå™¨èŠ‚ç‚¹æ¥ä¿éšœå…¶å®‰å…¨æ€§ã€‚å¦å¤–ï¼ŒSecretåªä¼šå­˜å‚¨åœ¨èŠ‚ç‚¹çš„å†…å­˜ä¸­ï¼Œæ°¸ä¸å†™â¼Šç‰©ç†å­˜å‚¨ï¼Œè¿™æ ·ä»èŠ‚ç‚¹ä¸Šåˆ é™¤Secretæ—¶å°±ä¸éœ€è¦æ“¦é™¤ç£ç›˜äº†ã€‚å¦å¤–Secreté€šè¿‡base64ç¼–ç å­˜å‚¨äºå…¶ä¸­çš„æ•æ„Ÿæ•°æ®ï¼Œè¿™æ ·åšæœ‰ä¸¤ç‚¹å¥½å¤„ï¼š\n\nbase64å¯ä»¥å°†ä¸€äº›éæ–‡æœ¬å¯¹è±¡ç¼–ç ä¸ºæ–‡æœ¬å€¼ï¼Œå¦‚å›¾ç‰‡ç­‰ã€‚æ³¨æ„å…¶å¤§å°ä¸èƒ½è¶…è¿‡1MBã€‚\nbase64ç¼–ç åçš„æ•°æ®äººç±»ä¸å¯è¯»ï¼Œè¿™é¿å…äº†ä¸€äº›æ—¶å€™æ“ä½œäººå‘˜æ— æ„ä¸­çœ‹åˆ°å¹¶è®°ä½å¯†ç çš„æƒ…å†µã€‚\n\nå› æ­¤åº”é‡‡â½¤ConfigMapå­˜å‚¨â¾®æ•æ„Ÿçš„â½‚æœ¬é…ç½®æ•°æ®ï¼Œé‡‡â½¤Secretå­˜å‚¨å¤©â½£æ•æ„Ÿçš„æ•°æ®ï¼Œé€šè¿‡é”®æ¥å¼•â½¤ã€‚å¦‚æœâ¼€ä¸ªé…ç½®â½‚ä»¶åŒæ—¶åŒ…å«æ•æ„Ÿä¸â¾®æ•æ„Ÿæ•°æ®ï¼Œè¯¥â½‚ä»¶åº”è¯¥è¢«å­˜å‚¨åœ¨Secretä¸­ã€‚\nSecretæœ‰ä¸‰ç§ç±»å‹ï¼š\n\nOpaqueï¼šbase64ç¼–ç æ ¼å¼çš„ Secretï¼Œç”¨æ¥å­˜å‚¨å¯†ç ã€å¯†é’¥ç­‰ã€‚\nService Accountï¼šç”¨æ¥è®¿é—®Kubernetes APIï¼Œç”±Kubernetesè‡ªåŠ¨åˆ›å»ºï¼Œå¹¶ä¸”ä¼šè‡ªåŠ¨æŒ‚è½½åˆ°Podçš„ /run/secrets/kubernetes.io/serviceaccountç›®å½•ä¸­ã€‚\nDockerConfigï¼šç”¨æ¥å­˜å‚¨ç§æœ‰docker registryçš„è®¤è¯ä¿¡æ¯ã€‚\n\né»˜è®¤ä»¤ç‰Œï¼ˆService Accountï¼‰é»˜è®¤è¢«æŒ‚è½½â¾„æ‰€æœ‰å®¹å™¨çš„Secretï¼Œç”¨äºå®¹å™¨è®¿é—®Kubernetes APIçš„èº«ä»½è®¤è¯ã€‚\nåˆ›å»ºå¹¶ä½¿ç”¨Opaqueç±»å‹Secretåˆ›å»ºä¸€ä¸ªSecretç”¨æ¥å­˜å‚¨mysqlçš„rootå¯†ç \nkubectl create secret generic mysql-passwd --from-literal=passwd=redrock\n\n\npasswdè¢«è‡ªåŠ¨base64ç¼–ç \nåœ¨Podä¸­ä½¿ç”¨Secret\napiVersion: v1kind: Podmetadata:  name: mysql-secretspec:  containers:    - name: mysql      image: mysql:5.7      env:        - name: MYSQL_ROOT_PASSWORD           valueFrom:            secretKeyRef:              name: mysql-passwd              key: passwd\n\né€šè¿‡VolumeæŒ‚è½½åˆ°å®¹å™¨å†…éƒ¨æ—¶ï¼Œå½“è¯¥Secretçš„å€¼å‘ç”Ÿå˜åŒ–æ—¶ï¼Œå®¹å™¨å†…éƒ¨å…·å¤‡è‡ªåŠ¨æ›´æ–°çš„èƒ½åŠ›ï¼Œä½†æ˜¯é€šè¿‡ç¯å¢ƒå˜é‡è®¾ç½®åˆ°å®¹å™¨å†…éƒ¨è¯¥å€¼ä¸å…·å¤‡è‡ªåŠ¨æ›´æ–°çš„èƒ½åŠ›ã€‚æ‰€ä»¥ä¸€èˆ¬æ¨èä½¿ç”¨VolumeæŒ‚è½½çš„æ–¹å¼ä½¿ç”¨Secretã€‚\napiVersion: apps/v1 kind: Deploymentmetadata:  name: easybanner-deployment   namespace: bot   labels:      app: easybannerspec:   replicas: 1  selector:     matchLabels:       app: easybanner  template:     metadata:      labels:        app: easybanner    spec:      volumes:        - name: easybanner-secret-config          secret:            secretName: easybanner-secret      containers:       - name: easybanner        image: reg.redrock.team/library/easybanner:1.0        env:          - name: App_ID            valueFrom:              secretKeyRef:                name: easybanner-secret                key: App_ID          - name: App_Secret            valueFrom:              secretKeyRef:                name: easybanner-secret                key: App_Secret          - name: URL            valueFrom:              secretKeyRef:                name: easybanner-secret                key: URL          - name: GIN_MODE            valueFrom:              secretKeyRef:                name: easybanner-secret                key: GIN_MODE        volumeMounts:          - name: easybanner-secret-config            mountPath: /app/secrets            readOnly: true        ports:        - containerPort: 8080\n\nåˆ›å»ºå¹¶ä½¿ç”¨DockerConfig Secretï¼ˆé•œåƒæ‹‰å–Secretï¼‰â¼¤éƒ¨åˆ†ç»„ç»‡æœºæ„ä¸å¸Œæœ›å®ƒä»¬çš„é•œåƒå¼€æ”¾ç»™æ‰€æœ‰â¼ˆï¼Œå› æ­¤ä¼šä½¿â½¤ç§æœ‰é•œåƒä»“åº“ã€‚éƒ¨ç½²â¼€ä¸ªpodæ—¶ï¼Œå¦‚æœå®¹å™¨é•œåƒä½äºç§æœ‰ä»“åº“ï¼ŒKuberneteséœ€æ‹¥æœ‰æ‹‰å–é•œåƒæ‰€éœ€çš„è¯ä¹¦ã€‚\næˆ‘ä»¬å¯ä»¥ç›´æ¥create secretï¼Œåªæ˜¯å‚æ•°æœ‰äº›å·®å¼‚ã€‚\nkubectl create secret docker-registry secret-dockercfg --docker-username=xxx --docker-password=xxx --docker-email=xxx\n\nè€Œæˆ‘ä»¬åœ¨å®¿ä¸»æœºdocker loginæ—¶ï¼Œç”¨æˆ·åå’Œå¯†ç ä¿¡æ¯è¢«ä¿å­˜åœ¨~/.docker/config.jsonï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥å¯¹è¿™ä¸ªæ–‡ä»¶è¿›è¡Œbase64ç¼–ç åå¡«å…¥.dockerconfigjsonå­—æ®µä¸­ã€‚\nbase64 ~/.docker/config.jsonapiVersion: v1kind: Secretmetadata:  name: secret-dockercfgtype: kubernetes.io/dockerconfigjson #æŒ‡å®šç±»å‹ ä½¿ç”¨æ–°ç‰ˆæœ¬çš„ data:  .dockerconfigjson: |        &quot;&lt;base64 encoded ~/.docker/config.json file&gt;&quot;\n\nç„¶åå†Podä¸­ä½¿ç”¨Secret\napiVersion: v1kind: Podmetadata:  name: pull-imagesspec:  imagePullSecrets: # åœ¨è¿™é‡ŒæŒ‡å®šSecretåç§°  - name: secret-dockercfg  containers:  - image: zhangxinhui02/nginx:private    name: nginx-private\n","categories":["Kubernetes"],"tags":["Kubernetes"]},{"title":"åŸºäºJenkins+Git+SonarQube+Draft+Buildah+Helmçš„CI/CDæµ","url":"/2025/12/08/%E5%9F%BA%E4%BA%8EJenkins+Git+SonarQube+Draft+Buildah+Helm%E7%9A%84CICD%E6%B5%81/","content":"æ„å»ºéƒ¨ç½²å·¥å…·åŠé•œåƒä½œç”¨ä»‹ç»å·¥å…·Jenkinsï¼šé€šè¿‡Pipelineå®ç°CI&#x2F;CDæµ\nSonarï¼šè¿›è¡Œä»£ç æ£€æŸ¥\ndraftï¼šæ ¹æ®é¡¹ç›®è‡ªåŠ¨ç”ŸæˆDockerfileä¸Helm Chart\nBuildahï¼šæ‰“åŒ…ã€æ¨é€é•œåƒ\nHelmï¼šéƒ¨ç½²Chartåˆ°Kubernetesé›†ç¾¤\né•œåƒbeatrueman/builder:1.0ï¼šæ•´åˆäº†draftä¸buildahï¼Œè´Ÿè´£é•œåƒæ„å»ºä¸é•œåƒæ¨é€\nbeatrueman/deployer:1.0ï¼šæ•´åˆäº†Helmï¼Œç”¨äºéƒ¨ç½²Chartåˆ°Kubernetes\nsonarsource/sonar-scanner-cli:latestï¼šç”¨äºæ‰§è¡Œä»£ç æ£€æŸ¥\njenkins/inbound-agent:3206.vb_15dcf73f6a_9-2ï¼šå®ƒæ˜¯ Jenkins Pipeline ä¸­çš„ä¸€ç§ä»£ç†æœºåˆ¶ï¼Œå…è®¸åœ¨ Jenkins ä¸­åŠ¨æ€åˆ›å»ºä»£ç†èŠ‚ç‚¹ä»¥æ‰§è¡Œç‰¹å®šçš„æ„å»ºä»»åŠ¡ã€‚\næ•´ä½“æµç¨‹\n\nå¼€å‘äººå‘˜æ¨é€ä»£ç åˆ°Gitä»“åº“ï¼Œè‡ªåŠ¨è§¦å‘Jenkins CI&#x2F;CDæµ\nSonarQubeè¿›è¡Œä»£ç æ£€æŸ¥\næŸ¥æ‰¾Dockerfileï¼Œå¦‚æœæ²¡æœ‰åˆ™é€šè¿‡Draftè‡ªåŠ¨ç”ŸæˆDockerfileå’ŒHelm Chart\nä½¿ç”¨buildahè¿›è¡Œé•œåƒæ‰“åŒ…ä¸é•œåƒæ¨é€åˆ°Harborä»“åº“\nä½¿ç”¨Helmå°†Chartéƒ¨ç½²åœ¨Kubernetesé›†ç¾¤ä¸Šï¼Œå¹¶æŠŠæ‰“åŒ…å¥½çš„chartåŒ…æ¨é€è‡³Harbor\n\nå‚æ•°å‚æ•°åŒ–æ„å»º\n\n\n\nå˜é‡å\nè¡¨ç¤ºå€¼\nå¯é€‰é¡¹\n\n\n\nHARBOR_REGISTRY\nHarborä»“åº“å\n\n\n\nPROJECT_NAME\né¡¹ç›®åç§°\nå¿…é¡»å°å†™\n\n\nENTRYPOINT\né¡¹ç›®å…¥å£æ–‡ä»¶ï¼ˆä»…ç”¨äºPythonï¼‰\napp.pyæˆ–main.py\n\n\nPORT\né¡¹ç›®æš´éœ²å…¥å£\n\n\n\nIMAGE_NAME\né•œåƒåç§°\n\n\n\nTAG\né•œåƒæ ‡ç­¾\n\n\n\nSONAR_PROJECT_NAME\nsonarä»£ç æ£€æŸ¥é¡¹ç›®åç§°\n\n\n\nå‡†å¤‡æ’ä»¶ä¸‹è½½åœ¨æ’ä»¶ç®¡ç†ä¸­æœç´¢å¹¶ä¸‹è½½ä»¥ä¸‹æ’ä»¶\nKubernetesï¼šKubernetesç‰ˆæœ¬4238.v41b_3ef14a_5d8\nSonarQube Scanner for Jenkinsï¼šSonarQube Scanner for Jenkinsç‰ˆæœ¬\næ·»åŠ å‡­æ®\n\nSonarQubeå‡­æ®ä¿å­˜çš„å†…å®¹ä¸ºåœ¨SonarQubeä¸­ç”Ÿæˆçš„å…¨å±€ä»¤ç‰Œ\nHarbor-Secretå‡­æ®ä¿å­˜Harborçš„ç”¨æˆ·åå’Œå¯†ç \nkubeconfigä¿å­˜æœ€åä¸€æ­¥ç”Ÿæˆçš„kubeconfig\n\nKubernetesé›†ç¾¤è¿æ¥ä»¥ä½¿ç”¨Kubernertséƒ¨ç½²çš„Jenkinsä¸ºä¾‹ï¼ˆéƒ¨ç½²æ–¹æ³•è¯·è‡ªè¡ŒæŸ¥è¯¢ï¼‰\n\n1.åœ¨ç³»ç»Ÿç®¡ç† &gt;&gt; Cloudsä¸­æ–°å¢ä¸€ä¸ªcloud\n2.ä¸»è¦å¡«å…¥ä»¥ä¸‹é…ç½®\n\nåç§°\nKubernetesåœ°å€ï¼šhttps://&lt;your_ip&gt;:6443\nKuberneteså‘½åç©ºé—´ï¼ˆéœ€è¦ä¸jenkinséƒ¨ç½²åœ¨åŒä¸€ä¸ªå‘½åç©ºé—´ï¼‰\nJenkinsåœ°å€ï¼šJenkinsåœ¨K8séƒ¨ç½²ï¼Œå¡«å…¥http://ClusterIP:Port (http://10.96.3.38:8080ï¼‰ã€‚è‹¥ä¸åœ¨K8séƒ¨ç½²ï¼Œéœ€è¦å°†/root/.kube/configbase64ç¼–ç åä¿å­˜ä¸ºå‡­æ®ï¼Œç„¶åå†å¡«å…¥jenkinsçš„æš´éœ²åœ°å€ã€‚\nJenkinsé€šé“ï¼šå¡«å…¥10.96.1.180:50000ï¼Œæ³¨æ„ä¸€å®šä¸è¦åŠ http\n\nå°†cloudåç§°å¡«å…¥cloud &quot;&quot;\n\n\n\nå¯ä»¥ç‚¹å‡»è¿æ¥æµ‹è¯•æ£€æŸ¥æ˜¯å¦å¯ä»¥è¿æ¥é›†ç¾¤\n\nSonarQubeå‡†å¤‡1.æ‰‹å·¥æ–°å»ºä¸€ä¸ªé¡¹ç›®\n2.æ–°å»ºä¸€ä¸ªå…¨å±€ä»¤ç‰Œ\n\n3.å°†è¯¥ä»¤ç‰Œç”Ÿæˆçš„tokenæ·»åŠ è¿›Jenkinsçš„å…¨å±€å‡­æ®ä¸­\n4.åœ¨ç³»ç»Ÿé…ç½®ä¸­ï¼Œå¡«å…¥Sonarçš„æœåŠ¡åœ°å€ä¸å‡­æ®\n\nä½¿ç”¨å—é™çš„kubeconfigä½¿ç”¨è¯¥å·¥å…·kubeconfig-generatorï¼Œç”Ÿæˆä¸€ä¸ªå—é™åˆ¶çš„kubeconfig\n\næ–°å»ºä¸€ä¸ªå‘½åç©ºé—´ï¼Œç”¨äºæœ€ç»ˆé¡¹ç›®çš„éƒ¨ç½²\nåœ¨ kubeconfig-generator.pyä¸­ï¼ŒæŒ‡å®šNAMESPACE ã€CLUSTER_SERVERã€SA_NAME\n\n\n3.å°†ç”Ÿæˆçš„kubeconfigä¸‹è½½ï¼Œä»¥secret fileå½¢å¼æ·»åŠ è¿›Jnekinså‡­æ®\n4.å› ä¸ºæ­¤æ—¶çš„configæ˜¯å—é™çš„ï¼Œéœ€è¦ç”Ÿæˆä¸€ä¸ªrolebindingï¼Œç”¨äºjenkinså‘½åç©ºé—´ä¸‹çš„defaultç”¨æˆ·æ§åˆ¶testå‘½åç©ºé—´ä¸‹çš„ä¸€äº›æ“ä½œ\napiVersion: rbac.authorization.k8s.io/v1kind: RoleBindingmetadata:  name: jenkins-rolebinding  namespace: test # æ§åˆ¶testå‘½åç©ºé—´subjects:- kind: ServiceAccount  name: default  namespace: jenkins # è¿™é‡Œå‡è®¾JenkinsæœåŠ¡è´¦æˆ·ä½äºjenkinså‘½åç©ºé—´roleRef:  kind: ClusterRole  name: edit # æˆ–è€…ä½ å¯ä»¥å®šä¹‰ä¸€ä¸ªè‡ªå®šä¹‰çš„Roleï¼ŒåªåŒ…å«æ‰€éœ€çš„æœ€å°æƒé™  apiGroup: rbac.authorization.k8s.io\n\nå®Œæ•´Jenkinsfilepipeline &#123;    agent &#123;        kubernetes &#123;            cloud &quot;Redrock-Cloud&quot;            yaml &quot;&quot;&quot;apiVersion: v1kind: Podmetadata:  labels:    component: jenkins-agentspec:  containers:    - name: sonar-scanner      image: sonarsource/sonar-scanner-cli:latest      command:        - cat      tty: true    - name: builder      image: beatrueman/builder:1.0      securityContext:        privileged: true      command:        - cat      tty: true    - name: deployer      image: beatrueman/deployer:1.0      command:        - cat      tty: true    - name: jnlp      image: jenkins/inbound-agent:3206.vb_15dcf73f6a_9-2      resources:        limits:          memory: &quot;1Gi&quot;          cpu: &quot;200m&quot;&quot;&quot;&quot;        &#125;    &#125;    // environment &#123;    //     HARBOR_REGISTRY = &#x27;&#x27;    //     PROJECT_NAME = &#x27;myapp&#x27; // é¡¹ç›®åç§°ï¼Œå¿…é¡»å°å†™    //     ENTRYPOINT = &#x27;main.py&#x27; // é¡¹ç›®å…¥å£æ–‡ä»¶ï¼Œapp.pyæˆ–main.py    //     PORT = &#x27;6666&#x27; // é¡¹ç›®æš´éœ²çš„ç«¯å£    //     IMAGE_NAME = &#x27;yicloud&#x27; // é•œåƒåç§°    //     TAG = &#x27;v1&#x27; // é•œåƒæ ‡ç­¾    //     SONAR_PROJECT_NAME = &#x27;Python&#x27; // sonaré¡¹ç›®åç§°    // &#125;    stages &#123;        stage(&#x27;git clone&#x27;) &#123;            steps &#123;                echo &quot;1.æ­£åœ¨å…‹éš†ä»£ç ......&quot;                git url: &quot;&quot;            &#125;        &#125;        stage(&#x27;SonarQube code checking&#x27;) &#123;            steps &#123;                container(&#x27;sonar-scanner&#x27;) &#123;                    echo &#x27;2.æ­£åœ¨è¿›è¡Œä»£ç æ£€æŸ¥......&#x27;                    echo &#x27;ä»£ç æ£€æŸ¥ç»“æœè¯·åœ¨é¢æ¿æŸ¥çœ‹ï¼&#x27;                    withSonarQubeEnv(&#x27;SonarQube&#x27;) &#123;                        sh &#x27;&#x27;&#x27;sonar-scanner \\                            -Dsonar.projectKey=$&#123;SONAR_PROJECT_NAME&#125; \\                            -Dsonar.projectName=$&#123;SONAR_PROJECT_NAME&#125; \\                            -Dsonar.sources=&quot;/home/jenkins/agent/workspace/$&#123;JOB_NAME&#125;&quot; \\                            -Dsonar.projectVersion=1.0 \\                            -Dsonar.sourceEncoding=UTF-8                        &#x27;&#x27;&#x27;                    &#125;                &#125;            &#125;        &#125;        stage(&#x27;Image build&#x27;) &#123;            steps &#123;                script &#123;                    echo &#x27;3.æ­£åœ¨åˆ¶ä½œé•œåƒ......&#x27;                    try &#123;                        def result = sh(script: &quot;ls -al | grep Dockerfile&quot;, returnStatus: true)                        if (result == 0) &#123;                            echo &quot;æ‰¾åˆ° Dockerfileï¼Œå¼€å§‹æ„å»ºé•œåƒ&quot;                            container(&#x27;builder&#x27;) &#123;                                sh &#x27;&#x27;&#x27;                                    draft create -a myapp --variable PORT=$&#123;PORT&#125; \\                                        --variable APPNAME=$&#123;PROJECT_NAME&#125; \\                                        --variable SERVICEPORT=8088 \\                                        --variable NAMESPACE=test \\                                        --variable IMAGENAME=$&#123;HARBOR_REGISTRY&#125;/library/$&#123;IMAGE_NAME&#125; \\                                        --variable IMAGETAG=$&#123;TAG&#125; \\                                        --variable ENTRYPOINT=$&#123;ENTRYPOINT&#125; \\                                        --variable VERSION=3 \\                                        --deploy-type helm \\                                        --deployment-only                                    rm &quot;/home/jenkins/agent/workspace/$&#123;JOB_NAME&#125;/charts/templates/namespace.yaml&quot;                                    buildah bud -t $&#123;HARBOR_REGISTRY&#125;/library/$&#123;IMAGE_NAME&#125;:$&#123;TAG&#125; .                                &#x27;&#x27;&#x27;                            &#125;                        &#125; else &#123;                            echo &quot;æœªæ‰¾åˆ° Dockerfileï¼Œå°†ç”Ÿæˆ Dockerfile&quot;                            container(&#x27;builder&#x27;) &#123;                                def jobNameLower = &quot;$&#123;JOB_NAME&#125;&quot;.toLowerCase()                                sh &#x27;&#x27;&#x27;                                    draft create -a myapp --variable PORT=$&#123;PORT&#125; \\                                        --variable APPNAME=$&#123;PROJECT_NAME&#125; \\                                        --variable SERVICEPORT=8088 \\                                        --variable NAMESPACE=test \\                                        --variable IMAGENAME=$&#123;HARBOR_REGISTRY&#125;/library/$&#123;IMAGE_NAME&#125; \\                                        --variable IMAGETAG=$&#123;TAG&#125; \\                                        --variable ENTRYPOINT=$&#123;ENTRYPOINT&#125; \\                                        --variable VERSION=3 \\                                        --deploy-type helm                                    rm &quot;/home/jenkins/agent/workspace/$&#123;JOB_NAME&#125;/charts/templates/namespace.yaml&quot;                                    buildah bud -t $&#123;HARBOR_REGISTRY&#125;/library/$&#123;IMAGE_NAME&#125;:$&#123;TAG&#125; .                                &#x27;&#x27;&#x27;                            &#125;                        &#125;                    &#125; catch (err) &#123;                        echo &quot;æŸ¥æ‰¾ Dockerfile å‘ç”Ÿé”™è¯¯: $&#123;err&#125;&quot;                    &#125;                &#125;            &#125;        &#125;        stage(&#x27;Image push&#x27;) &#123;            steps &#123;                echo &quot;3. Pushing image&quot;                container(&#x27;builder&#x27;) &#123;                    script &#123;                        withCredentials([usernamePassword(credentialsId: &#x27;Redrock-Harbor-Secret&#x27;, passwordVariable: &#x27;passwd&#x27;, usernameVariable: &#x27;username&#x27;)]) &#123;                            sh &quot;buildah login -u $&#123;username&#125; -p $&#123;passwd&#125; $&#123;env.HARBOR_REGISTRY&#125;&quot;                            sh &quot;buildah images&quot;                            sh &quot;buildah push $&#123;HARBOR_REGISTRY&#125;/library/$&#123;IMAGE_NAME&#125;:$&#123;TAG&#125;&quot;                        &#125;                    &#125;                &#125;            &#125;        &#125;                stage(&#x27;Deploy to Kubernetes&#x27;) &#123;            steps &#123;                echo &quot;5.å³å°†æŠŠæœåŠ¡éƒ¨ç½²åœ¨Kubernetesé›†ç¾¤ä¸Š......&quot;                container(&#x27;deployer&#x27;) &#123;                    script &#123;                        // ä½¿ç”¨å—é™åˆ¶çš„kubeconfig                        def kubeConfigCreds = credentials(&#x27;kubeconfig&#x27;)                        // å†™å…¥ä¸´æ—¶kubeconfigæ–‡ä»¶                        sh &#x27;echo &quot;$&#123;kubeConfigCreds&#125;&quot; | base64 --decode &gt; /tmp/kubeconfig.yaml&#x27;                        sh &#x27;ls&#x27;\t\t\t            // éƒ¨ç½²å¹¶è·å–è¿”å›ç ï¼Œå¦‚æœæˆåŠŸéƒ¨ç½²åˆ™æ‰“åŒ…chartå¹¶ä¸Šä¼ è‡³Harborä»“åº“                        def chartYamlContent = readFile &quot;charts/Chart.yaml&quot; // è¯»å–Chart.yaml                        def chartYaml = readYaml text: chartYamlContent                        def chartVersion = chartYaml.version // è·å–Chartçš„version                        def packageName = &quot;$&#123;PROJECT_NAME&#125;-$&#123;chartVersion&#125;.tgz&quot; // æ‰“åŒ…åçš„Chartå                                                def helmDeployResult = sh(script: &quot;helm install $&#123;PROJECT_NAME&#125; -n test --kubeconfig /tmp/kubeconfig.yaml charts&quot;, returnStatus: true)\t\t\t                if(helmDeployResult == 0) &#123;\t\t\t                    echo &#x27;éƒ¨ç½²æˆåŠŸï¼&#x27;\t\t\t                    echo &#x27;æ­£åœ¨æ‰“åŒ…Chartï¼Œå¹¶ä¸Šä¼ è‡³Harborä»“åº“&#x27;\t\t\t                    \t\t\t                    sh &quot;helm package charts&quot;\t\t\t                    withCredentials([usernamePassword(credentialsId: &#x27;Redrock-Harbor-Secret&#x27;, passwordVariable: &#x27;passwd&#x27;, usernameVariable: &#x27;username&#x27;)]) &#123;\t\t\t                        sh &quot;helm registry login $&#123;env.HARBOR_REGISTRY&#125; -u $&#123;username&#125; -p $&#123;passwd&#125;&quot;\t\t\t                        sh &quot;helm push $&#123;packageName&#125; oci://$&#123;HARBOR_REGISTRY&#125;/library&quot;\t\t\t                    &#125;\t\t\t                    \t\t\t                &#125; else &#123;\t\t\t                    error &quot;Chartéƒ¨ç½²å¤±è´¥ï¼ŒHelmè¿”å›ç : $&#123;helmDeployResult&#125;&quot;\t\t\t                &#125;\t\t\t                                    &#125;                &#125;            &#125;        &#125;    &#125;&#125;\n\n\nå®‰å…¨è­¦ç¤ºæ ¹æ®buildah image v1.34: Error: open &#x2F;usr&#x2F;lib&#x2F;containers&#x2F;storage&#x2F;overlay-images&#x2F;images.lock: permission denied Â· Issue #5332 Â· containers&#x2F;buildah (github.com)\nbuilderå®¹å™¨ä¸å¾—ä¸å¼€å¯privilegedï¼Œå¦åˆ™æ— æ³•è¿›è¡Œæ­£å¸¸çš„æ‰“åŒ…ä¸æ¨é€é•œåƒã€‚\nåŸå› ä¸è§£å†³å¯å‚è€ƒï¼šhttps://opensource.com/article/19/3/tips-tricks-rootless-buildah\n\n","categories":["Achievements"],"tags":["Achievements"]},{"title":"å…³äºGZCTFåå‘ä»£ç†é…ç½®ä¸å½“å¯¼è‡´å¹³å°åœ¨é«˜å¹¶å‘ä¸‹å´©æºƒ","url":"/2025/12/08/%E5%85%B3%E4%BA%8EGZCTF%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86%E9%85%8D%E7%BD%AE%E4%B8%8D%E5%BD%93%E5%AF%BC%E8%87%B4%E5%B9%B3%E5%8F%B0%E5%9C%A8%E9%AB%98%E5%B9%B6%E5%8F%91%E4%B8%8B%E5%B4%A9%E6%BA%83/","content":"ç¯å¢ƒGZCTFå•å®ä¾‹éƒ¨ç½²åœ¨172.20.14.20ã€172.20.14.110ã€172.20.14.111ä¸‰å°æœºå™¨çš„K8sé›†ç¾¤ä¸Šï¼Œä½¿ç”¨LoadBalancerå¯¹å¤–æš´éœ²æœåŠ¡ï¼ŒLoadBalancer IPç”±MetalLBåˆ†å¾—ï¼š172.20.14.118\né—®é¢˜æè¿°2024å¹´11æœˆ16æ—¥ï¼Œ2024 Redrock CTFå¼€èµ›ï¼Œè¿™æ¬¡æ¯”èµ›ä½¿ç”¨äº†æ–°çš„æ¯”èµ›å¹³å°GZ::CTF - GZ::CTF Docsã€‚\nç”±äºåå‘ä»£ç†é…ç½®ä¸å½“ï¼Œå¯¼è‡´å¹³å°åœ¨åˆšå¼€èµ›æ—¶å°±å› ä¸ºé«˜å¹¶å‘è€Œç«‹å³å´©æºƒï¼ŒæŠ¥é”™æ˜¾ç¤ºé”™è¯¯ä»£ç 429ï¼Œå¹¶ä¸”å¹³å°å“åº”å¾ˆæ…¢ï¼Œæ— æ³•æ­£å¸¸åˆ·æ–°ã€‚\n\n\næ’æŸ¥è¿‡ç¨‹åœ¨é‡åˆ°429é—®é¢˜åï¼Œé¦–å…ˆæ˜¯æ£€æŸ¥äº†é…ç½®æ–‡ä»¶ä¸­å’Œè®¿é—®é™åˆ¶æœ‰å…³çš„å‚æ•°é…ç½®ï¼Œéƒ½é€‚å½“çš„è°ƒå¤§ï¼Œå‘ç°å¹¶æ²¡æœ‰ä»€ä¹ˆæ”¹å–„ï¼Œæ²¡æœ‰è§£å†³é—®é¢˜ã€‚\n\nGZCTFæ˜¯å•å®ä¾‹éƒ¨ç½²çš„ï¼Œä¸ºäº†è®©æµé‡åˆ†æµï¼Œæˆ‘å°†Podæ‰©å®¹ï¼Œä½†æ˜¯å•å®ä¾‹éƒ¨ç½²ä¸å¤šå®ä¾‹éƒ¨ç½²å­˜åœ¨å·®åˆ«ï¼Œå¹¶ä¸”æ®å®˜æ–¹ä»‹ç»å•å®ä¾‹å·²ç»èƒ½æ»¡è¶³å¤§éƒ¨åˆ†çš„ä¸€èˆ¬æ¯”èµ›ï¼ˆæ»¡è¶³2000äºº200é¢˜ï¼‰ï¼Œå¹¶ä¸”æ˜¯å®˜æ–¹æœ€ä¸ºæ¨èçš„éƒ¨ç½²æ–¹å¼ã€‚å¤šå®ä¾‹éƒ¨ç½²éœ€è¦é…ç½®å¯¹è±¡å­˜å‚¨ï¼Œå¦åˆ™ä¼šå¯¼è‡´æ•°æ®ä¸ä¸€è‡´çš„é—®é¢˜ã€‚\n\næœ€ååœ¨å’¨è¯¢å¼€å‘è€…ä»¥åŠåœ¨æ£€æŸ¥æ—¥å¿—çš„è¿‡ç¨‹ä¸­å‘ç°äº†é—®é¢˜ï¼š\né…ç½®æ–‡ä»¶ä¸­çš„ForwardedOptionsçš„TrustedNetworkså’ŒTrustedProxieså­—æ®µä½¿ç”¨çš„æ˜¯é»˜è®¤å€¼ï¼Œåå‘ä»£ç†å¹¶æ²¡æœ‰ç”Ÿæ•ˆï¼Œlogsé‡Œå®¢æˆ·ç«¯çš„ipå…¨æ˜¯ä¸€è‡´çš„ï¼Œå¤§é‡çš„ç›¸åŒipå¯èƒ½è¶…è¿‡äº†å¹³å°çš„è®¿é—®é˜ˆå€¼ï¼Œæœ€åå¹³å°å¾ˆå®¹æ˜“å°±å´©æºƒäº†ã€‚\nplaintext[24-11-16 08:14:30.307 DBG] RequestLoggingMiddleware: [200]     7.10ms HTTP GET    /api/account/profile @ ::ffff:172.20.14.20 [24-11-16 08:14:30.704 DBG] RequestLoggingMiddleware: [404]     0.22ms HTTP GET    /hub/user @ ::ffff:172.20.14.20 [24-11-16 08:14:30.986 DBG] RequestLoggingMiddleware: [404]     1.32ms HTTP GET    /hub/user @ ::ffff:172.20.14.20\n\n\nè§£å†³æ³¨æ„å°†ForwardedOptionsçš„\n\nTrustedNetworkså€¼ä¸º172.20.14.20&#x2F;24\nTrustedProxieså€¼ä¸º172.20.14.118ï¼Œå³GZCTFçš„LoadBalancer IP\n\næ•´ä¸ªproxy chain\nplaintext172.20.14.2ï¼ˆç½‘å…³æœºï¼‰-&gt; 172.20.14.118ï¼ˆLoadBalancerï¼‰ -&gt; 172.20.14.20 ï¼ˆmaster1ï¼‰                                                    -&gt; 172.20.14.110ï¼ˆmaster2ï¼‰                                                    -&gt; 172.20.14.111 ï¼ˆmaster3ï¼‰","categories":["Trouble Shooting"],"tags":["Trouble Shooting"]},{"title":"åˆ©ç”¨é€šä¹‰çµç å®ç°æˆ‘çš„ç¬¬ä¸€æ¬¡å¼€æºè´¡çŒ®","url":"/2025/12/08/%E5%88%A9%E7%94%A8%E9%80%9A%E4%B9%89%E7%81%B5%E7%A0%81%E5%AE%9E%E7%8E%B0%E6%88%91%E7%9A%84%E7%AC%AC%E4%B8%80%E6%AC%A1%E5%BC%80%E6%BA%90%E8%B4%A1%E7%8C%AE/","content":"ç»“ç¼˜å¼€æºæœ€æ—©äº†è§£å¼€æºæ˜¯ä»å­¦æ ¡çš„å…´è¶£ç»„ç»‡å¼€å§‹çš„ã€‚2023å¹´10æœˆ21æ—¥ï¼ŒopenSUSEäºšæ´²å³°ä¼šåœ¨æˆ‘ä»¬å­¦æ ¡å¬å¼€ï¼Œè¿™æ¬¡ä¼šè®®æ±‡èšäº†è®¸å¤šæ¥è‡ªopenSUSEç¤¾åŒºè´¡çŒ®è€…ä»¥åŠå¯¹å¼€æºæ„Ÿå…´è¶£çš„çˆ±å¥½è€…ä»¬ã€‚æˆ‘ç¬¬ä¸€æ¬¡çŸ¥é“æœ‰è¿™ä¹ˆå¤šå¿—åŒé“åˆçš„çˆ±å¥½è€…åœ¨è¿›è¡Œå¼€æºè´¡çŒ®ï¼Œä»–ä»¬ä»¥ä¸ªäººå…´è¶£ä¸ºé©±åŠ¨åŠ›å…±åŒç»´æŠ¤æŠ¤ç€ä¸€ä¸ªç¤¾åŒºã€‚è¿™æ¬¡å³°ä¼šæ¿€å‘äº†æˆ‘å¯¹å¼€æºç¤¾åŒºçš„å…´è¶£ï¼Œä¸€é¢—ç§å­ä¹Ÿå¼€å§‹åŸ‹åœ¨æˆ‘çš„å¿ƒä¸­â€”â€”æˆ‘ä¹Ÿæƒ³è¦åšä¸€æ¬¡å¼€æºè´¡çŒ®ï¼\n\n2024å¹´6æœˆ24æ—¥ï¼Œæˆ‘ä¸Šå®Œè¯¾å‡†å¤‡å›å®¿èˆï¼Œåˆšå¥½åœ¨å¿…ç»ä¹‹è·¯ä¸Šçœ‹åˆ°â€œ2024å¤©æ± äº‘åŸç”Ÿç¼–ç¨‹æŒ‘æˆ˜èµ›â€çš„å®£ä¼ æµ·æŠ¥ã€‚æˆ‘ä¸€çœ‹å±…ç„¶æ˜¯é˜¿é‡Œäº‘ä¸¾åŠçš„ï¼Œå›åˆ°å®¿èˆåå°±ç«‹é©¬ä»”ç»†æŸ¥çœ‹äº†è¯¦ç»†çš„æ¯”èµ›ä¿¡æ¯ã€‚â€èµ›é“3ï¼šç”¨é€šä¹‰çµç ,äººäººéƒ½æ˜¯å¼€æºè´¡çŒ®è€…â€œå¾ˆç¬¦åˆæˆ‘çš„å…´è¶£ï¼Œæˆ‘ä¹Ÿç‰¹åˆ«æƒ³èƒ½æœ‰ä¸€ä¸ªè¢«Mergedçš„PRã€‚èµ›é“3æœ‰å¾ˆå¤šä¸ªé€‰é¢˜ï¼Œç»“åˆæˆ‘è‡ªå·±å­¦ä¹ è¿‡äº‘åŸç”Ÿçš„ä¸€äº›çŸ¥è¯†ï¼Œæˆ‘æœ€ç»ˆé€‰æ‹©äº†Higresså¼€æºé¡¹ç›®ï¼Œè¿™æ˜¯é˜¿é‡Œäº‘è‡ªå·±å¼€å‘çš„APIç½‘å…³ï¼Œå®ƒå’ŒNginxã€Traefikå¾ˆç±»ä¼¼ï¼Œä½†æ˜¯å®ƒå¢åŠ äº†è®¸å¤šæ–°çš„åŠŸèƒ½ï¼Œå¹¶ä¸”æ›´èšç„¦äºäº‘åŸç”Ÿç¯å¢ƒä¸­çš„æœåŠ¡ç½‘æ ¼ã€‚å°¤å…¶æ˜¯å®ƒæœ‰ä¸°å¯Œçš„æ’ä»¶ï¼Œç‰¹åˆ«æ˜¯ä¸AIæœ‰å…³çš„æ’ä»¶ï¼Œä½¿å¾—ç”¨æˆ·å¯ä»¥å¾ˆè½»æ˜“çš„æ‹¥æœ‰ä¸€ä¸ªå±äºè‡ªå·±çš„AIã€‚\n\nå‚åŠ æ¯”èµ›å› ä¸ºHigressè¿™ä¸ªå¼€æºé¡¹ç›®æ˜¯å¼€æ”¾å¼èµ›é¢˜ï¼Œæµè§ˆäº†å½“æ—¶çš„issuesï¼Œå› ä¸ºæ¥è§¦è¿‡CI&#x2F;CDï¼Œå¹¶ä¸”æ‡‚å¾—Kuberneteså’ŒDockerçš„ä¸€äº›æ“ä½œï¼Œæ‰€ä»¥æˆ‘æœ€ç»ˆé€‰æ‹©äº†è¿™ä¸ªissueï¼šæ”¯æŒé€šè¿‡ GitHub Actions æ¥æ„å»ºå’Œå‘å¸ƒ Wasm æ’ä»¶é•œåƒ Â· Issue #1052 Â· alibaba&#x2F;higress\n\né€šä¹‰çµç ä½“éªŒè™½ç„¶æ¥è§¦è¿‡CI&#x2F;CDï¼Œä½†æ˜¯æˆ‘ä»æ¥æ²¡æœ‰åœ¨Githubä¸Šå®ç°è¿‡å®ƒï¼Œä¹Ÿä¸ä¼šGithub Actionçš„è¯­æ³•æ ¼å¼ã€‚é€šä¹‰çµç ç»™äº†æˆ‘å¾ˆå¤§çš„å¸®åŠ©ã€‚æˆ‘æŒ‰ç…§é€šä¹‰çµç å®‰è£…æ–‡æ¡£å°†å®ƒå®‰è£…åˆ°äº†æˆ‘çš„VS Codeä¸­ï¼Œæ¥ä¸‹æ¥å°±æ˜¯æ„‰å¿«çš„ä½¿ç”¨ç¯èŠ‚äº†ã€‚\nåœ¨ä½¿ç”¨é€šä¹‰çµç çš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘å…ˆå¤åˆ¶äº†ä¸€ä»½å†™å¥½çš„Github Action Workflowï¼Œåˆ©ç”¨é€šä¹‰çµç çš„è§£é‡Šä»£ç å’Œç›´æ¥å¯¹è¯åŠŸèƒ½ï¼Œæˆ‘å¾ˆå¿«åœ°äº†è§£äº†Github Actionçš„åŸºæœ¬è¯­æ³•ä»¥åŠæ ¼å¼ã€‚\n\n\nç„¶åæˆ‘å°±å¼€å§‹ç¼–å†™issueæ‰€éœ€è¦çš„Github Action Workflowäº†ã€‚\nå…¶ä¸­ä»£ç ä¼˜åŒ–å»ºè®®åŠŸèƒ½å¸®äº†æˆ‘å¾ˆå¤§çš„å¿™ï¼Œæˆ‘åªéœ€è¦æŠŠæœ‰ç–‘é—®çš„ä»£ç å‹¾é€‰ï¼Œç„¶åå†æ‰§è¡Œ/generate optimizationï¼Œé€šä¹‰çµç å°±èƒ½å¾ˆæ–¹ä¾¿çš„ä¸ºæˆ‘æŒ‡å‡ºé”™è¯¯ï¼Œå¹¶ä¸”æå‡ºå»ºè®®ã€‚åœ¨ä»¥å¾€çš„è¯æˆ‘è¿˜éœ€è¦å…ˆæŠŠä»£ç å¤åˆ¶ä¸‹æ¥ï¼Œç„¶åå†æŠ›ç»™AIï¼Œæœ‰æ—¶è¿˜å¾—é™„å¸¦ä¸Šä¸‹æ–‡ã€‚\n\næäº¤PRå†™å¥½Github Action Workflowï¼Œæˆ‘æäº¤äº†PRã€‚ä½†æ˜¯è¿™ä¸ªPRä¸æ˜¯ä¸€æ¬¡æ€§å°±è¢«Mergeçš„ã€‚è¿™å…¶ä¸­æˆ‘å’Œé¡¹ç›®è´Ÿè´£äººè¿›è¡Œäº†å¾ˆå¤šæœ‰è¶£çš„è®¨è®ºã€‚æäº¤PRçš„é‚£æ®µæ—¶é—´åˆšå¥½æ˜¯æˆ‘çš„è€ƒè¯•å‘¨ï¼Œæ¯å¤©å¤ä¹ ä¹‹ä½™ï¼Œæœ€ä¸Šå¿ƒçš„äº‹æƒ…å°±æ˜¯æŸ¥çœ‹é‚®ç®±ï¼Œçœ‹çœ‹è´Ÿè´£äººæœ‰æ²¡æœ‰ç»™æˆ‘ç•™è¨€ï¼Œæ¯æ¬¡æ”¶åˆ°é‚®ä»¶æˆ‘éƒ½ä¼šååˆ†æ¿€åŠ¨ï¼Œå› ä¸ºä»–çœŸçš„åœ¨çœ‹æˆ‘çš„è´¡çŒ®ï¼ŒçœŸçš„åœ¨ä¸ºæˆ‘çš„è´¡çŒ®æå‡ºå»ºè®®ï¼\n\nä¸ºäº†è¿™ä»½è„šæœ¬èƒ½å¤ŸæˆåŠŸæ‰§è¡Œï¼Œæˆ‘è¿›è¡Œäº†å¾ˆå¤šæ¬¡çš„æµ‹è¯•ã€‚è€Œä¸”åœ¨æµ‹è¯•çš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘ç”šè‡³ä¹Ÿæ‰¾å‡ºäº†å®˜æ–¹æ–‡æ¡£å­˜åœ¨çš„ä¸€äº›é—®é¢˜ã€‚æˆ‘è¿˜æäº†ä¸€ä¸ªè‡ªå·±å‘ç°çš„issueï¼æŒ‰ç…§Wasm æ’ä»¶é•œåƒè§„èŒƒæ„å»ºå‡ºçš„é•œåƒä¸å¯ç”¨ Â· Issue #1100 Â· alibaba&#x2F;higress (github.com)\n2024å¹´7æœˆ8æ—¥ï¼Œæˆ‘è¿›è¡Œäº†æœ€åä¸€æ¬¡æµ‹è¯•ã€‚æˆ‘å†™äº†ååˆ†è¯¦ç»†çš„æµ‹è¯•æ–‡æ¡£ï¼Œç„¶åæäº¤ã€‚ç›´åˆ°æˆ‘çœ‹åˆ°è´Ÿè´£äººç»™æˆ‘è¯„è®ºäº†â€LGTM(Looks Good To Me)â€ï¼Œæˆ‘é«˜å…´æäº†ã€‚å¾ˆå¿«ä»–Mergeäº†æˆ‘çš„PRã€‚å°±è¿™æ ·æˆ‘å¾—åˆ°äº†ç¬¬ä¸€ä¸ªå±äºè‡ªå·±çš„Merged PRã€‚\n\nå‚èµ›å¿ƒå¾—æŠ€æœ¯æå‡é€šè¿‡è¿™æ¬¡æ¯”èµ›ï¼Œæˆ‘å­¦ä¼šäº†Github Action Workflowçš„åŸºæœ¬è¯­æ³•å’Œç¼–å†™æ ¼å¼ï¼Œå¹¶ä¸”å¯¹CI&#x2F;CDåœ¨ä¼ä¸šä¸­çš„åº”ç”¨æœ‰äº†æ›´è¿›ä¸€æ­¥çš„äº†è§£ã€‚\nå¹¶ä¸”æˆ‘è¿˜ä¸Šæ‰‹äº†é˜¿é‡Œäº‘å¼€å‘çš„æ–°ä¸€ä»£APIç½‘å…³Higressï¼Œä½“éªŒäº†å®ƒä¸°å¯Œçš„åŠŸèƒ½ï¼Œæ„Ÿå—åˆ°äº†å®ƒåœ¨äº‘åŸç”Ÿç¯å¢ƒä¸‹çš„å¼ºå¤§å®åŠ›\nå¼€æºæ°›å›´Higressæ˜¯ä¸€ä¸ªæ´»è·ƒçš„å¼€æºç¤¾åŒºï¼Œåœ¨è¿™ä¸ªç¤¾åŒºä¸­å¤§å®¶éƒ½ç§¯æçš„åˆ†äº«è‡ªå·±çš„çŸ¥è¯†å’Œideaï¼Œä¹äºå¯»æ‰¾bugã€‚è¿™ç§äº’å¸®äº’åŠ©ï¼Œä¹äºåˆ†äº«çš„æ´»è·ƒæ°›å›´å¤§å¤§æ¿€å‘äº†æˆ‘çš„å¼€æºå…´è¶£ã€‚\nä¸ªäººä½“ä¼šè¿™æ¬¡æ¯”èµ›ä¸ä»…æå‡äº†æˆ‘çš„æŠ€æœ¯ï¼Œè¿˜è®©æˆ‘å­¦ä¼šäº†å¦‚ä½•æ²Ÿé€šã€å¦‚ä½•è§£å†³é—®é¢˜ç­‰ç­‰ã€‚æˆ‘æ”¶è·å¾ˆå¤šï¼Œç›¸ä¿¡åœ¨ä»¥åæˆ‘ä¼šå¯¹å¼€æºç¤¾åŒºåšæ›´å¤šé«˜è´¨é‡çš„è´¡çŒ®ï¼Œäº‰å–åœ¨å¤šå‡ ä¸ªPR~\nè‡´è°¢ååˆ†æ„Ÿè°¢é˜¿é‡Œäº‘ä»¥åŠå¤©æ± ä¸ºæˆ‘ä»¬å¹¿å¤§å¼€æºçˆ±å¥½è€…æ­å»ºäº†ä¸€ä¸ªå¹¿é˜”æ— å çš„èˆå°ï¼Œè®©æˆ‘ä»¬æœ‰æœºä¼šå°†æ¢¦æƒ³è½¬åŒ–ä¸ºç°å®ï¼Œå°†åˆ›æ„ä»˜è¯¸å®è·µã€‚\nåŒæ—¶ä¹Ÿè¦æ„Ÿè°¢é¡¹ç›®çš„ç›¸å…³å·¥ä½œäººå‘˜ï¼Œæ— è®ºæ˜¯å¯¹äºæŠ€æœ¯ä¸Šçš„æŒ‡å¯¼å’Œå»ºè®®ï¼Œè¿˜æ˜¯æ¯”èµ›èµ„æ–™çš„ç»Ÿè®¡ä»¥åŠå¥–å“çš„ç»„ç»‡å‘æ”¾ï¼Œå¤§å®¶éƒ½è¾›è‹¦äº†ï¼\næœªæ¥çš„è·¯è¿˜å¾ˆé•¿ï¼Œä½†æˆ‘ç›¸ä¿¡ï¼Œåœ¨é˜¿é‡Œäº‘ä¸å¤©æ± çš„é™ªä¼´ä¸‹ï¼Œæˆ‘ä»¬å°†æºæ‰‹å…±è¿›ï¼Œå…±åˆ›è¾‰ç…Œã€‚\n","categories":["Blogs"],"tags":["Achievements","Blogs"]},{"title":"æ’ä»¶æ‰©å±•æŒ‡å¼•","url":"/2025/12/08/%E6%8F%92%E4%BB%B6%E6%89%A9%E5%B1%95%E6%8C%87%E5%BC%95/","content":"é¡¹ç›®çš„ç»„ä»¶æ”¾åœ¨internal/â€‹ä¸‹\n\ncontrollerï¼ˆæ§åˆ¶å™¨ï¼‰ï¼šè´Ÿè´£æ ¸å¿ƒä¸šåŠ¡é€»è¾‘çš„è°ƒåº¦å’Œåè°ƒï¼Œç›‘å¬ Kubernetes ä¸­ IPBlock è‡ªå®šä¹‰èµ„æºçš„å˜åŒ–ï¼Œç»´æŠ¤å’Œç®¡ç†å…¶ç”Ÿå‘½å‘¨æœŸã€‚\nengineï¼ˆå°ç¦åç«¯ï¼‰ï¼šè´Ÿè´£å°ç¦å‘½ä»¤çš„å®é™…æ‰§è¡Œã€‚\nnotifyï¼ˆé€šçŸ¥æœºåˆ¶ï¼‰ï¼šè´Ÿè´£å°†å°ç¦ã€è§£å°ç­‰äº‹ä»¶ä»¥å¤šç§æ–¹å¼é€šçŸ¥ç»™è¿ç»´äººå‘˜æˆ–å…¶ä»–ç³»ç»Ÿã€‚\ntriggerï¼ˆè§¦å‘å™¨ï¼‰ï¼šäº‹ä»¶è§¦å‘ä¸­å¿ƒï¼Œè´Ÿè´£ç›‘å¬å¤–éƒ¨å‘Šè­¦ç³»ç»Ÿæˆ–ä¸šåŠ¡äº‹ä»¶ï¼ˆå¦‚ Grafana Alertç­‰ï¼‰ï¼Œå¹¶æ ¹æ® Alert ç­–ç•¥è§¦å‘ç›¸å…³å°ç¦æ“ä½œï¼Œè‡ªåŠ¨åˆ›å»º IPBlock CRï¼Œä¸”æ”¯æŒè‡ªåŠ¨è§£å°ã€‚\npolicyï¼ˆå°ç¦ç­–ç•¥ï¼‰ï¼šå®šä¹‰ IP å°ç¦çš„åˆ¤å®šè§„åˆ™å’Œæ‰§è¡Œç­–ç•¥ã€‚\n\nengineä»‹ç»å°ç¦åç«¯å‡è¢«æŠ½è±¡ä¸ºAPIï¼ŒIPBlock-Operator-Plusé€šè¿‡è°ƒç”¨APIæ¥å®ç°å®é™…çš„å°ç¦è¡Œä¸ºã€‚\nç›®å‰é€šè¿‡engine/control.pyâ€‹æ¥å®ç°APIï¼Œæ¥å£åˆ—è¡¨å¦‚ä¸‹ï¼š\n\n\n\næ¥å£\næ–¹æ³•\nè¯´æ˜\n\n\n\n&#x2F;limit\nGET\niptablesé™æµæ¥å£\n\n\n&#x2F;unlimit\nGET\niptablesè§£é™æµæ¥å£\n\n\n&#x2F;limits\nGET\niptablesæŸ¥çœ‹å½“å‰é™æµæƒ…å†µ\n\n\n&#x2F;update\n\nXDPå°ç¦ç«¯å£\n\n\n&#x2F;remove\n\nXDPè§£å°ç¦ç«¯å£\n\n\n&#x2F;ban\nGET\nï¼ˆå¼ƒç”¨ï¼‰å¯ä»nginxæ—¥å¿—æŸ¥ï¼Œè¿”å›è¶…è¿‡ä¸€å®šæ¬¡æ•°çš„IP\n\n\n&#x2F;execute\nGET\nï¼ˆå¼ƒç”¨ï¼‰æ¥æ”¶IPï¼Œå¯¹å…¶æ‰§è¡ŒXDPå°ç¦\n\n\nengineæ”¯æŒåˆ—è¡¨ï¼š\n\nXDPï¼šä¾èµ–äºevilsp&#x2F;xdp_banner: ä¸€ä¸ªç®€å•çš„ XDP å°ç¨‹åºï¼Œç”¨äº BAN IP\n\niptablesï¼šä¾èµ–äºLinuxå·¥å…·iptablesã€‚\nè§„åˆ™ä¸º IP æ¯åˆ†é’Ÿæœ€å¤šå‘èµ·10ä¸ªæ–°è¿æ¥ï¼ˆå¯çªå‘20æ¬¡ï¼‰ï¼Œå¦åˆ™DROP\niptables -A INPUT -s &lt;IP&gt; -p tcp --dport &lt;TARGET_PORT&gt; \\  -m state --state NEW \\  -m hashlimit --hashlimit 10/min --hashlimit-burst 20 \\  --hashlimit-mode srcip --hashlimit-name limit_&lt;IP_REPLACED&gt; \\  -j ACCEPTiptables -A INPUT -s &lt;IP&gt; -p tcp --dport &lt;TARGET_PORT&gt; -j DROP\n\næ‰©å±•å¼€å‘æŒ‡å—engineå®šä¹‰äº†æ¥å£ï¼Œæ–°adapteråªéœ€è¦å®ç°è¿™ä¸¤ä¸ªæ–¹æ³•å³å¯ã€‚\ntype Adapter interface &#123;\t// Ban å¯¹æŸä¸ª IP å‘èµ·å°ç¦\t// ip: è¦å°ç¦çš„ IP åœ°å€\t// isParmanent: æ˜¯å¦æ°¸ä¹…å°ç¦ï¼ˆtrue è¡¨ç¤ºæ°¸ä¹…ï¼‰\t// durationSeconds: å°ç¦æ—¶é•¿ï¼ˆå•ä½ï¼šç§’ï¼Œä»…åœ¨ä¸´æ—¶å°ç¦æ—¶ç”Ÿæ•ˆï¼‰\tBan(ip string, isParmanent bool, durationSeconds int) (string, error)\t// UnBan è§£å°æŸä¸ª IP\tUnBan(ip string) (string, error)&#125;\n\nç„¶ååœ¨NewAdapterâ€‹æ³¨å†Œå¯¹åº”çš„adapter\nfunc NewAdapter(name, gatewayHost string) Adapter &#123;\tswitch name &#123;\tcase &quot;xdp&quot;:\t\treturn &amp;XDPAdapter&#123;GatewayHost: gatewayHost&#125;\tcase &quot;iptables&quot;:\t\treturn &amp;IptablesAdapter&#123;GatewayHost: gatewayHost&#125;\tdefault:\t\treturn &amp;XDPAdapter&#123;GatewayHost: gatewayHost&#125;\t&#125;&#125;\n\næ¥ç€åœ¨controller.pyâ€‹ä¸­è¦å®ç°å¯¹åº”çš„APIï¼Œæœ€ååœ¨configmapâ€‹ä¸­engineâ€‹å­—æ®µæŒ‡å®šå¯¹åº”çš„adapteråå³å¯ã€‚\nnotifyä»‹ç»notifyæ”¯æŒåˆ—è¡¨ï¼š\n\nlarkï¼šé£ä¹¦ï¼Œé€šè¿‡æœºå™¨äººæ¥è¿›è¡Œé€šçŸ¥\n\næ‰©å±•å¼€å‘æŒ‡å—notifyå®šä¹‰äº†æ¥å£ï¼Œæ–°notifyåªéœ€è¦å®ç°è¿™ä¸ªæ¥å£å³å¯ã€‚\n// Notifier æ˜¯é€šçŸ¥å‘é€æ¥å£çš„æŠ½è±¡å®šä¹‰ï¼Œ// å„ç§é€šçŸ¥åç«¯ï¼ˆå¦‚é£ä¹¦ã€é‚®ä»¶ã€Webhookç­‰ï¼‰éƒ½åº”å®ç°æ­¤æ¥å£ã€‚type Notifier interface &#123;\t// Notify è§¦å‘ä¸€ä¸ªé€šçŸ¥äº‹ä»¶ã€‚\t//\t// ctx: æ ‡å‡†çš„ context å¯¹è±¡ï¼Œç”¨äºæ§åˆ¶å–æ¶ˆã€è¶…æ—¶ç­‰ä¸Šä¸‹æ–‡è¡Œä¸ºã€‚\t// eventType: äº‹ä»¶ç±»å‹ï¼Œé€šå¸¸ä¸º &quot;ban&quot;ã€&quot;resolve&quot;ã€&quot;common&quot; ç­‰é¢„å®šä¹‰äº‹ä»¶åã€‚\t// vars: ç”¨äºå¡«å……é€šçŸ¥æ¨¡æ¿çš„å˜é‡é”®å€¼å¯¹ï¼Œä¾‹å¦‚ map[&quot;ip&quot;]=&quot;1.2.3.4&quot;ï¼Œmap[&quot;reason&quot;]=&quot;æ”»å‡»é¢‘ç¹&quot;ã€‚\t//\t// è¿”å›å€¼:\t//   - æˆåŠŸæ—¶è¿”å› nil\t//   - å¤±è´¥æ—¶è¿”å› errorï¼Œç”¨äºä¸Šå±‚é‡è¯•æˆ–å‘Šè­¦è®°å½•\tNotify(ctx context.Context, eventType string, vars map[string]string) error&#125;\n\nä»¥larkä¸ºä¾‹ï¼Œåœ¨lark.goâ€‹ä¸­å®ç°ä¸¤ä¸ªæ–¹æ³•\n// NewLarkNotify åˆ›å»ºä¸€ä¸ª LarkNotifyï¼ˆé£ä¹¦é€šçŸ¥å™¨ï¼‰å®ä¾‹ã€‚//// å‚æ•°://   - webhookURL: é£ä¹¦ç¾¤æœºå™¨äººçš„ Webhook åœ°å€ã€‚//   - templatePaths: å„ç±»é€šçŸ¥ç±»å‹æ‰€ç”¨çš„ card æ¨¡æ¿è·¯å¾„æ˜ å°„ï¼ˆå¦‚ map[&quot;ban&quot;]=&quot;templates/ban.json&quot;ï¼‰ã€‚//// è¿”å›å€¼://   - æˆåŠŸ: è¿”å› LarkNotify å®ä¾‹ã€‚//   - å¤±è´¥: è¿”å› errorï¼Œé€šå¸¸æ˜¯æ¨¡æ¿è§£æå¤±è´¥æˆ–é…ç½®ä¸åˆæ³•ã€‚func NewLarkNotify(webhookURL string, templatePaths map[string]string) (*LarkNotify, error) &#123;&#125;// Notify å®ç° Notifier æ¥å£ï¼Œ// æ ¹æ®äº‹ä»¶ç±»å‹å’Œå˜é‡æ„é€ é£ä¹¦å¡ç‰‡æ¶ˆæ¯ï¼Œå¹¶å‘é€è‡³ webhookã€‚//// å‚æ•°://   - ctx: è¯·æ±‚ä¸Šä¸‹æ–‡ï¼Œç”¨äºæ§åˆ¶è¶…æ—¶å’Œå–æ¶ˆç­‰ã€‚//   - eventType: äº‹ä»¶ç±»å‹ï¼ˆå¦‚ &quot;ban&quot;ã€&quot;resolve&quot;ã€&quot;error&quot;ï¼‰ã€‚//   - vars: æ¨¡æ¿å˜é‡é”®å€¼å¯¹ï¼Œä¾‹å¦‚ &#123;&quot;ip&quot;: &quot;1.2.3.4&quot;, &quot;reason&quot;: &quot;æ¶æ„è¿æ¥&quot;&#125;ã€‚//// è¿”å›å€¼://   - æˆåŠŸ: è¿”å› nilã€‚//   - å¤±è´¥: è¿”å› errorï¼Œè¡¨ç¤ºé€šçŸ¥å¤±è´¥ã€‚func (l *LarkNotify) Notify(ctx context.Context, eventType string, vars map[string]string) error &#123;&#125;\n\næœ€ååœ¨main.goâ€‹ä¸­watchConfigMapâ€‹ä¸­å®Œå–„loadNotifyâ€‹ã€‚\n// ä»¥é£ä¹¦ä¸ºä¾‹// åŠ è½½é€šçŸ¥ä¸­å¿ƒ\t\tloadNotify := func(cm *corev1.ConfigMap) &#123;\t\t\tnotifyType := cm.Data[&quot;notifyType&quot;]\t\t\twebhookURL := cm.Data[&quot;notifyWebhookURL&quot;]\t\t\ttemplates := make(map[string]string)\t\t\tfor k, v := range cm.Data &#123;\t\t\t\tif strings.HasPrefix(k, &quot;notifyTemplate_&quot;) &#123;\t\t\t\t\teventType := strings.TrimPrefix(k, &quot;notifyTemplate_&quot;)\t\t\t\t\ttemplates[eventType] = v\t\t\t\t&#125;\t\t\t&#125;\t\t\tif notifyType == &quot;lark&quot; &amp;&amp; webhookURL != &quot;&quot; &amp;&amp; len(templates) &gt; 0 &#123;\t\t\t\tlarkNotify, err := lark.NewLarkNotify(webhookURL, templates)\t\t\t\tif err != nil &#123;\t\t\t\t\tlog.Log.Error(err, &quot;Failed to create LarkNotify instance&quot;)\t\t\t\t\treconciler.Notifier = nil\t\t\t\t\treturn\t\t\t\t&#125;\t\t\t\treconciler.Notifier = larkNotify\t\t\t\tlog.Log.Info(&quot;LarkNotify has been initialized&quot;)\t\t\t\treturn\t\t\t&#125;\t\t\t//TODO å…¶ä»–é€šçŸ¥æ–¹å¼...\n\ntriggerä»‹ç»triggeræ”¯æŒåˆ—è¡¨ï¼š\n\ngrafanaï¼šå¯ä»¥ Grafana Alert è”åŠ¨ï¼Œé€šè¿‡ Webhook è¿›è¡Œè§¦å‘ã€‚\n\næ‰©å±•å¼€å‘æŒ‡å—\næ³¨æ„æ–° trigger åœ¨å¼€å‘æ—¶éœ€è¦è€ƒè™‘å¹¶å‘é—®é¢˜ã€‚å…·ä½“å®ç°å¯æŸ¥çœ‹ grafana.go ä¸­çš„å¤„ç†é€»è¾‘ï¼Œä¹Ÿå¯å‚è€ƒæ ¸å¿ƒåŠŸèƒ½æ¨¡å—å¼€å‘æ–‡æ¡£ä¸­å¹¶å‘å¤„ç†çš„é€»è¾‘ä»‹ç»ã€‚\n\ntriggeråŒæ ·å®šä¹‰äº†æ¥å£ï¼Œæ–°triggeråªéœ€è¦å®ç°æ¥å£å³å¯ã€‚\n// Trigger æ˜¯å°ç¦äº‹ä»¶çš„è§¦å‘å™¨æ¥å£ï¼ŒStart å¯åŠ¨ç›‘å¬ä»»åŠ¡ï¼ŒStop åœæ­¢ç›‘å¬ä»»åŠ¡type Trigger interface &#123;\tName() string\tStart(ctx context.Context) error\tStop(ctx context.Context) error&#125;\n\ntriggeråœ¨manager.goâ€‹ä¸­å®ç°äº†StartAllâ€‹å’ŒStopAllâ€‹ï¼Œä¼šå¯åŠ¨åœ¨configmapâ€‹ä¸­æŒ‡å®šçš„æ‰€æœ‰triggerã€‚\ntriggers:                                          # è§¦å‘å™¨ï¼Œç›®å‰ä»…æ”¯æŒ Grafana  - name: grafana    addr: &quot;:8090&quot;    path: &quot;/trigger/grafana&quot;  - name: your_trigger    other: xxx\n\ntriggerè‡ªå®šä¹‰çš„é…ç½®å­—æ®µï¼Œåœ¨main.goâ€‹ä¸­è¿›è¡Œé…ç½®\n// Grafana Trigger ç¤ºä¾‹type TriggerConfig struct &#123;\tName string `yaml:&quot;name&quot;`\tAddr string `yaml:&quot;addr,omitempty&quot;`\tPath string `yaml:&quot;path,omitempty&quot;`&#125;// è§£æ trigger å­—ç¬¦ä¸²ä¸º YAML åˆ—è¡¨func parseTriggers(yamlStr string) ([]TriggerConfig, error) &#123;\tvar triggers []TriggerConfig\terr := yaml.Unmarshal([]byte(yamlStr), &amp;triggers)\tif err != nil &#123;\t\treturn nil, err\t&#125;\treturn triggers, nil&#125;// é€‰æ‹©è§¦å‘å™¨func CreateTriggerByConfig(cfg TriggerConfig, mgr ctrl.Manager) trigger.Trigger &#123;\tswitch cfg.Name &#123;\tcase &quot;grafana&quot;:\t\treturn &amp;trigger.GrafanaTrigger&#123;\t\t\tClient: mgr.GetClient(),\t\t\tAddr:   cfg.Addr,\t\t\tPath:   cfg.Path,\t\t\t// 1000 ä¸ª IPï¼Œ 60 ç§’é˜²æŠ–\t\t\t// LRUä¸­æœ€å¤šä¿å­˜1000ä¸ªIPï¼Œè¾¾åˆ°1000ä¸ªåä¼šè‡ªåŠ¨æ·˜æ±°æœ€è¿‘æœ€å°‘ä½¿ç”¨çš„IP\t\t\t// å¯¹äºåŒä¸€ä¸ªIPï¼Œå¦‚æœæœ€è¿‘60så†…å‘ç”Ÿè¿‡ä¸€æ¬¡å°ç¦ï¼Œé‚£ä¹ˆè¿™60så†…å†æ¬¡æ”¶åˆ°è¯¥IPçš„ç›¸åŒè¯·æ±‚æ—¶ï¼Œä¼šè¢«é˜²æŠ–è¯†åˆ«ä¸ºé‡å¤\t\t\tDebouncer: utils.NewLRUDebouncer(1000, 60*time.Second),\t\t\tIPLocker:  utils.NewIPLock(),\t\t&#125;\t// TODO å…¶ä»–è§¦å‘å™¨ ...\tdefault:\t\treturn nil\t&#125;&#125;\n\npolicypolicyæ”¯æŒåŠŸèƒ½åˆ—è¡¨ï¼š\n\nwhitelistï¼šç™½åå•æœºåˆ¶\n\npolicyå®ç°æ¯”è¾ƒçµæ´»ï¼Œä¸‹é¢æè¿°ç™½åå•æœºåˆ¶çš„å®ç°æµç¨‹ã€‚\n\nåœ¨policy/watchlist.goâ€‹ä¸­å®ç°ä¸‰ä¸ªå‡½æ•°\n // ç™½åå•æœºåˆ¶// å•IPç™½åå•// CIDRç™½åå•// æ ‡ç­¾åŒ¹é…type Whitelist struct &#123;\tipNets []*net.IPNet // IPNetçš„æŒ‡é’ˆåˆ‡ç‰‡ï¼Œä¿å­˜CIDRç½‘æ®µ\tips    []net.IP     // ç²¾ç¡®IPç™½åå•&#125;// æ–°å»ºç™½åå•func NewWhitelist(ipList []string) *Whitelist &#123;&#125;// åˆ¤æ–­ç›®æ ‡IPæ˜¯å¦åœ¨ç™½åå•ä¸­func (w *Whitelist) IsWhitelisted(ip string) bool &#123;&#125;// æ‰“å°æ‰€æœ‰ç™½åå•å†…å®¹func (w *Whitelist) StringSlice() []string &#123;&#125;\n\nåœ¨config/loader.goâ€‹ä¸­å®ç°ä¸€ä¸ªLoadWhitelistFromConfigMapâ€‹ï¼Œç”¨äºåŠ è½½å®šä¹‰åœ¨configmapâ€‹ä¸­çš„ç™½åå•IPã€‚\n\nåœ¨main.goâ€‹çš„watchConfigMapâ€‹ä¸­æ¥ç›‘å¬ç™½åå•çš„æ–°å»ºå’Œæ›´æ–°æƒ…å†µã€‚\n\n\nâ€\n","categories":["Kubernetes"],"tags":["Kubernetes","Operator","Achievements"]},{"title":"å·¥ä½œè´Ÿè½½ä¸æœåŠ¡å‘ç°","url":"/2025/12/08/%E5%B7%A5%E4%BD%9C%E8%B4%9F%E8%BD%BD%E4%B8%8E%E6%9C%8D%E5%8A%A1%E5%8F%91%E7%8E%B0/","content":"åœ¨æ²¡æœ‰å·¥ä½œè´Ÿè½½ä¹‹å‰ï¼Œæˆ‘ä»¬éƒ½æ˜¯ç›´æ¥æ‰‹åŠ¨åˆ›å»ºä¸€ä¸ªä¸€ä¸ªçš„Podã€‚ä½†æ˜¯å¦‚æœå½“æˆ‘ä»¬éœ€è¦å°†ä¸€ä¸ªå¤æ‚çš„æœåŠ¡éƒ¨ç½²åˆ°åºå¤§çš„é›†ç¾¤ä¸Šå¹¶ä¸”å®ç°é«˜å¯ç”¨ï¼Œæˆ‘ä»¬æ€»ä¸èƒ½æ¯ä¸ªèŠ‚ç‚¹ä¸Šéƒ½éƒ¨ç½²ä¸€éå§ã€‚å†µä¸”å¦‚æœä½ å¯ä»¥å°†æ‰€æœ‰çš„Podæ‰‹åŠ¨éƒ½åˆ›å»ºå¥½ï¼Œä½†æ˜¯å¦‚æœé•œåƒå‘ç”Ÿäº†æ›´æ–°ï¼Œæˆ‘ä»¬ä¹Ÿéœ€è¦å°†ä¸€ä¸ªä¸€ä¸ªçš„Podæ‰‹åŠ¨è¿›è¡Œæ›´æ–°ã€‚å¤ªéº»çƒ¦äº†ï¼Œè¿™ä¸ªæ—¶å€™æˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨å·¥ä½œè´Ÿè½½ï¼Œå®ƒå¯ä»¥å¸®åŠ©æˆ‘ä»¬æ›´é«˜çš„ç®¡ç†Podã€‚\nå·¥ä½œè´Ÿè½½\nå·¥ä½œè´Ÿè½½ | Kubernetes\n\nå·¥ä½œè´Ÿè½½æ˜¯åœ¨ Kubernetes ä¸Šè¿è¡Œçš„åº”ç”¨ç¨‹åºã€‚\nä¸ºäº†å‡è½»ç”¨æˆ·çš„ä½¿ç”¨è´Ÿæ‹…ï¼Œé€šå¸¸ä¸éœ€è¦ç”¨æˆ·ç›´æ¥ç®¡ç†æ¯ä¸ª Podã€‚ è€Œæ˜¯ä½¿ç”¨è´Ÿè½½èµ„æºæ¥æ›¿ç”¨æˆ·ç®¡ç†ä¸€ç»„ Podã€‚ è¿™äº›è´Ÿè½½èµ„æºé€šè¿‡é…ç½®æ§åˆ¶å™¨æ¥ç¡®ä¿æ­£ç¡®ç±»å‹çš„ã€å¤„äºè¿è¡ŒçŠ¶æ€çš„ Pod ä¸ªæ•°æ˜¯æ­£ç¡®çš„ï¼Œä¸ç”¨æˆ·æ‰€æŒ‡å®šçš„çŠ¶æ€ç›¸ä¸€è‡´ã€‚\nKubernetes æä¾›è‹¥å¹²ç§å†…ç½®çš„å·¥ä½œè´Ÿè½½èµ„æº\n\nDeploymentå’ŒReplicaSet\nStatefulSetï¼šæœ‰çŠ¶æ€æœåŠ¡ï¼Œä¸º Pod æä¾›æŒä¹…å­˜å‚¨å’ŒæŒä¹…æ ‡è¯†ç¬¦ã€‚\nDaemonSetï¼šå®ˆæŠ¤å‹åº”ç”¨éƒ¨ç½²ï¼Œå¦‚æ—¥å¿—ã€ç›‘æ§ç»„ä»¶ã€‚\nJobå’ŒCronJobï¼šå®šæ—¶ä»»åŠ¡éƒ¨ç½²ï¼ŒæŒ‡å®šæ—¶é—´è¿è¡Œã€‚\n\nDeploymentDeploymentæ˜¯Kubernetesä¸­ç”¨äºå®šä¹‰Podå‰¯æœ¬é›†çš„å¯¹è±¡ï¼Œå®ƒè´Ÿè´£ç®¡ç†åº”ç”¨çš„éƒ¨ç½²å’Œæ›´æ–°ã€‚é€šè¿‡Deploymentï¼Œå¯ä»¥å®ç°åº”ç”¨çš„æ»šåŠ¨æ›´æ–°ã€å›æ»šä»¥åŠè‡ªåŠ¨ä¿®å¤ã€‚\nå·¥ä½œæ¨¡å¼Deploymentå¹¶ä¸ç›´æ¥ç®¡ç†Podï¼Œè€Œæ˜¯ç®¡ç†ReplicaSetï¼ŒReplicaSetå†ç®¡ç†Podã€‚åœ¨æˆ‘ä»¬åˆ›å»º Deployment çš„æ—¶å€™ï¼Œå®ƒä¼šç”¨è‡ªå·±çš„ Pod è§„èŒƒåˆ›å»ºä¸€ä¸ª ReplicaSetã€‚å½“æ›´æ–°ä¸€ä¸ª Deployment å¹¶ä¿®æ”¹å‰¯æœ¬æ•°é‡æ—¶ï¼Œå®ƒä¼šæŠŠæ›´æ–°å†…å®¹ä¼ é€’ç»™ä¸‹æ¸¸çš„ ReplicaSetã€‚\nä¸€ä¸ª ReplicaSet å¯¹è±¡å°±æ˜¯ç”±å‰¯æœ¬æ•°ç›®çš„å®šä¹‰å’Œä¸€ä¸ª Pod æ¨¡æ¿ç»„æˆçš„, å®ƒçš„å®šä¹‰å°±æ˜¯ Deployment çš„ä¸€ä¸ªå­é›†ã€‚å®ƒä¸»è¦å…³æ³¨çš„æ˜¯Podå®ä¾‹çš„æ•°é‡ï¼Œå¹¶åœ¨Podå‡ºç°é—®é¢˜æ—¶ï¼Œç»´æŒæ‰€éœ€å‰¯æœ¬æ•°é‡ã€‚\nDeploymentåˆ™æ˜¯å»ºç«‹åœ¨ReplicaSetä¹‹ä¸Šçš„æ›´é«˜çº§åˆ«çš„æŠ½è±¡ï¼Œç”¨äºç®¡ç†Podå‰¯æœ¬é›†å’Œåº”ç”¨ç¨‹åºçš„éƒ¨ç½²ã€‚ç„¶åå®ƒå¤šäº†æ»šåŠ¨æ›´æ–°ã€å›æ»šä»¥åŠè‡ªåŠ¨ä¿®å¤è¿™äº›åŠŸèƒ½ã€‚\n\nä¸»è¦ç»„æˆéƒ¨åˆ†\næ¨¡æ¿ï¼ˆTemplateï¼‰ ï¼šå®šä¹‰äº†è¦åˆ›å»ºçš„Podçš„è§„èŒƒï¼ŒåŒ…æ‹¬é•œåƒã€ç¯å¢ƒå˜é‡ã€å·ç­‰ã€‚å½“å‰¯æœ¬æ•°ä¸è¶³æ—¶ä¼šæ ¹æ®æ¨¡æ¿æ–°å»ºPodã€‚\nå‰¯æœ¬æ•°ï¼ˆReplica Countï¼‰ ï¼šæŒ‡å®šäº†å¸Œæœ›è¿è¡Œçš„Podå‰¯æœ¬æ•°é‡ã€‚\nå‡çº§ç­–ç•¥ï¼ˆUpdate Strategyï¼‰ ï¼šå®šä¹‰äº†åº”ç”¨æ›´æ–°çš„ç­–ç•¥ï¼ŒåŒ…æ‹¬æ»šåŠ¨æ›´æ–°ã€Recreateç­‰ã€‚\næ ‡ç­¾é€‰æ‹©å™¨ï¼ˆLabel Selectorï¼‰ ï¼šç”¨äºé€‰æ‹©è¦è¿›è¡Œç®¡ç†çš„Podå‰¯æœ¬é›†ã€‚\næ»šåŠ¨å‡çº§ï¼ˆRolling Updateï¼‰ ï¼šä¸€ç§å‡çº§ç­–ç•¥ï¼Œé€šè¿‡é€æ­¥æ›¿æ¢æ—§çš„Podå®ä¾‹æ¥å®ç°å¹³æ»‘çš„å‡çº§ã€‚\n\nç‰¹ç‚¹\næ»šåŠ¨æ›´æ–°ï¼šä¿è¯æ›´æ–°è¿‡ç¨‹ä¸ä¸­æ–­æœåŠ¡ã€‚\nå‰¯æœ¬ç®¡ç†ï¼šä¿è¯å§‹ç»ˆæœ‰æŒ‡å®šæ•°é‡çš„å®ä¾‹åœ¨è¿è¡Œã€‚\nè‡ªåŠ¨ä¿®å¤ï¼šå½“Podå‘ç”Ÿæ•…éšœæ—¶ä¼šè‡ªåŠ¨æ›¿æ¢ä¸ºæ–°çš„Podã€‚\nç‰ˆæœ¬å›æ»šï¼šå…è®¸ç”¨æˆ·å›æ»šåˆ°å…ˆå‰çš„ç‰ˆæœ¬ï¼Œä»¥åº”å¯¹æ›´æ–°å¸¦æ¥çš„é—®é¢˜\n\nç¤ºä¾‹ï¼šä½¿ç”¨Deploymentéƒ¨ç½²NginxapiVersion: apps/v1 # APIç‰ˆæœ¬kind: Deploymentmetadata: # å…ƒæ•°æ®éƒ¨åˆ†  name: nginx-deployment # èµ„æºåç§°  namespace:   labels: # ç»™deploymentæ‰“çš„æ ‡ç­¾    app: nginx # åä¸ºappå€¼ä¸ºnginxçš„æ ‡ç­¾spec: # å®šä¹‰éƒ¨ç½²å¯¹è±¡çš„è§„èŒƒ  replicas: 3 # å‰¯æœ¬æ•°é‡  selector: # é€‰æ‹©å™¨éƒ¨åˆ†ï¼Œç”¨äºæŒ‡å®šå“ªäº›Podå‰¯æœ¬å±äºæ­¤éƒ¨ç½²    matchLabels: # åŒ¹é…æ ‡ç­¾éƒ¨åˆ†ã€‚Serviceé€šè¿‡è¿™é‡Œæ¥åŒ¹é…Pod      app: nginx # æŒ‡å®šè¦åŒ¹é…çš„æ ‡ç­¾ä¸ºapp=nginxï¼Œç”¨äºé€‰å–å…·æœ‰è¿™ä¸ªæ ‡ç­¾çš„Podå‰¯æœ¬  template: # æ¨¡æ¿éƒ¨åˆ†    metadata:      labels:        app: nginx # éœ€è¦ä¸selectorè®¾ç½®çš„æ ‡ç­¾ä¸€è‡´    spec:      containers: # ç”¨äºå®šä¹‰Podä¸­çš„å®¹å™¨      - name: nginx # å®¹å™¨åç§°        image: reg.redrock.team/library/nginx:latest        ports:        - containerPort: 80 # æš´éœ²å®¹å™¨çš„80ç«¯å£ä¾›å¤–éƒ¨è®¿é—®\n\nkubectl apply -f deploy.yaml\n\nå¯ä»¥çœ‹åˆ°RSçš„NAMEæ˜¯åœ¨Deploymentä¹‹ååŠ äº†ä¸€æ®µå­—ç¬¦ä¸²ï¼Œè€ŒPodæ˜¯åœ¨RSååˆåŠ äº†ä¸€æ®µå­—ç¬¦ä¸²ï¼Œè¯´æ˜Podå…¶å®æ˜¯ç”±RSç›´æ¥ç®¡ç†çš„ã€‚\nå‰¯æœ¬ä¼¸ç¼©æ–¹å¼ä¸€ï¼šå‘½ä»¤è¡Œ\nkubectl scale deploy NAME --replicas=podæ•°é‡ -n NAMESPACE\n\næ–¹å¼äºŒï¼šç¼–è¾‘yamlæ–‡ä»¶\nä¿®æ”¹replicaså€¼å³å¯ã€‚\nPodä¸ºä»€ä¹ˆè¦æœ‰å‰¯æœ¬æ•°ï¼Ÿ\n\nä½¿ç”¨å¤šä¸ªå‰¯æœ¬æ¥è¿è¡ŒåŒä¸€ä¸ªæœåŠ¡ï¼Œå¯ä»¥æé«˜åº”ç”¨çš„å¯ç”¨æ€§ã€‚å¦‚æœä¸€ä¸ªPodå› ä¸ºæ•…éšœè€Œè¢«æ€æ­»ï¼Œå…¶ä»–Podä¼šç«‹å³æ¥æ›¿ä»£å®ƒï¼Œä»è€Œä¿è¯äº†æœåŠ¡çš„ç¨³å®šæ€§ã€‚\nå¤šä¸ªå‰¯æœ¬å¯ä»¥å°†æµé‡åˆ†æ•£åˆ°ä¸åŒçš„Podï¼Œä»è€Œå®ç°è´Ÿè½½å‡è¡¡ï¼Œé¿å…æ‰€æœ‰æµé‡é›†ä¸­åœ¨ä¸€ä¸ªPodä¸Šå¯¼è‡´è´Ÿè½½è¿‡é«˜ã€‚æµé‡é«˜æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥å¢åŠ å‰¯æœ¬æ•°ï¼Œå°‘æ—¶å¯ä»¥å‡å°‘å‰¯æœ¬æ•°ï¼Œä»è€ŒèŠ‚çœèµ„æºã€‚\nå¤šä¸ªPodå¯ä»¥å®ç°å¹³æ»‘çš„æ»šåŠ¨æ›´æ–°ã€‚\n\né•œåƒæ›´æ–°Deploymentæ”¯æŒä¸¤ç§é•œåƒæ›´æ–°ç­–ç•¥ï¼šé‡å»ºæ›´æ–°ï¼ˆRecreateï¼‰â€‹å’Œâ€‹æ»šåŠ¨æ›´æ–°ï¼ˆé»˜è®¤ï¼‰ï¼ˆRollingUpdateï¼‰ ï¼Œå¯ä»¥é€šè¿‡strategyé€‰é¡¹è¿›è¡Œé…ç½®ã€‚\né‡å»ºæ›´æ–°ï¼ˆRecreateï¼‰\nåœ¨specä¸‹å¢åŠ å¦‚ä¸‹å­—æ®µ\nspec:  strategy:  # ç­–ç•¥    type: Recreate  # é‡å»ºæ›´æ–°ç­–ç•¥\n\næ»šåŠ¨æ›´æ–°ï¼ˆRollingUpdateï¼‰\nstrategy:  type: RollingUpdate # æ»šåŠ¨æ›´æ–°ç­–ç•¥ï¼Œå¯ä»¥ä¸åŠ ï¼Œå› ä¸ºé»˜è®¤å°±æ˜¯æ»šåŠ¨æ›´æ–°  rollingUpdate:    maxUnavailable: 25%    maxSurge: 25%\n\nMaxSurgeå’ŒMaxUnavailableï¼Œè¿™ä¸¤ä¸ªå‚æ•°å†³å®šäº†æ›´æ–°è¿‡ç¨‹çš„é€Ÿåº¦ã€‚è¿™ä¸¤ä¸ªå‚æ•°å¯ä»¥æ˜¯ Pod æ•°é‡ï¼Œä¹Ÿå¯ä»¥æ˜¯ Deployment çš„å®ä¾‹æ•°é‡ç™¾åˆ†æ¯”ã€‚\nä¸ºä»€ä¹ˆè¦æœ‰è¿™ä¸¤ä¸ªå‚æ•°ï¼Ÿä¸ºä»€ä¹ˆè¦è®¾ç½®æ›´æ–°è¿‡ç¨‹çš„é€Ÿåº¦ï¼Ÿ\n\næˆ‘ä»¬çš„æœåŠ¡å¾ˆé‡è¦ï¼Œå¯¹æœåŠ¡çš„å˜æ›´éœ€è¦éå¸¸è°¨æ…ã€‚å› æ­¤å†³å®šåœ¨å…³é—­æ—§ç‰ˆæœ¬Podä¹‹å‰ï¼Œéœ€è¦é¦–å…ˆå¯åŠ¨æ–°Podã€‚åªæœ‰æ–° Pod å¯åŠ¨ã€è¿è¡Œå¹¶å°±ç»ªä¹‹åï¼Œæ‰èƒ½æ€æ­»æ—§ Podã€‚\nå‡å¦‚æˆ‘ä»¬çš„é›†ç¾¤å·²ç»æ»¡è½½ï¼Œæ— æ³•è´Ÿæ‹…å¤šä½™çš„Podæ¶ˆè€—ï¼Œæˆ‘ä»¬è‡ªç„¶éœ€è¦å…ˆå…³æ‰æ—§Podï¼Œç„¶åæ‰å¯åŠ¨æ–°Podã€‚\n\nå½“MaxUnavailableè®¾ç½®ä¸º 0 æ„å‘³ç€ï¼šâ€œåœ¨æ–° Pod å¯åŠ¨å¹¶å°±ç»ªä¹‹å‰ï¼Œä¸è¦å…³é—­ä»»ä½•æ—§ Podâ€ã€‚\nå½“MaxSurgeè®¾ç½®ä¸º 100% çš„æ„æ€æ˜¯ï¼šâ€œç«‹å³å¯åŠ¨æ‰€æœ‰æ–° Podâ€ï¼Œä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬æœ‰è¶³å¤Ÿçš„èµ„æºï¼Œæˆ‘ä»¬å¸Œæœ›å°½å¿«å®Œæˆæ›´æ–°ã€‚\nè¿™ä¸¤ä¸ªé»˜è®¤å€¼æ˜¯25%ï¼Œå‡å¦‚æˆ‘ä»¬æœ‰3ä¸ªå‰¯æœ¬ï¼Œæ„å‘³ç€æ›´æ–°æ—¶å…è®¸ 25%ï¼ˆ0.75ä¸ªå–æ•´ä¸º1ï¼‰ çš„Podå¤„äºä¸å¯ç”¨çŠ¶æ€ï¼Œå…è®¸æœ€å¤šå¢åŠ 1ä¸ªæ–°Podã€‚\nç‰ˆæœ¬å›é€€Deploymentæ”¯æŒç‰ˆæœ¬å‡çº§è¿‡ç¨‹ä¸­çš„æš‚åœï¼Œç»§ç»­åŠŸèƒ½ä»¥åŠç‰ˆæœ¬å›é€€ç­‰è¯¸å¤šåŠŸèƒ½ã€‚\nkubectl rollout option NAME -n NAMESPACEkubectl rolloutï¼šç‰ˆæœ¬å‡çº§ç›¸å…³åŠŸèƒ½ï¼Œæ”¯æŒä¸‹é¢çš„é€‰é¡¹ï¼šstatusï¼šæ˜¾ç¤ºå½“å‰å‡çº§çŠ¶æ€historyï¼šæ˜¾ç¤ºå‡çº§å†å²è®°å½•pauseï¼šæš‚åœç‰ˆæœ¬å‡çº§è¿‡ç¨‹resumeï¼šç»§ç»­å·²ç»æš‚åœçš„ç‰ˆæœ¬å‡çº§è¿‡ç¨‹restartï¼šé‡å¯ç‰ˆæœ¬å‡çº§è¿‡ç¨‹undoï¼šå›æ»šåˆ°ä¸Šä¸€çº§ç‰ˆæœ¬ï¼ˆå¯ä»¥ä½¿ç”¨--to-revisionå›æ»šåˆ°æŒ‡å®šç‰ˆæœ¬ï¼‰\n\né‡‘ä¸é›€å‘å¸ƒDeploymentæ”¯æŒæ›´æ–°è¿‡ç¨‹ä¸­çš„æ§åˆ¶ï¼Œå¦‚â€æš‚åœï¼ˆpauseï¼‰â€æˆ–â€ç»§ç»­ï¼ˆresumeï¼‰â€æ›´æ–°æ“ä½œã€‚\næœ‰æ—¶æˆ‘ä»¬ä¸æƒ³è®©æµ‹è¯•ç‰ˆæœ¬å½±å“æ‰€æœ‰ç”¨æˆ·ï¼Œå³ä½¿æ˜¯çŸ­æ—¶é—´ä¹Ÿä¸è¡Œã€‚æ‰€ä»¥æˆ‘ä»¬å¯ä»¥éƒ¨åˆ†æ¨å‡ºæ–°ç‰ˆæœ¬ã€‚ä¾‹å¦‚æˆ‘ä»¬éƒ¨ç½²æ–°æ—§ä¸¤ç»„å®ä¾‹ï¼Œ1% çš„æµé‡å‘é€ç»™æ–°ç‰ˆæœ¬ï¼Œå…ˆç­›é€‰ä¸€å°éƒ¨åˆ†çš„ç”¨æˆ·è¯·æ±‚è·¯ç”±åˆ°æ–°çš„podåº”ç”¨ï¼Œç»§ç»­è§‚å¯Ÿèƒ½å¦ç¨³å®šåœ°æŒ‰æœŸæœ›çš„æ–¹å¼è¿è¡Œã€‚ç¡®å®šæ²¡é—®é¢˜ä¹‹åå†ç»§ç»­å®Œæˆä½™ä¸‹çš„podèµ„æºæ»šåŠ¨æ›´æ–°ï¼Œå¦åˆ™ç«‹å³å›æ»šæ›´æ–°æ“ä½œã€‚\nç°åœ¨çš„é•œåƒç‰ˆæœ¬æ˜¯latestï¼Œåˆ‡æ¢ç‰ˆæœ¬åˆ°1.19.2ï¼Œå˜æ›´é€”ä¸­ä½¿ç”¨pause\nkubectl set image deploy nginx-deployment nginx=reg.redrock.team/library/nginx:1.19.2 -n lesson-demo&amp;&amp; kubectl rollout pause deploy nginx-deployment -n lesson-demo\n\nå‘ç°1.19.2ç‰ˆæœ¬åªå¢åŠ äº†ä¸€ä¸ªRSï¼Œè€Œlatestç‰ˆæœ¬æ²¡æœ‰å‡å°‘\n\næŸ¥çœ‹æ›´æ–°çŠ¶æ€ï¼Œå‘ç°deploymentæ­£åœ¨ç­‰å¾…æ›´æ–°ï¼Œå¹¶ä¸”ä¸€ä¸ªå·²ç»æ›´æ–°å®Œæˆã€‚\n\nç„¶åç»§ç»­æ›´æ–°\nkubectl rollout resume deploy nginx-deployment -n lesson-demo\n\nå…¨éƒ¨æ›´æ–°å®Œæˆ\n\næœåŠ¡å‘ç°ä¸è´Ÿè½½å‡è¡¡\næœåŠ¡ï¼ˆServiceï¼‰ | Kubernetes\n\nä¸ºä»€ä¹ˆéœ€è¦æœåŠ¡å‘ç°ï¼Ÿä¼ ç»Ÿçš„éƒ¨ç½²åº”ç”¨æœåŠ¡æ–¹å¼éƒ½æ˜¯ç›´æ¥éƒ¨ç½²åœ¨ç»™å®šçš„æœºå™¨ä¸Šï¼Œè®¿é—®æœåŠ¡æ—¶ï¼Œæˆ‘ä»¬åªéœ€è¦è®¿é—®è¯¥æœºå™¨çš„IPå³å¯ã€‚ä½†K8sé›†ç¾¤ä¸­çš„åº”ç”¨éƒ½æ˜¯é€šè¿‡Podå»éƒ¨ç½²çš„ï¼Œè€Œ pod ç”Ÿå‘½å‘¨æœŸæ˜¯çŸ­æš‚çš„ã€‚åœ¨ Pod çš„ç”Ÿå‘½å‘¨æœŸè¿‡ç¨‹ä¸­ï¼Œæ¯”å¦‚å®ƒåˆ›å»ºæˆ–é”€æ¯ï¼Œå®ƒçš„ IP åœ°å€éƒ½ä¼šå‘ç”Ÿå˜åŒ–ï¼Œè¿™æ ·å°±ä¸èƒ½ä½¿ç”¨ä¼ ç»Ÿçš„éƒ¨ç½²æ–¹å¼ï¼Œä¸èƒ½æŒ‡å®š IP å»è®¿é—®æŒ‡å®šçš„åº”ç”¨ã€‚\nServiceå‰é¢æˆ‘ä»¬é€šè¿‡Deploymentåˆ›å»ºäº†ä¸€ç»„Podï¼Œè¿™äº›Podç»„éœ€è¦æä¾›ä¸€ä¸ªç»Ÿä¸€çš„è®¿é—®å…¥å£ï¼Œä»¥åŠæ€ä¹ˆå»æ§åˆ¶æµé‡è´Ÿè½½å‡è¡¡åˆ°è¿™ä¸ªç»„é‡Œé¢ã€‚å…¶å®æˆ‘ä»¬å¯ä»¥åœ¨éƒ¨ç½²æ—¶å°±æä¾›ä¸€ä¸ªæ¨¡æ¿ä»¥åŠè®¿é—®æ–¹å¼ï¼Œä½¿åº”ç”¨æœåŠ¡æš´éœ²åœ¨å¤–éƒ¨ã€‚è¿™æ—¶å°±éœ€è¦æœåŠ¡å‘ç°ï¼Œä¹Ÿå°±æ˜¯K8sä¸­çš„Serviceã€‚\nç¤ºä¾‹ï¼šé€šè¿‡Serviceæš´éœ²NginxæœåŠ¡apiVersion: v1kind: Servicemetadata:  name: nginx-service  namespace: lesson-demospec:  selector:    app: nginx # åŒ¹é…å…·æœ‰è¯¥æ ‡ç­¾çš„Pod  ports:    - protocol: TCP       # æœåŠ¡ç›‘å¬çš„ç«¯å£å·ï¼Œå½“å…¶ä»–æœåŠ¡æˆ–å¤–éƒ¨å®¢æˆ·ç«¯ä¸è¯¥æœåŠ¡é€šä¿¡æ—¶ï¼Œå®ƒä»¬å°†ä½¿ç”¨è¿™ä¸ªç«¯å£å·è¿›è¡Œé€šä¿¡ï¼Œè¯¥ç«¯å£å·æ˜¯æœåŠ¡å¯¹å¤–éƒ¨æš´éœ²çš„å…¥å£ã€‚å³é€šè¿‡clusterIP: portå¯ä»¥è®¿é—®åˆ°æŸä¸ªservice      port: 9376      # targetPortå¯ä»¥ç›´æ¥æŒ‡å®šPodçš„ç«¯å£ï¼Œä¹Ÿå¯ä»¥æŒ‡å®šPodç«¯å£æ‰€å¯¹åº”çš„åç§°ã€‚      # targetPortä¸€å®šè¦ä¸containerPortæš´éœ²å‡ºçš„ç«¯å£å¯¹åº”      targetPort: 80\n\nServiceçš„ç±»å‹ClusterIP\n\nåªåœ¨é›†ç¾¤å†…éƒ¨ç”Ÿæ•ˆçš„IPï¼Œé›†ç¾¤å†…æ‰€æœ‰èŠ‚ç‚¹éƒ½èƒ½è®¿é—®åˆ°å®ƒã€‚\nClusterIPç±»å‹ä¹Ÿæ˜¯æˆ‘ä»¬ä¸æŒ‡å®šç±»å‹æ—¶çš„é»˜è®¤Serviceç±»å‹ã€‚\n\napplyä¹‹åï¼Œæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡è®¿é—®ClusterIP:PORTçš„å½¢å¼æ¥è®¿é—®åˆ°æˆ‘ä»¬çš„æœåŠ¡ã€‚\nè®¿é—®æ–¹å¼ï¼šClusterIP:PORT\n\nè¿™ä¸ª IP åœ°å€å°±æ˜¯ Service çš„ IP åœ°å€ï¼Œè¿™ä¸ª IP åœ°å€åœ¨é›†ç¾¤é‡Œé¢å¯ä»¥è¢«å…¶å®ƒ pod æ‰€è®¿é—®ï¼Œç›¸å½“äºé€šè¿‡è¿™ä¸ª IP åœ°å€æä¾›äº†ç»Ÿä¸€çš„ä¸€ä¸ª pod çš„è®¿é—®å…¥å£ï¼Œä»¥åŠæœåŠ¡å‘ç°ã€‚è€ŒEndpointsæ˜¯æ¯ä¸ªPodçš„åç«¯IPã€‚\nNodePort\nå½“éœ€è¦ä»é›†ç¾¤å¤–éƒ¨è®¿é—®Serviceæ—¶ï¼Œå°±å¯ä»¥ä½¿ç”¨NodePortã€‚\nNodePortä¼šåœ¨æ¯ä¸ªNodeIPä¸Šå¯ç”¨ä¸€ä¸ªç›¸åŒçš„ç«¯å£æ¥æš´éœ²æœåŠ¡ã€‚NodeIPå°±æ˜¯æˆ‘ä»¬åœ¨åˆ›å»ºé›†ç¾¤æ—¶æŒ‡å®šçš„èŠ‚ç‚¹IPï¼Œç«¯å£é™å®šèŒƒå›´ä¸º30000-32767ã€‚\nå½“æˆ‘ä»¬è®¿é—®NodeIP:PORTæ—¶ï¼Œæµé‡ä¼šç”± kube-proxy ç½‘ç»œç»„ä»¶è¿›ä¸€æ­¥åˆ°ç»™å¯¹åº”çš„ Podã€‚\nè®¿é—®æ–¹å¼ï¼šNodeIP:PORT\napiVersion: v1kind: Servicemetadata:  name: nginx-service  namespace: lesson-demospec:  type: NodePort  selector:    app: nginx   ports:    - port: 80      targetPort: 80      nodePort: 30007\n\nLoadBalancer\nNodePortä¼šåœ¨æ¯å°Nodeä¸Šç›‘å¬ç«¯å£æ¥æ”¶ç”¨æˆ·æµé‡ï¼Œä½†åœ¨å®é™…æƒ…å†µä¸‹ï¼Œå¯¹ç”¨æˆ·æš´éœ²çš„åªä¼šæœ‰ä¸€ä¸ªIPå’Œç«¯å£ï¼Œé‚£è¿™ä¹ˆå¤šå°Nodeè¯¥ä½¿ç”¨å“ªå°è®©ç”¨æˆ·æ¥è®¿é—®å‘¢ï¼Ÿè€Œä¸”å¦‚æœåªè®¿é—®ä¸€ä¸ªNodeIPï¼Œé‚£ä¹ˆè¿™ä¸ªèŠ‚ç‚¹å‹åŠ›ä¼šå¾ˆå¤§ã€‚\nè¿™æ—¶å°±éœ€è¦å‰é¢åŠ ä¸€ä¸ªå…¬ç½‘è´Ÿè½½å‡è¡¡å™¨ä¸ºé¡¹ç›®æä¾›ç»Ÿä¸€è®¿é—®å…¥å£äº†ã€‚\nLoadBalancer é€šå¸¸æ˜¯äº‘æœåŠ¡å‚å•†æä¾›çš„è´Ÿè½½å‡è¡¡å™¨ï¼Œæˆ‘ä»¬é€šè¿‡å¤–éƒ¨çš„è´Ÿè½½å‡è¡¡å™¨å°†æµé‡è·¯ç”±åˆ°åˆ›å»ºçš„æœåŠ¡å•†ã€‚\nå°†Serviceçš„ç±»å‹è®¾ç½®ä¸ºLoadBalanceråï¼Œæˆ‘ä»¬æœ‰ä¸¤ä¸ªé€‰æ‹©ï¼Œä¸€ä¸ªæ˜¯è®¾ç½®è´Ÿè½½å‡è¡¡å™¨çš„IPï¼Œå¦ä¸€ç§è´Ÿè½½å‡è¡¡å™¨ä¼šè‡ªåŠ¨ä¸ºæˆ‘ä»¬åˆ†é…ä¸€ä¸ªExternalIPä½œä¸ºå‡ºå£ã€‚\n\nè®¿é—®æ–¹å¼ï¼šEXTERNALIP:PORT\napiVersion: v1kind: Servicemetadata:  name: nginx-servicespec:  type: LoadBalancer  selector:    app: nginx   ports:    - port: 80      targetPort: 80\n\nexternalIPs\nä¸€èˆ¬æˆ‘ä»¬çš„æœåŠ¡åªæš´éœ²äº†ClusterIPï¼Œè€ŒNodePortçš„ç«¯å£åˆæœ‰30000-32767çš„èŒƒå›´é™åˆ¶ã€‚è¿™æ—¶æˆ‘ä»¬å°±å¯ä»¥é…ç½®ä¸ŠexternalIPï¼Œè¡¨ç¤ºæ¥è‡ªexternalIPçš„æµé‡èƒ½è¿›å…¥æˆ‘ä»¬çš„æœåŠ¡ï¼Œ\nexternalIPä¸€èˆ¬å¡«è´Ÿè½½å‡è¡¡å™¨çš„IPã€‚\næ³¨æ„ï¼šexternalIPsä¸€å®šä¸èƒ½å¡«NodeIPï¼Œä¸ç„¶ä¼šå¯¼è‡´è¯¥èŠ‚ç‚¹ç›´æ¥å´©æºƒï¼ˆcalicoã€kubeletã€kube-proxyç­‰ç»„ä»¶æ— æ³•ä¸apiserverè¿›è¡Œé€šä¿¡ï¼‰ï¼Œå‡ºç°The connection to the server apiserver.cluster.local:6443 was refused - did you specify the right host or port?\nåŸå› åˆ†æå¯ä»¥çœ‹k8s IPVSæ¨¡å¼ä¸‹externalIPå¯¼è‡´èŠ‚ç‚¹æ•…éšœæµ…æ_external-ip-CSDNåšå®¢\napiVersion: v1kind: Servicemetadata:  name: nginx-servicespec:  externalIPs:  - 1.2.3.4   selector:    app: nginx   ports:    - port: 80      targetPort: 80\n\nServiceå››ç§ç±»å‹çš„å¯¹æ¯”\n\n\nç±»å‹\nç”¨é€”ä»‹ç»\n\n\n\nClusterIP\né»˜è®¤ç±»å‹ï¼Œè‡ªåŠ¨åˆ†é…ä¸€ä¸ªä»…clusterIpå†…éƒ¨å¯ä»¥è®¿é—®çš„è™šæ‹Ÿipåœ°å€\n\n\nNodePort\nåœ¨ClusterIPåŸºç¡€ä¸Šä¸ºServiceæœºå™¨ä¸Šç»‘å®šä¸€ä¸ªç«¯å£ï¼Œè¿™æ ·å°±å¯ä»¥é€šè¿‡NodePortæ¥è®¿é—®æœåŠ¡\n\n\nLoadBalancer\nåœ¨NodePortåŸºç¡€ä¸Šå€ŸåŠ©äº‘æœåŠ¡å•†åˆ›å»ºä¸€ä¸ªå¤–éƒ¨è´Ÿè½½å‡è¡¡å™¨ï¼Œå¹¶å°†è¯·æ±‚è½¬å‘åˆ°NodePortæ¥è®¿é—®æœåŠ¡\n\n\nexternalIPs\næŠŠé›†ç¾¤å¤–éƒ¨çš„æœåŠ¡å¼•å…¥åˆ°é›†ç¾¤å†…éƒ¨æ¥ï¼Œåœ¨é›†ç¾¤å†…éƒ¨ç›´æ¥ä½¿ç”¨\n\n\nIngresså’ŒIngressRouteæ²¡æœ‰Ingressä¹‹å‰ï¼Œæˆ‘ä»¬ä½¿ç”¨NodePortå¯¹å¤–æš´éœ²æœåŠ¡ï¼Œä½†å½“æœåŠ¡å¤šäº†ä»¥åï¼Œä¼šå­˜åœ¨ä¸€äº›å¼Šç«¯ï¼Œæ¯”å¦‚æš´éœ²å¤ªå¤šçš„çš„ç«¯å£ï¼Œæ— æ³•å®ç°åŸŸåè½¬å‘ç­‰ç­‰ã€‚\nIngresså…¶å®å°±æ˜¯ä»Kubernetesé›†ç¾¤å¤–éƒ¨è®¿é—®çš„ä¸€ä¸ªå…¥å£ï¼Œå®ƒå¯ä»¥å¸®åŠ©æˆ‘ä»¬é€šè¿‡ä¸åŒåŸŸåæ¥å°†æµé‡åŒ¹é…åˆ°å¯¹åº”çš„æœåŠ¡ï¼Œç±»ä¼¼äºNginxã€‚\nIngressåœ¨Serviceä¸Šé¢ä¸€å±‚ï¼Œå¯ä»¥å®šä¹‰é›†ç¾¤å¤–éƒ¨åˆ°é›†ç¾¤å†…Serviceçš„HTTPå’ŒHTTPSçš„è·¯ç”±ã€‚\n\nä½¿ç”¨æ–¹æ³•ï¼šå…ˆè‡ªè¡Œéƒ¨ç½²IngressController â†’ å†éƒ¨ç½²Ingressèµ„æºã€‚\nIngressControllerçš„åŠŸèƒ½ï¼š\n\næ¥å—å¤–éƒ¨æµé‡ï¼Œå¹¶å°†è¯·æ±‚è´Ÿè½½å‡è¡¡åˆ°å†…éƒ¨Pod\néƒ¨ç½²Ingressè·¯ç”±è½¬å‘è§„åˆ™\nç›‘æ§Podï¼Œå¹¶åœ¨æ·»åŠ æˆ–åˆ é™¤Podåè‡ªåŠ¨æ›´æ–°è´Ÿè½½å‡è¡¡è§„åˆ™ã€‚\n\nå¯ä»¥æŠŠIngress controllerç†è§£ä¸ºä¸€ä¸ªç›‘å¬å™¨ï¼Œå®ƒå¯ä»¥ä¸æ–­åœ°ä¸ kube-apiserver æ‰“äº¤é“ï¼Œå®æ—¶çš„æ„ŸçŸ¥åç«¯ serviceã€pod çš„å˜åŒ–ï¼Œå½“å¾—åˆ°è¿™äº›å˜åŒ–ä¿¡æ¯åï¼ŒIngress controller å†ç»“åˆ Ingress çš„é…ç½®ï¼Œæ›´æ–°åå‘ä»£ç†è´Ÿè½½å‡è¡¡å™¨ï¼Œè¾¾åˆ°æœåŠ¡å‘ç°çš„ä½œç”¨ã€‚\nIngress Controllerçš„å®ç°æœ‰å¤šç§ï¼Œæ¯”å¦‚Ingress-Nginxã€Traefikç­‰ï¼Œç”±äºIngress-Nginxçš„é…ç½®æ¯”è¾ƒéº»çƒ¦ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸€èˆ¬ä½¿ç”¨å®ƒçš„æ›¿ä»£å“Traefikã€‚\nTraefik Ingress Controllerä¼˜åŠ¿ï¼š\n\néƒ¨ç½²è¿‡ç¨‹ç®€å•\nä½¿ç”¨Goè¯­è¨€å¼€å‘ï¼Œå®Œç¾è´´åˆK8s\nTraefikè¡ç”Ÿçš„IngressRouteé…ç½®æ›´åŠ ç®€æ´ï¼Œæˆ‘ä»¬ä¸€èˆ¬ä½¿ç”¨IngressRoute\næ‹¥æœ‰å¤šç§ä¸­é—´ä»¶ï¼Œå¯ä»¥ç”¨äºå°†è¯·æ±‚è·¯ç”±åˆ°ç›®çš„åœ°ä¹‹å‰æˆ–ä¹‹åæ¥è°ƒæ•´è¯·æ±‚ã€‚\n\nå®‰è£…ä½¿ç”¨Helmå®‰è£…ï¼ˆHelmæ˜¯K8sä¸­çš„ä¸€ä¸ªåŒ…ç®¡ç†å™¨ï¼‰\n# helmå®‰è£…$ curl -fsSL -o get_helm.sh https://raw.githubusercontent.com/helm/helm/main/scripts/get-helm-3$ chmod 700 get_helm.sh$ ./get_helm.sh\n\nhelm repo add traefik https://traefik.github.io/chartshelm repo listhelm repo updatehelm pull traefik/traefikkubectl create namespace traefikhelm install traefik traefik/traefik -n traefik\n\néƒ¨ç½²å®Œæˆåï¼Œæˆ‘ä»¬å°±å¯ä»¥æŠŠæŸä¸ªåŸŸåè§£æåˆ°æˆ‘ä»¬çš„é›†ç¾¤ï¼ˆä¸‹é¢æŠŠk8s.yiiong.topè§£æåˆ°172.20.14.20ï¼‰ï¼Œç„¶åæˆ‘ä»¬å¯ä»¥é…ç½®IngressRouteè§„åˆ™ï¼ŒTraefikå°±å¯ä»¥æ ¹æ®IngressRouteè§„åˆ™æ¥å°†æµé‡è·¯ç”±åˆ°å¯¹åº”çš„æœåŠ¡ï¼Œå¹¶ä¸ºæ¯ä¸ªæœåŠ¡æä¾›ç‹¬ç«‹çš„åŸŸåã€‚\nè·¯ç”±å®ç°Traefikæœ‰ä¸¤ä¸ªæœåŠ¡å…¥å£ï¼ˆentryPointï¼‰\n\n80ï¼Œå¯¹åº”entryPoint:web\n443ï¼Œå¯¹åº”entryPoint:websecure\n\nTraefiké»˜è®¤ä»¥NodePortå½¢å¼æš´éœ²ï¼Œå¯¹äºå¦‚ä¸‹çš„Traefikæ¥è¯´ï¼Œå®ƒçš„å¤–éƒ¨å…¥å£å°±æ˜¯30350å’Œ31971ï¼Œä»30350è¿›å…¥80å…¥å£ï¼Œä»31971è¿›å…¥443å…¥å£ï¼Œå…·ä½“è§„åˆ™å¯ä»¥åœ¨values.yamlä¸­ä¿®æ”¹ã€‚\nå¦‚æœæˆ‘ä»¬ä¸æƒ³é€šè¿‡åŸŸå:ç«¯å£ï¼ˆk8s.yiiong.top:30350ï¼‰,æˆ‘ä»¬å¯ä»¥é€šè¿‡é…ç½®Nginxçš„åå‘ä»£ç†ï¼Œå®ç°ç›´æ¥è®¿é—®åŸŸååˆ°æˆ‘ä»¬å¯¹åº”çš„æœåŠ¡ã€‚\nNAME              TYPE       CLUSTER-IP   EXTERNAL-IP   PORT(S)                      AGEservice/traefik   NodePort   10.96.1.38   &lt;none&gt;        80:30350/TCP,443:31971/TCP   174d\n\nè·¯ç”±å®ç°\n\nIngressRouteIngressæ˜¯å®˜æ–¹çš„ä¸œè¥¿ï¼Œè€ŒIngressRouteåˆ™æ˜¯Traefik Ingress Controllerå°è£…å¥½çš„ä¸€ç§ç‰¹æ®ŠIngressèµ„æºã€‚\né…ç½®ä¸€ä¸ªHTTPçš„IngressRoute\napiVersion: traefik.containo.us/v1alpha1kind: IngressRoutemetadata:  name: nginx-http  namespace: lesson-demospec:  entryPoints: # å…¥å£ç‚¹ï¼Œå…¥å£ç‚¹æ˜¯åœ¨æˆ‘ä»¬Ingressæ§åˆ¶å™¨ä¸­å®šä¹‰çš„å…¥å£ç«¯å£ï¼Œè¡¨ç¤ºè¿›å…¥è¯¥ç«¯å£çš„æœåŠ¡æ‰éµå¾ªè¯¥IngressRouteçš„è·¯ç”±  - web  routes:  - match: Host(`k8s.yiiong.top`) # åŒ¹é…è¿™ä¸ªåŸŸå    kind: Rule # è·¯ç”±ç±»å‹çš„è§„åˆ™    services:    - name: nginx-service # åŒ¹é…åä¸ºnginx-serviceçš„svc      port: 9376 # è¿™ä¸ªsvcæš´éœ²åœ¨9376ï¼ŒäºŒè€…è¦ç›¸åŒ\n\næ¥ä¸‹æ¥è®¿é—®http://k8s.yiiong.top:30350å³å¯è®¿é—®åˆ°æˆ‘ä»¬å¯¹åº”çš„æœåŠ¡ã€‚\n\né…ç½®HTTPSçš„IngressRoute\næˆ‘ä»¬è¿™é‡Œå…ˆä½¿ç”¨opensslæ¥ç”Ÿæˆä¸€ä¸ªè‡ªç­¾è¯ä¹¦ã€‚\nopenssl genrsa -out ca.key 4096 openssl req -x509 -new -nodes -sha512 -days 36500 \\  -subj &quot;/C=CN/ST=Chongqing/L=Chongqing/O=Redrock/OU=Personal/CN=k8s.yiiong.top&quot; \\  -key ca.key \\  -out ca.crt    openssl genrsa -out tls.key 4096 openssl req -sha512 -new \\ -subj &quot;/C=CN/ST=Chongqing/L=Chongqing/O=Redrock/OU=Personal/CN=k8s.yiiong.top&quot; \\ -key tls.key \\ -out tls.csr openssl x509 -req -sha512 -days 3650 \\    -CA ca.crt -CAkey ca.key -CAcreateserial \\    -in tls.csr \\    -out tls.crt\n\nåˆ›å»ºè¯ä¹¦çš„Secretï¼ˆK8sä¸­ä¸€ç§å­˜å‚¨å’Œç®¡ç†æ•æ„Ÿæ•°æ®çš„èµ„æºç±»å‹ï¼‰\nkubectl create secret -n lesson-demo generic traefik-tls --from-file=tls.crt --from-file=tls.key\n\né…ç½®Yaml\napiVersion: traefik.containo.us/v1alpha1kind: IngressRoutemetadata:  name: nginx-https  namespace: lesson-demospec:  # è¿™é‡ŒæŒ‡å®šhttpsåªèƒ½èµ°443ç«¯å£  entryPoints:  # ä½¿ç”¨websecureä½œå…¥å£    - websecure  routes:    - kind: Rule      match: Host(`k8s.yiiong.top`)      services:        - name: nginx-service          port: 9376  # tlsç›¸å…³é…ç½®  tls:  # æŒ‡å®šè¯ä¹¦ï¼Œæ˜¯æˆ‘ä»¬å‰é¢åˆ›å»ºçš„è¯ä¹¦    secretName: traefik-tls\n\næ¥ä¸‹æ¥è®¿é—®https://k8s.yiiong.top:31971\n\n\nä¸åœ¨é›†ç¾¤é‡Œä½¿ç”¨HTTPS\n\nåœ¨é›†ç¾¤ä¸­ä½¿ç”¨HTTPSå¤ªéº»çƒ¦äº†ï¼Œè¦é…è¿™ä¹ˆå¤šä¸œè¥¿ï¼Œæœ‰æ²¡æœ‰ä»€ä¹ˆæ›´å¥½çš„åŠæ³•å¯ä»¥æŠŠå®ƒç»•å¼€ï¼Œç„¶åæˆ‘ä»¬ä¹Ÿèƒ½ä½¿ç”¨HTTPSè¯·æ±‚å‘¢ï¼Ÿ\nç­”æ¡ˆæ˜¯åœ¨é›†ç¾¤ä¸­é…ç½®ä¸€ä¸ªç½‘å…³æœºï¼Œè®©è¿™ä¸ªç½‘å…³æœºæ¥æ§åˆ¶æµé‡çš„è¿›å…¥ï¼Œæˆ‘ä»¬åªéœ€è¦å…³æ³¨æµé‡è¿›å…¥ç½‘å…³åï¼ŒæŠŠtlsç»™å¸è½½æ‰ï¼Œæœ€åç”¨httpçš„æµé‡è¿›å…¥æˆ‘ä»¬çš„é›†ç¾¤ï¼Œè¿™ç§æ–¹æ¡ˆå³å®‰å…¨ï¼Œè¿˜æ–¹ä¾¿ï¼Œä¸è¿‡ç¼ºç‚¹æ˜¯åªé€‚åˆåœ¨å¤šèŠ‚ç‚¹çš„é›†ç¾¤ä¸­ä½¿ç”¨\n\nä¸­é—´ä»¶middlewareä¸»è¦ç”¨æ¥å¯¹HTTPè¯·æ±‚åšä¸€äº›ä¿®æ”¹\n\nHTTPå¼ºåˆ¶è·³è½¬HTTPS\nå®ç°æ•ˆæœï¼šè®¿é—®http://k8s.yiiong.top:30350è‡ªåŠ¨è·³è½¬è‡³https://k8s.yiiong.top:31971\nå…ˆapplyåˆšæ‰çš„HTTPSçš„IngressRouteã€‚\nç„¶åé…ç½®ä¸€ä¸ªä¸­é—´ä»¶\nè¿™é‡Œä¼šç”¨åˆ°RedirectSchemeçš„å†…ç½®ä¸­é—´ä»¶ï¼Œé…ç½®å¦‚ä¸‹ï¼š\napiVersion: traefik.containo.us/v1alpha1kind: Middlewaremetadata:  name: redirect-https-middleware  namespace: lesson-demospec:  redirectScheme:    scheme: https    port: &quot;31971&quot; # ç”±äºæˆ‘çš„HTTPSåœ¨31971ç«¯å£ï¼ŒæŒ‡å®šä¸€ä¸‹ç«¯å£ï¼Œè®©å…¶é‡å®šå‘åˆ°31971\n\nç„¶ååœ¨HTTPçš„Yamlæ–‡ä»¶é‡Œæœ€åæ·»åŠ åˆšåˆšåˆ›å»ºçš„ä¸­é—´ä»¶ã€‚\nmiddlewares:  - name: redirect-https-middleware\n\nå¯è§HTTPè¢«æˆåŠŸé‡å®šå‘åˆ°HTTPS\n\nå»é™¤è¯·æ±‚å‰ç¼€\næœ‰æ—¶å€™æˆ‘ä»¬åªæœ‰ä¸€ä¸ªåŸŸåï¼Œä½†æˆ‘ä»¬æƒ³é€šè¿‡è¿™ä¸€ä¸ªåŸŸåè®¿é—®ä¸åŒçš„åº”ç”¨ã€‚\nåœ¨Nginxä¸­ï¼Œæˆ‘ä»¬å¯ä»¥é…ç½®Locationæ¥åŒ¹é…æµé‡ï¼ŒTraefikä¹Ÿå¯ä»¥è¿™ä¹ˆåšã€‚\nä½†æ˜¯å®šåˆ¶ä¸åŒçš„å‰ç¼€åï¼Œç”±äºåº”ç”¨æœ¬èº«å¹¶æ²¡æœ‰è¿™äº›å‰ç¼€ï¼Œå¯¼è‡´è¯·æ±‚è¿”å›404ï¼Œè¿™æ—¶å€™æˆ‘ä»¬å°±éœ€è¦å¯¹è¯·æ±‚çš„pathè¿›è¡Œå¤„ç†ã€‚\nå…ˆåˆ›å»ºä¸€ä¸ªå¸¦å‰ç¼€çš„IngressRoute\napiVersion: traefik.containo.us/v1alpha1kind: IngressRoutemetadata:  name: nginx-http  namespace: lesson-demospec:  entryPoints:  - web  routes:  - match: Host(`k8s.yiiong.top`) &amp;&amp; PathPrefix(`/nginx`)    kind: Rule    services:    - name: nginx-service      port: 9376\n\nç›´æ¥è®¿é—®ä¼šè¿”å›404\n\né…ç½®ä¸­é—´ä»¶stripPrefix\napiVersion: traefik.containo.us/v1alpha1kind: Middlewaremetadata:  name: prefix-url-middleware  namespace: lesson-demospec:  stripPrefix:    prefixes:      - /nginx\n\nä¿®æ”¹IngressRouteï¼Œä½¿ç”¨ä¸­é—´ä»¶\nmiddlewares:   - name: prefix-url-middleware\n\n\nç°åº¦å‘å¸ƒ\nç°åº¦å‘å¸ƒæˆ‘ä»¬æœ‰æ—¶å€™ä¹Ÿä¼šç§°ä¸ºé‡‘ä¸é›€å‘å¸ƒï¼ˆCanaryï¼‰ï¼Œä¸»è¦å°±æ˜¯è®©ä¸€éƒ¨åˆ†æµ‹è¯•çš„æœåŠ¡ä¹Ÿå‚ä¸åˆ°çº¿ä¸Šå»ï¼Œç»è¿‡æµ‹è¯•è§‚å¯Ÿçœ‹æ˜¯å¦ç¬¦åˆä¸Šçº¿è¦æ±‚ã€‚\nå‡è®¾ä¸€ä¸ªåº”ç”¨ç°åœ¨è¿è¡Œç€V1ç‰ˆæœ¬ï¼Œæ–°çš„V2ç‰ˆæœ¬éœ€è¦ä¸Šçº¿ï¼Œè¿™æ—¶å€™æˆ‘ä»¬éœ€è¦åœ¨é›†ç¾¤ä¸­éƒ¨ç½²å¥½V2ç‰ˆæœ¬ï¼Œç„¶åé€šè¿‡Traefikæä¾›çš„å¸¦æƒé‡çš„è½®è¯¢(WRR)æ¥å®ç°è¯¥åŠŸèƒ½ã€‚\nè¿™å’Œæˆ‘ä»¬ä¹‹å‰è®²Nginxå¸¦æƒé‡çš„è´Ÿè½½å‡è¡¡å¾ˆç±»ä¼¼ã€‚\néœ€è¦ä¸¤ä¸ªåŠä»¥ä¸Šçš„Serviceï¼Œç„¶åå†åŠ ä¸€ä¸ªTraefikService\napiVersion: traefik.containo.us/v1alpha1kind: TraefikServicemetadata:  name: appspec:  weighted:    services:      - name: appv1 # æœåŠ¡1        weight: 3        port: 80        kind: Service      - name: appv2 # æœåŠ¡2        weight: 1        port: 80        kind: Service\n\næˆ‘ä»¬ç»™v1ç‰ˆæœ¬é…ç½®æƒé‡3ï¼Œç»™è¦ä¸Šçº¿çš„v2ç‰ˆæœ¬é…ç½®æƒé‡1.ä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬3æ¬¡è®¿é—®domain.coméƒ½ä¼šæ˜¯v1ç‰ˆæœ¬ï¼Œç¬¬4æ¬¡å°±æ˜¯v2ç‰ˆæœ¬ã€‚å’Œæˆ‘ä»¬å½“æ—¶Nginxä¸¾çš„8881å’Œ8882çš„é‚£ä¸ªä¾‹å­ä¸€æ¨¡ä¸€æ ·ã€‚\nåˆ›å»ºTraefikServiceç±»å‹åï¼Œæˆ‘ä»¬åœ¨IngressRouteç±»å‹ä¸­å°†serviceå†™ä¸ºtraefikServiceå³å¯\napiVersion: traefik.containo.us/v1alpha1kind: IngressRoutemetadata:  name: app-ingressroute-canary spec:  entryPoints:    - web  routes:  - match: Host(`domain.com`)    kind: Rule    services:    - name: app      kind: TraefikService\n\nå¾…v2ç‰ˆæœ¬æµ‹è¯•æ²¡é—®é¢˜åï¼Œå°±å¯ä»¥å°†æµé‡å…¨åˆ‡åˆ°v2äº†ã€‚\nTraefikçš„ä¸­é—´ä»¶è¿˜æœ‰å¾ˆå¤šï¼Œæ¯”å¦‚Basic Authï¼ˆç”¨æˆ·èº«ä»½è®¤è¯ï¼‰ã€ipWhiteListï¼ˆå®šä¹‰IPç™½åå•ï¼‰ã€mirroringï¼ˆæµé‡å¤åˆ¶ï¼‰ç­‰ç­‰\nå¤§å®¶å¯ä»¥é€šè¿‡Traefik Proxy Middleware Overview - Traefikè¿›è¡Œå­¦ä¹ æ›´å¤šçš„ä¸­é—´ä»¶ï¼Œç”šè‡³å¯ä»¥è‡ªè¡Œå¼€å‘è‡ªå®šä¹‰ä¸­é—´ä»¶ã€‚\næ€»ç»“ï¼šæœåŠ¡æš´éœ²æ¨¡å¼\n\n\næš´éœ²æ¨¡å¼\nè®¿é—®æ–¹å¼\n\n\n\nService (NodePort) + Deployment\nNodeIP:NodePort\n\n\nIngressRoute + Serviceï¼ˆCluserIPï¼‰ + Deployment\nåŸŸå\n\n\nLoadBalancer + Service + Deployment\nè´Ÿè½½å‡è¡¡å™¨IP:PORT\n\n\nç¬¬äºŒç§æ–¹å¼æ˜¯æœ€å¸¸ç”¨çš„ï¼Œä¹‹æ‰€ä»¥Serviceè¢«è®¾ç½®æˆClusterIPï¼Œæ˜¯å› ä¸ºæµé‡è¿›å…¥é›†ç¾¤åç›´æ¥å°±ç”±Ingress Controllerç®¡ç†ï¼Œä¸å†é€šè¿‡kube-proxyç®¡ç†ã€‚æˆ‘ä»¬å¸¸å¸¸å°†åŸŸåè§£æåˆ°é›†ç¾¤ä¸»æœºï¼Œç„¶åIngressRouteè®¾ç½®ç›¸åŒçš„ä¸»æœºåï¼Œå°±èƒ½å®ç°æµé‡åŒ¹é…\nä½œä¸šï¼š\n1.å°†ç¬¬ä¸‰èŠ‚è¯¾è¯¾åä½œä¸šä½¿ç”¨FastAPIå¼€å‘çš„Webé¡¹ç›®éƒ¨ç½²åœ¨K8sä¸Šï¼Œå¹¶é€šè¿‡IngressRoute + Serviceï¼ˆCluserIPï¼‰ + Deployment + Middlewareï¼ˆå»å‰ç¼€ï¼‰ çš„æ–¹å¼æš´éœ²æœåŠ¡ã€‚\n2.éƒ¨ç½²2ä¸ªä»¥ä¸Šçš„æœåŠ¡åœ¨K8sä¸Šï¼Œåˆ©ç”¨IngressRouteç”¨åŸŸååŒºåˆ†è®¿é—®ã€‚\næœ€ç»ˆå°†æœåŠ¡åœ°å€ï¼ˆè¦æ±‚èƒ½è®¿é—®åˆ°ï¼‰å’Œæ•´ä¸ªéƒ¨ç½²æµç¨‹è®°å½•æ–‡æ¡£æäº¤åˆ°yiiong@redrock.team\næˆªæ­¢æ—¶é—´5æœˆ5æ—¥\n","categories":["Kubernetes"],"tags":["Kubernetes"]},{"title":"æ•°æ®ç»“æ„","url":"/2025/12/08/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/","content":"ç»ªè®ºæ•°æ®ï¼šæ‰€æœ‰èƒ½è¾“å…¥åˆ°è®¡ç®—æœºä¸­å¹¶å¯ä»¥è¢«è®¡ç®—æœºå¤„ç†çš„ä¿¡å·ã€‚\næ•°æ®å…ƒç´ ï¼šç”¨äºå®Œæ•´åœ°æè¿°ä¸€ä¸ªå¯¹è±¡ï¼Œæ˜¯æ•°æ®çš„åŸºæœ¬å•ä½ã€‚\næ•°æ®é¡¹ï¼šç»„æˆæ•°æ®å…ƒç´ çš„ã€æœ‰ç‹¬ç«‹å«ä¹‰çš„ã€ä¸å¯åˆ†å‰²çš„æœ€å°å•ä½ã€‚\næ•°æ®å¯¹è±¡ï¼šæ€§è´¨ç›¸åŒçš„æ•°æ®å…ƒç´ çš„é›†åˆï¼Œæ˜¯æ•°æ®çš„ä¸€ä¸ªå­é›†ã€‚\næ•°æ®ç»“æ„ï¼šç›¸äº’ä¹‹é—´å­˜åœ¨ä¸€ä¸ªæˆ–å¤šç§ç‰¹å®šå…³ç³»çš„æ•°æ®å…ƒç´ çš„é›†åˆã€‚\né€»è¾‘ç»“æ„ï¼šä»å…·ä½“é—®é¢˜æŠ½è±¡å‡ºæ¥çš„æ•°å­¦æ¨¡å‹ã€‚\nå­˜å‚¨ç»“æ„ï¼šé€»è¾‘ç»“æ„åœ¨è®¡ç®—æœºä¸­çš„å­˜å‚¨è¡¨ç¤ºã€‚åˆ†é¡ºåºå­˜å‚¨ç»“æ„å’Œé“¾å¼å­˜å‚¨ç»“æ„ã€‚\næŠ½è±¡æ•°æ®ç±»å‹ï¼šç”±ç”¨æˆ·å®šä¹‰çš„ï¼Œè¡¨ç¤ºåº”ç”¨é—®é¢˜çš„æ•°å­¦æ¨¡å‹ï¼Œä»¥åŠå®šä¹‰åœ¨è¿™ä¸ªæ¨¡å‹ä¸Šçš„ä¸€ç»„æ“ä½œçš„æ€»ç§°ã€‚\næ—¶é—´å¤æ‚åº¦O(1) &lt; O(logn) &lt; O(n) &lt; O(nlogn) &lt; O(nn) &lt; O(nn*n)\nO(2çš„næ¬¡æ–¹) &lt; O(n!) &lt; O(nçš„næ¬¡æ–¹)\nå†’æ³¡æ’åº\næœ€å¥½æ—¶é—´å¤æ‚åº¦ï¼šO(n) -&gt; ä¸€è½®å†’æ³¡å°±æ’å¥½\næœ€åæ—¶é—´å¤æ‚åº¦ï¼šO(n*n)\nçº¿æ€§è¡¨é¡ºåºè¡¨çš„åŸºæœ¬æ“ä½œé¡ºåºè¡¨çš„å­˜å‚¨ç»“æ„\nplaintext#include &lt;stdio.h&gt;#include &lt;stdlib.h&gt;#define MAXSIZE 100#define OVERFLOW -1typedef struct&#123;    int *elem; // å­˜å‚¨ç©ºé—´çš„åŸºåœ°å€    int length; // å½“å‰é•¿åº¦&#125;SqList; // é¡ºåºè¡¨çš„ç»“æ„ç±»å‹ä¸ºSqList\n\nåˆå§‹åŒ–plaintext// åˆå§‹åŒ–int InitList(SqList *L)&#123;    L-&gt;elem = (int *)malloc(sizeof(int) * MAXSIZE); // åˆ†é…å†…å­˜    if (!L-&gt;elem) &#123;        exit(OVERFLOW);    &#125; // åˆ†é…å†…å­˜å¤±è´¥é€€å‡ºç¨‹åº    L-&gt;length = 0; // åˆ›å»ºä¸€ä¸ªç©ºé¡ºåºè¡¨    return 0;&#125;plaintext// è°ƒç”¨int main()&#123;    int L;    int result = InitList(&amp;L);    if (result==0) &#123;        printf(&quot;Init successfully!&quot;);    &#125;    else &#123;        printf(&quot;Init error!&quot;);    &#125;    return 0;&#125;\n\nå–å€¼ï¼ˆæŒ‰ä½ç½®æŸ¥æ‰¾å€¼ï¼‰æ—¶é—´å¤æ‚åº¦O(1)\nplaintext// å–å€¼// ä½¿ç”¨ int *value è€Œä¸æ˜¯ int value çš„åŸå› æ˜¯å‡½æ•°éœ€è¦å°†æ‰¾åˆ°çš„å…ƒç´ å€¼è¿”å›ç»™è°ƒç”¨è€…ã€‚// ä½¿ç”¨æŒ‡é’ˆå¯ä»¥å®ç°è¿™ä¸€ç‚¹ï¼Œè€Œä¸éœ€è¦é€šè¿‡å‡½æ•°çš„è¿”å›å€¼æ¥ä¼ é€’å¤šä¸ªç»“æœã€‚int GetElem(SqList *L, int i, int *e)&#123;    if (i &lt; 1 || i &gt; L-&gt;length) &#123;        return -1; // åˆ¤æ–­içš„åˆæ³•æ€§    &#125;    *e = L-&gt;elem[i-1]; // ç¬¬i-1ä¸ªä½ç½®å­˜å‚¨çš„ç¬¬iä¸ªæ•°æ®å…ƒç´     return 0;&#125;plaintext// ä¸»å‡½æ•°è°ƒç”¨int main() &#123;\t// é¡ºåºè¡¨èµ‹å€¼    L.elem[0] = 10;    L.elem[1] = 20;    L.length = 2;    int value, result2 = 1;    result2 = GetElem(&amp;L, 1, &amp;value); // æŸ¥æ‰¾é¡ºåºè¡¨ç¬¬ä¸€ä¸ªå…ƒç´     if (result2 == 0) &#123;        printf(&quot;ç´¢å¼•1å¤„çš„å€¼ä¸º%d\\n&quot;,value);    &#125;    else    &#123;        printf(&quot;ç´¢å¼•è¶…å‡ºèŒƒå›´&quot;);    &#125;    return 0;&#125;\n\næŸ¥æ‰¾ï¼ˆæŒ‰å€¼æŸ¥æ‰¾ä½ç½®ï¼‰O(n)\nplaintext// æŒ‰å€¼æŸ¥æ‰¾ä½ç½®int LocateElem(SqList *L, int e)&#123;    for(int i=0;i &lt; L-&gt;length; i++) &#123;        if(L-&gt;elem[i] == e) &#123;            return i + 1;        &#125;    &#125;    return 0;&#125;plaintextint main()&#123;\tL.elem = 20;\tL.length = 2;\t// æŒ‰å€¼æŸ¥æ‰¾    int elem = 20;    int pos = LocateElem(&amp;L, elem);    if ( pos != 0 ) &#123;        printf(&quot;%dåœ¨é¡ºåºè¡¨ä¸­çš„ä½ç½®æ˜¯%d&quot;, elem, pos);    &#125;    else &#123;        printf(&quot;å€¼æœªæ‰¾åˆ°&quot;);    &#125;    return 0;&#125;\n\næ’å…¥æœ€å¥½ï¼šO(1) åœ¨æœ€åä¸€ä¸ªä½ç½®æ’å…¥\næœ€åï¼šO(n) åœ¨ç¬¬ä¸€ä¸ªä½ç½®æ’å…¥\nå¹³å‡ï¼šO(n)\nplaintext// æ’å…¥int ListInsert(SqList *L, int i, int e)&#123;    if( i&lt;1 || i&gt;L-&gt;length+1 ) &#123; // ä½ç½®ä¸åˆæ³•        printf(&quot;ä½ç½®ä¸åˆæ³•ï¼\\n&quot;);        return -1;    &#125;    if( L-&gt;length == MAXSIZE ) &#123; // å­˜å‚¨ç©ºé—´å·²æ»¡        printf(&quot;å­˜å‚¨ç©ºé—´å·²æ»¡ï¼\\n&quot;);        return -1;    &#125;    for(int j = L-&gt;length-1; j &gt;= i-1; j-- ) // å°†iåçš„å…ƒç´ ä¾æ¬¡å‘åç§»åŠ¨    &#123;        L-&gt;elem[j+1] = L-&gt;elem[j]; // æ’å…¥ä½ç½®ä¹‹åå…ƒç´ åç§»    &#125;    L-&gt;elem[i-1] = e; // æ’å…¥å…ƒç´     ++L-&gt;length;    return 0;&#125;plaintext// è°ƒç”¨int main() &#123;// æ’å…¥å…ƒç´     int position = 3;    int a = 6;    L.length = 5;    printf(&quot;åŸå…ˆçš„é¡ºåºè¡¨å…ƒç´ ä¸º:\\n&quot;);    for(int j = 0; j &lt; 5; j++)    &#123;        L.elem[j] = j+1;        printf(&quot;%d&quot;, L.elem[j]);    &#125;    printf(&quot;\\næ’å…¥åçš„é¡ºåºè¡¨å…ƒç´ ä¸º:\\n&quot;);    int r = ListInsert(&amp;L, position, a);    if (r == 0) &#123;        printf(&quot;æ’å…¥æˆåŠŸï¼\\n&quot;);        for(int k = 0; k &lt; 6; k++) &#123;            printf(&quot;%d&quot;,L.elem[k]);        &#125;    &#125;    else    &#123;         printf(&quot;æ’å…¥å¤±è´¥ï¼\\n&quot;);    &#125;    return 0;&#125;\n\nåˆ é™¤æœ€å¥½ï¼šO(1) åˆ é™¤æœ€åä¸€ä¸ªä½ç½®\næœ€åï¼šO(n) åˆ é™¤ç¬¬ä¸€ä¸ªä½ç½®\nå¹³å‡ï¼šO(n)\nplaintext// åˆ é™¤void ListDelete(SqList *L, int i)&#123;    if( i &lt; 1 || i &gt; L-&gt;length) &#123;        printf(&quot;ä½ç½®ä¸åˆæ³•!\\n&quot;);    &#125;    for(int j = i; j &lt;= L-&gt;length-1; j++)    &#123;        L-&gt;elem[j-1] = L-&gt;elem[j]; // å‰ç§»    &#125;    --L-&gt;length;&#125;plaintextint main() &#123;// åˆ é™¤å…ƒç´     int d = 3;    ListDelete(&amp;L, d);    printf(&quot;åˆ é™¤åçš„é¡ºåºè¡¨å†…å®¹ä¸º:\\n&quot;);    for(int i = 0; i &lt; L.length; i++) &#123;        printf(&quot;%d&quot;,L.elem[i]);    &#125;    return 0; &#125;\n\né“¾è¡¨çš„åŸºæœ¬æ“ä½œå•é“¾è¡¨å•é“¾è¡¨æ“ä½œå®Œæ•´ä»£ç plaintext#include &lt;stdio.h&gt;#include &lt;stdlib.h&gt;typedef struct&#123;    int data; // æ•°æ®åŸŸ    struct LNode *next; // æŒ‡é’ˆåŸŸï¼ŒæŒ‡å‘ä¸‹ä¸€ä¸ªèŠ‚ç‚¹&#125;LNode;typedef LNode* LinkList; // å®šä¹‰é“¾è¡¨ç±»å‹// åˆå§‹åŒ–LinkList InitList()&#123;    LinkList L = (LinkList)malloc(sizeof(LNode)); // ç”Ÿæˆå¤´ç»“ç‚¹    if(L == NULL) &#123;        printf(&quot;é“¾è¡¨åˆå§‹åŒ–å¤±è´¥ï¼\\n&quot;);        exit(0);    &#125;    L-&gt;next = NULL; // å¤´æŒ‡é’ˆè®¾ç½®ä¸ºç©º    printf(&quot;é“¾è¡¨åˆå§‹åŒ–æˆåŠŸï¼\\n&quot;);    return L;&#125;// å‰æ’æ³•åˆ›å»ºå•é“¾è¡¨void CreateList_H(LinkList *L, int n)&#123;    // å…ˆåˆ›å»ºä¸€ä¸ªç©ºé“¾è¡¨    *L = InitList();    for(int i = 0; i &lt; n; ++i)    &#123;        LNode *p = (LinkList)malloc(sizeof(LNode)); // ç”Ÿæˆæ–°ç»“ç‚¹        scanf(&quot;%d&quot;, &amp;p-&gt;data); // è¾“å…¥å…ƒç´ å€¼èµ‹ç»™æ–°ç»“ç‚¹çš„æ•°æ®åŸŸ        p-&gt;next = (*L)-&gt;next;  // å°†æ–°ç»“ç‚¹*pæ’å…¥åˆ°å¤´ç»“ç‚¹ä¹‹å        (*L)-&gt;next = p;    &#125;&#125;// å°¾æ’æ³•åˆ›å»ºå•é“¾è¡¨void CreateList_R(LinkList *L ,int n)&#123;    *L = InitList();    LNode *r = *L; // å°¾æŒ‡é’ˆræŒ‡å‘å¤´ç»“ç‚¹    for(int i = 0; i &lt; n; ++i)    &#123;        LNode *p = (LinkList)malloc(sizeof(LNode));        scanf(&quot;%d&quot;, &amp;p-&gt;data); // è¾“å…¥å…ƒç´ å€¼èµ‹ç»™æ–°ç»“ç‚¹çš„æ•°æ®åŸŸ        p-&gt;next = NULL; // æ–°ç»“ç‚¹çš„ä¸‹ä¸ªç»“ç‚¹æŒ‡å‘ç©ºï¼Œä¹Ÿå°±æ˜¯æ–°ç»“ç‚¹ä¸ºå°¾ç»“ç‚¹        r-&gt;next = p; // åŸæ¥çš„å°¾ç»“ç‚¹çš„ä¸‹ä¸€ä¸ªç»“ç‚¹æŒ‡å‘æ–°ç»“ç‚¹        r = p; // å°¾æŒ‡é’ˆæŒ‡å‘æ–°ç»“ç‚¹    &#125;&#125;// å–å€¼int GetElem(LinkList L, int i, int *e)&#123;    LinkList p = L-&gt;next;    int j = 1; // è®¡æ•°å™¨    while(p &amp;&amp; j &lt; i)    &#123;        p = p-&gt;next;        ++j;    &#125;    if(!p || j &gt; i)    &#123;        return -1;    &#125;    *e = p-&gt;data;    return 0;&#125;// æŸ¥æ‰¾LinkList *LocateListElem(LinkList L, int e)&#123;    LinkList p = L-&gt;next;    while(p &amp;&amp; p-&gt;data != e)    &#123;        p = p-&gt;next;    &#125;    return p;&#125;// æ’å…¥int ListInsert(LinkList *L, int i, int e)&#123;// åœ¨å¸¦å¤´ç»“ç‚¹çš„å•é“¾è¡¨Lä¸­ç¬¬iä¸ªä½ç½®æ’å…¥å€¼ä¸ºeçš„æ–°ç»“ç‚¹    //LNode *p = *L;    LinkList p = *L;    int j = 0;    while(p &amp;&amp; (j &lt; i-1))    &#123;        p = p-&gt;next; // æŸ¥æ‰¾ç¬¬i-1ä¸ªç»“ç‚¹ï¼ŒpæŒ‡å‘è¯¥ç»“ç‚¹        ++j; //    &#125;    if( !p || j &gt; i - 1)    &#123;        return -1;    &#125;    //LNode *s = (LinkList)malloc(sizeof(LNode));    LinkList s = (LinkList)malloc(sizeof(LNode));    if (s == NULL) &#123;        return -1; // å†…å­˜åˆ†é…å¤±è´¥    &#125;    s-&gt;data = e;    s-&gt;next = p-&gt;next;    p-&gt;next = s;    return 0;&#125;// åˆ é™¤int ListDelete(LinkList *L, int i)&#123;    LinkList p = *L;    int j = 0;    while( (p-&gt;next) &amp;&amp; (j &lt; i-1) )    &#123;        p = p-&gt;next;        ++j;    &#125;    // å½“i&gt;næˆ–è€…i&lt;1æ—¶ï¼Œä½ç½®ä¸åˆç†    if( !(p-&gt;next) || (j &gt; i-1) )    &#123;        return -1;    &#125;    LNode *q = p-&gt;next; // ä¸´æ—¶ä¿å­˜è¢«åˆ é™¤ç»“ç‚¹çš„åœ°å€ä»¥å¤‡é‡Šæ”¾    p-&gt;next = q-&gt;next; // æ”¹å˜åˆ é™¤ç»“ç‚¹å‰é©±ç»“ç‚¹çš„æŒ‡é’ˆï¼Œä¹Ÿå°±æ˜¯è®©i-1ä¸ªç»“ç‚¹ç›´æ¥æŒ‡å‘è¢«åˆ é™¤ç»“ç‚¹ï¼ˆqï¼‰çš„ä¸‹ä¸€ä¸ªç»“ç‚¹ï¼ˆq-&gt;nextï¼‰    free(q);    return 0;&#125;// æ‰“å°é“¾è¡¨void PrintList(LinkList L)&#123;    LNode *p = L-&gt;next; // ä»é¦–å…ƒç»“ç‚¹    while(p != NULL) &#123;        printf(&quot;%d -&gt; &quot;, p-&gt;data);        p = p-&gt;next;    &#125;    printf(&quot;NULL\\n&quot;);&#125;// é‡Šæ”¾é“¾è¡¨void DestroyList(LinkList *L)&#123;    if(*L == NULL) &#123;        return;    &#125;    LNode *p = (*L)-&gt;next;    while(p != NULL)&#123;        LNode *temp = p;        p = p-&gt;next;        free(temp);    &#125;    free(*L); // é‡Šæ”¾å¤´ç»“ç‚¹    *L = NULL; // è®¾ç½®é“¾è¡¨æŒ‡é’ˆä¸ºNULL&#125;int main()&#123;    LinkList list;    int n;    printf(&quot;è¯·è¾“å…¥é“¾è¡¨ä¸­å…ƒç´ çš„æ•°é‡ï¼š&quot;);    scanf(&quot;%d&quot;, &amp;n);    printf(&quot;åˆ›å»ºé“¾è¡¨ï¼Œè¯·è¾“å…¥%dä¸ªå…ƒç´ ï¼š\\n&quot;,n);    //CreateList_H(&amp;list, n);    CreateList_R(&amp;list, n);    printf(&quot;æ’å…¥çš„å…ƒç´ ä¸ºï¼š\\n&quot;);    PrintList(list);    int m = 2;    int e;    if (GetElem(list, m, &amp;e) == 0) &#123;        printf(&quot;ç¬¬%dä¸ªä½ç½®çš„å…ƒç´ ä¸ºï¼š%d\\n&quot;, m, e);    &#125; else &#123;        printf(&quot;è·å–å…ƒç´ å¤±è´¥\\n&quot;);    &#125;    // æŸ¥æ‰¾æ•°æ®ä¸ºmçš„ä½ç½®    printf(&quot;æ•°æ®ä¸º%dçš„åœ°å€æ˜¯%p\\n&quot;, m , LocateListElem(list, m));    // æ’å…¥    int pos = 3;    int elem = 18;    int result = ListInsert(&amp;list, pos, elem);    if(result == 0)    &#123;        printf(&quot;æ’å…¥æˆåŠŸï¼\\n&quot;);        printf(&quot;åœ¨ç¬¬%dä½ç½®æ’å…¥äº†%d\\n&quot;,pos, elem);        PrintList(list);    &#125;    else    &#123;        printf(&quot;æ’å…¥å¤±è´¥\\n&quot;);    &#125;    // åˆ é™¤    int r = ListDelete(&amp;list, pos);    if(result == 0)    &#123;        printf(&quot;åˆ é™¤æˆåŠŸï¼\\n&quot;);        printf(&quot;åˆ é™¤äº†ç¬¬%dä¸ªä½ç½®\\n&quot;,pos);        PrintList(list);    &#125;    else    &#123;        printf(&quot;åˆ é™¤å¤±è´¥\\n&quot;);    &#125;    DestroyList(&amp;list); // é‡Šæ”¾é“¾è¡¨&#125;\n\né“¾è¡¨åŒ…æ‹¬ä¸¤ä¸ªåŸŸï¼š\n\næ•°æ®åŸŸï¼šå­˜å‚¨æ•°æ®å…ƒç´ ä¿¡æ¯\næŒ‡é’ˆåŸŸï¼šå­˜å‚¨ç›´æ¥åç»§å­˜å‚¨ä½ç½®\n\nå•é“¾è¡¨çš„å­˜å‚¨ç»“æ„\nplaintext#include &lt;stdio.h&gt;#include &lt;stdlib.h&gt;typedef struct&#123;    int data; // æ•°æ®åŸŸ    struct LNode *next; // æŒ‡é’ˆåŸŸï¼ŒæŒ‡å‘ä¸‹ä¸€ä¸ªèŠ‚ç‚¹&#125;LNode;typedef LNode* LinkList; // å®šä¹‰é“¾è¡¨ç±»å‹LNodeï¼šç”¨äºè¡¨ç¤ºé“¾è¡¨ä¸­çš„ä¸€ä¸ªèŠ‚ç‚¹ã€‚ç”¨äºåˆ›å»ºæ–°çš„èŠ‚ç‚¹ã€‚ç”¨äºè®¿é—®èŠ‚ç‚¹çš„æˆå‘˜ï¼ˆå¦‚ data å’Œ nextï¼‰ã€‚LinkListï¼šç”¨äºè¡¨ç¤ºé“¾è¡¨çš„å¤´æŒ‡é’ˆã€‚ç”¨äºä¼ é€’å’Œè¿”å›é“¾è¡¨çš„å¤´æŒ‡é’ˆã€‚ç”¨äºéå†é“¾è¡¨ã€‚æ•´ä¸ªç¨‹åºä¸­LNode*ç­‰ä»·äºLinkList\n\nå•é“¾è¡¨åˆå§‹åŒ–plaintext// åˆå§‹åŒ–LinkList InitList()&#123;    LinkList L = (LinkList)malloc(sizeof(LNode)); // ç”Ÿæˆå¤´èŠ‚ç‚¹    if(L == NULL) &#123;        printf(&quot;é“¾è¡¨åˆå§‹åŒ–å¤±è´¥ï¼\\n&quot;);        exit(0);    &#125;    L-&gt;next = NULL; // å¤´æŒ‡é’ˆè®¾ç½®ä¸ºç©º    printf(&quot;é“¾è¡¨åˆå§‹åŒ–æˆåŠŸï¼\\n&quot;);    return L;&#125;plaintext// è°ƒç”¨int main()&#123;    LinkList list = InitList();    free(list);    return 0;&#125;\n\nå–å€¼ï¼ˆæŒ‰ä½ç½®æŸ¥æ‰¾å€¼ï¼‰æ­¥éª¤ï¼š\n\næŒ‡é’ˆpæŒ‡å‘é¦–å…ƒèŠ‚ç‚¹ï¼Œç”¨jåšè®¡æ•°å™¨åˆå€¼èµ‹å€¼ä¸º1\nä»é¦–å…ƒèŠ‚ç‚¹å¼€å§‹ä¾æ¬¡é¡ºç€é“¾åŸŸå‘ä¸‹è®¿é—®ï¼Œåªè¦æŒ‡å‘å½“å‰ç»“ç‚¹çš„æŒ‡é’ˆpä¸ä¸ºç©ºï¼Œå¹¶ä¸”æ²¡æœ‰åˆ°è¾¾åºå·ä¸ºiçš„ç»“ç‚¹ï¼Œåˆ™åšä»¥ä¸‹å¾ªç¯\npæŒ‡å‘ä¸‹ä¸€ä¸ªç»“ç‚¹\nè®¡æ•°å™¨jç›¸åº”åŠ 1\n\n\né€€å‡ºå¾ªç¯æ—¶ï¼Œå¦‚æœpä¸ºç©ºï¼Œæˆ–è€…è®¡æ•°å™¨jå¤§äºiï¼Œè¯´æ˜æŒ‡å®šçš„åºå·iå€¼ä¸åˆæ³•ï¼ˆå³iå¤§äºè¡¨é•¿næˆ–è€…iå°äºç­‰äº0ï¼‰ï¼Œå–å€¼å¤±è´¥è¿”å›-1.\nå½“j&#x3D;iæ—¶ï¼Œpæ‰€æŒ‡å‘çš„ç»“ç‚¹å°±æ˜¯è¦æ‰¾çš„ç¬¬iä¸ªç»“ç‚¹ï¼Œç”¨eæ¥ä¿å­˜å½“å‰çš„æ•°æ®åŸŸã€‚\n\nplaintext// å–å€¼int GetElem(LinkList L, int i, int *e)&#123;    LinkList p = L-&gt;next;    int j = 1; // è®¡æ•°å™¨    while(p &amp;&amp; j &lt; i)    &#123;        p = p-&gt;next;        ++j;    &#125;    if(!p || j &gt; i)    &#123;        return -1;    &#125;    *e = p-&gt;data;    return 0;&#125;plaintext// è°ƒç”¨\tint m = 2;    int e;    if (GetElem(list, m, &amp;e) == 0) &#123;        printf(&quot;ç¬¬%dä¸ªä½ç½®çš„å…ƒç´ ä¸ºï¼š%d\\n&quot;, m, e);    &#125; else &#123;        printf(&quot;è·å–å…ƒç´ å¤±è´¥\\n&quot;);    &#125;\n\n\næŸ¥æ‰¾ï¼ˆæŒ‰å€¼æŸ¥æ‰¾ç»“ç‚¹åœ°å€ï¼‰æ­¥éª¤ï¼š\n\nç”¨pæŒ‡å‘é¦–å…ƒç»“ç‚¹\nä»é¦–å…ƒç»“ç‚¹ä¾æ¬¡é¡ºç€é“¾åŸŸnextå‘ä¸‹æŸ¥æ‰¾ï¼Œåªè¦å½“å‰ç»“ç‚¹æŒ‡é’ˆpä¸ä¸ºç©ºï¼Œå¹¶ä¸”pæ‰€æŒ‡å‘ç»“ç‚¹çš„æ•°æ®åŸŸä¸ç­‰äºeï¼Œåˆ™æ‰§è¡ŒpæŒ‡å‘ä¸‹ä¸€ä¸ªç»“ç‚¹æ“ä½œ\nè¿”å›pã€‚è‹¥æŸ¥æ‰¾æˆåŠŸï¼Œpæ­¤æ—¶å³ä¸ºç»“ç‚¹çš„åœ°å€å€¼ã€‚å¦åˆ™pä¸ºNULLã€‚\n\nplaintext// æŸ¥æ‰¾LinkList *LocateListElem(LinkList L, int e)&#123;    LinkList p = L-&gt;next;    while(p &amp;&amp; p-&gt;data != e)    &#123;        p = p-&gt;next;    &#125;    return p;&#125;\n\nå‰æ’æ³•åˆ›å»ºå•é“¾è¡¨æ­¥éª¤ï¼š\n\nåˆ›å»ºä¸€ä¸ªåªæœ‰å¤´ç»“ç‚¹çš„ç©ºé“¾è¡¨ï¼Œå°±æ˜¯InitList()åšçš„äº‹æƒ…\næ ¹æ®å¸¦åˆ›å»ºé“¾è¡¨ï¼Œå¾ªç¯næ¬¡ï¼Œæ‰§è¡Œä»¥ä¸‹æ“ä½œ\nç”Ÿæˆæ–°ç»“ç‚¹*p\nè¾“å…¥å…ƒç´ èµ‹å€¼ç»™*pçš„æ•°æ®åŸŸ\nå°†æ–°ç»“ç‚¹*pæ’å…¥åˆ°å¤´ç»“ç‚¹ä¹‹å\n\n\n\n\nplaintext// å‰æ’æ³•åˆ›å»ºå•é“¾è¡¨void CreateList_H(LinkList *L, int n)&#123;    // å…ˆåˆ›å»ºä¸€ä¸ªç©ºé“¾è¡¨    *L = InitList();    for(int i = 0; i &lt; n; ++i)    &#123;        // LNode *p = (LNode *)malloc(sizeof(LNode));        LNode *p = (LinkList)malloc(sizeof(LNode)); // ç”Ÿæˆæ–°ç»“ç‚¹        scanf(&quot;%d&quot;, &amp;p-&gt;data); // è¾“å…¥å…ƒç´ å€¼èµ‹ç»™æ–°ç»“ç‚¹çš„æ•°æ®åŸŸ        p-&gt;next = (*L)-&gt;next;  // å°†æ–°ç»“ç‚¹*pæ’å…¥åˆ°å¤´ç»“ç‚¹ä¹‹å        (*L)-&gt;next = p;    &#125;&#125;\n\n\nåæ’æ³•åˆ›å»ºå•é“¾è¡¨\næ­¥éª¤ï¼š\n\nåˆ›å»ºä¸€ä¸ªåªæœ‰å¤´ç»“ç‚¹çš„ç©ºé“¾è¡¨ï¼Œå°±æ˜¯InitList()åšçš„äº‹æƒ…\nå°¾æŒ‡é’ˆråˆå§‹åŒ–ï¼ŒæŒ‡å‘å¤´ç»“ç‚¹\næ ¹æ®åˆ›å»ºé“¾è¡¨ï¼Œå¾ªç¯næ¬¡ä»¥ä¸‹æ“ä½œ\nç”Ÿæˆæ–°ç»“ç‚¹*p\nè¾“å…¥å…ƒç´ èµ‹å€¼ç»™*pçš„æ•°æ®åŸŸ\nå°†æ–°ç»“ç‚¹pæ’å…¥åˆ°å°¾ç»“ç‚¹rä¹‹å\nå°¾æŒ‡é’ˆræŒ‡å‘æ–°çš„å°¾ç»“ç‚¹*p\n\n\n\nplaintext// å°¾æ’æ³•åˆ›å»ºå•é“¾è¡¨void CreateList_R(LinkList *L ,int n)&#123;    *L = InitList();    LNode *r = *L; // å°¾æŒ‡é’ˆræŒ‡å‘å¤´ç»“ç‚¹    for(int i = 0; i &lt; n; ++i)    &#123;        LNode *p = (LinkList)malloc(sizeof(LNode));        scanf(&quot;%d&quot;, &amp;p-&gt;data); // è¾“å…¥å…ƒç´ å€¼èµ‹ç»™æ–°ç»“ç‚¹çš„æ•°æ®åŸŸ        p-&gt;next = NULL; // æ–°ç»“ç‚¹çš„ä¸‹ä¸ªç»“ç‚¹æŒ‡å‘ç©ºï¼Œä¹Ÿå°±æ˜¯æ–°ç»“ç‚¹ä½œä¸ºå°¾ç»“ç‚¹        r-&gt;next = p; // åŸæ¥çš„å°¾ç»“ç‚¹çš„ä¸‹ä¸€ä¸ªç»“ç‚¹æŒ‡å‘æ–°ç»“ç‚¹        r = p; // å°¾æŒ‡é’ˆæŒ‡å‘æ–°ç»“ç‚¹    &#125;&#125;\n\n\næ’å…¥\næ­¥éª¤ï¼š\n\næ‰¾ç¬¬i-1ä¸ªä½ç½®çš„ç»“ç‚¹ï¼Œç„¶åæŒ‡é’ˆpæŒ‡å‘è¯¥ç»“ç‚¹\nç”Ÿæˆä¸€ä¸ªæ–°ç»“ç‚¹*s\nå°†*sçš„æ•°æ®åŸŸç½®ä¸ºe\n*sçš„æŒ‡é’ˆåŸŸæŒ‡å‘ç¬¬iä¸ªç»“ç‚¹ï¼ˆs-&gt;next &#x3D; p-&gt;nextï¼‰\npçš„æŒ‡é’ˆåŸŸæŒ‡å‘æ–°ç»“ç‚¹sï¼ˆp-&gt;next &#x3D; sï¼‰\n\nplaintext// æ’å…¥int ListInsert(LinkList *L, int i, int e)&#123;// åœ¨å¸¦å¤´ç»“ç‚¹çš„å•é“¾è¡¨Lä¸­ç¬¬iä¸ªä½ç½®æ’å…¥å€¼ä¸ºeçš„æ–°ç»“ç‚¹    //LNode *p = *L;    LinkList p = *L;    int j = 0;    while(p &amp;&amp; (j &lt; i-1))    &#123;        p = p-&gt;next; // æŸ¥æ‰¾ç¬¬i-1ä¸ªç»“ç‚¹ï¼ŒpæŒ‡å‘è¯¥ç»“ç‚¹        ++j; //    &#125;    if( !p || j &gt; i - 1 )    &#123;        return -1;    &#125;    //LNode *s = (LNode *)malloc(sizeof(LNode));    LinkList s = (LinkList)malloc(sizeof(LNode));    if (s == NULL) &#123;        return -1; // å†…å­˜åˆ†é…å¤±è´¥    &#125;    s-&gt;data = e;    s-&gt;next = p-&gt;next;    p-&gt;next = s;    return 0;&#125;plaintext// è°ƒç”¨    int pos = 3;    int elem = 18;    int result = ListInsert(&amp;list, pos, elem);    if(result == 0)    &#123;        printf(&quot;æ’å…¥æˆåŠŸï¼\\n&quot;);        printf(&quot;åœ¨ç¬¬%dä½ç½®æ’å…¥äº†%d\\n&quot;,pos, elem);        PrintList(list);    &#125;    else    &#123;        printf(&quot;æ’å…¥å¤±è´¥\\n&quot;);    &#125;\n\nåˆ é™¤æ­¥éª¤ï¼š\n\næ‰¾ai-1ï¼ŒæŒ‡é’ˆpæŒ‡å‘è¯¥ç»“ç‚¹\nä¸´æ—¶ä¿å­˜å¾…åˆ é™¤ç»“ç‚¹aiçš„åœ°å€åœ¨qä¸­ï¼Œä»¥å¤‡é‡Šæ”¾\nå°†ç»“ç‚¹*pçš„æŒ‡å‘aiçš„åç»§èŠ‚ç‚¹\né‡Šæ”¾aiçš„ç©ºé—´\n\n\nplaintext// åˆ é™¤int ListDelete(LinkList *L, int i)&#123;    LinkList p = *L;    int j = 0;    while( (p-&gt;next) &amp;&amp; (j &lt; i-1) )    &#123;        p = p-&gt;next;        ++j;    &#125;    // å½“i&gt;næˆ–è€…i&lt;1æ—¶ï¼Œä½ç½®ä¸åˆç†    if( !(p-&gt;next) || (j &gt; i-1) )    &#123;        return -1;    &#125;    LNode *q = p-&gt;next; // ä¸´æ—¶ä¿å­˜è¢«åˆ é™¤ç»“ç‚¹çš„åœ°å€ä»¥å¤‡é‡Šæ”¾    p-&gt;next = q-&gt;next; // æ”¹å˜åˆ é™¤ç»“ç‚¹å‰é©±ç»“ç‚¹çš„æŒ‡é’ˆï¼Œä¹Ÿå°±æ˜¯è®©i-1ä¸ªç»“ç‚¹ç›´æ¥æŒ‡å‘è¢«åˆ é™¤ç»“ç‚¹ï¼ˆqï¼‰çš„ä¸‹ä¸€ä¸ªç»“ç‚¹ï¼ˆq-&gt;nextï¼‰    free(q);    return 0;&#125;// ä¸ºä»€ä¹ˆå¾ªç¯æ¡ä»¶ä½¿ç”¨p-&gt;nextè€Œä¸æ˜¯pï¼Ÿå¦‚æœä½¿ç”¨pä½œä¸ºå¾ªç¯æ¡ä»¶ï¼Œå³while(p &amp;&amp; j &lt; i-1)ï¼Œè¿™å¯èƒ½ä¼šå¯¼è‡´ä»¥ä¸‹é—®é¢˜ï¼š1.å½“iä¸º1æ—¶ï¼šå¦‚æœè¦åˆ é™¤ç¬¬ä¸€ä¸ªèŠ‚ç‚¹ï¼Œå³i=1ï¼Œé‚£ä¹ˆåœ¨ç¬¬ä¸€æ¬¡è¿­ä»£ä¹‹å‰ï¼Œjå·²ç»ç­‰äº0äº†ï¼Œæ­¤æ—¶j &lt; i-1å°±ä¸æˆç«‹äº†ï¼Œå¾ªç¯ä¸ä¼šæ‰§è¡Œï¼Œpä»ç„¶æ˜¯å¤´æŒ‡é’ˆã€‚è¿™æ„å‘³ç€æˆ‘ä»¬æ— æ³•è¿›å…¥å¾ªç¯å»è®¿é—®p-&gt;nextï¼Œä¹Ÿå°±ä¸èƒ½è¿›è¡Œåˆ é™¤æ“ä½œã€‚2.éå†è‡³é“¾è¡¨æœ«å°¾ï¼šä½¿ç”¨p-&gt;nextä½œä¸ºæ¡ä»¶å¯ä»¥ä¿è¯æˆ‘ä»¬åœ¨åˆ°è¾¾é“¾è¡¨çš„æœ€åä¸€ä¸ªå…ƒç´ æ—¶åœæ­¢ï¼Œå› ä¸ºæœ€åä¸€ä¸ªå…ƒç´ çš„nextæ˜¯æŒ‡å‘NULLçš„ã€‚å¦‚æœæˆ‘ä»¬åªæ£€æŸ¥pï¼Œåˆ™ä¼šä¸€ç›´éå†åˆ°pä¸ºNULLä¸ºæ­¢ï¼Œè¿™æ ·æˆ‘ä»¬å°±æ— æ³•è®¿é—®p-&gt;nextæ¥è¿›è¡Œåˆ é™¤æ“ä½œã€‚plaintext// åˆ é™¤    int r = ListDelete(&amp;list, pos);    if(result == 0)    &#123;        printf(&quot;åˆ é™¤æˆåŠŸï¼\\n&quot;);        printf(&quot;åˆ é™¤äº†ç¬¬%dä¸ªä½ç½®\\n&quot;,pos);        PrintList(list);    &#125;    else    &#123;        printf(&quot;åˆ é™¤å¤±è´¥\\n&quot;);    &#125;\n\n\næŸ¥çœ‹é“¾è¡¨å…ƒç´ plaintext// æ‰“å°é“¾è¡¨void PrintList(LinkList L)&#123;    LNode *p = L-&gt;next; // ä»é¦–å…ƒç»“ç‚¹    while(p != NULL) &#123;        printf(&quot;%d -&gt; &quot;, p-&gt;data);        p = p-&gt;next;    &#125;    printf(&quot;NULL\\n&quot;);&#125;\n\né‡Šæ”¾å•é“¾è¡¨plaintext// é‡Šæ”¾é“¾è¡¨void DestroyList(LinkList *L)&#123;    if(*L == NULL) &#123;        return;    &#125;    LNode *p = (*L)-&gt;next;    while(p != NULL)&#123;        LNode *temp = p;        p = p-&gt;next;        free(temp);    &#125;    free(*L); // é‡Šæ”¾å¤´ç»“ç‚¹    *L = NULL; // è®¾ç½®é“¾è¡¨æŒ‡é’ˆä¸ºNULL&#125;\n\nåŒå‘é“¾è¡¨åŒå‘é“¾è¡¨åˆå§‹åŒ–åŒå‘é“¾è¡¨ç»“æ„ä½“\nplaintext#include &lt;stdio.h&gt;#include &lt;stdlib.h&gt;typedef struct DuLNode&#123;    int data; // æ•°æ®åŸŸ    struct DuLNode *prior; // ç›´æ¥å‰é©±    struct DuLNode *next; // ç›´æ¥åé©±&#125;DuLNode;typedef DuLNode* DuList;\n\nä»åå‘å‰æŸ¥çœ‹é“¾è¡¨å…ƒç´ å…ˆè®¾ç½®å¤´ç»“ç‚¹ï¼Œç„¶åæ‰¾å°¾ç»“ç‚¹\nä»å‰å‘åå°±ä¸ç”¨æ‰¾å°¾ç»“ç‚¹äº†\nplaintext//  ä»åå‘å‰æ‰“å°åŒå‘é“¾è¡¨void PrintList_E(DuList L)&#123;    DuList p = L-&gt;next; // å¤´ç»“ç‚¹    // æ‰¾æœ€åä¸€ä¸ªç»“ç‚¹    while (p-&gt;next != NULL) &#123;        p = p-&gt;next;    &#125;        while(p != NULL) &#123;        printf(&quot;%d -&gt; &quot;, p-&gt;data);        p = p-&gt;prior;    &#125;    printf(&quot;NULL\\n&quot;);&#125;\n\n\næ’å…¥\nplaintext// æ’å…¥int ListInsert(DuList *L, int i, int e)&#123;    DuList p = LocateListElem(*L, i);    if(!p)    &#123;        return -1;    &#125;    DuList s = (DuList)malloc(sizeof(DuLNode));    s-&gt;data = e;    s-&gt;prior = p-&gt;prior;    if (p-&gt;prior != NULL)    &#123;        p-&gt;prior-&gt;next = s;    &#125;    s-&gt;next = p;    p-&gt;prior = s;    return 0;&#125;plaintext// è°ƒç”¨ï¼Œç¬¬ä¸‰ä¸ªä½ç½®æ’å…¥19int main()&#123;    DuList list;    //InitDuList();    int n;    printf(&quot;è¯·è¾“å…¥åŒå‘é“¾è¡¨ä¸­å…ƒç´ çš„æ•°é‡ï¼š&quot;);    scanf(&quot;%d&quot;, &amp;n);    CreateList_H(&amp;list, n);    PrintList(list);    int pos = 3;    int e = 19;    // æ’å…¥    int result = ListInsert(&amp;list, pos, e);    if(result == 0)    &#123;        printf(&quot;\\næ’å…¥æˆåŠŸï¼\\n&quot;);        printf(&quot;åœ¨ç¬¬%dä¸ªä½ç½®æ’å…¥äº†%d\\n&quot;, pos, e);        PrintList(list);    &#125;    else    &#123;        printf(&quot;æ’å…¥å¤±è´¥ï¼&quot;);    &#125;    return 0;&#125;\n\n\nåˆ é™¤\nplaintext// åˆ é™¤void ListDelete_DuL(DuList *L, int i)&#123;    DuList p = LocateListElem(*L, i);    if(!p)        return;    p-&gt;prior-&gt;next = p-&gt;next;    p-&gt;next-&gt;prior = p-&gt;prior;    free(p);&#125;\n\n\næ ˆå’Œé˜Ÿåˆ—é¡ºåºæ ˆçš„åŸºæœ¬æ“ä½œå®Œæ•´ä»£ç plaintext#include &lt;stdio.h&gt;#include &lt;stdlib.h&gt;#define MAXSIZE 100#define ERROR -1typedef struct&#123;    int *base; // æ ˆåº•æŒ‡é’ˆ    int *top; // æ ˆé¡¶æŒ‡é’ˆ    int stacksize; // æ ˆå¯ç”¨çš„æœ€å¤§å®¹é‡&#125;SqStack, *Stack;// åˆå§‹åŒ–Stack InitStack()&#123;    Stack s = (Stack)malloc(sizeof(SqStack));    if (s == NULL)    &#123;        printf(&quot;æ ˆå†…å­˜åˆ†é…å¤±è´¥ï¼\\n&quot;);        exit(1);    &#125;    // ä¸ºæ ˆåº•åˆ†é…å†…å­˜    s-&gt;base = (int *)malloc(MAXSIZE * sizeof(int));    if(s-&gt;base == NULL) &#123;        free(s);        printf(&quot;æ ˆå†…å­˜åˆ†é…å¤±è´¥ï¼\\n&quot;);        exit(1);    &#125;    s-&gt;top = s-&gt;base;    s-&gt;stacksize = MAXSIZE;    printf(&quot;æ ˆåˆå§‹åŒ–æˆåŠŸï¼\\n&quot;);    return s;&#125;// å…¥æ ˆint Push(Stack s, int e)&#123;    // æ’å…¥å…ƒç´ eä¸ºæ–°çš„æ ˆé¡¶å…ƒç´     if(s-&gt;top-s-&gt;base == s-&gt;stacksize)    &#123;        printf(&quot;æ ˆæ»¡ï¼\\n&quot;);        return ERROR;    &#125;    *s-&gt;top = e;    s-&gt;top++; // æ ˆé¡¶ä¸Šç§»    return 0;&#125;// å‡ºæ ˆint Pop(Stack s, int *e)&#123;    if(s-&gt;top == s-&gt;base)    &#123;        printf(&quot;æ ˆç©ºï¼\\n&quot;);        return ERROR;    &#125;    s-&gt;top--; // æ ˆé¡¶æŒ‡é’ˆä¸‹ç§»    *e = *s-&gt;top; // æ ˆé¡¶å…ƒç´ èµ‹å€¼ç»™e    return 0;&#125;// å–æ ˆé¡¶å…ƒç´ int GetTop(Stack s, int *e)&#123;    // è¿”å›æ ˆé¡¶å…ƒç´ ï¼Œä¸ä¿®æ”¹æ ˆé¡¶æŒ‡é’ˆ    if(s-&gt;top != s-&gt;base) // å¦‚æœæ ˆéç©º    &#123;        *e = *(s-&gt;top - 1);        return 0;    &#125;    return ERROR;&#125;int main()&#123;    Stack s = InitStack();    int n; // æ ˆé•¿    printf(&quot;è¯·è¾“å…¥æ ˆé•¿ï¼š&quot;);    scanf(&quot;%d&quot;, &amp;n);    // å…¥æ ˆ    for(int i = 0; i &lt; n; i++) &#123;        int e;        printf(&quot;è¾“å…¥å…¥æ ˆå…ƒç´ ï¼š&quot;);        scanf(&quot;%d&quot;, &amp;e);        if(Push(s, e) == 0) &#123;            printf(&quot;å…¥æ ˆæˆåŠŸï¼š%d\\n&quot;, e);        &#125;        else &#123;            printf(&quot;å…¥æ ˆå¤±è´¥ï¼š%d&quot;, e);        &#125;    &#125;    // å‡ºæ ˆ    for(int i = 0; i &lt; n; i++) &#123;        int e;        if(Pop(s, &amp;e) == 0)&#123;            printf(&quot;å‡ºæ ˆæˆåŠŸï¼Œå…ƒç´ ä¸º%d\\n&quot;,e);            int topElem;            if(GetTop(s, &amp;topElem) == 0) &#123;                printf(&quot;æ­¤æ—¶æ ˆé¡¶å…ƒç´ ä¸ºï¼š%d\\n&quot;, topElem);            &#125;            else &#123;                printf(&quot;æ ˆç©ºï¼Œæ— æ³•è·å–æ ˆé¡¶å…ƒç´ ï¼\\n&quot;);            &#125;        &#125;        else            printf(&quot;å‡ºæ ˆå¤±è´¥ï¼\\n&quot;);    &#125;    return 0;&#125;\n\nç‰¹ç‚¹ï¼šå…ˆå…¥åå‡ºï¼Œåå…¥å…ˆå‡º\nplaintext#include &lt;stdio.h&gt;#include &lt;stdlib.h&gt;#define MAXSIZE 100#define ERROR -1typedef struct&#123;    int *base; // æ ˆåº•æŒ‡é’ˆ    int *top; // æ ˆé¡¶æŒ‡é’ˆ    int stacksize; // æ ˆå¯ç”¨çš„æœ€å¤§å®¹é‡&#125;SqStack, *Stack;\n\n\nåˆå§‹åŒ–plaintext// åˆå§‹åŒ–Stack InitStack()&#123;    Stack s = (Stack)malloc(sizeof(SqStack));    if (s == NULL)    &#123;        printf(&quot;æ ˆå†…å­˜åˆ†é…å¤±è´¥ï¼\\n&quot;);        exit(1);    &#125;    // ä¸ºæ ˆåº•åˆ†é…å†…å­˜    s-&gt;base = (int *)malloc(MAXSIZE * sizeof(int));    if(s-&gt;base == NULL) &#123;        free(s);        printf(&quot;æ ˆå†…å­˜åˆ†é…å¤±è´¥ï¼\\n&quot;);        exit(1);    &#125;    s-&gt;top = s-&gt;base;    s-&gt;stacksize = MAXSIZE;    printf(&quot;æ ˆåˆå§‹åŒ–æˆåŠŸï¼\\n&quot;);    return s;&#125;\n\nå…¥æ ˆæ­¥éª¤ï¼š\n\nåˆ¤æ–­æ ˆæ˜¯å¦æ»¡ï¼ˆs-&gt;top - s-&gt;base &#x3D;&#x3D; 0ï¼‰\nå°†æ–°å…ƒç´ å‹å…¥æ ˆé¡¶ï¼Œæ ˆé¡¶æŒ‡é’ˆåŠ ä¸€\n\nplaintext// å…¥æ ˆint Push(Stack s, int e)&#123;    // æ’å…¥å…ƒç´ eä¸ºæ–°çš„æ ˆé¡¶å…ƒç´     if(s-&gt;top-s-&gt;base == s-&gt;stacksize)    &#123;        printf(&quot;æ ˆæ»¡ï¼\\n&quot;);        return ERROR;    &#125;    *s-&gt;top = e;    s-&gt;top++; // æ ˆé¡¶ä¸Šç§»    return 0;&#125;\n\nå‡ºæ ˆæ­¥éª¤ï¼š\n\nåˆ¤æ–­æ ˆæ˜¯å¦ä¸ºç©ºï¼ˆs-&gt;top &#x3D;&#x3D; s-&gt;baseï¼‰\næ ˆé¡¶æŒ‡é’ˆå‡ä¸€ï¼Œæ ˆé¡¶å…ƒç´ å‡ºæ ˆ\n\nplaintext// å‡ºæ ˆint Pop(Stack s, int *e)&#123;    if(s-&gt;top == s-&gt;base)    &#123;        printf(&quot;æ ˆç©ºï¼\\n&quot;);        return ERROR;    &#125;    s-&gt;top--; // æ ˆé¡¶æŒ‡é’ˆä¸‹ç§»    *e = *s-&gt;top; // æ ˆé¡¶å…ƒç´ èµ‹å€¼ç»™e    return 0;&#125;\n\nè·å–æ ˆé¡¶å…ƒç´ plaintext// å–æ ˆé¡¶å…ƒç´ int GetTop(Stack s, int *e)&#123;    // è¿”å›æ ˆé¡¶å…ƒç´ ï¼Œä¸ä¿®æ”¹æ ˆé¡¶æŒ‡é’ˆ    if(s-&gt;top != s-&gt;base) // å¦‚æœæ ˆéç©º    &#123;        *e = *(s-&gt;top - 1);        return 0;    &#125;    return ERROR;&#125;plaintext// å‡ºæ ˆ    for(int i = 0; i &lt; n; i++) &#123;        int e;        if(Pop(s, &amp;e) == 0)&#123;            printf(&quot;å‡ºæ ˆæˆåŠŸï¼Œå…ƒç´ ä¸º%d\\n&quot;,e);            int topElem;            if(GetTop(s, &amp;topElem) == 0) &#123;                printf(&quot;æ­¤æ—¶æ ˆé¡¶å…ƒç´ ä¸ºï¼š%d\\n&quot;, topElem);            &#125;            else &#123;                printf(&quot;æ ˆç©ºï¼Œæ— æ³•è·å–æ ˆé¡¶å…ƒç´ ï¼\\n&quot;);            &#125;        &#125;        else            printf(&quot;å‡ºæ ˆå¤±è´¥ï¼\\n&quot;);    &#125;\n\n\nå¾ªç¯é˜Ÿåˆ—çš„åŸºæœ¬æ“ä½œå®Œæ•´ä»£ç plaintext#include &lt;stdio.h&gt;#include &lt;stdlib.h&gt;#define MAXQSIZE 100#define ERROR -1typedef struct&#123;    int *base; // å­˜å‚¨ç©ºé—´åŸºåœ°å€    int front; // å¤´æŒ‡é’ˆ    int rear; // å°¾æŒ‡é’ˆ&#125;SqQueue, *Queue;// åˆå§‹åŒ–Queue InitQueue()&#123;    Queue q = (Queue)malloc(sizeof(SqQueue));    q-&gt;base = (Queue)malloc(MAXQSIZE * sizeof(SqQueue));    if(!q-&gt;base)    &#123;        printf(&quot;é˜Ÿåˆ—åˆå§‹åŒ–å¤±è´¥ï¼\\n&quot;);        exit(0);    &#125;    q-&gt;rear = 0;    q-&gt;front = q-&gt;rear;    return q;&#125;// æ±‚é˜Ÿåˆ—é•¿åº¦int QueueLength(Queue q)&#123;    // å¯¹äºéå¾ªç¯é˜Ÿåˆ—ï¼Œå·®å€¼å¯èƒ½ä¸ºè´Ÿæ•°ï¼Œæ‰€ä»¥éœ€è¦å’ŒMAXQSIZEæ±‚ä½™    return (q-&gt;rear - q-&gt;front + MAXQSIZE) % MAXQSIZE;&#125;// å…¥é˜Ÿint EnQueue(Queue q, int e)&#123;    if(( q-&gt;rear + 1 ) % MAXQSIZE == q-&gt;front)        return ERROR;    q-&gt;base[q-&gt;rear] = e; // æ–°å…ƒç´ æ’å…¥é˜Ÿå°¾    q-&gt;rear = (q-&gt;rear + 1) % MAXQSIZE; // é˜Ÿå°¾æŒ‡é’ˆåŠ 1    return 0;&#125;// å‡ºé˜Ÿint DeQueue(Queue q, int *e)&#123;    if( q-&gt;front == q-&gt;rear)        return ERROR;    *e = q-&gt;base[q-&gt;front]; // ä¿å­˜é˜Ÿå¤´å…ƒç´     q-&gt;front = (q-&gt;front + 1) % MAXQSIZE; // é˜Ÿå¤´æŒ‡é’ˆåŠ 1    return 0;&#125;// å–å¾ªç¯é˜Ÿåˆ—é˜Ÿå¤´å…ƒç´ int GetHead(Queue q)&#123;    if(q-&gt;front != q-&gt;rear)        return q-&gt;base[q-&gt;front];&#125;int main()&#123;    Queue q = InitQueue();    int n, e;    printf(&quot;è¯·è¾“å…¥é˜Ÿåˆ—çš„é•¿åº¦ï¼š&quot;);    scanf(&quot;%d&quot;, &amp;n);    for(int i = 0; i &lt; n; i++)    &#123;        printf(&quot;å…¥é˜Ÿå…ƒç´ ï¼š&quot;);        scanf(&quot;%d&quot;, &amp;e);        int result = EnQueue(q, e);        if(result == 0) &#123;            printf(&quot;æˆåŠŸå…¥é˜Ÿï¼\\n&quot;);            printf(&quot;æ­¤æ—¶é˜Ÿåˆ—é•¿åº¦ä¸ºï¼š%d\\n&quot;, QueueLength(q));        &#125;        else        &#123;            printf(&quot;å…¥é˜Ÿå¤±è´¥ï¼\\n&quot;);        &#125;    &#125;    printf(&quot;\\n\\n&quot;);    // å‡ºé˜Ÿ    for(int j = 0; j &lt; n; j++)    &#123;        if(DeQueue(q, &amp;e) == 0) &#123;            printf(&quot;æ­¤æ—¶é˜Ÿåˆ—é•¿åº¦ä¸ºï¼š%d\\n&quot;, QueueLength(q));            // æ˜¾ç¤ºå½“å‰é˜Ÿåˆ—å…ƒç´             int head = GetHead(q);            if(head != ERROR) &#123;                printf(&quot;å‡ºé˜Ÿå…ƒç´ ï¼š%d\\n&quot;, e);                printf(&quot;å½“å‰é˜Ÿå¤´å…ƒç´ ä¸ºï¼š%d\\n&quot;,head);                printf(&quot;\\n&quot;);            &#125;            else                printf(&quot;é˜Ÿåˆ—ä¸ºç©ºï¼Œæ— æ³•å–é˜Ÿå¤´å…ƒç´ ï¼\\n&quot;);        &#125;        else            printf(&quot;å‡ºé˜Ÿå¤±è´¥ï¼\\n&quot;);    &#125;    free(q-&gt;base);    free(q);    return 0;&#125;\n\nç‰¹ç‚¹ï¼šå…ˆå…¥å…ˆå‡ºï¼Œåå…¥åå‡º\nå¾ªç¯é˜Ÿåˆ—åˆ¤æ–­\né˜Ÿç©ºï¼šQ.front &#x3D; Q.rear\né˜Ÿæ»¡ï¼š(Q.rear + 1)%MAXSIZE &#x3D;&#x3D; Q.front\nå°‘ç”¨ä¸€ä¸ªå­˜å‚¨ä½ç½®ï¼Œçº¦å®šä¸€ä¸ªä½ç½®ä¸ºç©º\nç»“æ„ä½“\nplaintext#include &lt;stdio.h&gt;#include &lt;stdlib.h&gt;#define MAXQSIZE 100#define ERROR -1typedef struct&#123;    int *base; // å­˜å‚¨ç©ºé—´åŸºåœ°å€    int front; // å¤´æŒ‡é’ˆ    int rear; // å°¾æŒ‡é’ˆ&#125;SqQueue, *Queue;\n\nåˆå§‹åŒ–plaintext// åˆå§‹åŒ–Queue InitQueue()&#123;    Queue q = (Queue)malloc(sizeof(SqQueue));    q-&gt;base = (Queue)malloc(MAXQSIZE * sizeof(SqQueue));    if(!q-&gt;base)    &#123;        printf(&quot;é˜Ÿåˆ—åˆå§‹åŒ–å¤±è´¥ï¼\\n&quot;);        exit(0);    &#125;    q-&gt;rear = 0;    q-&gt;front = q-&gt;rear;    return q;&#125;\n\næ±‚é˜Ÿåˆ—é•¿åº¦å¯¹äºéå¾ªç¯é˜Ÿåˆ—ï¼Œå·®å€¼å¯èƒ½ä¸ºè´Ÿæ•°ï¼Œæ‰€ä»¥éœ€è¦å’ŒMAXQSIZEæ±‚ä½™\nplaintext// æ±‚é˜Ÿåˆ—é•¿åº¦int QueueLength(Queue q)&#123;    // å¯¹äºéå¾ªç¯é˜Ÿåˆ—ï¼Œå·®å€¼å¯èƒ½ä¸ºè´Ÿæ•°ï¼Œæ‰€ä»¥éœ€è¦å’ŒMAXQSIZEæ±‚ä½™    return (q-&gt;rear - q-&gt;front + MAXQSIZE) % MAXQSIZE;&#125;\n\nå…¥é˜Ÿæ­¥éª¤ï¼š\n\nåˆ¤æ–­é˜Ÿåˆ—æ˜¯å¦ä¸ºæ»¡\nå°†æ–°å…ƒç´ æ’å…¥é˜Ÿå°¾\né˜Ÿå°¾æŒ‡é’ˆåŠ 1ï¼ˆq-&gt;rear + 1ï¼‰ % MAXSIZE\n\nplaintext// å…¥é˜Ÿint EnQueue(Queue q, int e)&#123;    if(( q-&gt;rear + 1 ) % MAXQSIZE == q-&gt;front)        return ERROR;    q-&gt;base[q-&gt;rear] = e; // æ–°å…ƒç´ æ’å…¥é˜Ÿå°¾    q-&gt;rear = (q-&gt;rear + 1) % MAXQSIZE; // é˜Ÿå°¾æŒ‡é’ˆåŠ 1    return 0;&#125;\n\nå‡ºé˜Ÿæ­¥éª¤ï¼š\n\nåˆ¤æ–­é˜Ÿç©º\nä¿å­˜é˜Ÿå¤´å…ƒç´ \né˜Ÿå¤´æŒ‡é’ˆåŠ 1\n\nplaintext// å‡ºé˜Ÿint DeQueue(Queue q, int *e)&#123;    if( q-&gt;front == q-&gt;rear)        return ERROR;    *e = q-&gt;base[q-&gt;front]; // ä¿å­˜é˜Ÿå¤´å…ƒç´     q-&gt;front = (q-&gt;front + 1) % MAXQSIZE; // é˜Ÿå¤´æŒ‡é’ˆåŠ 1    return 0;&#125;\n\nå–é˜Ÿå¤´å…ƒç´ plaintext// å–å¾ªç¯é˜Ÿåˆ—é˜Ÿå¤´å…ƒç´ int GetHead(Queue q)&#123;    if(q-&gt;front != q-&gt;rear)        return q-&gt;base[q-&gt;front];&#125;\n\n\næ ‘å’ŒäºŒå‰æ ‘æ ‘çš„åŸºæœ¬æœ¯è¯­\n\nç»“ç‚¹ï¼šæ ‘ä¸­çš„ä¸€ä¸ªç‹¬ç«‹å•å…ƒã€‚ä¾‹å¦‚A B C D\n\nç»“ç‚¹çš„åº¦ï¼šç»“ç‚¹æ‹¥æœ‰çš„å­æ ‘æ•°ã€‚ä¾‹å¦‚Açš„åº¦ä¸º3ï¼ŒCçš„åº¦ä¸º1\n\næ ‘çš„åº¦ï¼šæ ‘å†…å„ç»“ç‚¹åº¦çš„æœ€å¤§å€¼ã€‚\nåº¦ä¸º3ï¼Œä¸å«æ ¹èŠ‚ç‚¹\n\nå¶å­ï¼šåº¦ä¸º0çš„ç»“ç‚¹ã€‚ç»“ç‚¹K L F G M I Jéƒ½æ˜¯å¶å­\n\néç»ˆç«¯ç»“ç‚¹ï¼šåº¦ä¸ä¸º0çš„ç»“ç‚¹ã€‚\nå†…éƒ¨èŠ‚ç‚¹\n\nåŒäº²å’Œå­©å­ï¼šç»“ç‚¹çš„å­æ ‘çš„æ ¹ç§°ä¸ºè¯¥ç»“ç‚¹çš„å­©å­ï¼Œè¯¥ç»“ç‚¹ç§°ä¸ºå­©å­çš„åŒäº²ã€‚ä¾‹å¦‚Bçš„åŒäº²ä¸ºAï¼ŒBçš„å­©å­æœ‰Eå’ŒF\n\nå…„å¼Ÿï¼šåŒä¸€ä¸ªåŒäº²çš„å­©å­ä¹‹é—´äº’ç§°å…„å¼Ÿã€‚\nä¾‹å¦‚H I Jäº’ä¸ºå…„å¼Ÿ\n\nç¥–å…ˆï¼šä»æ ¹åˆ°è¯¥ç»“ç‚¹æ‰€ç»åˆ†æ”¯ä¸Šçš„æ‰€æœ‰èŠ‚ç‚¹ã€‚ä¾‹å¦‚Mçš„ç¥–å…ˆä¸ºH D A\n\nå­å­™ï¼šä»¥æŸç»“ç‚¹ä¸ºæ ¹çš„å­æ ‘ä¸­çš„ä»»æ„ä¸€ä¸ªç»“ç‚¹éƒ½ç§°ä¸ºè¯¥ç»“ç‚¹çš„å­å­™ã€‚ä¾‹å¦‚Bçš„å­å­™ä¸ºE K L\n\nå±‚æ¬¡ï¼šç»“ç‚¹çš„å±‚æ¬¡ä»æ ¹å¼€å§‹å®šä¹‰ï¼Œæ ¹ä¸ºç¬¬ä¸€å±‚ï¼Œæ ¹çš„å­©å­ä¸ºç¬¬äºŒå±‚ã€‚æ ‘ä¸­ä»»ä¸€ç»“ç‚¹çš„å±‚æ¬¡ç­‰äºå…¶åŒäº²ç»“ç‚¹çš„å±‚æ¬¡åŠ ä¸€ã€‚\n\nå ‚å…„å¼Ÿï¼šåŒäº²åœ¨åŒä¸€å±‚çš„ç»“ç‚¹äº’ä¸ºå ‚å…„å¼Ÿã€‚ä¾‹å¦‚Gä¸E F H I Jäº’ä¸ºå ‚å…„å¼Ÿ\n\næ ‘çš„æ·±åº¦ï¼šæ ‘ä¸­ç»“ç‚¹çš„æœ€å¤§å±‚æ¬¡ã€‚ä¾‹å¦‚å›¾ä¸­çš„æ·±åº¦ä¸º4\n\næœ‰åºæ ‘å’Œæ— åºæ ‘ï¼šå¦‚æœå°†æ ‘ä¸­ç»“ç‚¹çš„å„ä¸ªå­æ ‘çœ‹æˆä»å·¦åˆ°å³æ˜¯æœ‰æ¬¡åºçš„ï¼ˆå³ä¸èƒ½äº’æ¢ï¼‰ï¼Œåˆ™ç§°è¯¥æ ‘ä¸ºæœ‰åºæ ‘ï¼Œå¦åˆ™ä¸ºæ— åºæ ‘ã€‚åœ¨æœ‰åºæ ‘ä¸­æœ€å·¦è¾¹å­æ ‘çš„æ ¹ç§°ä¸ºç¬¬ä¸€ä¸ªå­©å­ï¼Œæœ€å³è¾¹ç§°ä¸ºæœ€åä¸€ä¸ªå­©å­\n\næ£®æ—ï¼šæ˜¯mæ£µäº’ä¸ç›¸äº¤çš„æ ‘çš„é›†åˆã€‚å¯¹æ ‘ä¸­æ¯ä¸ªç»“ç‚¹è€Œè¨€ï¼Œå…¶å­æ ‘çš„é›†åˆå³ä¸ºæ£®æ—ã€‚\n\n\näºŒå‰æ ‘æ€§è´¨\nåœ¨äºŒå‰æ ‘çš„ç¬¬iå±‚ä¸Šè‡³å¤šæœ‰2^(i-1)ä¸ªç»“ç‚¹ï¼ˆi &gt;&#x3D; 1ï¼‰\n\næ·±åº¦ä¸ºkçš„äºŒå‰æ ‘è‡³å¤šæœ‰2^k - 1ä¸ªç»“ç‚¹\n\nå¯¹ä»»ä½•ä¸€ä¸ªäºŒå‰æ ‘Tï¼Œå¦‚æœå…¶ç»ˆç«¯ç»“ç‚¹æ•°ä¸ºn0ï¼Œåº¦ä¸º2çš„ç»“ç‚¹æ•°ä¸ºn2ï¼Œåˆ™n0 &#x3D; n2 + 1\n\nå…·æœ‰nä¸ªç»“ç‚¹çš„å®Œå…¨äºŒå‰æ ‘çš„æ·±åº¦ä¸º(ä¸å¤§äºlog2nçš„æœ€å¤§æ•´æ•° + 1)\n\nå¦‚æœå¯¹ä¸€æ£µæœ‰nä¸ªç»“ç‚¹çš„å®Œå…¨äºŒå‰æ ‘ï¼ˆå…¶æ·±åº¦ä¸ºä¸å¤§äºlog2nçš„æœ€å¤§æ•´æ•° + 1ï¼‰çš„ç»“ç‚¹æŒ‰å±‚æ¬¡ç¼–å·ï¼ˆä»ç¬¬1å±‚åˆ°ç¬¬ä¸å¤§äºlog2nçš„æœ€å¤§æ•´æ•° + 1å±‚ï¼Œæ¯å±‚ä»å·¦åˆ°å³ï¼‰ï¼Œåˆ™å¯¹ä»»ä¸€ç»“ç‚¹iï¼ˆ 1 &lt;&#x3D; i &lt;&#x3D; n ï¼‰ï¼Œæœ‰\nå¦‚æœiä¸º1ï¼Œåˆ™ç»“ç‚¹iæ˜¯äºŒå‰æ ‘çš„æ ¹ï¼Œæ— åŒäº²ï¼›å¦‚æœi &gt; 1, åˆ™å…¶åŒäº²PARENT[i]æ˜¯ä¸å¤§äºi&#x2F;2çš„æœ€å¤§æ•´æ•°\nå¦‚æœ2i &gt; nï¼Œåˆ™ç»“ç‚¹iæ— å·¦å­©å­ï¼›å¦åˆ™å…¶å·¦å­©å­LCHILD(i)æ˜¯ç»“ç‚¹2i\nå¦‚æœ2i + 1 &gt; n, åˆ™ç»“ç‚¹iæ— å³å­©å­ï¼›å¦åˆ™å…¶å³å­©å­RCHILD(i)æ˜¯ç»“ç‚¹2i + 1\n\n\næ»¡äºŒå‰æ ‘ï¼šæ·±åº¦ä¸ºkä¸”å«æœ‰2^k - 1ä¸ªç»“ç‚¹çš„äºŒå‰æ ‘ã€‚æ¯ä¸€å±‚ä¸Šçš„ç»“ç‚¹æ•°éƒ½æ˜¯æœ€å¤§çš„ç»“ç‚¹æ•°\nå®Œå…¨äºŒå‰æ ‘ï¼šæ·±åº¦ä¸ºkçš„ï¼Œæœ‰nä¸ªç»“ç‚¹çš„äºŒå‰æ ‘ã€‚\nç‰¹ç‚¹æ˜¯ï¼š\n\nå¶å­ç»“ç‚¹åªå¯èƒ½åœ¨å±‚æ¬¡æœ€å¤§çš„ä¸¤å±‚å‡ºç°\nå¯¹ä»»ä¸€ç»“ç‚¹ï¼Œè‹¥å…¶å³åˆ†æ”¯ä¸‹çš„å­å­™çš„æœ€å¤§å±‚æ¬¡ä¸ºlï¼Œåˆ™å…¶å·¦åˆ†æ”¯ä¸‹çš„å­å­™çš„æœ€å¤§å±‚æ¬¡å¿…ä¸ºlæˆ–l + 1\n\n\n","categories":["CS"],"tags":["CS"]},{"title":"çº¢å²©æ‰“å°å§¬å¤æ´»è®°å½•","url":"/2025/12/08/%E7%BA%A2%E5%B2%A9%E6%89%93%E5%8D%B0%E5%A7%AC%E5%A4%8D%E6%B4%BB%E8%AE%B0%E5%BD%95/","content":"ä¸‹é¢è®°å½•ä¸€ä¸‹åœ¨å¤æ´»ç½‘æ ¡æ‰“å°æœºæœºå™¨äºº-çº¢å²©æ‰“å°å§¬æ—¶é‡åˆ°çš„é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆ\nåšå‡ºçš„æ›´æ–°1.ä½¿ç”¨äº†Helemet-CIè¿›è¡Œé•œåƒæ‰“åŒ…\n2.æ›´æ”¹äº†Dockerfileçš„å†…å®¹ï¼Œä½¿é•œåƒå¯ä»¥å¿«é€Ÿä¸”æ­£ç¡®çš„è¢«æ‰“åŒ…\n3.ç”±äºé£ä¹¦æ¥æ”¶æ¶ˆæ¯æ¥å£çš„jsonæ¥æ”¶ä½“å‘ç”Ÿäº†æ”¹å˜ï¼Œå¯¹reply.pyä¸­çš„file_nameã€file_keyå’Œimage_keyä¸‰ä¸ªå˜é‡çš„è·å–é€ æˆäº†å½±å“ï¼Œä½¿ç”¨json.loads()å‡½æ•°è§£å†³\n1.è¯»å–ç¯å¢ƒå˜é‡é—®é¢˜æœºå™¨äººé€šè¿‡configmapè¯»å–app_idï¼Œapp_secretç­‰ç¯å¢ƒå˜é‡ï¼Œæ²¡æœ‰configmapçš„è¯æœºå™¨äººä¼šæŠ¥ä»¥ä¸‹é”™è¯¯\nTraceback (most recent call last):  File &quot;/nonebot/bot.py&quot;, line 22, in &lt;module&gt;    driver.register_adapter(FeishuAdapter)  File &quot;/usr/local/lib/python3.10/dist-packages/nonebot/internal/driver/abstract.py&quot;, line 77, in register_adapter    self._adapters[name] = adapter(self, **kwargs)  File &quot;/usr/local/lib/python3.10/dist-packages/nonebot/adapters/feishu/adapter.py&quot;, line 46, in __init__    self.feishu_config: Config = Config(**self.config.dict())  File &quot;pydantic/main.py&quot;, line 341, in pydantic.main.BaseModel.__init__pydantic.error_wrappers.ValidationError: 1 validation error for Configfeishu_bots  value is not a valid list (type=type_error.list)\n\næç¤ºfeishu_botsä¸æ˜¯ä¸€ä¸ªæœ‰æ•ˆåˆ—è¡¨ï¼Œæ„å‘³ç€æœºå™¨äººæœªè¯»å–åˆ°configmapé‡Œçš„ç¯å¢ƒå˜é‡\nåœ¨éƒ¨ç½²æ—¶ä¹Ÿä¸èƒ½ç›´æ¥æŠŠè¿™äº›ç¯å¢ƒå˜é‡ç›´æ¥æ˜æ–‡å¡«å†™åœ¨.env.prodä¸­\n2.Dockerfileçš„ä¿®æ”¹2.1 aptæ¢æºé—®é¢˜æœ€å¼€å§‹çš„Dockerfileä½¿ç”¨äº†python:slimé•œåƒï¼Œå¯¼è‡´åœ¨æ‰§è¡Œapt-get updateå‘½ä»¤æ—¶å¼‚å¸¸çš„æ…¢\nå¹¶ä¸”åœ¨è¿™ä¸ªé•œåƒï¼ˆdebiané•œåƒä¹Ÿæ˜¯ï¼‰ä¸­ä¸èƒ½æ›´æ”¹é•œåƒæºï¼Œä¼šæç¤º\n\näºæ˜¯æ›´æ”¹ä¸º\nFROM ubuntu:22.04\n\nä½¿ç”¨sedå‘½ä»¤æ›´æ”¹é•œåƒæºä¸ºæ¸…åæº\nRUN sed -i &#x27;s/archive.ubuntu.com/mirrors.tuna.tsinghua.edu.cn/g&#x27; /etc/apt/sources.list   \n\n2.2 pipæ¢æºé—®é¢˜æœ€å¼€å§‹çš„Dockerfileä¸­çš„æ‰€æœ‰pip installå‡æœªæŒ‡å®šæºï¼Œç»å¸¸ä¼šå‡ºç°ç½‘ç»œé—®é¢˜\n\näºæ˜¯æˆ‘å‘æ‰€æœ‰pipéƒ½æŒ‡å®šäº†æº\nä½¿ç”¨pipx install nb-cliç»å¸¸å‡ºç°ç½‘ç»œé—®é¢˜\n\npipx æ˜¯ä¸€ä¸ªè‡ªç”±å¼€æºç¨‹åºï¼Œå…è®¸ä½ åœ¨éš”ç¦»çš„è™šæ‹Ÿç¯å¢ƒä¸­å®‰è£…å’Œè¿è¡Œ Python åº”ç”¨ã€‚\n\n\nä½¿ç”¨pip install nb-cli -i https://pypi.tuna.tsinghua.edu.cn/simpleå³å¯è§£å†³\n2.3 æœªæ‰¾åˆ°nbå‘½ä»¤/bin/sh: 1: /root/.local/bin/nb: not found\n\nåœ¨Dockerfileä¸­\nCMD which nb\n\nå³å¯æ˜¾ç¤ºæ­£ç¡®çš„nbä½ç½®\n3.IngressRouteè¯·æ±‚è·¯å¾„ä¸‹åˆ’çº¿é—®é¢˜åœ¨IngressRouteä¸­ï¼Œè¯·æ±‚è·¯å¾„æœ€åçš„ä¸‹åˆ’çº¿ä¼šå½±å“è§£æ\n\nåœ¨æœ¬å®ä¾‹ä¸­ï¼Œä¸åŠ ä¸‹åˆ’çº¿æ‰èƒ½è¢«æ­£ç¡®è§£æ\n\n4.é£ä¹¦æ¥æ”¶æ¶ˆæ¯æ¥æ”¶ä½“æ”¹å˜å½±å“å˜é‡é—®é¢˜é£ä¹¦æ¥æ”¶æ¶ˆæ¯jsonæ¥æ”¶ä½“ç»“æ„å¦‚ä¸‹\n&#123;    &quot;schema&quot;: &quot;2.0&quot;,    &quot;header&quot;: &#123;        &quot;event_id&quot;: &quot;56dc6536843b7bd94680cf2af1c8791&quot;,        &quot;token&quot;: &quot;aJ2XlWEC5uNfiaQMzaNUCbFMeIW28828&quot;,        &quot;create_time&quot;: &quot;1698134093609&quot;,        &quot;event_type&quot;: &quot;im.message.receive_v1&quot;,        &quot;tenant_key&quot;: &quot;17cf1f7e2f06d758&quot;,        &quot;app_id&quot;: &quot;cli_a42011585561100d&quot;    &#125;,    &quot;event&quot;: &#123;        &quot;message&quot;: &#123;            &quot;chat_id&quot;: &quot;oc_8b46f745993928bcfe0f23fe30cee4d0&quot;,            &quot;chat_type&quot;: &quot;p2p&quot;,            &quot;content&quot;: &quot;&#123;\\&quot;file_key\\&quot;:\\&quot;file_v2_718639f3-fbf7-4a12-8ff3-56ea16b1d4ag\\&quot;,\\&quot;file_name\\&quot;:\\&quot;a.pdf\\&quot;&#125;&quot;,            &quot;create_time&quot;: &quot;1698134093362&quot;,            &quot;message_id&quot;: &quot;om_3fb62cafecae381509e6e36eeb2f5cc3&quot;,            &quot;message_type&quot;: &quot;file&quot;,            &quot;update_time&quot;: &quot;1698134093362&quot;        &#125;,        &quot;sender&quot;: &#123;            &quot;sender_id&quot;: &#123;                &quot;open_id&quot;: &quot;ou_b7f2f10f337267948c94258ab8c684e&quot;,                &quot;union_id&quot;: &quot;on_01a1d695ec162830a027295516386bdc&quot;,                &quot;user_id&quot;: &quot;9a8cfgee&quot;            &#125;,            &quot;sender_type&quot;: &quot;user&quot;,            &quot;tenant_key&quot;: &quot;17cf1f7e2f06d758&quot;        &#125;    &#125;&#125;\n\nå¯¹åŸå…ˆreply.pyä¸­file_nameã€file_keyå’Œimage_keyä¸‰ä¸ªå˜é‡çš„è·å–é€ æˆäº†å½±å“\n\nç°é€šè¿‡json.loads()å‡½æ•°é‡æ–°æå–è¿™ä¸‰ä¸ªå˜é‡ï¼Œå…¶ä»–åŒç†\neä¸ºæ•´ä¸ªæ¥æ”¶ä½“çš„å†…å®¹ï¼Œeventä¸ºeventçš„å†…å®¹ï¼Œå…¶ä»–åŒç†\n\n","categories":["Trouble Shooting"],"tags":["Trouble Shooting"]},{"title":"æ ¸å¿ƒåŠŸèƒ½æ¨¡å—","url":"/2025/12/08/%E6%A0%B8%E5%BF%83%E5%8A%9F%E8%83%BD%E6%A8%A1%E5%9D%97/","content":"ä»‹ç»controlleræ˜¯IPBlock-Operator-Plusçš„æ ¸å¿ƒæ¨¡å—ï¼Œåœ¨ipblock_controller.goâ€‹ä¸­å®ç°ã€‚å®ƒè´Ÿè´£æ ¸å¿ƒä¸šåŠ¡é€»è¾‘çš„è°ƒåº¦å’Œåè°ƒï¼Œç›‘å¬ Kubernetes ä¸­ IPBlock è‡ªå®šä¹‰èµ„æºçš„å˜åŒ–ï¼Œç»´æŠ¤å’Œç®¡ç†å…¶ç”Ÿå‘½å‘¨æœŸã€‚å®ƒæ˜¯æ•´ä¸ªé¡¹ç›®çš„æ ¸å¿ƒéƒ¨åˆ†ï¼Œåè°ƒå„ä¸ªæ¨¡å—ååŒå·¥ä½œã€‚\nReconcileï¼ˆè°ƒå’Œã€åè°ƒã€è§£å†³å†²çªï¼‰â€‹æ˜¯Kubernetes Operatorçš„æ ¸å¿ƒæ–¹æ³•ï¼Œç”¨äºé©±åŠ¨èµ„æºçš„çŠ¶æ€çš„æœŸæœ›ä¸€è‡´æ€§ï¼Œè¿™ä¹Ÿæ˜¯Kubernetes controllerçš„æ ¸å¿ƒç†å¿µä¸ä»»åŠ¡ã€‚å¯¹äºIPBlock-Operator-Plusè€Œè¨€ï¼Œå®ƒçš„ä»»åŠ¡å°±æ˜¯å¤„ç†æ¯ä¸€ä¸ªIPBlockâ€‹å¯¹è±¡çš„çŠ¶æ€å˜æ›´ã€è§¦å‘åŠ¨ä½œä»¥åŠæ›´æ–°çŠ¶æ€å­—æ®µï¼ˆStatusï¼‰ç­‰æ ¸å¿ƒé€»è¾‘ã€‚\nç»“æ„å®šä¹‰IPBlockReconcilerâ€‹æ¥å£å®šä¹‰\ntype IPBlockReconciler struct &#123;\tclient.Client                      // å®¢æˆ·ç«¯é€šä¿¡\tScheme        *runtime.Scheme      // åºåˆ—åŒ–å’Œååºåˆ—åŒ–\tRecorder      record.EventRecorder // Eventè®°å½•å™¨\tAdapter       engine.Adapter       // å°ç¦é€‚é…å™¨æ¥å£\tAdapterName   string\tGatewayHost   string\tCmName        string\tCmNamespace   string\tWhitelist     *policy.Whitelist // ConfigMapè¯»å–\tmu            sync.RWMutex      // è¯»å†™é”\tNotifier      notify.Notifier   // é€šçŸ¥æ¥å£&#125;\n\nipblock_controller.goâ€‹ä¸­å®ç°çš„å‡½æ•°ï¼Œå¦‚ä¸‹ï¼š\n// å¤„ç†CRDå„ç§äº‹ä»¶çš„å…·ä½“ä¸šåŠ¡é€»è¾‘, reqåŒ…å«æ ‡è¯†å½“å‰å¯¹è±¡çš„ä¿¡æ¯ï¼šåç§°å’Œå‘½åç©ºé—´// ctrl æ˜¯ controller-runtimeçš„ä¸»å…¥å£åŒ…// ctrl.Request è¡¨ç¤ºæ§åˆ¶å™¨éœ€è¦å¤„ç†çš„èµ„æºå¯¹è±¡æ ‡è¯†ï¼Œä¹Ÿå°±æ˜¯å“ªä¸ªèµ„æºè¦ Reconcile// ctrl.Result æ§åˆ¶æ˜¯å¦éœ€è¦é‡æ–°æ’é˜Ÿæ‰§è¡Œè¯¥èµ„æºï¼Œä¹Ÿå°±æ˜¯æ˜¯å¦éœ€è¦å†æ¬¡æ‰§è¡Œfunc (r *IPBlockReconciler) Reconcile(ctx context.Context, req ctrl.Request) (ctrl.Result, error) &#123;&#125;// è®¡ç®—å½“å‰Specçš„Hashfunc HashSpec(spec opsv1.IPBlockSpec) (string, error) &#123;&#125;// ç”¨äºè§£å†³å¯¹è±¡ç‰ˆæœ¬å†²çªå¼•å‘çš„æ›´æ–°é—®é¢˜func (r *IPBlockReconciler) UpdateIPBlockStatus(ctx context.Context, ipblock *opsv1.IPBlock, updateFn func(*opsv1.IPBlock)) (*opsv1.IPBlock, error) &#123;&#125;// å®šæ—¶è§£å°func (r *IPBlockReconciler) scheduleAutoUnblock(ipblock *opsv1.IPBlock) &#123;&#125;// å¹¶å‘å®‰å…¨ï¼Œé€šè¿‡é”æ¥æ›´æ–°ç™½åå•func (r *IPBlockReconciler) UpdateWhitelist(wl *policy.Whitelist) &#123;&#125;// å¹¶å‘å®‰å…¨ï¼Œé€šè¿‡é”æ¥æ›´æ–°GatewayHostfunc (r *IPBlockReconciler) UpdateGatewayHost(newHost string) &#123;&#125;\n\nå­—æ®µå®šä¹‰IPBlockå®šä¹‰\ntype IPBlock struct &#123;\tmetav1.TypeMeta   `json:&quot;,inline&quot;`\tmetav1.ObjectMeta `json:&quot;metadata,omitempty&quot;`\tSpec   IPBlockSpec   `json:&quot;spec,omitempty&quot;`\tStatus IPBlockStatus `json:&quot;status,omitempty&quot;`&#125;// Spec// å°ç¦è¯·æ±‚type IPBlockSpec struct &#123;\t// INSERT ADDITIONAL SPEC FIELDS - desired state of cluster\t// Important: Run &quot;make&quot; to regenerate code after modifying this file\t// Foo is an example field of IPBlock. Edit ipblock_types.go to remove/update\tFoo      string   `json:&quot;foo,omitempty&quot;`\tIP       string   `json:&quot;ip&quot;`                 // ç›®æ ‡IP\tReason   string   `json:&quot;reason,omitempty&quot;`   // å°ç¦åŸå› \tSource   string   `json:&quot;source,omitempty&quot;`   // å°ç¦æ¥æºï¼Œå¦‚ &quot;alertmanager&quot;ã€&quot;manual&quot;ã€&quot;webhook&quot;ï¼Œä¾¿äºè¿½è¸ª\tBy       string   `json:&quot;by,omitempty&quot;`       // è°è§¦å‘çš„å°ç¦\tDuration string   `json:&quot;duration,omitempty&quot;` // å°ç¦æŒç»­æ—¶é—´\tTags     []string `json:&quot;tags,omitempty&quot;`     // å…³é”®è¯ç­›é€‰\tUnblock  bool     `json:&quot;unblock,omitempty&quot;`  // ç”¨æˆ·æ˜¾å¼è§£å°\tTrigger  bool     `json:&quot;trigger,omitempty&quot;`  // ç”¨æˆ·æ˜¾å¼è¯·æ±‚é‡æ–°å°ç¦&#125;// Status// å°ç¦çŠ¶æ€type IPBlockStatus struct &#123;\t// INSERT ADDITIONAL STATUS FIELD - define observed state of cluster\t// Important: Run &quot;make&quot; to regenerate code after modifying this file\tResult       string `json:&quot;result,omitempty&quot;` // success, failed, unblocked\tPhase        string `json:&quot;phase,omitempty&quot;`  // pending, active, expired\tBlockedAt    string `json:&quot;blockedAt,omitempty&quot;`\tUnblockedAt  string `json:&quot;unblockedAt,omitempty&quot;`\tMessage      string `json:&quot;message,omitempty&quot;`\tLastSpecHash string `json:&quot;lastSpecHash,omitempty&quot;`&#125;\n\nçŠ¶æ€æœºphasephaseç”¨æ¥æ ‡è¯† IP çŠ¶æ€é˜¶æ®µ\n\n\n\nPhase\nå«ä¹‰è¯´æ˜\n\n\n\nâ€‹pendingâ€‹\nåˆå§‹åŒ–é˜¶æ®µï¼ˆé»˜è®¤å€¼ï¼‰\n\n\nâ€‹activeâ€‹\nå·²å°ç¦çŠ¶æ€\n\n\nâ€‹expiredâ€‹\nå·²è§£å°ï¼ˆè‡ªåŠ¨æˆ–æ‰‹åŠ¨ï¼‰\n\n\nâ€‹skippedâ€‹\nè·³è¿‡ï¼ˆå¦‚ç™½åå•å‘½ä¸­ï¼‰\n\n\nâ€‹failedâ€‹\næ“ä½œå¤±è´¥ï¼Œå¦‚å°ç¦å¤±è´¥ã€éæ³•é…ç½®ç­‰\n\n\n\nçŠ¶æ€æµè½¬é€»è¾‘è¯´æ˜åˆå§‹çŠ¶æ€ï¼špendingâ€‹\nåˆ›å»ºæ—¶è®¾ä¸º pendingâ€‹\n\nè‹¥å‘½ä¸­ç™½åå• â†’ è®¾ä¸º skippedâ€‹\n\nè‹¥æœªå‘½ä¸­ç™½åå•ï¼Œå°è¯•å°ç¦ï¼š\n\næˆåŠŸ â†’ activeâ€‹\nå¤±è´¥ â†’ failedâ€‹\n\n\n\nç™½åå•çŠ¶æ€ï¼šskippedâ€‹\nè¡¨ç¤ºå·²è·³è¿‡å¤„ç†\nå¹‚ç­‰é€»è¾‘ä¸‹è·³è¿‡æ‰§è¡Œï¼ˆä¸é‡å¤å°ç¦ï¼‰\n\nå°ç¦ä¸­çŠ¶æ€ï¼šactiveâ€‹\nè¡¨ç¤º IP å½“å‰å·²å°ç¦\nè‹¥è®¾å®š Durationâ€‹ ä¸”æœªè¿‡æœŸ â†’ ç­‰å¾…æ—¶é—´ç»“æŸåç”± goroutine è°ƒç”¨ scheduleAutoUnblockâ€‹ è§£å° â†’ expiredâ€‹\nè‹¥æ‰‹åŠ¨è§¦å‘ Spec.Trigger = trueâ€‹ â†’ é‡æ–°æ‰§è¡Œå°ç¦æµç¨‹\nè‹¥æ‰‹åŠ¨è®¾ç½® Spec.Unblock = trueâ€‹ â†’ æ‰§è¡Œè§£å°æ“ä½œ â†’ expiredâ€‹\n\nå·²è§£å°çŠ¶æ€ï¼šexpiredâ€‹\nè§£å°æˆåŠŸåè®¾ç½®ä¸º expiredâ€‹\nè¡¨ç¤ºèµ„æºç”Ÿå‘½å‘¨æœŸå·²é—­ç¯ï¼ˆå¯ç•™å¾… GCï¼‰\n\nå¤±è´¥çŠ¶æ€ï¼šfailedâ€‹\nå°ç¦å¤±è´¥æˆ–éæ³•é…ç½®ï¼ˆå¦‚ durationâ€‹ è§£æå¤±è´¥ï¼‰\nå†™å…¥ .Status.Result = failedâ€‹ï¼Œå¹¶é€šè¿‡ notifier é€šçŸ¥é”™è¯¯\n\nresult\n\n\nResult å€¼\nå«ä¹‰\n\n\n\nâ€‹successâ€‹\næ“ä½œæˆåŠŸï¼ˆå°ç¦æˆ–è§£å°æˆåŠŸï¼‰\n\n\nâ€‹failedâ€‹\næ“ä½œå¤±è´¥ï¼ˆå°ç¦æˆ–è§£å°å¤±è´¥ï¼‰\n\n\nâ€‹unblockedâ€‹\nå·²è§£å°ï¼ˆé€šå¸¸å¯¹åº”è§£å°åŠ¨ä½œå®Œæˆï¼‰\n\n\nâ€‹skippedâ€‹\nè·³è¿‡æ“ä½œï¼ˆå¦‚ç™½åå•ã€é‡å¤è·³è¿‡ï¼‰\n\n\nï¼ˆç©ºå­—ç¬¦ä¸²ï¼‰\nå°šæœªæ‰§è¡Œæ“ä½œæˆ–åˆå§‹çŠ¶æ€\n\n\n\nReconcileå…·ä½“å®ç°reconcileä¸»è¦åšäº†äº”ä»¶äº‹ï¼š\n\nå¦‚æœæœ‰æ‰‹åŠ¨è§£å°ï¼Œä¼˜å…ˆå¤„ç†\nç™½åå•è·³è¿‡ï¼ˆåªåœ¨é trigger æƒ…å†µä¸‹åˆ¤æ–­ï¼‰\næ‰‹åŠ¨å¼ºåˆ¶å°ç¦\nå¹‚ç­‰åˆ¤æ–­ï¼ˆçŠ¶æ€æ— å˜åŒ– + æœªè§¦å‘ï¼‰\nå°ç¦æ“ä½œ\n\næ‰‹åŠ¨è§£å°å¤„ç†\nspecâ€‹ è¡¨ç¤ºç”¨æˆ·æœŸæœ›çš„çŠ¶æ€ï¼Œï¼ˆæƒ³è¦ä»€ä¹ˆï¼‰â€‹statusâ€‹ è¡¨ç¤ºæ§åˆ¶å™¨è§‚å¯Ÿåˆ°çš„å®é™…çŠ¶æ€ã€‚ï¼ˆç°åœ¨æ˜¯ä»€ä¹ˆï¼‰\nå¤§è‡´æµç¨‹æ˜¯ï¼š\n\nè¯»å–spec.Unblock == trueâ€‹ï¼Œè¡¨æ˜ç”¨æˆ·æ„å›¾è¦è§£å°\næ‰§è¡Œè§£å°é€»è¾‘ â€”â€”&gt; è§£å°æˆåŠŸ\næ›´æ–°status.result == unblockedâ€‹ï¼Œè®°å½•äº†è§£å°å®Œæˆ\nç„¶åè¦æŠŠspec.unblockâ€‹æ›´æ–°ä¸ºfalseâ€‹ï¼Œå¦åˆ™ä¸‹æ¬¡Reconcileåˆä¼šé‡å¤è§£å°ï¼Œé€ æˆæ··ä¹±\n\n\nä¸»è¦åœ¨åˆ¤æ–­unblockedâ€‹æ˜¯å¦ä¸ºtrueâ€‹ã€‚\né¢„å¤„ç†ï¼š\né¦–å…ˆéœ€è¦é€šè¿‡r.Getâ€‹å»é›†ç¾¤ä¸­è·å–åä¸º req.Nameâ€‹ çš„ IPBlockâ€‹ èµ„æºï¼Œçœ‹çœ‹æœ‰æ²¡æœ‰è¿™ä¸ªèµ„æºã€‚\næœ‰çš„è¯åˆå§‹åŒ–phaseâ€‹ä¸ºpendingâ€‹ï¼Œä½¿ç”¨r.Updateâ€‹æ¥æ›´æ–°ã€‚\næ‰‹åŠ¨è§£å°åˆ¤æ–­ï¼š\né¦–å…ˆåˆ¤æ–­å½“å‰èµ„æºçš„resultâ€‹æ˜¯ä¸æ˜¯unblockedâ€‹ï¼Œæ˜¯çš„è¯è·³è¿‡ã€‚\nä¸æ˜¯çš„è¯ï¼Œå°±éœ€è¦ç”¨r.Adapter.Unban(ip)â€‹æ–¹æ³•æ¥è§£å°ipï¼Œè§£å°æˆåŠŸæˆ–å¤±è´¥éƒ½ä¼šç”¨r.UpdateIPBlockStatusâ€‹æ¥æ›´æ–°èµ„æºçš„çŠ¶æ€ï¼ˆStatusï¼‰ï¼Œç„¶åé€šè¿‡ Notify è¿›è¡Œé€šçŸ¥ã€‚\næœ€ååˆ©ç”¨r.Patchâ€‹æ›´æ–°ipblock.Spec.Unblockâ€‹ä¸ºfalseâ€‹\nç™½åå•è·³è¿‡é¦–å…ˆåˆ¤æ–­ç™½åå•æ˜¯å¦å­˜åœ¨ &amp;&amp; IP æ˜¯å¦åœ¨ç™½åå•ä¸­ï¼Œå‘½ä¸­ï¼ˆå³phase == skippedâ€‹ï¼‰ï¼Œåˆ™æ›´æ–°status.phaseâ€‹å’Œstatus.resultâ€‹ä¸ºskippedâ€‹\næ‰‹åŠ¨å¼ºåˆ¶å°ç¦å½“ spec.trigger == trueâ€‹æ—¶ï¼Œæ§åˆ¶å™¨åœ¨ Reconcile ä¸­ä¼šè¯†åˆ«åˆ°è¿™ä¸€æ ‡å¿—ï¼Œå…ˆå°†å…¶é‡ç½®ä¸ºfalseâ€‹ï¼Œå¹¶è®¾ç½® triggered = trueâ€‹ã€‚éšåé€šè¿‡r.Update(ctx, &amp;ipblock)â€‹æ›´æ–°èµ„æºå¯¹è±¡ï¼Œä»è€Œè§¦å‘ä¸€æ¬¡æ–°çš„ Reconcileâ€‹ã€‚åœ¨ä¸‹ä¸€è½® Reconcile ä¸­ï¼Œæ§åˆ¶å™¨ç”±äºæ£€æµ‹åˆ° triggered == trueâ€‹ï¼ˆå³ä½¿ spec å†…å®¹æœªå˜ã€å“ˆå¸Œä¸€è‡´ï¼‰ï¼Œä¹Ÿä¼šè·³è¿‡å¹‚ç­‰åˆ¤æ–­ï¼Œè¿›å…¥å¹¶æ‰§è¡Œ Step 5 ä¸­çš„å°ç¦æ“ä½œã€‚\nè¿™ä¹ˆåšå®ç°äº†ä¸€ç§ â€œæŒ‰é’®è¡Œä¸ºâ€ ï¼Œä¸åœ¨è¿™é‡Œç›´æ¥è°ƒç”¨Ban()â€‹æ–¹æ³•æ˜¯å‡ºäºå¹‚ç­‰æ€§ + å£°æ˜å¼æ§åˆ¶ + æœ€å°å˜æ›´åŸç†è€ƒè™‘ã€‚\n\n\n\nåŸå› \nè¯´æ˜\n\n\n\nå¹‚ç­‰æ€§\nå°ç¦æ“ä½œå¿…é¡»é¿å…é‡å¤æ‰§è¡Œ â†’ æ‰€ä»¥æ§åˆ¶å™¨é€šè¿‡ hash å’Œtriggeredâ€‹åˆ¤æ–­\n\n\nå£°æ˜å¼æ§åˆ¶\næ§åˆ¶å™¨è¡Œä¸ºåº”ç”±specâ€‹é©±åŠ¨ â†’ ç”¨æˆ·è®¾ç½®trigger: trueâ€‹å³å¯ï¼Œä¸éœ€è¦å‘½ä»¤å¼è°ƒç”¨å‡½æ•°\n\n\nå¯¹é½ controller-runtime æ¨¡å¼\næ‰€æœ‰èµ„æºçŠ¶æ€å˜æ›´ç”± Reconcile é©±åŠ¨ï¼ŒåŒ…æ‹¬ trigger çš„æ¸…é™¤\n\n\nå¹‚ç­‰åˆ¤æ–­è¿™é‡Œé€šè¿‡HashSpec()â€‹æ¥è¿›è¡Œå“ˆå¸Œï¼Œä¹Ÿå°±æ˜¯å¯¹Specæ•´ä¸ªéƒ¨åˆ†è¿›è¡Œå“ˆå¸Œç¼–ç \nfunc HashSpec(spec opsv1.IPBlockSpec) (string, error) &#123;\tb, err := json.Marshal(spec)\tif err != nil &#123;\t\treturn &quot;&quot;, err\t&#125;\th := sha256.Sum256(b)\treturn fmt.Sprintf(&quot;%x&quot;, h), nil&#125;\n\næ§åˆ¶å™¨é€šè¿‡è®¡ç®—å½“å‰ IPBlock çš„ specâ€‹ å­—æ®µçš„å“ˆå¸Œå€¼ï¼ˆHashSpec(ipblock.Spec)â€‹ï¼‰ï¼Œä¸ä¹‹å‰è®°å½•åœ¨ status.lastSpecHashâ€‹ ä¸­çš„å“ˆå¸Œå€¼è¿›è¡Œå¯¹æ¯”ï¼Œä»è€Œåˆ¤æ–­ç”¨æˆ·é…ç½®æ˜¯å¦å‘ç”Ÿå˜æ›´ã€‚\n\nå¦‚æœä¸€è‡´ï¼ˆå³ LastSpecHash == currentHashâ€‹ï¼‰ï¼Œä¸” Phase != pendingâ€‹ï¼Œå¹¶ä¸”æ²¡æœ‰è®¾ç½® trigger == trueâ€‹ï¼Œè¯´æ˜ï¼š\n\nç”¨æˆ·æœªä¿®æ”¹specâ€‹\næ§åˆ¶å™¨å·²ç»æ‰§è¡Œè¿‡å°ç¦æˆ–è·³è¿‡å¤„ç†\nå½“å‰çŠ¶æ€ä¸æœŸæœ›ä¸€è‡´\n\nå› æ­¤å°±ä¼šè·³è¿‡æœ¬æ¬¡å¤„ç†ï¼Œä¿è¯äº†æ§åˆ¶å™¨çš„å¹‚ç­‰æ€§ï¼Œé¿å…äº†é‡å¤å°ç¦\n\nè‹¥å“ˆå¸Œå€¼å‘ç”Ÿå˜åŒ–æˆ–è®¾ç½®äº† trigger == trueâ€‹ï¼Œè¯´æ˜ç”¨æˆ·æœŸæœ›é‡æ–°æ‰§è¡Œå°ç¦é€»è¾‘ï¼Œæ­¤æ—¶æ§åˆ¶å™¨å°†ç»§ç»­æ‰§è¡Œ Step 5 å°ç¦æ“ä½œã€‚\n\n\nå°ç¦æ“ä½œåœ¨ Step 5 ä¸­ï¼Œæ§åˆ¶å™¨æ ¹æ® spec.Durationâ€‹ å­—æ®µåˆ¤æ–­å°ç¦æ—¶é•¿ï¼š\n\nå¦‚æœ Durationâ€‹ ä¸ºç©ºå­—ç¬¦ä¸²ï¼Œè¡¨ç¤ºæ°¸ä¹…å°ç¦ï¼Œè®¾ç½® isPermanent = trueâ€‹ï¼Œå¹¶ä¸ä¼ é€’å…·ä½“æ—¶é•¿ï¼›\n\nå¦‚æœ Durationâ€‹ éç©ºï¼Œåˆ™è°ƒç”¨ time.ParseDurationâ€‹ è§£æè¯¥å­—ç¬¦ä¸²ä¸ºå…·ä½“æ—¶é•¿ banSecondsâ€‹ï¼ˆç§’æ•°ï¼‰ï¼›\n\nå¦‚æœè§£æå¤±è´¥ï¼Œåˆ™æ›´æ–°çŠ¶æ€ä¸ºå¤±è´¥ï¼Œå¹¶è¿”å›é”™è¯¯ï¼›\n\n\n\néšåè°ƒç”¨é€‚é…å™¨æ¥å£ r.Adapter.Ban(ip, isPermanent, banSeconds)â€‹ æ‰§è¡Œå°ç¦æ“ä½œã€‚\n\nè‹¥å°ç¦å¤±è´¥ï¼Œæ›´æ–°çŠ¶æ€ä¸ºå¤±è´¥ï¼Œå¹¶é€šè¿‡Notifyå‘é€é”™è¯¯é€šçŸ¥ï¼›\nè‹¥å°ç¦æˆåŠŸï¼Œæ›´æ–°çŠ¶æ€ä¸ºæˆåŠŸï¼ŒåŒ…æ‹¬æ›´æ–°æ—¶é—´æˆ³ã€è®°å½•æœ€åçš„ spec å“ˆå¸Œç­‰ä¿¡æ¯ï¼Œå¹¶é€šè¿‡é€šçŸ¥å™¨å‘é€å°ç¦æˆåŠŸé€šçŸ¥ã€‚\n\næœ€åï¼Œè‹¥ä¸ºéæ°¸ä¹…å°ç¦ï¼Œä¸”æœªæ›¾è‡ªåŠ¨è§£å°ï¼Œåˆ™å¯åŠ¨ä¸€ä¸ªåç¨‹å¼‚æ­¥æ‰§è¡Œè‡ªåŠ¨è§£å°è®¡åˆ’ã€‚\nâ€\nå¯¹äºè‡ªåŠ¨è§£å°å‡½æ•°scheduleAutoUnblockâ€‹ï¼Œä¸»è¦æ€è·¯å°±æ˜¯time.Sleep(ä¼ å…¥çš„æ—¶é—´)â€‹é˜»å¡å½“å‰åç¨‹ç­‰å¾…è¿™æ®µæ—¶é—´ï¼ˆå³å°ç¦åˆ°æœŸæ—¶é—´ï¼‰ï¼Œç„¶åæ‰§è¡Œr.Adapter.UnBan(ipblock.Spec.IP)â€‹ï¼Œå¯¹äºæˆåŠŸ&#x2F;å¤±è´¥ï¼Œæ›´æ–°çŠ¶æ€å¹¶é€šçŸ¥ã€‚\nçŠ¶æ€æ›´æ–°å‡½æ•°func (r *IPBlockReconciler) UpdateIPBlockStatus(ctx context.Context, ipblock *opsv1.IPBlock, updateFn func(*opsv1.IPBlock)) (*opsv1.IPBlock, error) &#123;&#125;\n\nç›®çš„æ˜¯ä¸ºäº†å®‰å…¨åœ°æ›´æ–°Statuså­—æ®µï¼Œç‰¹åˆ«è§£å†³å¹¶å‘æ›´æ–°æ˜¯çš„ç‰ˆæœ¬å†²çªé—®é¢˜\n\nå®šä¹‰ä¸€ä¸ªå˜é‡ latestâ€‹ï¼Œç”¨æ¥å­˜å‚¨æ¯æ¬¡é‡è¯•æ—¶è·å–çš„æœ€æ–° IPBlock å¯¹è±¡ã€‚\n\nè°ƒç”¨ retry.RetryOnConflict(retry.DefaultBackoff, func() error {...})â€‹ï¼Œè¯¥å‡½æ•°ä¼šæ•è·å› ä¸ºç‰ˆæœ¬å†²çªå¯¼è‡´çš„æ›´æ–°å¤±è´¥ï¼Œå¹¶è‡ªåŠ¨æŒ‰ç…§é»˜è®¤é‡è¯•ç­–ç•¥é‡è¯•ã€‚\n\nåœ¨é‡è¯•å‡½æ•°å†…éƒ¨ï¼š\n\nå…ˆè°ƒç”¨ r.Get(...)â€‹ ä» API Server è·å–è¯¥ IPBlock çš„æœ€æ–°ç‰ˆæœ¬ï¼Œé¿å…åŸºäºè¿‡æ—¶ç‰ˆæœ¬æ›´æ–°é€ æˆå†²çªã€‚\nè°ƒç”¨ä¼ å…¥çš„å›è°ƒå‡½æ•° updateFn(&amp;latest)â€‹ï¼Œè®©è°ƒç”¨æ–¹ä¿®æ”¹ latestâ€‹ å¯¹è±¡çš„ Status å­—æ®µã€‚\nè°ƒç”¨ r.Status().Update(ctx, &amp;latest)â€‹ ä»…æ›´æ–°å¯¹è±¡çš„ Status å­èµ„æºï¼ˆç¬¦åˆ Kubernetes è®¾è®¡ï¼ŒStatus å’Œ Spec å¯åˆ†å¼€æ›´æ–°ï¼‰ã€‚\n\n\nå¦‚æœ Updateâ€‹ å‡ºé”™ä¸”æ˜¯ç‰ˆæœ¬å†²çªé”™è¯¯ï¼ŒRetryOnConflictâ€‹ ä¼šè‡ªåŠ¨é‡è¯•ï¼Œç›´åˆ°æˆåŠŸæˆ–è¶…è¿‡æœ€å¤§é‡è¯•æ¬¡æ•°ã€‚\n\nå¦‚æœæœ€ç»ˆå¤±è´¥ï¼Œè®°å½•é”™è¯¯æ—¥å¿—ã€‚\n\nè¿”å›æœ€æ–°çŠ¶æ€çš„å¯¹è±¡æŒ‡é’ˆå’Œé”™è¯¯ã€‚\n\n\né€šçŸ¥æ¨¡æ¿ä¸åŠ¨æ€å‚æ•°æ›¿æ¢è¿™é‡Œä¸»è¦ä½¿ç”¨çš„ Lark çš„ card json æ¨¡æ¿ï¼Œå°†éœ€è¦æ›¿æ¢çš„éƒ¨åˆ†å†™æˆå˜é‡å½¢å¼ã€‚\nson...&quot;elements&quot;: [              &#123;                &quot;tag&quot;: &quot;markdown&quot;,                &quot;content&quot;: &quot;&lt;font color=\\&quot;grey\\&quot;&gt;å‘Šè­¦å†…å®¹&lt;/font&gt;\\n**$&#123;ip&#125;**\\n å‘èµ·è¯·æ±‚è¿‡äºé¢‘ç¹ï¼ˆ1åˆ†é’Ÿå†… **$&#123;count&#125;** æ¬¡ï¼‰&quot;,                &quot;i18n_content&quot;: &#123;                  &quot;en_us&quot;: &quot;&lt;font color=\\&quot;grey\\&quot;&gt;Alert details&lt;/font&gt;\\nMobile client crash rate at 5%&quot;                &#125;,...\n\nç„¶ååœ¨ä½¿ç”¨æ—¶ï¼ŒåŠ¨æ€ä¼ å…¥å‚æ•°å³å¯ã€‚ï¼ˆæ¨¡æ¿ç±»å‹ï¼Œä¼ é€’å‚æ•°ï¼‰\nif r.Notifier != nil &#123;\t\t\tlogger.Info(&quot;Notifier found, sending ban notification&quot;, &quot;ip&quot;, ip)\t\t\terr := r.Notifier.Notify(ctx, &quot;ban&quot;, map[string]string&#123;\t\t\t\t&quot;alarm_time&quot;: time.Now().Format(&quot;2006-01-02 15:04:05&quot;),\t\t\t\t&quot;ip&quot;:         ip,\t\t\t\t&quot;count&quot;:      countExtra(ipblock.Spec.Reason), // è¿™é‡Œå¡«å®é™…count\t\t\t&#125;)\t\t\tif err != nil &#123;\t\t\t\tlogger.Error(err, &quot;å‘é€å°ç¦é€šçŸ¥å¤±è´¥&quot;, &quot;ip&quot;, ip)\t\t\t&#125; else &#123;\t\t\t\tlogger.Info(&quot;å‘é€å°ç¦é€šçŸ¥æˆåŠŸ&quot;, &quot;ip&quot;, ip)\t\t\t&#125;\t\t&#125; else &#123;\t\t\tlogger.Info(&quot;Notifier is nil, skipping ban notification&quot;)\t\t&#125;\n\nConfigMapçƒ­æ›´æ–°åœ¨main.goâ€‹ä¸­watchConfigMapâ€‹å®ç°ã€‚\nfunc watchConfigMap(ctx context.Context, mgr ctrl.Manager, reconciler *controller.IPBlockReconciler) &#123;&#125;\n\n\né€šè¿‡ mgr.GetCache().GetInformer(ctx, &amp;corev1.ConfigMap{})â€‹ è·å– ConfigMap çš„ Informer\n\n\nInformer æ˜¯ controller-runtime æä¾›çš„æœºåˆ¶ï¼Œåº•å±‚å°è£…äº† Kubernetes çš„ç¼“å­˜å’Œäº‹ä»¶ç›‘å¬åŠŸèƒ½ã€‚\n\nå®ƒä¼šç›‘å¬é›†ç¾¤ä¸­ ConfigMap èµ„æºçš„æ–°å¢ã€æ›´æ–°ã€åˆ é™¤äº‹ä»¶ï¼Œè§¦å‘ç›¸åº”å›è°ƒå‡½æ•°ã€‚\n\n\n\né€šè¿‡ AddEventHandlerâ€‹ æ³¨å†Œäº‹ä»¶å¤„ç†å‡½æ•°ï¼Œå³æ³¨å†Œä¸€ä¸ªâ€å½“èµ„æºå‘ç”Ÿå˜åŒ–æ—¶éœ€è¦æ‰§è¡Œçš„å‡½æ•°â€\n\n\nAddFuncï¼šå½“ç›‘å¬çš„ ConfigMap æ–°å»ºæ—¶è§¦å‘ã€‚\nUpdateFuncï¼šå½“ç›‘å¬çš„ ConfigMap æ›´æ–°æ—¶è§¦å‘ã€‚\n\n\nå…·ä½“å¤„ç†é€»è¾‘ï¼š\n\na. è¯»å–å¹¶æ›´æ–°å…³é”®é…ç½®å­—æ®µ\n\ngatewayHostâ€‹ï¼šç½‘å…³åœ°å€ï¼Œå˜æ›´æ—¶è°ƒç”¨ reconciler.UpdateGatewayHostâ€‹ åŠ¨æ€æ›´æ–°ã€‚\n\nç™½åå•ï¼šè°ƒç”¨ config.LoadWhitelistFromConfigMapâ€‹ åŠ è½½æœ€æ–°ç™½åå•ï¼Œæ›´æ–° reconciler.UpdateWhitelistâ€‹ï¼ˆå¹¶å‘å®‰å…¨æ›´æ–°ï¼‰ã€‚\n\né€‚é…å™¨åç§°ï¼ˆengineâ€‹ å­—æ®µï¼‰ï¼šæ›´æ–°é€‚é…å™¨å®ä¾‹ã€‚\n\n\nb. è§¦å‘å™¨ï¼ˆTriggersï¼‰åŠ è½½å’Œé‡å¯\n\nä» ConfigMap çš„ triggerâ€‹ å­—æ®µåŠ è½½è§¦å‘å™¨é…ç½®ã€‚\n\nåœæ­¢æ‰€æœ‰æ—§è§¦å‘å™¨ï¼Œé‡æ–°åˆ›å»ºå¹¶æ³¨å†Œæ–°è§¦å‘å™¨ï¼Œæœ€åå¯åŠ¨å®ƒä»¬ã€‚\n\n\nc. é€šçŸ¥ï¼ˆNotifyï¼‰é…ç½®åŠ è½½\n\nè¯»å–é€šçŸ¥ç±»å‹ã€Webhook URL å’Œæ¨¡æ¿ã€‚\n\nåŠ¨æ€åˆ›å»ºæ–°çš„é€šçŸ¥å®ä¾‹ï¼ˆå¦‚é£ä¹¦ LarkNotifyï¼‰ï¼Œæ›¿æ¢æ—§å®ä¾‹ï¼Œå®ç°é€šçŸ¥é…ç½®çš„çƒ­åˆ‡æ¢ã€‚\n\n\nå¹¶å‘å¤„ç†IPBlock-Operator-Plusåœ¨å®é™…ä½¿ç”¨ä¸­å¯èƒ½ä¼šå‡ºç°å¹¶å‘é—®é¢˜ï¼Œä¸»è¦ä¼šå‡ºç°ä»¥ä¸‹ä¸‰ç§æƒ…å†µï¼š\n\nåœºæ™¯ä¸¾ä¾‹ï¼š\n\nå• Trigger é‡å¤æŠ¥è­¦ï¼šGrafana é…ç½®æœ‰è¯¯ï¼Œ1åˆ†é’Ÿå†…å¯¹åŒä¸€ IP å‘å‡º10æ¬¡æŠ¥è­¦ã€‚\nå¤šä¸ª Trigger åŒæ—¶è§¦å‘ï¼šæ¯”å¦‚ Prometheus å’Œ Grafana åŒæ—¶ç›‘æ§ TCP å’Œ HTTP æµé‡ï¼Œè§¦å‘äº†å¯¹åŒä¸€ IP çš„å‘Šè­¦ã€‚\nå¤šä¸ª IP å¹¶å‘å‘Šè­¦ï¼šé«˜å³°æœŸç³»ç»Ÿå—åˆ° SYN Flood æ”»å‡»ï¼Œå¤šä¸ª IP åŒæ—¶å‘èµ·è¿æ¥ï¼Œäº§ç”Ÿå¤§é‡å‘Šè­¦ã€‚\n\n\n\nå¦‚æœå•Triggeré¢‘ç¹æŠ¥è­¦ï¼ŒPOSTäº†å¤šä¸ªWebhookï¼Œå¯èƒ½ä¼šå‡ºç°é‡å¤CRèµ„æºã€‚\n\nå¦‚æœæœ‰å¤šä¸ªTriggerï¼Œå¤šä¸ªTriggeré€šçŸ¥äº†åŒä¸€ä¸ª IPï¼Œä¹Ÿå¯èƒ½å‡ºç°é‡å¤CRèµ„æºï¼Œæˆ–è€…å‡ºç°å†²çªã€‚\n\nå¤šä¸ªTriggeré€šçŸ¥ä¸åŒ IPï¼Œå¯èƒ½å‡ºç°èµ„æºç«äº‰æˆ–å†²çªã€‚\n\n\né’ˆå¯¹è¿™ä¸‰ç§æƒ…å†µï¼Œåœ¨internal/utilsâ€‹ä¸‹æ·»åŠ äº†ä¸€äº›å·¥å…·ä¸“é—¨å¤„ç†è¿™å‡ ç§å¹¶å‘é—®é¢˜ã€‚\n\ndebouncer.goâ€‹ï¼šå®šä¹‰ Debouncer æ¥å£ï¼Œæ‹¥æœ‰ä¸€ä¸ªShouldAllow(key string) boolâ€‹æ–¹æ³•ï¼Œç”¨äºå†³å®šæ˜¯å¦å…è®¸æœ¬æ¬¡å¤„ç†ã€‚\nlru_debouncer.goâ€‹ï¼šDebouncer çš„æ¥å£å…·ä½“å®ç°ã€‚åˆ©ç”¨LRUå¤„ç†Webhooké£æš´ï¼Œé¿å…å› ä¸ºå¤§é‡ Webhook é€šçŸ¥åŒä¸€ä¸ª IPï¼Œå¯¼è‡´å‡ºç°å¤§é‡é‡å¤çš„ CR èµ„æºã€‚\ngen_name.goâ€‹ï¼šå¯¹ IPBlock CR åè¿›è¡Œå”¯ä¸€æ€§æ ‡è¯†ï¼Œé¿å…å¤šä¸ª Trigger é€šçŸ¥åŒä¸€ä¸ª IPï¼Œå¯¼è‡´å‡ºç°å¤§é‡é‡å¤çš„ CR èµ„æºã€‚\nIPLock.goâ€‹ï¼šç”¨äºç®¡ç† IP ç»´åº¦çš„å¹¶å‘é”ï¼Œé¿å…å¤šä¸ª Trigger å¹¶å‘å†²çªæˆ–é‡å¤åˆ›å»º CR ï¼Œåœ¨åŒä¸€æ—¶é—´åªå…è®¸ä¸€ä¸ª Trigger ï¼ˆæˆ–ä¸€ä¸ª goroutineï¼‰å¤„ç†åŒä¸€ä¸ª IPã€‚\n\nLRU é˜²æŠ–æœºåˆ¶ç¡®ä¿åŒä¸€ä¸ª IP åªä¼šæœ‰ä¸€ä¸ªèµ„æºï¼Œé˜²æ­¢ Webhook é£æš´ã€‚\n\nLRUï¼ˆLeast Recently Usedï¼‰ç¼“å­˜æ·˜æ±°ç­–ç•¥ï¼Œæ˜¯ä¸€ç§ç¼“å­˜æ·˜æ±°æœºåˆ¶ã€‚å®ƒä¼šæ·˜æ±°æœ€è¿‘æœ€å°‘è¢«è®¿é—®çš„æ•°æ®ï¼Œè…¾å‡ºç©ºé—´ç»™æ–°æ•°æ®ã€‚\nå…·ä½“æ˜¯é€šè¿‡ç»´æŠ¤ä¸¤ä¸ªé“¾è¡¨ï¼šæ´»è·ƒé“¾è¡¨å’Œéæ´»è·ƒé“¾è¡¨å®ç°çš„ã€‚\næœ‰æ–°æ•°æ®è®¿é—®æ—¶ï¼ŒæŠŠæ–°æ•°æ®æ’å…¥éæ´»è·ƒé“¾è¡¨çš„å°¾éƒ¨ã€‚\nå¦‚æœè®¿é—®äº†éæ´»è·ƒé“¾è¡¨ä¸­çš„æ•°æ®ï¼Œå°±æŠŠè¿™ä¸ªæ•°æ®æ”¾åœ¨æ´»è·ƒé“¾è¡¨çš„å¤´éƒ¨ã€‚\nå¦‚æœè®¿é—®äº†æ´»è·ƒé“¾è¡¨ä¸­çš„æ•°æ®ï¼Œå°±æŠŠè¿™ä¸ªæ•°æ®æ”¾åœ¨æ´»è·ƒé“¾è¡¨çš„å¤´éƒ¨ã€‚\nå¦‚æœç¼“å­˜æ»¡äº†ï¼Œå†æ’å…¥æ—¶ï¼Œæ·˜æ±°ä½äºé“¾è¡¨æœ€åçš„æ•°æ®ã€‚\n\né€»è¾‘ä¿å­˜åœ¨utils/lru_debouncer.goâ€‹ä¸­ï¼Œè¿™é‡Œæ˜¯å¯¹ Debouncer æ¥å£çš„å®ç°ã€‚ä¸»è¦æœ‰ä¸¤ä¸ªæ–¹æ³•ï¼š\n// ä½¿ç”¨&quot;k8s.io/utils/lru&quot;åŒ…ï¼Œç”Ÿæˆä¸€ä¸ª LRU é˜²æŠ–å™¨ã€‚func NewLRUDebouncer(size int, ttl time.Duration) *lruDebouncer &#123;&#125;// æ£€æŸ¥å½“å‰è¡Œä¸ºæ˜¯å¦åˆæ³•ã€‚func (d *lruDebouncer) ShouldAllow(ip string) bool &#123;&#125;\n\næ ¸å¿ƒæ–¹æ³•æ˜¯ShouldAllowâ€‹ï¼Œè¿™ä¸ªæ–¹æ³•åšäº†ä¸‹é¢å‡ ä»¶äº‹ï¼š\n\nç»™ cache åŠ ä¸Šäº’æ–¥é”ï¼Œé˜²æ­¢å¹¶å‘è¯·æ±‚ä¸­å¯¹å…¶è®¿é—®å’Œä¿®æ”¹ã€‚\nåœ¨ç¼“å­˜ä¸­æ£€æŸ¥æ˜¯å¦æœ‰è¯¥ IP çš„è®°å½•\næœ‰çš„è¯ï¼Œå°±æ£€æŸ¥å®ƒä¸Šæ¬¡è§¦å‘æ—¶é—´ ts å’Œç°åœ¨ time.Since(ts) çš„é—´éš”ã€‚\nå¦‚æœé—´éš”æ—¶é—´å°äºè®¾å®šçš„ TTLï¼Œè¯´æ˜æ˜¯é‡å¤è§¦å‘äº†ï¼Œå°±è¿”å› falseï¼Œæ‹’ç»æœ¬æ¬¡æ“ä½œã€‚\n\nç„¶ååœ¨internal/trigger/grafana.goâ€‹ä¸­åº”ç”¨é˜²æŠ–ï¼ˆåœ¨åˆ›å»º CR ä¹‹å‰ï¼‰\n// é˜²æŠ–ï¼Œé˜²æ­¢é‡å¤åˆ›å»º CRif !g.Debouncer.ShouldAllow(ip) &#123;\tlogger.Info(&quot;[grafana] Skip duplicate IPBlock within TTL&quot;, &quot;ip&quot;, ip)\treturn&#125;\n\næœ€ååœ¨main.goâ€‹ä¸­ï¼Œæ³¨å†Œé˜²æŠ–å™¨ã€‚\næˆ‘ä»¬å®šä¹‰äº†é˜²æŠ–é¢‘ç‡è§„åˆ™ï¼š\n\nå¯¹äºä¸åŒ IPï¼ŒLRU ä¸­æœ€å¤šä¿å­˜1000ä¸ªIPï¼Œè¾¾åˆ°1000ä¸ªåä¼šè‡ªåŠ¨æ·˜æ±°æœ€è¿‘æœ€å°‘ä½¿ç”¨çš„ IPã€‚\nå¯¹äºåŒä¸€ä¸ªIPï¼Œå¦‚æœæœ€è¿‘60så†…å‘ç”Ÿè¿‡ä¸€æ¬¡å°ç¦ï¼Œé‚£ä¹ˆè¿™60så†…å†æ¬¡æ”¶åˆ°è¯¥IPçš„ç›¸åŒè¯·æ±‚æ—¶ï¼Œä¼šè¢«é˜²æŠ–è¯†åˆ«ä¸ºé‡å¤ã€‚\n\n// é€‰æ‹©è§¦å‘å™¨func CreateTriggerByConfig(cfg TriggerConfig, mgr ctrl.Manager) trigger.Trigger &#123;\tswitch cfg.Name &#123;\tcase &quot;grafana&quot;:\t\treturn &amp;trigger.GrafanaTrigger&#123;\t\t\tClient: mgr.GetClient(),\t\t\tAddr:   cfg.Addr,\t\t\tPath:   cfg.Path,\t\t\t// 1000 ä¸ª IPï¼Œ 60 ç§’é˜²æŠ–\t\t\tDebouncer: utils.NewLRUDebouncer(1000, 60*time.Second),\t\t\tIPLocker:  utils.NewIPLock(),\t\t&#125;\t// TODO å…¶ä»–è§¦å‘å™¨ ...\tdefault:\t\treturn nil\t&#125;&#125;\n\nå”¯ä¸€æ€§ CR åç§°ç¡®ä¿åŒä¸€ä¸ª IP åªä¼šæœ‰ä¸€ä¸ªèµ„æºã€‚\n\næ—¢ç„¶å¯èƒ½ä¼šå‡ºç°é‡å¤çš„ CR èµ„æºï¼Œé‚£æˆ‘ä»¬å°±é€šè¿‡ä¸€äº›ç‰¹å¾æ¥è®©æ¯ä¸ª CR å”¯ä¸€åŒ–ï¼Œè¿™æ ·å¤šä¸ª Trigger åœ¨ä¸ŠæŠ¥ç›¸åŒ IP æ—¶ï¼Œç”Ÿæˆçš„ CR åä¹Ÿæ˜¯ç›¸åŒçš„ã€‚K8sä¸ä¼šå‡ºç°ç›¸åŒåçš„ CR ï¼Œè¿™æ ·å°±æœ‰æ•ˆé¿å…äº†å¤§é‡ç›¸åŒ CR æ¶ˆè€—èµ„æºçš„å¹¶å‘é—®é¢˜ã€‚\n\né€»è¾‘ä¿å­˜åœ¨utils/gen_name.goâ€‹ä¸­ï¼Œä¸»è¦æ˜¯å¯¹ IP è¿›è¡Œ md5 hashï¼Œå–8ä½ï¼Œç„¶åå’Œipblock-â€‹è¿›è¡Œæ‹¼æ¥ã€‚\nfunc GenCRName(ip string) string &#123;\thash := md5.Sum([]byte(ip))\treturn &quot;ipblock-&quot; + hex.EncodeToString(hash[:8]) // 16ä½&#125;\n\nç„¶åæˆ‘ä»¬åœ¨internal/trigger/grafana.goâ€‹ä¸­åº”ç”¨ï¼Œåœ¨åˆ›å»º CR ä¹‹å‰ï¼Œå…ˆåˆ¤æ–­ CR æ˜¯å¦å·²ç»å­˜åœ¨ï¼ˆg.Client.Get()â€‹ + apierrors.IsNotFound(err)â€‹ï¼‰ã€‚\ncrName := utils.GenCRName(ip)// å…ˆåˆ¤æ–­ CR æ˜¯å¦å·²ç»å­˜åœ¨var existing opsv1.IPBlockerr := g.Client.Get(context.Background(), client.ObjectKey&#123;\tName:      crName,\tNamespace: &quot;default&quot;,&#125;, &amp;existing)if err == nil &#123;\tlogger.Info(&quot;[grafana] IPBlock already exists, skip creation&quot;, &quot;ip&quot;, ip)\treturn&#125;\t// å¦‚æœ NotFoundï¼Œç»§ç»­åˆ›å»ºif err != nil &amp;&amp; !apierrors.IsNotFound(err) &#123;\tlogger.Error(err, &quot;[grafana] Error checking IPBlock existence&quot;, &quot;ip&quot;, ip)\treturn&#125;\n\nIPé”æœºåˆ¶ç¡®ä¿åŒä¸€æ—¶é—´åªå…è®¸ä¸€ä¸ª Trigger ï¼ˆæˆ–ä¸€ä¸ª goroutineï¼‰å¤„ç†åŒä¸€ä¸ª IP çš„å°ç¦é€»è¾‘ã€‚\n\nå‡è®¾åŒä¸€æ—¶åˆ»ï¼Œè¿™ä¸¤ä¸ª trigger å‡ ä¹åŒæ—¶æ”¶åˆ°äº†é’ˆå¯¹ IP 1.2.3.4â€‹ çš„ webhookï¼š\n\nTriggerA å¼€å§‹å¤„ç†ï¼šæ‰“ç®—åˆ›å»ºä¸€ä¸ª IPBlockâ€‹ èµ„æº\nTriggerB ä¹Ÿæ”¶åˆ°ç›¸åŒ IP çš„å‘Šè­¦ï¼Œä¹Ÿæƒ³åˆ›å»ºä¸€ä¸ªåŒæ ·çš„ IPBlockâ€‹\n\nå¦‚æœæ²¡æœ‰åŠ é”ï¼š\n\nä¸¤ä¸ª trigger å¯èƒ½å‡ ä¹åŒæ—¶è¿›å…¥äº† Client.Create(...)â€‹\nç»“æœ Kubernetes å¯èƒ½æŠ¥é”™ AlreadyExistsâ€‹\nçŠ¶æ€å¯èƒ½å†²çªï¼Œæ—¥å¿—ä¹Ÿä¼šä¹±\n\n\né€»è¾‘ä¿å­˜åœ¨utils/IPLock.goâ€‹ä¸­ï¼Œä¸»è¦åšä¸‰ä»¶äº‹ï¼š\ntype IPLock struct &#123;\tglobal sync.Mutex // ä¿æŠ¤ locks map\tlocks  map[string]*sync.Mutex // å…¨å±€é”ï¼Œç”¨æ¥ä¿æŠ¤ locks è¿™ä¸ª mapï¼Œé˜²æ­¢å¹¶å‘è¯»å†™å®ƒæ—¶å‘ç”Ÿç«æ€ã€‚&#125;\n\n// æ–°å»ºä¸€ä¸ªé”ç®¡ç†å™¨func NewIPLock() *IPLock &#123;&#125;// è·å–æŸä¸ª IP çš„é”func (i *IPLock) Lock(ip string) &#123;&#125;// é‡Šæ”¾æŸä¸ª IP çš„é”func (i *IPLock) Unlock(ip string) &#123;&#125;\n\næ ¸å¿ƒæ˜¯Lockâ€‹ï¼Œå®ƒåšäº†è¿™å‡ ä»¶äº‹ï¼š\n\næ–°å»ºä¸€ä¸ªå…¨å±€é”ï¼Œé˜²æ­¢å¤šä¸ª goroutine è®¿é—® map å‡ºç°é—®é¢˜ã€‚\næŸ¥çœ‹è¯¥ IP æ˜¯å¦æœ‰å¯¹åº”çš„é”ï¼Œæ²¡æœ‰å°±æ–°å»ºä¸€ä¸ªé”ï¼Œå¹¶åŠ å…¥mapä¸­ã€‚\nå†é‡Šæ”¾å…¨å±€é”ã€‚\næœ€åè°ƒç”¨å…·ä½“ IP çš„lock.Lock()â€‹ï¼Œé˜»å¡ç­‰å¾…è·å–é”ã€‚\n\nç„¶ååº”ç”¨åœ¨internal/trigger/grafana.goâ€‹ï¼Œå¯¹é¢„è­¦å¾ªç¯æ—¶ï¼Œä¼šå¾ªç¯è·å–åˆ°æ¯ä¸ª IPï¼Œè¿™é‡Œæˆ‘ä»¬ä½¿ç”¨åŒ¿åå‡½æ•°ï¼Œä¸ºäº†ç¡®ä¿æ¯ä¸ª IP çš„é”åœ¨å¤„ç†å®Œæˆåèƒ½åŠæ—¶é‡Šæ”¾ï¼Œé¿å…å›  deferâ€‹ å»¶è¿Ÿé‡Šæ”¾å¯¼è‡´çš„é”é˜»å¡ï¼Œæˆ‘ä»¬ä¸ºæ¯ä¸ª IP çš„å¤„ç†é€»è¾‘åŒ…è£¹ä¸€ä¸ªåŒ¿åå‡½æ•°ï¼š\n// é¿å…å¹¶å‘æ—¶çš„ç«äº‰å’Œæ­»é”func(ip string) &#123;\tg.IPLocker.Lock(ip)    defer g.IPLocker.Unlock(ip)\t...&#125;(ip)\n\nè¿™æ ·è®¾è®¡çš„å¥½å¤„æ˜¯æ¯è½®å¾ªç¯çš„ defer éƒ½ä¼šåœ¨å½“å‰åŒ¿åå‡½æ•°ç»“æŸæ—¶é‡Šæ”¾é”ï¼Œé¿å…å¤šä¸ª IP çš„å¤„ç†äº’ç›¸é˜»å¡ï¼Œä¿è¯å¹¶å‘å®‰å…¨ã€‚\n","categories":["Kubernetes"],"tags":["Kubernetes","Operator","Achievements"]},{"title":"ç®—æ³•è®°å½•","url":"/2025/12/08/%E7%AE%97%E6%B3%95%E8%AE%B0%E5%BD%95/","content":"é¡¹ç›®çš„ç»„ä»¶æ”¾åœ¨internal/â€‹ä¸‹\n\ncontrollerï¼ˆæ§åˆ¶å™¨ï¼‰ï¼šè´Ÿè´£æ ¸å¿ƒä¸šåŠ¡é€»è¾‘çš„è°ƒåº¦å’Œåè°ƒï¼Œç›‘å¬ Kubernetes ä¸­ IPBlock è‡ªå®šä¹‰èµ„æºçš„å˜åŒ–ï¼Œç»´æŠ¤å’Œç®¡ç†å…¶ç”Ÿå‘½å‘¨æœŸã€‚\n\nengineï¼ˆå°ç¦åç«¯ï¼‰ï¼šè´Ÿè´£å°ç¦å‘½ä»¤çš„å®é™…æ‰§è¡Œã€‚\n\nnotifyï¼ˆé€šçŸ¥æœºåˆ¶ï¼‰ï¼šè´Ÿè´£å°†å°ç¦ã€è§£å°ç­‰äº‹ä»¶ä»¥å¤šç§æ–¹å¼é€šçŸ¥ç»™è¿ç»´äººå‘˜æˆ–å…¶ä»–ç³»ç»Ÿã€‚\n\ntriggerï¼ˆè§¦å‘å™¨ï¼‰ï¼šäº‹ä»¶è§¦å‘ä¸­å¿ƒï¼Œè´Ÿè´£ç›‘å¬å¤–éƒ¨å‘Šè­¦ç³»ç»Ÿæˆ–ä¸šåŠ¡äº‹ä»¶ï¼ˆå¦‚ Grafana Alertç­‰ï¼‰ï¼Œå¹¶æ ¹æ® Alert ç­–ç•¥è§¦å‘ç›¸å…³å°ç¦æ“ä½œï¼Œè‡ªåŠ¨åˆ›å»º IPBlock CRï¼Œä¸”æ”¯æŒè‡ªåŠ¨è§£å°ã€‚\n\npolicyï¼ˆå°ç¦ç­–ç•¥ï¼‰ï¼šå®šä¹‰ IP å°ç¦çš„åˆ¤å®šè§„åˆ™å’Œæ‰§è¡Œç­–ç•¥ã€‚\n\n\n### ä»‹ç»å°ç¦åç«¯å‡è¢«æŠ½è±¡ä¸ºAPIï¼ŒIPBlock-Operator-Plusé€šè¿‡è°ƒç”¨APIæ¥å®ç°å®é™…çš„å°ç¦è¡Œä¸ºã€‚ç›®å‰é€šè¿‡`engine/control.py`â€‹æ¥å®ç°APIï¼Œæ¥å£åˆ—è¡¨å¦‚ä¸‹ï¼š| æ¥å£     | æ–¹æ³• | è¯´æ˜                                          || -------- | ---- | --------------------------------------------- || /limit   | GET  | iptablesé™æµæ¥å£                              || /unlimit | GET  | iptablesè§£é™æµæ¥å£                            || /limits  | GET  | iptablesæŸ¥çœ‹å½“å‰é™æµæƒ…å†µ                      || /update  |      | XDPå°ç¦ç«¯å£                                   || /remove  |      | XDPè§£å°ç¦ç«¯å£                                 || /ban     | GET  | ï¼ˆå¼ƒç”¨ï¼‰å¯ä»nginxæ—¥å¿—æŸ¥ï¼Œè¿”å›è¶…è¿‡ä¸€å®šæ¬¡æ•°çš„IP || /execute | GET  | ï¼ˆå¼ƒç”¨ï¼‰æ¥æ”¶IPï¼Œå¯¹å…¶æ‰§è¡ŒXDPå°ç¦               |engineæ”¯æŒåˆ—è¡¨ï¼š- XDPï¼šä¾èµ–äº[evilsp/xdp_banner: ä¸€ä¸ªç®€å•çš„ XDP å°ç¨‹åºï¼Œç”¨äº BAN IP](https://github.com/evilsp/xdp_banner)- iptablesï¼šä¾èµ–äºLinuxå·¥å…·iptablesã€‚  è§„åˆ™ä¸º IP æ¯åˆ†é’Ÿæœ€å¤šå‘èµ·10ä¸ªæ–°è¿æ¥ï¼ˆå¯çªå‘20æ¬¡ï¼‰ï¼Œå¦åˆ™DROP  ```go  iptables -A INPUT -s &lt;IP&gt; -p tcp --dport &lt;TARGET_PORT&gt; \\   Â -m state --state NEW \\   Â -m hashlimit --hashlimit 10/min --hashlimit-burst 20 \\   Â --hashlimit-mode srcip --hashlimit-name limit_&lt;IP_REPLACED&gt; \\   Â -j ACCEPT  â€‹  iptables -A INPUT -s &lt;IP&gt; -p tcp --dport &lt;TARGET_PORT&gt; -j DROP\n\næ‰©å±•å¼€å‘æŒ‡å—engineå®šä¹‰äº†æ¥å£ï¼Œæ–°adapteråªéœ€è¦å®ç°è¿™ä¸¤ä¸ªæ–¹æ³•å³å¯ã€‚\ntype Adapter interface &#123;    // Ban å¯¹æŸä¸ª IP å‘èµ·å°ç¦    // ip: è¦å°ç¦çš„ IP åœ°å€    // isParmanent: æ˜¯å¦æ°¸ä¹…å°ç¦ï¼ˆtrue è¡¨ç¤ºæ°¸ä¹…ï¼‰    // durationSeconds: å°ç¦æ—¶é•¿ï¼ˆå•ä½ï¼šç§’ï¼Œä»…åœ¨ä¸´æ—¶å°ç¦æ—¶ç”Ÿæ•ˆï¼‰    Ban(ip string, isParmanent bool, durationSeconds int) (string, error)â€‹    // UnBan è§£å°æŸä¸ª IP    UnBan(ip string) (string, error)&#125;â€‹\n\nç„¶ååœ¨NewAdapterâ€‹æ³¨å†Œå¯¹åº”çš„adapter\nfunc NewAdapter(name, gatewayHost string) Adapter &#123;    switch name &#123;    case &quot;xdp&quot;:        return &amp;XDPAdapter&#123;GatewayHost: gatewayHost&#125;    case &quot;iptables&quot;:        return &amp;IptablesAdapter&#123;GatewayHost: gatewayHost&#125;    default:â€‹        return &amp;XDPAdapter&#123;GatewayHost: gatewayHost&#125;    &#125;&#125;\n\næ¥ç€åœ¨controller.pyâ€‹ä¸­è¦å®ç°å¯¹åº”çš„APIï¼Œæœ€ååœ¨configmapâ€‹ä¸­engineâ€‹å­—æ®µæŒ‡å®šå¯¹åº”çš„adapteråå³å¯ã€‚\nnotifyä»‹ç». \nnotifyæ”¯æŒåˆ—è¡¨ï¼š\n\nlarkï¼šé£ä¹¦ï¼Œé€šè¿‡æœºå™¨äººæ¥è¿›è¡Œé€šçŸ¥\n\næ‰©å±•å¼€å‘æŒ‡å—notifyå®šä¹‰äº†æ¥å£ï¼Œæ–°notifyåªéœ€è¦å®ç°è¿™ä¸ªæ¥å£å³å¯ã€‚\n// ä¸»è®¡ç®—å‡½æ•°int Calculate(char e[])&#123;    numStack OPND = InitNumStack();    opStack OPTR = InitOpStack();    PushOp(OPTR, &#x27;#&#x27;);  // åˆå§‹åŒ–è¿ç®—ç¬¦æ ˆ    char ch, op;    int a, b, result = 0;    int num = 0;    int flag = 0; // æ£€æµ‹æ˜¯å¦ä¸ºå¤šä½æ•°    strcat(e, &quot;#&quot;);    for(int i = 0; e[i] != &#x27;\\0&#x27;; i++)    &#123;        ch = e[i];        if (ch &gt;= &#x27;0&#x27; &amp;&amp; ch &lt;= &#x27;9&#x27;) &#123;            num = num * 10 + (ch - &#x27;0&#x27;); // ç´¯åŠ ç»„åˆæˆå¤šä½æ•°            flag = 1;        &#125;        else &#123;            if(flag) &#123;                PushNum(OPND, num);  // å‹å…¥æ“ä½œæ•°                num = 0;                flag = 0;            &#125;            while(getPriority(GetOpTop(OPTR), ch) == &#x27;&gt;&#x27;) &#123;                PopOp(OPTR, &amp;op);                PopNum(OPND, &amp;b);                PopNum(OPND, &amp;a);                result = Operate(a, b, op);                PushNum(OPND, result);            &#125;            if (getPriority(GetOpTop(OPTR), ch) == &#x27;&lt;&#x27;) &#123;                PushOp(OPTR, ch);  // å‹å…¥å½“å‰è¿ç®—ç¬¦            &#125; else if (getPriority(GetOpTop(OPTR), ch) == &#x27;=&#x27;) &#123;                PopOp(OPTR, &amp;op); // å‡ºæ ˆåŒ¹é…            &#125;        &#125;    &#125;    PopNum(OPND, &amp;result);    return result;&#125;\n\nä»¥larkä¸ºä¾‹ï¼Œåœ¨lark.goâ€‹ä¸­å®ç°ä¸¤ä¸ªæ–¹æ³•\n// NewLarkNotify åˆ›å»ºä¸€ä¸ª LarkNotifyï¼ˆé£ä¹¦é€šçŸ¥å™¨ï¼‰å®ä¾‹ã€‚//// å‚æ•°:// Â  - webhookURL: é£ä¹¦ç¾¤æœºå™¨äººçš„ Webhook åœ°å€ã€‚// Â  - templatePaths: å„ç±»é€šçŸ¥ç±»å‹æ‰€ç”¨çš„ card æ¨¡æ¿è·¯å¾„æ˜ å°„ï¼ˆå¦‚ map[&quot;ban&quot;]=&quot;templates/ban.json&quot;ï¼‰ã€‚//// è¿”å›å€¼:// Â  - æˆåŠŸ: è¿”å› LarkNotify å®ä¾‹ã€‚// Â  - å¤±è´¥: è¿”å› errorï¼Œé€šå¸¸æ˜¯æ¨¡æ¿è§£æå¤±è´¥æˆ–é…ç½®ä¸åˆæ³•ã€‚func NewLarkNotify(webhookURL string, templatePaths map[string]string) (*LarkNotify, error) &#123;&#125;// Notify å®ç° Notifier æ¥å£ï¼Œ// æ ¹æ®äº‹ä»¶ç±»å‹å’Œå˜é‡æ„é€ é£ä¹¦å¡ç‰‡æ¶ˆæ¯ï¼Œå¹¶å‘é€è‡³ webhookã€‚//// å‚æ•°:// Â  - ctx: è¯·æ±‚ä¸Šä¸‹æ–‡ï¼Œç”¨äºæ§åˆ¶è¶…æ—¶å’Œå–æ¶ˆç­‰ã€‚// Â  - eventType: äº‹ä»¶ç±»å‹ï¼ˆå¦‚ &quot;ban&quot;ã€&quot;resolve&quot;ã€&quot;error&quot;ï¼‰ã€‚// Â  - vars: æ¨¡æ¿å˜é‡é”®å€¼å¯¹ï¼Œä¾‹å¦‚ &#123;&quot;ip&quot;: &quot;1.2.3.4&quot;, &quot;reason&quot;: &quot;æ¶æ„è¿æ¥&quot;&#125;ã€‚//// è¿”å›å€¼:// Â  - æˆåŠŸ: è¿”å› nilã€‚// Â  - å¤±è´¥: è¿”å› errorï¼Œè¡¨ç¤ºé€šçŸ¥å¤±è´¥ã€‚func (l *LarkNotify) Notify(ctx context.Context, eventType string, vars map[string]string) error &#123;&#125;\n\næœ€ååœ¨main.goâ€‹ä¸­watchConfigMapâ€‹ä¸­å®Œå–„loadNotifyâ€‹ã€‚\nint main()&#123;    char e[MAXSIZE]; // ä¸€æ¡è¡¨è¾¾å¼     char p[MAXSIZE][MAXSIZE]; // æ‰€æœ‰è¡¨è¾¾å¼    int count = 0;    printf(&quot;è¾“å…¥è¡¨è¾¾å¼ï¼Œæ¯è¡Œä¸€ä¸ªï¼Œä»¥\\&quot;=\\&quot;ç»“æŸï¼š\\n&quot;);    while(1) &#123;        gets(e); // è¯»å–ä¸€è¡Œè¡¨è¾¾å¼        // å»é™¤æ¢è¡Œç¬¦        e[strcspn(e,&quot;\\n&quot;)] = 0;        if(strcmp(e, &quot;=&quot;) == 0) &#123;            break;        &#125;        strcpy(p[count++], e);    &#125;    printf(&quot;è®¡ç®—ç»“æœä¸ºï¼š\\n&quot;);    for(int i = 0; i &lt;count; i++) &#123;        int result = Calculate(p[i]);        printf(&quot;%d\\n&quot;, result);    &#125;    return 0;&#125;\n\ntriggerä»‹ç»triggeræ”¯æŒåˆ—è¡¨ï¼š\n\ngrafanaï¼šå¯ä»¥ Grafana Alert è”åŠ¨ï¼Œé€šè¿‡ Webhook è¿›è¡Œè§¦å‘ã€‚\n\næ‰©å±•å¼€å‘æŒ‡å—{0}æ³¨æ„æ–° trigger åœ¨å¼€å‘æ—¶éœ€è¦è€ƒè™‘å¹¶å‘é—®é¢˜ã€‚å…·ä½“å®ç°å¯æŸ¥çœ‹ grafana.go ä¸­çš„å¤„ç†é€»è¾‘ï¼Œä¹Ÿå¯å‚è€ƒæ ¸å¿ƒåŠŸèƒ½æ¨¡å—å¼€å‘æ–‡æ¡£ä¸­å¹¶å‘å¤„ç†çš„é€»è¾‘ä»‹ç»ã€‚triggeråŒæ ·å®šä¹‰äº†æ¥å£ï¼Œæ–°triggeråªéœ€è¦å®ç°æ¥å£å³å¯ã€‚\ngo&#x2F;&#x2F; Trigger æ˜¯å°ç¦äº‹ä»¶çš„è§¦å‘å™¨æ¥å£ï¼ŒStart å¯åŠ¨ç›‘å¬ä»»åŠ¡ï¼ŒStop åœæ­¢ç›‘å¬ä»»åŠ¡type Trigger interface {    Name() string    Start(ctx context.Context) error    Stop(ctx context.Context) error}\ntriggeråœ¨manager.goâ€‹ä¸­å®ç°äº†StartAllâ€‹å’ŒStopAllâ€‹ï¼Œä¼šå¯åŠ¨åœ¨configmapâ€‹ä¸­æŒ‡å®šçš„æ‰€æœ‰triggerã€‚\n Â triggers: Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â # è§¦å‘å™¨ï¼Œç›®å‰ä»…æ”¯æŒ Grafana Â  Â - name: grafana Â  Â  Â addr: &quot;:8090&quot; Â  Â  Â path: &quot;/trigger/grafana&quot; Â  Â - name: your_trigger Â  Â  Â other: xxx\n\ntriggerè‡ªå®šä¹‰çš„é…ç½®å­—æ®µï¼Œåœ¨main.goâ€‹ä¸­è¿›è¡Œé…ç½®\n// Grafana Trigger ç¤ºä¾‹type TriggerConfig struct &#123;\tName string `yaml:&quot;name&quot;`\tAddr string `yaml:&quot;addr,omitempty&quot;`\tPath string `yaml:&quot;path,omitempty&quot;`&#125;// è§£æ trigger å­—ç¬¦ä¸²ä¸º YAML åˆ—è¡¨func parseTriggers(yamlStr string) ([]TriggerConfig, error) &#123;\tvar triggers []TriggerConfig\terr := yaml.Unmarshal([]byte(yamlStr), &amp;triggers)\tif err != nil &#123;\t\treturn nil, err\t&#125;\treturn triggers, nil&#125;// é€‰æ‹©è§¦å‘å™¨func CreateTriggerByConfig(cfg TriggerConfig, mgr ctrl.Manager) trigger.Trigger &#123;\tswitch cfg.Name &#123;\tcase &quot;grafana&quot;:\t\treturn &amp;trigger.GrafanaTrigger&#123;\t\t\tClient: mgr.GetClient(),\t\t\tAddr:   cfg.Addr,\t\t\tPath:   cfg.Path,\t\t\t// 1000 ä¸ª IPï¼Œ 60 ç§’é˜²æŠ–\t\t\t// LRUä¸­æœ€å¤šä¿å­˜1000ä¸ªIPï¼Œè¾¾åˆ°1000ä¸ªåä¼šè‡ªåŠ¨æ·˜æ±°æœ€è¿‘æœ€å°‘ä½¿ç”¨çš„IP\t\t\t// å¯¹äºåŒä¸€ä¸ªIPï¼Œå¦‚æœæœ€è¿‘60så†…å‘ç”Ÿè¿‡ä¸€æ¬¡å°ç¦ï¼Œé‚£ä¹ˆè¿™60så†…å†æ¬¡æ”¶åˆ°è¯¥IPçš„ç›¸åŒè¯·æ±‚æ—¶ï¼Œä¼šè¢«é˜²æŠ–è¯†åˆ«ä¸ºé‡å¤\t\t\tDebouncer: utils.NewLRUDebouncer(1000, 60*time.Second),\t\t\tIPLocker:  utils.NewIPLock(),\t\t&#125;\t// TODO å…¶ä»–è§¦å‘å™¨ ...\tdefault:\t\treturn nil\t&#125;&#125;\n\npolicyæ”¯æŒåŠŸèƒ½åˆ—è¡¨ï¼š- whitelistï¼šç™½åå•æœºåˆ¶policyå®ç°æ¯”è¾ƒçµæ´»ï¼Œä¸‹é¢æè¿°ç™½åå•æœºåˆ¶çš„å®ç°æµç¨‹ã€‚1. åœ¨`policy/watchlist.go`â€‹ä¸­å®ç°ä¸‰ä¸ªå‡½æ•°   ```go   // ç™½åå•æœºåˆ¶   // å•IPç™½åå•   // CIDRç™½åå•   // æ ‡ç­¾åŒ¹é…      type Whitelist struct &#123;   \tipNets []*net.IPNet // IPNetçš„æŒ‡é’ˆåˆ‡ç‰‡ï¼Œä¿å­˜CIDRç½‘æ®µ   \tips    []net.IP     // ç²¾ç¡®IPç™½åå•   &#125;      // æ–°å»ºç™½åå•   func NewWhitelist(ipList []string) *Whitelist &#123;&#125;      // åˆ¤æ–­ç›®æ ‡IPæ˜¯å¦åœ¨ç™½åå•ä¸­   func (w *Whitelist) IsWhitelisted(ip string) bool &#123;&#125;      // æ‰“å°æ‰€æœ‰ç™½åå•å†…å®¹   func (w *Whitelist) StringSlice() []string &#123;&#125;\n\n\nåœ¨config/loader.goâ€‹ä¸­å®ç°ä¸€ä¸ªLoadWhitelistFromConfigMapâ€‹ï¼Œç”¨äºåŠ è½½å®šä¹‰åœ¨configmapâ€‹ä¸­çš„ç™½åå•IPã€‚\n\nåœ¨main.goâ€‹çš„watchConfigMapâ€‹ä¸­æ¥ç›‘å¬ç™½åå•çš„æ–°å»ºå’Œæ›´æ–°æƒ…å†µã€‚\n\n\nâ€\n","categories":["CS"],"tags":["æ•°æ®ç»“æ„","C"]},{"title":"è°ƒåº¦ä¸Helm","url":"/2025/12/08/%E8%B0%83%E5%BA%A6%E4%B8%8EHelm/","content":"è°ƒåº¦Kuberneteså…è®¸ä½ å»å½±å“podè¢«è°ƒåº¦åˆ°å“ªä¸ªèŠ‚ç‚¹ã€‚èµ·åˆï¼Œåªèƒ½é€šè¿‡åœ¨podè§„èŒƒâ¾¥æŒ‡å®šèŠ‚ç‚¹é€‰æ‹©å™¨æ¥å®ç°ï¼Œåâ¾¯é€šè¿‡å…¶ä»–æœºåˆ¶çš„é€æ¸åŠ â¼Šæ¥æ‰©å®¹è¿™é¡¹åŠŸèƒ½ã€‚\nå›ºå®šèŠ‚ç‚¹ï¼ˆNodeNameï¼‰æŒ‡å®šPodè°ƒåº¦åˆ°æŸä¸ªèŠ‚ç‚¹ä¸Šå¹¶ä¸”å›ºå®š\napiVersion: apps/v1kind: Deploymentmetadata:  name: node-name-test  labels:    app: node-name-testspec:  replicas: 5  selector:    matchLabels:      app: node-name-test  template:    metadata:      labels:        app: node-name-test    spec:      nodeName: master # æŒ‡å®šèŠ‚ç‚¹åå³å¯      containers:      - image: nginx        name: nginx\n\næ ‡ç­¾é€‰æ‹©å™¨æ ¹æ®æ ‡ç­¾é€‰æ‹©å¯ä»¥è°ƒåº¦çš„èŠ‚ç‚¹\nç»™èŠ‚ç‚¹æ‰“æ ‡ç­¾\nkubect label nodes master disk-type=ssd # ç»™åä¸ºmasterçš„èŠ‚ç‚¹æ‰“ä¸Šåä¸ºdisk-typeï¼Œå€¼ä¸ºssdçš„æ ‡ç­¾\n\nå»é™¤æ ‡ç­¾\nkubectl label nodes master disk-type- # æœ€åä¸€ä¸ªæ è¡¨ç¤ºå–æ¶ˆèŠ‚ç‚¹ä¸Šçš„ç‰¹å®šæ ‡ç­¾\n\nåªæœ‰å…·å¤‡è¿™ä¸ªæ ‡ç­¾çš„èŠ‚ç‚¹æ‰ä¼šè¢« Deployment é€‰æ‹©æ¥éƒ¨ç½² Podã€‚\napiVersion: apps/v1kind: Deploymentmetadata:  name: node-name-test  labels:    app: node-name-testspec:  replicas: 5  selector:    matchLabels:      app: node-name-test  template:    metadata:      labels:        app: node-name-test    spec:      containers:      - image: nginx        name: nginx      nodeSelector:        disk-type: ssd\n\næ±¡ç‚¹ï¼ˆTaintsï¼‰å’Œå®¹å¿åº¦ï¼ˆTolerationsï¼‰èŠ‚ç‚¹æ±¡ç‚¹ä»¥åŠpodå¯¹äºæ±¡ç‚¹çš„å®¹å¿åº¦â½¤äºé™åˆ¶å“ªäº›podå¯ä»¥è¢«è°ƒåº¦åˆ°æŸâ¼€ä¸ªèŠ‚ç‚¹ã€‚åªæœ‰å½“â¼€ä¸ªpodå®¹å¿æŸä¸ªèŠ‚ç‚¹çš„æ±¡ç‚¹ï¼Œè¿™ä¸ªpodæ‰èƒ½è¢«è°ƒåº¦åˆ°è¯¥èŠ‚ç‚¹ã€‚\nå®¹å¿åº¦æ˜¯é€šè¿‡æ˜ç¡®çš„åœ¨podä¸­æ·»åŠ çš„ä¿¡æ¯ï¼Œæ¥å†³å®šâ¼€ä¸ªpodå¯ä»¥æˆ–è€…ä¸å¯ä»¥è¢«è°ƒåº¦åˆ°å“ªäº›èŠ‚ç‚¹ä¸Šã€‚\næ±¡ç‚¹åˆ™æ˜¯åœ¨ä¸ä¿®æ”¹å·²æœ‰podä¿¡æ¯çš„å‰æä¸‹ï¼Œé€šè¿‡åœ¨èŠ‚ç‚¹ä¸Šæ·»åŠ æ±¡ç‚¹ä¿¡æ¯ï¼Œæ¥æ‹’ç»podåœ¨æŸäº›èŠ‚ç‚¹ä¸Šçš„éƒ¨ç½²ã€‚\nä½¿ç”¨kubectl describe node &lt;node-name&gt;æ¥æŸ¥çœ‹æ±¡ç‚¹Taints\næ±¡ç‚¹çš„è¡¨ç°å½¢å¼ä¸º&lt;key&gt;=&lt;value&gt;:&lt;effect&gt;\nåœ¨èŠ‚ç‚¹ä¸Šæ‰“ä¸Šæ±¡ç‚¹å¦‚æœæˆ‘æƒ³ç»™èŠ‚ç‚¹æ‰“ä¸Šä¸€ä¸ªæ±¡ç‚¹\nkubectl taint node master node-role.kubernetes.io/master=:NoSchedule # node-role.kubernetes.io/masteræ˜¯ç¤¾åŒºæ¨èçš„æ ‡ç­¾å‘½åçº¦å®škubectl taint node master node-role.kubernetes.io/master- # åœ¨é”®åååŠ -å¯ä»¥å»é™¤æ±¡ç‚¹\n\nè¿™ä¼šç»™masterèŠ‚ç‚¹æ‰“ä¸Šæ±¡ç‚¹ï¼Œé˜»æ­¢ä¸€èˆ¬Podè¢«è°ƒåº¦åˆ°è¯¥èŠ‚ç‚¹ä¸Šã€‚ä¸€èˆ¬å¯ä»¥å®¹å¿è¿™ä¸ªæ±¡ç‚¹çš„Podéƒ½æ˜¯ç³»ç»Ÿçº§åˆ«çš„Podï¼ˆæ¯”å¦‚æŸäº›ç³»ç»Ÿç»„ä»¶ä»¥Podå½¢å¼è¿è¡Œï¼‰\nè€Œeffectæœ‰ä¸‰ç§\n\nNoScheduleè¡¨â½°å¦‚æœpodæ²¡æœ‰å®¹å¿è¿™äº›æ±¡ç‚¹ï¼Œpodåˆ™ä¸èƒ½è¢«è°ƒåº¦åˆ°åŒ…å«è¿™äº›æ±¡ç‚¹çš„èŠ‚ç‚¹ä¸Šã€‚\nPreferNoScheduleæ˜¯NoScheduleçš„â¼€ä¸ªå®½æ¾çš„ç‰ˆæœ¬ï¼Œè¡¨â½°å°½é‡é˜»â½Œpodè¢«è°ƒåº¦åˆ°è¿™ä¸ªèŠ‚ç‚¹ä¸Šï¼Œä½†æ˜¯å¦‚æœæ²¡æœ‰å…¶ä»–èŠ‚ç‚¹å¯ä»¥è°ƒåº¦ï¼Œpodä¾ç„¶ä¼šè¢«è°ƒåº¦åˆ°è¿™ä¸ªèŠ‚ç‚¹ä¸Šã€‚\nNoExecuteä¸åŒäºNoScheduleä»¥åŠPreferNoScheduleï¼Œåä¸¤è€…åªåœ¨è°ƒåº¦æœŸé—´èµ·ä½œâ½¤ï¼Œâ½½NoExecuteä¹Ÿä¼šå½±å“æ­£åœ¨èŠ‚ç‚¹ä¸Šè¿â¾ç€çš„podã€‚å¦‚æœåœ¨â¼€ä¸ªèŠ‚ç‚¹ä¸Šæ·»åŠ äº†NoExecuteæ±¡ç‚¹ï¼Œé‚£äº›åœ¨è¯¥èŠ‚ç‚¹ä¸Šè¿â¾ç€çš„podï¼Œå¦‚æœæ²¡æœ‰å®¹å¿è¿™ä¸ªNoExecuteæ±¡ç‚¹ï¼Œå°†ä¼šä»è¿™ä¸ªèŠ‚ç‚¹å»é™¤ã€‚\n\næ±¡ç‚¹æœ‰ä»€ä¹ˆç”¨ï¼Ÿ\næ¯”å¦‚æœ‰â¼€ä¸ªå•ç‹¬çš„Kubernetesé›†ç¾¤ï¼Œä¸Šâ¾¯åŒæ—¶æœ‰â½£äº§ç¯å¢ƒå’Œâ¾®â½£äº§ç¯å¢ƒçš„æµé‡ã€‚å…¶ä¸­æœ€é‡è¦çš„â¼€ç‚¹æ˜¯ï¼Œâ¾®â½£äº§ç¯å¢ƒçš„podä¸èƒ½è¿â¾åœ¨â½£äº§ç¯å¢ƒçš„èŠ‚ç‚¹ä¸Šã€‚æˆ‘ä»¬å°±å¯ä»¥é€šè¿‡åœ¨â½£äº§ç¯å¢ƒçš„èŠ‚ç‚¹ä¸Šæ·»åŠ æ±¡ç‚¹æ¥æ»¡â¾œè¿™ä¸ªè¦æ±‚ã€‚\nåœ¨Podä¸Šæ·»åŠ æ±¡ç‚¹å®¹å¿åº¦ä¸ºäº†å°†â½£äº§ç¯å¢ƒçš„Podéƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒèŠ‚ç‚¹ä¸Šï¼ŒPodéœ€è¦èƒ½å®¹å¿é‚£äº›ä½ æ·»åŠ åœ¨èŠ‚ç‚¹ä¸Šçš„æ±¡ç‚¹ã€‚\napiVersion: apps/v1kind: Deploymentmetadata:  name: taint-test  labels:    app: taint-testspec:  replicas: 5  selector:    matchLabels:      app: taint-test  template:    metadata:      labels:        app: taint-test    spec:      containers:      - image: nginx        name: nginx      tolerations: # æ·»åŠ å®¹å¿åº¦      - key: node-type        operator: Equal        value: production        effect: NoSchedule\n\nEqualæ“ä½œç¬¦è¦æ±‚æ±¡ç‚¹çš„é”®å’Œå€¼å¿…é¡»ä¸å®¹å¿åº¦è§„åˆ™ä¸­æŒ‡å®šçš„é”®å’Œå€¼å®Œå…¨åŒ¹é…ã€‚ä¹Ÿå°±æ˜¯è¯´åªæœ‰å½“èŠ‚ç‚¹ä¸Šè®¾ç½®äº† key ä¸º node-typeï¼Œå¹¶ä¸”è¿™ä¸ª key å¯¹åº”çš„å€¼ä¸º productionæ—¶ï¼Œæ‰ä¼šä½¿å¾— Pod å…·æœ‰å®¹å¿åº¦ï¼Œå¹¶ä¸”å¯ä»¥è¢«è°ƒåº¦åˆ°å¸¦æœ‰å¯¹åº”æ±¡ç‚¹çš„èŠ‚ç‚¹ä¸Šã€‚å…¶ä»–ä»»ä½•ä¸ç¬¦åˆè¯¥è¦æ±‚çš„æ±¡ç‚¹éƒ½å°†ä¸ä¼šå½±å“ Pod çš„è°ƒåº¦ã€‚\nèŠ‚ç‚¹äº²å’Œæ€§æ±¡ç‚¹å¯ä»¥â½¤æ¥è®©podè¿œç¦»ç‰¹å®šçš„èŠ‚ç‚¹ã€‚è€ŒèŠ‚ç‚¹äº²å’Œæ€§ï¼ˆnode affinityï¼‰è¿™ç§æœºåˆ¶å…è®¸ä½ é€šçŸ¥Kuberneteså°†podåªè°ƒåº¦åˆ°æŸä¸ªâ¼ç‚¹â¼¦é›†ä¸Šâ¾¯ã€‚\nä½¿ç”¨é¦–é€‰çš„èŠ‚ç‚¹äº²å’Œæ€§è°ƒåº¦ Podæœ¬æ¸…å•æè¿°äº†ä¸€ä¸ª Podï¼Œå®ƒæœ‰ä¸€ä¸ªèŠ‚ç‚¹äº²å’Œæ€§è®¾ç½® preferredDuringSchedulingIgnoredDuringExecutionï¼Œdisktype: ssdã€‚ è¿™æ„å‘³ç€ Pod å°†é¦–é€‰å…·æœ‰ disktype=ssd æ ‡ç­¾çš„èŠ‚ç‚¹ã€‚pods/pod-nginx-preferred-affinity.yaml å¤åˆ¶ pods/pod-nginx-preferred-affinity.yaml åˆ°å‰ªè´´æ¿apiVersion: v1kind: Podmetadata:  name: nginxspec:  affinity:    nodeAffinity:      preferredDuringSchedulingIgnoredDuringExecution:      - weight: 1        preference:          matchExpressions:          - key: disktype            operator: In            values:            - ssd            containers:  - name: nginx    image: nginx    imagePullPolicy: IfNotPresent\n\næ¢é’ˆKubernetes ä¸ºæ£€æŸ¥åº”ç”¨çŠ¶æ€å®šä¹‰äº†ä¸‰ç§æ¢é’ˆï¼Œå®ƒä»¬åˆ†åˆ«å¯¹åº”å®¹å™¨ä¸åŒçš„çŠ¶æ€ï¼š\n\nStartupï¼Œå¯åŠ¨æ¢é’ˆï¼Œç”¨æ¥æ£€æŸ¥åº”ç”¨æ˜¯å¦å·²ç»å¯åŠ¨æˆåŠŸï¼Œé€‚åˆé‚£äº›æœ‰å¤§é‡åˆå§‹åŒ–å·¥ä½œè¦åšï¼Œå¯åŠ¨å¾ˆæ…¢çš„åº”ç”¨ã€‚\nLivenessï¼Œå­˜æ´»æ¢é’ˆï¼Œç”¨æ¥æ£€æŸ¥åº”ç”¨æ˜¯å¦æ­£å¸¸è¿è¡Œï¼Œæ˜¯å¦å­˜åœ¨æ­»é”ã€æ­»å¾ªç¯ã€‚\nReadinessï¼Œå°±ç»ªæ¢é’ˆï¼Œç”¨æ¥æ£€æŸ¥åº”ç”¨æ˜¯å¦å¯ä»¥æ¥æ”¶æµé‡ï¼Œæ˜¯å¦èƒ½å¤Ÿå¯¹å¤–æä¾›æœåŠ¡ã€‚\n\nå¦‚æœä¸€ä¸ª Pod é‡Œçš„å®¹å™¨é…ç½®äº†æ¢é’ˆï¼ŒKubernetes åœ¨å¯åŠ¨å®¹å™¨åå°±ä¼šä¸æ–­åœ°è°ƒç”¨æ¢é’ˆæ¥æ£€æŸ¥å®¹å™¨çš„çŠ¶æ€ï¼š\n\nå¦‚æœ Startup æ¢é’ˆå¤±è´¥ï¼ŒKubernetes ä¼šè®¤ä¸ºå®¹å™¨æ²¡æœ‰æ­£å¸¸å¯åŠ¨ï¼Œå°±ä¼šå°è¯•åå¤é‡å¯ï¼Œå½“ç„¶å…¶åé¢çš„ Liveness æ¢é’ˆå’Œ Readiness æ¢é’ˆä¹Ÿä¸ä¼šå¯åŠ¨ã€‚\nå¦‚æœ Liveness æ¢é’ˆå¤±è´¥ï¼ŒKubernetes å°±ä¼šè®¤ä¸ºå®¹å™¨å‘ç”Ÿäº†å¼‚å¸¸ï¼Œä¹Ÿä¼šé‡å¯å®¹å™¨ã€‚\nå¦‚æœ Readiness æ¢é’ˆå¤±è´¥ï¼ŒKubernetes ä¼šè®¤ä¸ºå®¹å™¨è™½ç„¶åœ¨è¿è¡Œï¼Œä½†å†…éƒ¨æœ‰é”™è¯¯ï¼Œä¸èƒ½æ­£å¸¸æä¾›æœåŠ¡ï¼Œå°±ä¼šæŠŠå®¹å™¨ä» Service å¯¹è±¡çš„è´Ÿè½½å‡è¡¡é›†åˆä¸­æ’é™¤ï¼Œä¸ä¼šç»™å®ƒåˆ†é…æµé‡ã€‚\n\nå¤åˆ¶\n# kubectl explain pod.spec.containers.startupProbe# kubectl explain pod.spec.containers.livenessProbe# kubectl explain pod.spec.containers.readinessProbe## kubectl logs ngx-pod-probe -f---# this cm will be mounted to /etc/nginx/conf.dapiVersion: v1kind: ConfigMapmetadata:  name: ngx-confdata:  default.conf: |    server &#123;      listen 80;      location = /ready &#123;        return 200 &#x27;I am ready&#x27;;        #return 500 &#x27;I am not ready&#x27;;      &#125;      location / &#123;        default_type text/plain;        return 200 &quot;Nginx OK&quot;;      &#125;    &#125;---apiVersion: v1kind: Podmetadata:  name: ngx-pod-probespec:  volumes:  - name: ngx-conf-vol    configMap:      name: ngx-conf  containers:  - image: nginx:alpine    name: ngx    ports:    - containerPort: 80    volumeMounts:    - mountPath: /etc/nginx/conf.d      name: ngx-conf-vol    # probes are here    startupProbe:      periodSeconds: 1      timeoutSeconds: 1      exec:        command: [&quot;cat&quot;, &quot;/var/run/nginx.pid&quot;]        #command: [&quot;cat&quot;, &quot;nginx.pid&quot;]  # wrong pid file    livenessProbe:      periodSeconds: 10      timeoutSeconds: 1      #failureThreshold: 1      tcpSocket:        #port: 80        port: 8080    readinessProbe:      periodSeconds: 5      timeoutSeconds: 1      httpGet:        path: /ready        port: 80---\n\nèµ„æºé…é¢æœ‰äº†åå­—ç©ºé—´ï¼Œæˆ‘ä»¬å°±å¯ä»¥åƒç®¡ç†å®¹å™¨ä¸€æ ·ï¼Œç»™åå­—ç©ºé—´è®¾å®šé…é¢ï¼ŒæŠŠæ•´ä¸ªé›†ç¾¤çš„è®¡ç®—èµ„æºåˆ†å‰²æˆä¸åŒçš„å¤§å°ï¼ŒæŒ‰éœ€åˆ†é…ç»™å›¢é˜Ÿæˆ–é¡¹ç›®ä½¿ç”¨ã€‚\nåå­—ç©ºé—´çš„èµ„æºé…é¢éœ€è¦ä½¿ç”¨ä¸€ä¸ªä¸“é—¨çš„ API å¯¹è±¡ï¼Œå«åš ResourceQuotaâ€‹ï¼Œå› ä¸ºèµ„æºé…é¢å¯¹è±¡å¿…é¡»ä¾é™„åœ¨æŸä¸ªåå­—ç©ºé—´ä¸Šï¼Œæ‰€ä»¥åœ¨å®ƒçš„ metadataâ€‹ å­—æ®µé‡Œå¿…é¡»æ˜ç¡®å†™å‡º namespaceâ€‹ï¼ˆå¦åˆ™å°±ä¼šåº”ç”¨åˆ° default åå­—ç©ºé—´ï¼‰ã€‚\nå¤åˆ¶\n# kubectl create ns dev-ns $out# kubectl create quota dev-qt $out## kubectl explain quota.spec# kubectl describe -n dev-ns quota dev-qt## kubectl explain limits.spec.limits## kubectl run ngx --image=nginx:alpine -n dev-ns# kubectl describe pod ngx -n dev-ns---apiVersion: v1kind: Namespacemetadata:  name: dev-ns---apiVersion: v1kind: ResourceQuotametadata:  name: dev-qt  namespace: dev-nsspec:  hard:    requests.cpu: 10    requests.memory: 10Gi    limits.cpu: 10    limits.memory: 20Gi    requests.storage: 100Gi    persistentvolumeclaims: 100    pods: 100    configmaps: 100    secrets: 100    services: 10    services.nodeports: 5    count/jobs.batch: 1    count/cronjobs.batch: 1    count/deployments.apps: 1---apiVersion: v1kind: LimitRangemetadata:  name: dev-limits  namespace: dev-nsspec:  limits:  - type: Container    defaultRequest:      cpu: 200m      memory: 50Mi    default:      cpu: 500m      memory: 100Mi  - type: Pod    max:      cpu: 800m      memory: 200Mi---\n\nå®ƒéœ€è¦åœ¨ specâ€‹ é‡Œä½¿ç”¨ hardâ€‹ å­—æ®µï¼Œæ„æ€å°±æ˜¯â€œç¡¬æ€§å…¨å±€é™åˆ¶â€ã€‚\n\nCPU å’Œå†…å­˜é…é¢ï¼Œä½¿ç”¨ request.*â€‹ã€limits.*â€‹ï¼Œè¿™æ˜¯å’Œå®¹å™¨èµ„æºé™åˆ¶æ˜¯ä¸€æ ·çš„ã€‚\nå­˜å‚¨å®¹é‡é…é¢ï¼Œä½¿ requests.storageâ€‹ é™åˆ¶çš„æ˜¯ PVC çš„å­˜å‚¨æ€»é‡ï¼Œä¹Ÿå¯ä»¥ç”¨ persistentvolumeclaimsâ€‹ é™åˆ¶ PVC çš„ä¸ªæ•°ã€‚\næ ¸å¿ƒå¯¹è±¡é…é¢ï¼Œä½¿ç”¨å¯¹è±¡çš„åå­—ï¼ˆè‹±è¯­å¤æ•°å½¢å¼ï¼‰ï¼Œæ¯”å¦‚ podsâ€‹ã€configmapsâ€‹ã€secretsâ€‹ã€servicesâ€‹ã€‚\nå…¶ä»– API å¯¹è±¡é…é¢ï¼Œä½¿ç”¨ count/name.groupâ€‹ çš„å½¢å¼ï¼Œæ¯”å¦‚ count/jobs.batchâ€‹ã€count/deployments.appsâ€‹ã€‚\n\nåœ¨åå­—ç©ºé—´åŠ ä¸Šäº†èµ„æºé…é¢é™åˆ¶ä¹‹åï¼Œå®ƒä¼šæœ‰ä¸€ä¸ªåˆç†ä½†æ¯”è¾ƒâ€œçƒ¦äººâ€çš„çº¦æŸï¼šè¦æ±‚æ‰€æœ‰åœ¨é‡Œé¢è¿è¡Œçš„ Pod éƒ½å¿…é¡»ç”¨å­—æ®µ resourcesâ€‹ å£°æ˜èµ„æºéœ€æ±‚ï¼Œå¦åˆ™å°±æ— æ³•åˆ›å»ºã€‚è¿™ä¸ªæ—¶å€™å°±è¦ç”¨åˆ°ä¸€ä¸ªå¾ˆå°ä½†å¾ˆæœ‰ç”¨çš„è¾…åŠ©å¯¹è±¡äº†â€”â€”  LimitRangeâ€‹ ï¼Œç®€ç§°æ˜¯ limitsâ€‹ ï¼Œå®ƒèƒ½ä¸º API å¯¹è±¡æ·»åŠ é»˜è®¤çš„èµ„æºé…é¢é™åˆ¶ã€‚\n\nspec.limitsâ€‹ æ˜¯å®ƒçš„æ ¸å¿ƒå±æ€§ï¼Œæè¿°äº†é»˜è®¤çš„èµ„æºé™åˆ¶ã€‚\ntypeâ€‹ æ˜¯è¦é™åˆ¶çš„å¯¹è±¡ç±»å‹ï¼Œå¯ä»¥æ˜¯ Containerâ€‹ã€Podâ€‹ã€PersistentVolumeClaimâ€‹ã€‚\ndefaultâ€‹ æ˜¯é»˜è®¤çš„èµ„æºä¸Šé™ï¼Œå¯¹åº”å®¹å™¨é‡Œçš„ resources.limitsâ€‹ï¼Œåªé€‚ç”¨äº Containerâ€‹ã€‚\ndefaultRequestâ€‹ é»˜è®¤ç”³è¯·çš„èµ„æºï¼Œå¯¹åº”å®¹å™¨é‡Œçš„ resources.requestsâ€‹ï¼ŒåŒæ ·ä¹Ÿåªé€‚ç”¨äº Containerâ€‹ã€‚\nmaxâ€‹ã€minâ€‹ æ˜¯å¯¹è±¡èƒ½ä½¿ç”¨çš„èµ„æºçš„æœ€å¤§æœ€å°å€¼ã€‚\n\nHelm\nHelm | Docs\n\nHelmæ˜¯ä¸€æ¬¾å¼€æºçš„K8såŒ…ç®¡ç†å™¨ï¼Œç±»ä¼¼äºaptï¼Œyumæˆ–è€…Pythonä¸­çš„ pip ä¸€æ ·ï¼Œèƒ½å¿«é€ŸæŸ¥æ‰¾ã€ä¸‹è½½å’Œå®‰è£…è½¯ä»¶åŒ…ã€‚Helmèƒ½å¤Ÿå°†ä¸€ç»„K8Sèµ„æºæ‰“åŒ…ç»Ÿä¸€ç®¡ç†, æ˜¯æŸ¥æ‰¾ã€å…±äº«å’Œä½¿ç”¨ä¸ºKubernetesæ„å»ºçš„è½¯ä»¶çš„æœ€ä½³æ–¹å¼ã€‚\nä¸ºä»€ä¹ˆè¦ä½¿ç”¨Helmï¼Ÿ\nå‡å¦‚ç°åœ¨éœ€è¦éƒ¨ç½²ä¸€ä¸ªå¤æ‚ä¸”åºå¤§çš„æœåŠ¡ï¼Œæˆ‘éœ€è¦å¾ˆå¤šä¸ªyamlæ–‡ä»¶ä¸€ä¸ªä¸€ä¸ªé…å¥½æ¯ä¸€ç§èµ„æºå¯¹è±¡ï¼Œè¿™æ ·åšå¾ˆéº»çƒ¦ã€‚Helmå¾ˆå¥½åœ°è§£å†³äº†è¿™ä¸ªé—®é¢˜ï¼Œå®ƒèƒ½å¤ŸæŠŠè¿™äº›é›¶é›¶æ•£æ•£çš„åº”ç”¨èµ„æºæ–‡ä»¶æ”¾åœ¨ä¸€èµ·è¿›è¡Œç»Ÿä¸€é…ç½®ï¼Œä»è€Œæ–¹ä¾¿å…¶ä»–äººåœ°éƒ¨ç½²ä¸ä½¿ç”¨ï¼Œå°±å’Œapt installä¸€æ ·ï¼Œä»…ä»…ä¸€å¥helm installå°±å¯ä»¥éƒ¨ç½²å¥½ä¸€ä¸ªç°æˆçš„æœåŠ¡äº†ã€‚\nå®‰è£…ä½¿ç”¨è„šæœ¬å®‰è£…ï¼Œå®ƒå¯ä»¥è®©ä½ çŸ¥é“åœ¨æ‰§è¡Œä¹‹å‰è„šæœ¬åšäº†ä»€ä¹ˆ\ncurl -fsSL -o get_helm.sh https://raw.githubusercontent.com/helm/helm/main/scripts/get-helm-3chmod 700 get_helm.sh./get_helm.sh\n\næˆ–è€…ç›´æ¥æ‰§è¡Œå®‰è£…\ncurl https://raw.githubusercontent.com/helm/helm/main/scripts/get-helm-3 | bash\n\nåŸºæœ¬æ¦‚å¿µChart ä»£è¡¨ç€ Helm åŒ…ã€‚å®ƒåŒ…å«åœ¨ Kubernetes é›†ç¾¤å†…éƒ¨è¿è¡Œåº”ç”¨ç¨‹åºï¼Œå·¥å…·æˆ–æœåŠ¡æ‰€éœ€çš„æ‰€æœ‰èµ„æºå®šä¹‰ã€‚ä½ å¯ä»¥æŠŠå®ƒçœ‹ä½œæ˜¯ Apt dpkgï¼Œæˆ– Yum RPM åœ¨Kubernetes ä¸­çš„ç­‰ä»·ç‰©ã€‚\nRepositoryï¼ˆä»“åº“ï¼‰  æ˜¯ç”¨æ¥å­˜æ”¾å’Œå…±äº« charts çš„åœ°æ–¹ã€‚å®˜æ–¹ä»“åº“æ˜¯hub.helm.shï¼Œä½ ä¹Ÿå¯ä»¥ç”¨Harboræ¥å­˜æ”¾chartsã€‚\nRelease æ˜¯è¿è¡Œåœ¨ Kubernetes é›†ç¾¤ä¸­çš„ chart çš„å®ä¾‹ã€‚ä¸€ä¸ª chart é€šå¸¸å¯ä»¥åœ¨åŒä¸€ä¸ªé›†ç¾¤ä¸­å®‰è£…å¤šæ¬¡ï¼Œæ¯ä¸€ä¸ªreleaseæŒ‡å®šä¸åŒçš„åç§°å³å¯ã€‚æ¯ä¸€æ¬¡å®‰è£…éƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„ releaseã€‚\nHelmçš„å·¥ä½œæµç¨‹ï¼šHelm å®‰è£… charts åˆ° Kubernetes é›†ç¾¤ä¸­ï¼Œæ¯æ¬¡å®‰è£…éƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„ releaseã€‚ä½ å¯ä»¥åœ¨ Helm çš„ chart repositories ä¸­å¯»æ‰¾æ–°çš„ chartã€‚\nåŸºæœ¬å‘½ä»¤ä½¿ç”¨helm searchç”¨æ¥æŸ¥æ‰¾Charts\nhelm search hub wordpressæŸ¥æ‰¾Artifact Hubä¸­æœç´¢åˆ°æ‰€æœ‰çš„wordpress charts\n\nhelm search repoä»ä½ æ·»åŠ çš„ä»“åº“ä¸­æŸ¥æ‰¾chart\n\nhelm installç”¨æ¥å®‰è£…helmåŒ…\nhelm search repo wordpresshelm install wordpress bitnami/wordpress # ä»bitnamiè¿™ä¸ªä»“åº“ä¸­å®‰è£…wordpressçš„chartï¼ŒæŠŠè¿™ä¸ªreleaseå‘½åä¸ºwordpressï¼Œå®ƒè¢«å®‰è£…åœ¨defaultä¸‹\n\nhelm statuså¯ä»¥ç”¨æ¥è¿½è¸ªreleaseçš„çŠ¶æ€\nä½¿ç”¨helm uninstall -n &lt;namespace&gt; æ¥å¸è½½release\nhelm uninstall wordpress # æŒ‡å®šreleaseåç§°helm list # æŸ¥çœ‹å½“å‰å‘½åç©ºé—´éƒ¨ç½²çš„æ‰€æœ‰release\n\nè‡ªå®šä¹‰å®‰è£…é…ç½®å¾ˆå¤šæ—¶å€™æˆ‘ä»¬éœ€è¦è‡ªå®šä¹‰chartæ¥æŒ‡å®šæˆ‘ä»¬æƒ³è¦çš„é…ç½®ã€‚\nä½¿ç”¨ helm show values å¯ä»¥æŸ¥çœ‹ chart ä¸­çš„å¯é…ç½®é€‰é¡¹\nä½ å¯ä»¥helm pull  &lt;chart.tgz&gt;æ‰‹åŠ¨æ‹‰å–chartåŒ…ï¼Œè§£å‹åæ‰‹åŠ¨ä¿®æ”¹å…¶ä¸­çš„values.yamlä¸­çš„ä»»æ„é…ç½®é¡¹ï¼Œç„¶ååœ¨å®‰è£…æ—¶æŒ‡å®šæˆ‘ä»¬è‡ªå®šä¹‰çš„é…ç½®\nhelm install -f values.yaml bitnami/wordpress\n\nå¦‚æœé…ç½®ä¸å¤šï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨å‘½ä»¤è¡Œ-- setæ¥å¯¹æŒ‡å®šé¡¹è¿›è¡Œè¦†ç›–\n--setæœ‰ä¸€äº›æ ¼å¼é™åˆ¶ï¼š\næœ€ç®€å•ç”¨æ³•ï¼ˆé”®å€¼å¯¹å½¢å¼ï¼‰ï¼šâ€“set name&#x3D;valueï¼Œç­‰ä»·äºå¦‚ä¸‹yamlæ ¼å¼\nname: value\n\nå¤šä¸ªå€¼ç”¨é€—å·åˆ†éš”ï¼šâ€“set outer.inner&#x3D;valueï¼Œä»–è¢«è½¬åŒ–ä¸º\nouter:  inner: value\n\nåˆ—è¡¨ä½¿ç”¨èŠ±æ‹¬å·ï¼šâ€“set name&#x3D;{a, b, c}ï¼Œç­‰ä»·äº\nname:  - a  - b  - c\n\næŸäº›é”®å€¼å¯ä»¥è®¾ç½®ä¸ºnullæˆ–ç©ºï¼šâ€“set name&#x3D;[],a&#x3D;null\nname: []a: null\n\nä»2.5.0ç‰ˆæœ¬å¼€å§‹ï¼Œè¿˜å¯ä»¥ä½¿ç”¨æ•°ç»„ä¸‹æ ‡çš„æ–¹å¼è®¿é—®åˆ—è¡¨ä¸­çš„å…ƒç´ ã€‚ä¾‹å¦‚ï¼šâ€“set servers[0].port&#x3D;80\nservers:  - port: 80\n\nå¤šä¸ªå€¼ï¼ˆé€—å·åˆ†éš”ï¼‰ï¼šâ€“set servers[0].port&#x3D;80,servers[0].host&#x3D;example\nservers:  - port: 80    host: example\n\nå¦‚æœè¦ä½¿ç”¨ç‰¹æ®Šå­—ç¬¦ï¼Œä½¿ç”¨åæ–œçº¿æ¥è½¬ä¹‰ï¼šâ€“set name&#x3D;value1,value2\nname: &quot;value1,value2&quot;\n\næ›´å¤æ‚çš„è¯å°±ä¸è¦ä½¿ç”¨â€“setäº†ï¼Œç›´æ¥ä¿®æ”¹values.yaml\nhelm upgradeå’Œhelm rollbackç”¨æ¥å‡çº§releaseå’Œå¤±è´¥æ—¶æ¢å¤\nä¸€æ¬¡å‡çº§æ“ä½œä¼šä½¿ç”¨å·²æœ‰çš„ release å¹¶æ ¹æ®ä½ æä¾›çš„ä¿¡æ¯å¯¹å…¶è¿›è¡Œå‡çº§ã€‚ç”±äº Kubernetes çš„ chart å¯èƒ½ä¼šå¾ˆå¤§è€Œä¸”å¾ˆå¤æ‚ï¼ŒHelm ä¼šå°è¯•æ‰§è¡Œæœ€å°ä¾µå…¥å¼å‡çº§ã€‚å³å®ƒåªä¼šæ›´æ–°è‡ªä¸Šæ¬¡å‘å¸ƒä»¥æ¥å‘ç”Ÿäº†æ›´æ”¹çš„å†…å®¹ã€‚\n$ helm upgrade -f panda.yaml happy-panda bitnami/wordpress\n\nåœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œhappy-panda è¿™ä¸ª release ä½¿ç”¨ç›¸åŒçš„ chart è¿›è¡Œå‡çº§ï¼Œä½†æ˜¯ä½¿ç”¨äº†ä¸€ä¸ªæ–°çš„ YAML æ–‡ä»¶ï¼š\nmariadb.auth.username: user1\n\nè¿™æ ·é…ç½®ä¸­ä¼šæ›´æ–°è¿™ä¸€é¡¹é…ç½®\nå¦‚æœå‘å¸ƒè¿‡ç¨‹ä¸­å‡ºç°ä¸ç¬¦åˆé¢„æœŸçš„äº‹æƒ…ï¼Œhelmå¯ä»¥åƒdeploymentä¸€æ ·è¿›è¡Œå›æ»šåˆ°ä¹‹å‰çš„ç‰ˆæœ¬\nhelm repoå¯ä»¥æŸ¥çœ‹ä»“åº“\nhelm repo liståˆ—å‡ºå½“å‰å·²ç»æ·»åŠ çš„ä»“åº“\nhelm repo addæ·»åŠ æ–°çš„ä»“åº“\nhelm repo updateæ›´æ–°ä»“åº“\nåˆ›å»ºè‡ªå·±çš„chartså¿«é€Ÿå¼€å§‹ä½ å¯ä»¥é€šè¿‡helm createæ¥å¿«é€Ÿç”Ÿæˆä¸€ä¸ªchartæ¨¡æ¿\nåœ¨ç¼–è¾‘chartæ—¶ï¼Œå¯ä»¥é€šè¿‡helm lintéªŒè¯æ ¼å¼æ˜¯å¦æ­£ç¡®\nç¼–è¾‘å®Œæˆåï¼Œä½¿ç”¨helm packageæ¥æ‰“åŒ…chartï¼Œç„¶åè¿™ä¸ªchartå°±å¯ä»¥installå®‰è£…ï¼Œè¿˜å¯ä»¥ä¸Šä¼ åˆ°chartä»“åº“ä¸­ã€‚\nå½“ä½ æƒ³æµ‹è¯•æ¨¡æ¿æ¸²æŸ“çš„å†…å®¹ä½†åˆä¸æƒ³å®‰è£…ä»»ä½•å®é™…åº”ç”¨æ—¶ï¼Œå¯ä»¥ä½¿ç”¨helm install --debug --dry-run goodly-guppy ./mynginxã€‚è¿™æ ·ä¸ä¼šå®‰è£…åº”ç”¨(chart)åˆ°ä½ çš„kubenetesé›†ç¾¤ä¸­ï¼Œåªä¼šæ¸²æŸ“æ¨¡æ¿å†…å®¹åˆ°æ§åˆ¶å°ï¼ˆç”¨äºæµ‹è¯•ï¼‰ã€‚\nç¼–å†™ç›¸å…³æ–‡ä»¶Helm chartçš„ç»“æ„å¦‚ä¸‹ï¼š\nmychart/  Chart.yaml  values.yaml  charts/  templates/  ...\n\ntemplates/ ç›®å½•åŒ…æ‹¬äº†æ¨¡æ¿æ–‡ä»¶ã€‚ä¹Ÿå°±æ˜¯Deploymentã€Serviceã€ConfigMapç­‰çš„yamlæ–‡ä»¶ï¼Œhelmä¼šå°†è¿™äº›å‘é€ç»™Kubernetesï¼ŒKubernetesæ ¹æ®è¿™äº›åˆ›å»ºèµ„æºã€‚å’Œä¸€èˆ¬çš„åˆ›å»ºèµ„æºæ–¹å¼ä¸åŒçš„æ˜¯ï¼Œè¿™äº›yamlæ–‡ä»¶ä¸­çš„ä¸€äº›å‚æ•°å’Œå˜é‡ä¼šåœ¨å®‰è£…æ—¶ç”± Helm è¿›è¡Œæ›¿æ¢æˆ–å¡«å……ï¼Œç„¶ååœ¨values.yamlé›†ä¸­è®¾ç½®ã€‚\nvalues.yaml æ–‡ä»¶ä¹Ÿå¯¼å…¥åˆ°äº†æ¨¡æ¿ã€‚è¿™ä¸ªæ–‡ä»¶åŒ…å«äº†chartçš„ é»˜è®¤å€¼ ã€‚\nChart.yaml æ–‡ä»¶åŒ…å«äº†è¯¥chartçš„æè¿°ã€‚\nåˆ›å»ºä¸€ä¸ªè‡ªå·±çš„nginx chart\nhelm create mynginx\n\nå¯ä»¥çœ‹åˆ°mynginx/templates/ ç›®å½•ä¸‹ä¸€äº›æ–‡ä»¶å·²ç»å­˜åœ¨äº†ï¼š\n\nNOTES.txt: chartçš„â€å¸®åŠ©æ–‡æœ¬â€ã€‚è¿™ä¼šåœ¨ä½ çš„ç”¨æˆ·æ‰§è¡Œhelm installæ—¶å±•ç¤ºç»™ä»–ä»¬ã€‚\ndeployment.yaml: åˆ›å»ºKubernetes å·¥ä½œè´Ÿè½½çš„åŸºæœ¬æ¸…å•\nservice.yaml: ä¸ºä½ çš„å·¥ä½œè´Ÿè½½åˆ›å»ºä¸€ä¸ª serviceç»ˆç«¯åŸºæœ¬æ¸…å•ã€‚\n_helpers.tpl: æ”¾ç½®å¯ä»¥é€šè¿‡chartå¤ç”¨çš„æ¨¡æ¿è¾…åŠ©å¯¹è±¡\n\næˆ‘ä»¬å…ˆæŠŠå®ƒä»¬éƒ½åˆ æ‰ï¼Œç„¶åè‡ªå·±åˆ›ä½œç›¸å…³æ–‡ä»¶ã€‚\næˆ‘ä»¬çš„templates/ä¸‹ä¸»è¦éœ€è¦deployment.yamlå’Œservice.yaml\næ¨¡æ¿æ–‡ä»¶å¯ä»¥åƒå¹³æ—¶æ‰‹åŠ¨ç¼–å†™èµ„æºæ¸…å•yamlæ–‡ä»¶çš„æ ¼å¼ä¸€æ ·ï¼Œä½†æ˜¯å°†æŸäº›å€¼ç¡¬ç¼–ç åˆ°ä¸€ä¸ªé”®ä¸­ä¸æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„æ–¹å¼ã€‚helmæå€¡ä½¿ç”¨æ’å…¥çš„æ–¹å¼æ¥ç”ŸæˆæŸäº›å­—æ®µï¼Œè¿™æ ·å¯ä»¥æé«˜é…ç½®çš„çµæ´»æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚\nhelmä¸­ä»¥&#123;&#123; xxx &#125;&#125;çš„å½¢å¼æ¥è¿›è¡Œæ’å…¥ã€‚\næˆ‘ä»¬ä»¥è¿™ä¸¤ä¸ªæ­£å¸¸çš„èµ„æºæ–‡ä»¶ä½œä¸ºåŸºç¡€ï¼Œç„¶åæŒ‰ç…§æ’å…¥çš„æ–¹å¼æ¥å¯¹æŸäº›å­—æ®µè¿›è¡Œä¿®æ”¹ï¼Œä½¿å®ƒä»¬å˜å¾—æœ‰helmçš„é£æ ¼ã€‚\nå†…ç½®å¯¹è±¡\nå¯¹è±¡å¯ä»¥é€šè¿‡æ¨¡æ¿å¼•æ“ä¼ é€’åˆ°æ¨¡æ¿ä¸­ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›å†…ç½®çš„å¯¹è±¡ã€‚\n\nReleaseï¼šReleaseå¯¹è±¡æè¿°äº†ç‰ˆæœ¬å‘å¸ƒæœ¬èº«ã€‚æ¯”å¦‚å¸¸ç”¨çš„Release.Nameï¼Œä»£è¡¨äº†releaseçš„åç§°ã€‚\nValuesï¼šValueså¯¹è±¡æ˜¯ä»values.yamlæ–‡ä»¶å’Œç”¨æˆ·æä¾›çš„æ–‡ä»¶ä¼ è¿›æ¨¡æ¿çš„ã€‚é»˜è®¤ä¸ºç©ºã€‚\nChartï¼šChart.yamlæ–‡ä»¶å†…å®¹ã€‚ Chart.yamlé‡Œçš„æ‰€æœ‰æ•°æ®åœ¨è¿™é‡Œéƒ½å¯ä»¥å¯è®¿é—®çš„ã€‚æ¯”å¦‚ &#123;&#123; .Chart.Name &#125;&#125;-&#123;&#123; .Chart.Version &#125;&#125; ä¼šæ‰“å°å‡º mychart-0.1.0\n\nValuesæ–‡ä»¶\nå®ƒçš„å†…å®¹å¯ä»¥æ¥è‡ªå¤šä¸ªä½ç½®\n\nchartä¸­çš„values.yamlæ–‡ä»¶\nä½¿ç”¨-få‚æ•°(helm install -f myvals.yaml ./mychart)ä¼ é€’åˆ° helm install æˆ– helm upgradeçš„valuesæ–‡ä»¶\nä½¿ç”¨--set (æ¯”å¦‚helm install --set foo=bar ./mychart)ä¼ é€’çš„å•ä¸ªå‚æ•°\n\nä»¥ä¸Šåˆ—è¡¨æœ‰æ˜ç¡®é¡ºåºï¼šé»˜è®¤ä½¿ç”¨values.yamlï¼Œä¼˜å…ˆçº§ä¸ºvalues.yamlæœ€ä½ï¼Œ--setå‚æ•°æœ€é«˜ã€‚\næ¨¡æ¿å‡½æ•°\nåˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬å·²ç»çŸ¥é“äº†å¦‚ä½•å°†ä¿¡æ¯ä¼ åˆ°æ¨¡æ¿ä¸­ã€‚ ä½†æ˜¯ä¼ å…¥çš„ä¿¡æ¯å¹¶ä¸èƒ½è¢«ä¿®æ”¹ã€‚ æœ‰æ—¶æˆ‘ä»¬å¸Œæœ›ä»¥ä¸€ç§æ›´æœ‰ç”¨çš„æ–¹å¼æ¥è½¬æ¢æ‰€æä¾›çš„æ•°æ®ã€‚\nhelmä¸­é€šå¸¸å€’ç½®å‘½ä»¤ï¼Œå€Ÿç”¨ç®¡é“ç¬¦æ¥ä½¿ç”¨å‡½æ•°ï¼Œè¿™ç§æ„Ÿè§‰å°±åƒä½¿ç”¨ç®¡é“ç¬¦æŠŠå‚æ•°â€œå‘é€â€ç»™å‡½æ•°ã€‚\næ¯”å¦‚quoteå‡½æ•°æŠŠ.Valueså¯¹è±¡ä¸­çš„å­—ç¬¦ä¸²å±æ€§ç”¨å¼•å·å¼•èµ·æ¥ï¼Œç„¶åæ”¾åˆ°æ¨¡æ¿ä¸­\næœ¬æ¥åº”è¯¥è¿™æ ·å†™\né¦–å…ˆåœ¨values.yamlä¸­å®šä¹‰\nfavourite: rice\n\n&#123;&#123; quote .Values.favorite.food &#125;&#125;  # è½¬æ¢ä¸º&quot;rice&quot;ï¼Œå°±æ˜¯åŠ äº†ä¸ªå¼•å·\n\nä½†helmæå€¡è¿™æ ·å†™\n&#123;&#123; .Values.favorite.food | quote &#125;&#125;\n\næ¨¡æ¿ä¸­é¢‘ç¹ä½¿ç”¨çš„ä¸€ä¸ªå‡½æ•°æ˜¯defaultï¼Œè¿™ä¸ªå‡½æ•°å…è®¸ä½ åœ¨æ¨¡æ¿ä¸­æŒ‡å®šä¸€ä¸ªé»˜è®¤å€¼ï¼Œä»¥é˜²è¿™ä¸ªå€¼è¢«å¿½ç•¥ã€‚\nnamespace: &#123;&#123; .Values.namespace | default &quot;default&quot; &#125;&#125;# æŒ‡å®šå‘½åç©ºé—´ï¼Œå¦‚æœvalues.yamlé‡Œæ²¡æœ‰æŒ‡å®šï¼ˆæ²¡æœ‰namespaceè¿™ä¸ªé”®ï¼‰ï¼Œå°±é»˜è®¤æŒ‡å®šdefault\n\næµæ§åˆ¶\næœ‰æ—¶æˆ‘ä»¬åœ¨values.yamlä¸­ä¼šåˆ©ç”¨enable: true/falseæ¥å¼€å¯æˆ–å…³é—­æŸäº›åŠŸèƒ½è¿™æ˜¯å¯ä»¥åˆ©ç”¨æ§åˆ¶ç»“æ„if/elseå—æ¥å®ç°ã€‚values.yamlä¸­å¼€å¯NodePort\nNodePort:  enable: true # or flase ä½¿ç”¨å¸ƒå°”å€¼  type: NodePort  nodePort: 30001  port: 9376\n\ntemplates/NodePort.yamlé¦–å°¾åŠ ä¸Š&#123;&#123; if .Values.NodePort.enable &#125;&#125;å’Œ&#123;&#123; end &#125;&#125;å³å¯\nè¿˜æœ‰å…¶ä»–çš„æ§åˆ¶ç»“æ„\n\nwithï¼šç”¨æ¥æŒ‡å®šå˜é‡èŒƒå›´\nrangeï¼šç”¨åšå¾ªç¯\n\nå‘½åæ¨¡æ¿\nåœ¨ç¼–å†™æ¨¡æ¿ç»†èŠ‚ä¹‹å‰ï¼Œæ–‡ä»¶çš„å‘½åæƒ¯ä¾‹éœ€è¦æ³¨æ„ï¼š\n\ntemplates/ä¸­çš„å¤§å¤šæ•°æ–‡ä»¶è¢«è§†ä¸ºåŒ…å«Kubernetesæ¸…å•\nNOTES.txtæ˜¯ä¸ªä¾‹å¤–\nå‘½åä»¥ä¸‹åˆ’çº¿(_)å¼€å§‹çš„æ–‡ä»¶åˆ™å‡å®š æ²¡æœ‰ åŒ…å«æ¸…å•å†…å®¹ã€‚è¿™äº›æ–‡ä»¶ä¸ä¼šæ¸²æŸ“ä¸ºKuberneteså¯¹è±¡å®šä¹‰ï¼Œä½†åœ¨å…¶ä»–chartæ¨¡æ¿ä¸­éƒ½å¯ç”¨ã€‚\n\nå½“æˆ‘ä»¬ç¬¬ä¸€æ¬¡åˆ›å»ºmynginxæ—¶ï¼Œä¼šçœ‹åˆ°ä¸€ä¸ªåä¸º_helpers.tplçš„æ–‡ä»¶ï¼Œè¿™ä¸ªæ–‡ä»¶æ˜¯æ¨¡æ¿å±€éƒ¨çš„é»˜è®¤ä½ç½®ã€‚\ndefineå’Œtemplate\næˆ‘ä»¬å¯ä»¥ä½¿ç”¨defineå’Œtemplateæ¥å£°æ˜å’Œä½¿ç”¨æ¨¡æ¿\næ¯”å¦‚æˆ‘åœ¨_helpers.tplä¸­åˆ›å»ºä¸€ä¸ªæ¨¡æ¿ã€‚æŒ‰ç…§æƒ¯ä¾‹defineæ–¹æ³•ä¼šæœ‰ä¸ªç®€å•çš„æ–‡æ¡£å—(&#123;&#123;/* ... */&#125;&#125;)æ¥æè¿°è¦åšçš„äº‹ã€‚\n&#123;&#123;- define &quot;MY.NAME&quot; &#125;&#125;  # body of template here&#123;&#123;- end &#125;&#125;&#123;&#123;/* Generate basic labels */&#125;&#125;&#123;&#123;- define &quot;mynginx.labels&quot; &#125;&#125;  labels:    app: nginx&#123;&#123;- end &#125;&#125;\n\nç„¶åä½¿ç”¨templateæ¥ä½¿ç”¨æ¨¡æ¿\nname: &#123;&#123; .Release.Name &#125;&#125;-deployment   namespace: &#123;&#123; .Values.namespace | default &quot;default&quot; &#125;&#125;  &#123;&#123;- template &quot;mynginx.labels&quot; &#125;&#125;\n\nincludeæ–¹æ³•\nå‡è®¾æˆ‘ä»¬åˆšæ‰çš„æ¨¡æ¿æ˜¯è¿™æ ·çš„\n&#123;&#123;- define &quot;mynginx.labels&quot; &#125;&#125;app: nginx # é¡¶æ ¼æ²¡æœ‰ç©ºæ ¼&#123;&#123;- end &#125;&#125;\n\nè¿™æ—¶æ’å…¥æ¨¡æ¿æ–‡ä»¶\nname: &#123;&#123; .Release.Name &#125;&#125;-deployment   namespace: &#123;&#123; .Values.namespace | default &quot;default&quot; &#125;&#125;  labels:  \t&#123;&#123;- template &quot;mynginx.labels&quot; &#125;&#125;\n\nè¿™æ—¶å®ƒçš„è¾“å‡ºå¦‚ä¸‹\nname: &#123;&#123; .Release.Name &#125;&#125;-deployment   namespace: &#123;&#123; .Values.namespace | default &quot;default&quot; &#125;&#125;  labels:app: nginx  \t\n\næ³¨æ„åˆ°app: nginxçš„ç¼©è¿›ä¸å¯¹ã€‚å› ä¸ºè¢«æ›¿æ¢çš„æ¨¡æ¿ä¸­æ–‡æœ¬æ˜¯å·¦å¯¹é½çš„ã€‚ç”±äºtemplateæ˜¯ä¸€ä¸ªè¡Œä¸ºï¼Œä¸æ˜¯æ–¹æ³•ï¼Œæ— æ³•å°† templateè°ƒç”¨çš„è¾“å‡ºä¼ ç»™å…¶ä»–æ–¹æ³•ï¼Œæ•°æ®åªæ˜¯ç®€å•åœ°æŒ‰è¡Œæ’å…¥ã€‚\nä¸ºäº†å¤„ç†è¿™ä¸ªé—®é¢˜ï¼ŒHelmæä¾›äº†ä¸€ä¸ªtemplateçš„å¯é€‰é¡¹ï¼Œå¯ä»¥å°†æ¨¡æ¿å†…å®¹å¯¼å…¥å½“å‰ç®¡é“ï¼Œç„¶åä¼ é€’ç»™ç®¡é“ä¸­çš„å…¶ä»–æ–¹æ³•ã€‚\nä½¿ç”¨indentæ­£ç¡®åœ°ç¼©è¿›\nname: &#123;&#123; .Release.Name &#125;&#125;-deployment   namespace: &#123;&#123; .Values.namespace | default &quot;default&quot; &#125;&#125;  labels:&#123;&#123;include &quot;mynginx.labels&quot; | indent 4 &#125;&#125;\n\nNOTES.txtæ–‡ä»¶\nåœ¨helm install æˆ– helm upgradeå‘½ä»¤çš„æœ€åï¼ŒHelmä¼šæ‰“å°å‡ºå¯¹ç”¨æˆ·æœ‰ç”¨çš„ä¿¡æ¯ã€‚è¿™äº›ä¿¡æ¯ä¿å­˜åœ¨NOTE.txtæ–‡ä»¶ä¸­\nThank you for installing &#123;&#123; .Chart.Name &#125;&#125;.Your release is named &#123;&#123; .Release.Name &#125;&#125;.To learn more about the release, try:  $ helm status &#123;&#123; .Release.Name &#125;&#125;  $ helm get all &#123;&#123; .Release.Name &#125;&#125;\n\nè¾“å‡ºå¦‚ä¸‹\nThank you for installing mynginx.Your release is named nginx1.To learn more about the release, try:  $ helm status nginx1  $ helm get all nginx1\n\nChart.yaml\nè¿™ä¸ªæ–‡ä»¶å£°æ˜äº†å½“å‰ Chart çš„åç§°ã€ç‰ˆæœ¬ç­‰åŸºæœ¬ä¿¡æ¯ï¼Œè¿™äº›ä¿¡æ¯ä¼šåœ¨è¯¥ Chart è¢«æ”¾å…¥ä»“åº“åï¼Œä¾›ç”¨æˆ·æµè§ˆæ£€ç´¢ã€‚\nåœ¨ Chart.yaml é‡Œæœ‰ä¸¤ä¸ªè·Ÿç‰ˆæœ¬ç›¸å…³çš„å­—æ®µï¼Œå…¶ä¸­ version æŒ‡æ˜çš„æ˜¯ Chart çš„ç‰ˆæœ¬ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬åº”ç”¨åŒ…çš„ç‰ˆæœ¬ï¼Œè€Œ appVersion æŒ‡æ˜çš„æ˜¯å†…éƒ¨å®é™…ä½¿ç”¨çš„åº”ç”¨ç‰ˆæœ¬ã€‚è¿™ä¸¤ä¸ªå­—æ®µäº’ä¸ç›¸å…³ï¼Œæ­¤å­—æ®µä»…ä¾›å‚è€ƒï¼Œå¯¹chartç‰ˆæœ¬è®¡ç®—æ²¡æœ‰å½±å“ã€‚æˆ‘ä»¬å¯ä»¥ä¸å…³å¿ƒå®ƒã€‚\næ¯”å¦‚ nginx chartçš„ç‰ˆæœ¬å­—æ®µversion: 1.2.3æŒ‰ç…§åç§°è¢«è®¾ç½®ä¸ºï¼š\nnginx-1.2.3.tgz\n\næ‰“åŒ…chartå¹¶ä¸Šä¼ åˆ°Harbor# æ‰“åŒ…charthelm package CHART_PATH# ç™»å½•harborhelm registry login reg.redrock.team -u admin -p xxx# æ¨é€charthelm push CHART_PACKAGE oci://reg.redrock.team/library\n\nä¹Ÿå¯ä»¥æŠŠæ‰“åŒ…å¥½çš„chartä¸Šä¼ åˆ°Githubä¸Šï¼Œç„¶åé€šè¿‡helm pullè§£å‹å®‰è£…\nå…¶ä»–Kubeconfigä½¿ç”¨ kubeconfig æ–‡ä»¶ç»„ç»‡é›†ç¾¤è®¿é—® | Kubernetes\nkubectl å‘½ä»¤è¡Œå·¥å…·ä½¿ç”¨ kubeconfig æ–‡ä»¶æ¥æŸ¥æ‰¾é€‰æ‹©é›†ç¾¤æ‰€éœ€çš„ä¿¡æ¯ï¼ˆæŒ‡å®šè¦æ“ä½œçš„é›†ç¾¤ï¼‰ï¼Œå¹¶ä¸é›†ç¾¤çš„ API æœåŠ¡å™¨è¿›è¡Œé€šä¿¡ã€‚HelmåŒæ ·ä½¿ç”¨kubeconfigæ¥æŒ‡å®šæ“ä½œçš„é›†ç¾¤ã€‚\nç”¨äºé…ç½®é›†ç¾¤è®¿é—®çš„æ–‡ä»¶ç§°ä¸º kubeconfig æ–‡ä»¶ã€‚ è¿™æ˜¯å¼•ç”¨åˆ°é…ç½®æ–‡ä»¶çš„é€šç”¨æ–¹æ³•ï¼Œå¹¶ä¸æ„å‘³ç€æœ‰ä¸€ä¸ªåä¸º kubeconfig çš„æ–‡ä»¶ã€‚\né»˜è®¤æƒ…å†µä¸‹ï¼Œkubectl åœ¨ $HOME/.kube ç›®å½•ä¸‹æŸ¥æ‰¾åä¸º config çš„æ–‡ä»¶ã€‚ ä½ å¯ä»¥é€šè¿‡è®¾ç½® KUBECONFIG ç¯å¢ƒå˜é‡æˆ–è€…è®¾ç½® --kubeconfigå‚æ•°æ¥æŒ‡å®šå…¶ä»– kubeconfig æ–‡ä»¶ã€‚\né…ç½®å¯¹å¤šé›†ç¾¤çš„è®¿é—® | Kubernetes\næŸ¥çœ‹configç­¾å‘æ—¥æœŸ\nopenssl x509 -in /etc/kubernetes/pkki/apiserver.crt -noout -text | grep Not\n","categories":["Kubernetes"],"tags":["Kubernetes"]},{"title":"è¿ç»´å¸¸ç”¨å·¥å…·","url":"/2025/12/08/%E8%BF%90%E7%BB%B4%E5%B8%B8%E7%94%A8%E5%B7%A5%E5%85%B7/","content":"Harbor\nHarbor (goharbor.io)\n\nå°½ç®¡Dockerå®˜æ–¹æä¾›äº†å…¬å…±çš„é•œåƒä»“åº“DockerHubï¼Œä½†ä»å®‰å…¨æ€§å’Œç¨³å®šæ€§ç­‰æ–¹é¢è€ƒè™‘ï¼Œéƒ¨ç½²ç§æœ‰é•œåƒä»“åº“æ˜¯éå¸¸æœ‰å¿…è¦çš„ã€‚Harboræ˜¯ä¸€ä¸ªç”±VMwareå…¬å¸å¼€æºçš„ä¼ä¸šçº§çš„Docker Registryç®¡ç†é¡¹ç›®ï¼Œæ˜¯æˆ‘ä»¬æ­å»ºç§æœ‰é•œåƒä»“åº“çš„ä¸äºŒä¹‹é€‰ã€‚\næ•´ä½“æ¶æ„\nå¦‚ä¸Šå›¾æ‰€ç¤ºæ˜¯ Harbor 2.0 çš„æ¶æ„å›¾ï¼Œä»ä¸Šåˆ°ä¸‹å¯åˆ†ä¸ºä»£ç†å±‚ã€åŠŸèƒ½å±‚å’Œæ•°æ®å±‚ã€‚\n\nä»£ç†å±‚ï¼šä»£ç†å±‚å®è´¨ä¸Šæ˜¯ä¸€ä¸ª Nginx åå‘ä»£ç†ï¼Œè´Ÿè´£æ¥æ”¶ä¸åŒç±»å‹çš„å®¢æˆ·ç«¯è¯·æ±‚ï¼ŒåŒ…æ‹¬æµè§ˆå™¨ã€ç”¨æˆ·è„šæœ¬ã€Docker ç­‰ï¼Œå¹¶æ ¹æ®è¯·æ±‚ç±»å‹å’Œ URI è½¬å‘ç»™ä¸åŒçš„åç«¯æœåŠ¡è¿›è¡Œå¤„ç†ã€‚\nåŠŸèƒ½å±‚ï¼š\nPortalï¼šæ˜¯ä¸€ä¸ªåŸºäº Argular çš„å‰ç«¯åº”ç”¨ï¼Œæä¾› Harbor ç”¨æˆ·è®¿é—®çš„ç•Œé¢ã€‚\nCoreï¼šæ˜¯ Harbor ä¸­çš„æ ¸å¿ƒç»„ä»¶ï¼Œå°è£…äº† Harbor ç»å¤§éƒ¨åˆ†çš„ä¸šåŠ¡é€»è¾‘ã€‚\nJobServiceï¼šå¼‚æ­¥ä»»åŠ¡ç»„ä»¶ï¼Œè´Ÿè´£ Harbor ä¸­å¾ˆå¤šæ¯”è¾ƒè€—æ—¶çš„åŠŸèƒ½ï¼Œæ¯”å¦‚ Artifact å¤åˆ¶ã€æ‰«æã€åƒåœ¾å›æ”¶ç­‰ã€‚\nDocker Distributionï¼šHarbor é€šè¿‡ Distribution å®ç° Artifact çš„è¯»å†™å’Œå­˜å–ç­‰åŠŸèƒ½ã€‚\nRegistryCtlï¼šDocker Distribution çš„æ§åˆ¶ç»„ä»¶ã€‚\nNotaryï¼ˆå¯é€‰ï¼‰ ï¼šåŸºäº TUF æä¾›é•œåƒç­¾åç®¡ç†çš„åŠŸèƒ½ã€‚\næ‰«æå·¥å…·ï¼ˆå¯é€‰ï¼‰ ï¼šé•œåƒçš„æ¼æ´æ£€æµ‹å·¥å…·ã€‚\nChartMuseumï¼ˆå¯é€‰ï¼‰ ï¼šæä¾› API ç®¡ç†é OCI è§„èŒƒçš„ Helm Chartï¼Œéšç€å…¼å®¹ OCI è§„èŒƒçš„ Helm Chart åœ¨ç¤¾åŒºä¸Šè¢«æ›´å¹¿æ³›åœ°æ¥å—ï¼ŒHelm Chart èƒ½ä»¥ Artifact çš„å½¢å¼åœ¨ Harbor ä¸­å­˜å‚¨å’Œç®¡ç†ï¼Œä¸å†ä¾èµ– ChartMuseumï¼Œå› æ­¤ Harbor å¯èƒ½ä¼šåœ¨åç»­ç‰ˆæœ¬ä¸­ç§»é™¤å¯¹ ChartMuseum çš„æ”¯æŒã€‚\n\n\næ•°æ®å±‚ï¼š\nRedisï¼šä¸»è¦ä½œä¸ºç¼“å­˜æœåŠ¡å­˜å‚¨ä¸€äº›ç”Ÿå‘½å‘¨æœŸè¾ƒçŸ­çš„æ•°æ®ï¼ŒåŒæ—¶å¯¹äº JobService è¿˜æä¾›äº†ç±»ä¼¼é˜Ÿåˆ—çš„åŠŸèƒ½ã€‚\nPostgreSQLï¼šå­˜å‚¨ Harbor çš„åº”ç”¨æ•°æ®ï¼Œæ¯”å¦‚é¡¹ç›®ä¿¡æ¯ã€ç”¨æˆ·ä¸é¡¹ç›®çš„å…³ç³»ã€ç®¡ç†ç­–ç•¥ã€é…ç½®ä¿¡æ¯ã€Artifact çš„å…ƒæ•°æ®ç­‰ç­‰ã€‚\nArtifact å­˜å‚¨ï¼šå­˜å‚¨ Artifact æœ¬èº«çš„å†…å®¹ï¼ŒArtiactå°±æ˜¯æ¯æ¬¡æ¨é€é•œåƒã€Helm Chart æ—¶ï¼Œæ•°æ®æœ€ç»ˆå­˜å‚¨çš„åœ°æ–¹ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼ŒHarbor ä¼šæŠŠ Artifact å†™å…¥æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿä¸­ã€‚ç”¨æˆ·ä¹Ÿå¯ä»¥ä¿®æ”¹é…ç½®ï¼Œå°† Artifact å­˜å‚¨åœ¨å¤–éƒ¨å­˜å‚¨ä¸­ï¼Œä¾‹å¦‚é˜¿é‡Œäº‘çš„å¯¹è±¡å­˜å‚¨ OSS ç­‰ç­‰ã€‚\n\n\n\nHarborçš„å®‰è£…Harborå®‰è£…ç¤ºèŒƒ\nHarborçš„ä½¿ç”¨åŸºæœ¬æ¨é€ä¸æ‹‰å–å…ˆç™»å½•\ndocker login https://harbor.yiiong.top:8443\n\né•œåƒæ¨é€ï¼ˆå…ˆæ‰“æ ‡ç­¾ï¼Œå†æ¨é€ï¼‰\nharboråœ°å€&#x2F;é¡¹ç›®å&#x2F;é•œåƒå:ç‰ˆæœ¬\ndocker tag mysql harbor.yiiong.top:8443/library/mysql:latest\n\né•œåƒæ‹‰å–\ndocker pull harbor.yiiong.top:8443/library/mysql:latest\n\næœºå™¨äººè´¦æˆ·åœ¨ä¸€äº›æƒ…å†µä¸‹ï¼Œä¸ºäº†æé«˜ Harbor ä»“åº“çš„å®‰å…¨æ€§è€ƒè™‘ï¼Œä¸å»ºè®®ç›´æ¥åœ¨æµæ°´çº¿ä»»åŠ¡ï¼ˆCI&#x2F;CDï¼‰ä¸­ç›´æ¥ä½¿ç”¨ä¸ªäººè´¦æˆ·ã€‚å› ä¸ºè¿™ç§æ–¹å¼ä¼šå¯¼è‡´æƒé™ç®¡ç†å’Œç»´æŠ¤å˜å¾—å¤æ‚ï¼Œå°¤å…¶æ˜¯å½“é¡¹ç›®æ˜¯å…¬å¼€çš„æ—¶å€™ã€‚\nä¸ºè§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨ Harbor è‡ªå¸¦çš„æœºå™¨äººè´¦æˆ·ï¼ˆRobot Accountï¼‰ã€‚æœºå™¨äººè´¦æˆ·æ˜¯ä¸€ç§ç‰¹æ®Šç±»å‹çš„è´¦æˆ·ï¼Œå…è®¸éä¸ªäººå®ä½“è®¿é—® Harbor ä»“åº“å¹¶æ‰§è¡Œç‰¹å®šçš„æ“ä½œï¼Œè€Œæ— éœ€æä¾›å®é™…çš„ç”¨æˆ·åå’Œå¯†ç ã€‚é€šè¿‡æœºå™¨äººè´¦æˆ·ï¼Œå¯ä»¥å®ç°è‡ªåŠ¨åŒ– CI&#x2F;CD æµç¨‹ä¸­çš„æ¨é€å’Œæ‹‰å–é•œåƒæ“ä½œï¼Œç¡®ä¿å®‰å…¨åŒæ—¶å‡å°‘äººä¸ºå¤„ç†ã€‚\nå†…ç½‘ç©¿é€å·¥å…·frp\nGithub\næ–‡æ¡£ | frp (gofrp.org)\n\nfrp æ˜¯ä¸€æ¬¾é«˜æ€§èƒ½çš„åå‘ä»£ç†åº”ç”¨ï¼Œä¸“æ³¨äºå†…ç½‘ç©¿é€ã€‚å®ƒæ”¯æŒå¤šç§åè®®ï¼ŒåŒ…æ‹¬ TCPã€UDPã€HTTPã€HTTPS ç­‰ï¼Œå¹¶ä¸”å…·å¤‡ P2P é€šä¿¡åŠŸèƒ½ã€‚ä½¿ç”¨ frpï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨frpå®‰å…¨ã€ä¾¿æ·åœ°å°†å†…ç½‘æœåŠ¡æš´éœ²åˆ°å…¬ç½‘ï¼Œé€šè¿‡æ‹¥æœ‰å…¬ç½‘ IP çš„èŠ‚ç‚¹è¿›è¡Œä¸­è½¬ã€‚\nåœ¨0.52.0ç‰ˆæœ¬å¼€å§‹æ”¯æŒtomlæ ¼å¼çš„é…ç½®æ–‡ä»¶äº†ï¼Œå¹¶å°†åœ¨åç»§æŸä¸ªç‰ˆæœ¬å¼€å§‹å–æ¶ˆå¯¹inié…ç½®æ ¼å¼çš„æ”¯æŒã€‚\né€šè¿‡SSHè®¿é—®å†…ç½‘æœºå™¨åˆ©ç”¨frpå°†å¤„äºå†…ç½‘é¦™æ©™æ´¾ä¸­çš„æœåŠ¡ç©¿é€è‡³å…¬ç½‘_proxy.go:204-CSDNåšå®¢\né€šè¿‡è‡ªå®šä¹‰åŸŸåè®¿é—®å†…ç½‘çš„ Web æœåŠ¡åˆ©ç”¨frpå°†å¤„äºå†…ç½‘é¦™æ©™æ´¾ä¸­çš„æœåŠ¡ç©¿é€è‡³å…¬ç½‘_proxy.go:204-CSDNåšå®¢\nåå°è¿è¡Œä¸€åˆ‡éƒ½æ²¡æœ‰é—®é¢˜åï¼Œæˆ‘ä»¬æŠŠå®ƒä»¬åˆ¶ä½œæˆserviceï¼Œä¿è¯å®ƒä»¬å¯ä»¥åœ¨åå°ç¨³å®šè¿è¡Œ\næœåŠ¡ç«¯\nvim /usr/lib/systemd/system/frps.service\n\nfrps.serviceé…ç½®å¦‚ä¸‹\n[Unit]Description=frps Server ServiceAfter=network.targetWants=network.target[Service]Type=simpleExecStart=/root/frp-all/frp-os-server/frps -c /root/frp-all/frp-os-server/frps.toml # ä½ çš„frpsæ–‡ä»¶çš„ç»å¯¹è·¯å¾„[Install]WantedBy=multi-user.target\n\nå¯åŠ¨\nsystemctl start frps\n\nå¼€æœºè‡ªå¯\nsystemctl enable frps\n\næŸ¥çœ‹æ—¥å¿—\nsystemctl status frps\n\nå®¢æˆ·ç«¯\nä¸æœåŠ¡ç«¯åŒç†ï¼Œfrpc.serviceçš„é…ç½®ä¸­ExecStartä¿®æ”¹ä¸ºfrpcæ–‡ä»¶çš„ç»å¯¹è·¯å¾„ï¼Œä¸‹é¢æ“ä½œç›¸åŒ\nåŸç†\nfrpcå¹¶ä¸ç›‘å¬å“ªä¸ªç«¯å£ï¼Œåªæ˜¯å®ƒåœ¨å±€åŸŸç½‘ä¸»æœºä¸­å¯åŠ¨æ—¶ä¼šé€šè¿‡ä¸€ä¸ªéšæœºç«¯å£æ¥ä¸å¤–ç½‘æœåŠ¡å™¨çš„7010ç«¯å£å»ºç«‹ä¸€ä¸ªéš§é“è¿æ¥ï¼Œéš§é“å»ºç«‹å7010ç«¯å£å’Œé‚£ä¸ªfrpcæ‰€ç”¨è¿‡çš„éšæœºç«¯å£å¹¶ä¸ç›´æ¥å‚ä¸æ•°æ®åŒ…çš„ä¼ è¾“ã€‚frpsä¼šå°†å‘å¾€å¤–ç½‘æœåŠ¡å™¨6010ç«¯å£çš„æ•°æ®ç›´æ¥æ’å…¥éš§é“ä¸­ä¼ è‡³frpcä¸­ï¼Œè¿™æ˜¯éš§é“æŠ€æœ¯çš„ä¸€ä¸ªå…³é”®ç‰¹æ€§ï¼Œå…è®¸æ•°æ®åœ¨ç½‘ç»œä¸Šé«˜æ•ˆã€å®‰å…¨åœ°ä¼ è¾“ã€‚\nngrok\nDownload (ngrok.com)\n\nngrok é€šè¿‡åœ¨å…¬å…±ç«¯ç‚¹å’Œæœ¬åœ°è¿è¡Œçš„ Web æœåŠ¡å™¨ä¹‹é—´å»ºç«‹ä¸€ä¸ªå…è´¹ä¸”å®‰å…¨çš„é€šé“ï¼Œå®ç°å†…ç½‘ä¸»æœºçš„æœåŠ¡å¯ä»¥æš´éœ²ç»™å¤–ç½‘ã€‚\nä½ å¯ä»¥ä½¿ç”¨ngrokå°†ä½ å¤„äºå†…ç½‘çš„æœåŠ¡æš‚æ—¶æš´éœ²åœ¨å…¬ç½‘ï¼Œæ–¹ä¾¿æµ‹è¯•æœåŠ¡ã€‚\nå…ˆæ·»åŠ Authtokenngrok config add-authtoken &lt;token&gt;å¼€å¯éš§é“ngrok http &lt;port&gt;\n\nNginxä»‹ç»Nginxæ˜¯ä¸€æ¬¾è½»é‡çº§çš„Web æœåŠ¡å™¨&#x2F;åå‘ä»£ç†æœåŠ¡å™¨åŠ ç”µå­é‚®ä»¶ï¼ˆIMAP&#x2F;POP3ï¼‰ä»£ç†æœåŠ¡å™¨ã€‚å…¶ç‰¹ç‚¹æ˜¯å æœ‰å†…å­˜å°‘ï¼Œå¹¶å‘èƒ½åŠ›å¼ºï¼Œäº‹å®ä¸Šnginxçš„å¹¶å‘èƒ½åŠ›åœ¨åŒç±»å‹çš„ç½‘é¡µæœåŠ¡å™¨ä¸­è¡¨ç°è¾ƒå¥½ï¼Œä¸­å›½å¤§é™†ä½¿ç”¨nginxç½‘ç«™ç”¨æˆ·æœ‰ï¼šç™¾åº¦ã€äº¬ä¸œã€æ–°æµªã€ç½‘æ˜“ã€è…¾è®¯ã€æ·˜å®ç­‰ã€‚\næ­£å‘ä»£ç†ä¸åå‘ä»£ç†æ­£å‘ä»£ç†\næ­£å‘ä»£ç†ï¼ŒæŒ‡çš„æ˜¯é€šè¿‡ä»£ç†æœåŠ¡å™¨ ä»£ç†æµè§ˆå™¨/å®¢æˆ·ç«¯å»é‡å®šå‘è¯·æ±‚è®¿é—®åˆ°ç›®æ ‡æœåŠ¡å™¨ çš„ä¸€ç§ä»£ç†æœåŠ¡ã€‚æ­£å‘ä»£ç†æœåŠ¡çš„ç‰¹ç‚¹æ˜¯ä»£ç†æœåŠ¡å™¨ ä»£ç†çš„å¯¹è±¡æ˜¯æµè§ˆå™¨/å®¢æˆ·ç«¯ï¼Œä¹Ÿå°±æ˜¯å¯¹äºç›®æ ‡æœåŠ¡å™¨ æ¥è¯´æµè§ˆå™¨/å®¢æˆ·ç«¯æ˜¯éšè—çš„ã€‚\næ­£å‘ä»£ç†æœ‰ä»€ä¹ˆç”¨é€”ï¼Ÿ\nä¸¾ä¸ªä¾‹å­ï¼šæˆ‘æ˜¯ä¸€ä¸ªç”¨æˆ·ï¼Œæˆ‘è®¿é—®ä¸äº†æŸç½‘ç«™ï¼Œä½†æ˜¯èƒ½è®¿é—®ä¸€ä¸ªä»£ç†æœåŠ¡å™¨ï¼Œè¿™ä¸ªä»£ç†æœåŠ¡å™¨èƒ½è®¿é—®é‚£ä¸ªæˆ‘ä¸èƒ½è®¿é—®çš„ç½‘ç«™ï¼Œäºæ˜¯æˆ‘å…ˆè¿ä¸Šä»£ç†æœåŠ¡å™¨ï¼Œå‘Šè¯‰ä»–æˆ‘éœ€è¦é‚£ä¸ªæ— æ³•è®¿é—®ç½‘ç«™çš„å†…å®¹ï¼Œä»£ç†æœåŠ¡å™¨å»æŠŠæ•°æ®åŒ…å–å›æ¥ï¼Œç„¶åè¿”å›ç»™æˆ‘ã€‚\n\nè®¿é—®åŸæ¥æ— æ³•è®¿é—®çš„èµ„æºï¼Œå¦‚google ï¼ˆé€šè¿‡æ­£å‘ä»£ç†å®ç°ç§‘å­¦ä¸Šç½‘ï¼‰\nå¯ä»¥åšç¼“å­˜ï¼ŒåŠ é€Ÿè®¿é—®èµ„æº\nå¯¹å®¢æˆ·ç«¯è®¿é—®æˆæƒï¼Œä¸Šç½‘è¿›è¡Œè®¤è¯\nä»£ç†å¯ä»¥è®°å½•ç”¨æˆ·è®¿é—®è®°å½•ï¼ˆä¸Šç½‘è¡Œä¸ºç®¡ç†ï¼‰\nå¯¹å¤–éšè—ç”¨æˆ·ä¿¡æ¯ï¼Œä¿æŠ¤éšç§\n\nåå‘ä»£ç†\nåå‘ä»£ç†ï¼ŒæŒ‡çš„æ˜¯æµè§ˆå™¨/å®¢æˆ·ç«¯å¹¶ä¸çŸ¥é“è‡ªå·±è¦è®¿é—®å…·ä½“å“ªå°ç›®æ ‡æœåŠ¡å™¨ï¼ŒåªçŸ¥é“å»è®¿é—®ä»£ç†æœåŠ¡å™¨ ï¼Œä»£ç†æœåŠ¡å™¨å†é€šè¿‡åå‘ä»£ç† +è´Ÿè½½å‡è¡¡å®ç°è¯·æ±‚åˆ†å‘åˆ°åº”ç”¨æœåŠ¡å™¨çš„ä¸€ç§ä»£ç†æœåŠ¡ã€‚åå‘ä»£ç†æœåŠ¡çš„ç‰¹ç‚¹æ˜¯ä»£ç†æœåŠ¡å™¨ ä»£ç†çš„å¯¹è±¡æ˜¯åº”ç”¨æœåŠ¡å™¨ï¼Œä¹Ÿå°±æ˜¯å¯¹äºæµè§ˆå™¨/å®¢æˆ·ç«¯ æ¥è¯´åº”ç”¨æœåŠ¡å™¨æ˜¯éšè—çš„ã€‚\nå¤§å‹ç½‘ç«™ï¼Œé€šå¸¸å°†åå‘ä»£ç†ä½œä¸ºå…¬ç½‘è®¿é—®åœ°å€ï¼Œè€ŒWebåº”ç”¨æœåŠ¡å™¨ä½œä¸ºå†…ç½‘ã€‚\næœ‰äº†åå‘ä»£ç†ï¼Œç”¨æˆ·æ°¸è¿œä¸ä¼šä¸ä½¿ç”¨å®ƒçš„WebæœåŠ¡å™¨è¿›è¡Œç›´æ¥é€šä¿¡ã€‚å¯ä»¥å°†å®ƒä»¬çœ‹ä½œwebæœåŠ¡ å™¨æˆ–æœåŠ¡å™¨é›†ç¾¤çš„æŸç§åŒ…è£…å™¨ã€‚é€šè¿‡è´Ÿè½½å¹³è¡¡å’Œç¼“å­˜ï¼Œå®ƒä»¬å¯ä»¥ä¿æŠ¤webæœåŠ¡å™¨å…é­æ”»å‡»ï¼Œå¹¶æä¾›æ›´å¥½ çš„webæ€§èƒ½ã€‚\nåå‘ä»£ç†çš„ç”¨é€”ï¼š\n\nåå‘ä»£ç†æœåŠ¡å™¨åƒä¸€ä¸ªå¤§é—¨ä¸€æ ·ä¿è¯å†…ç½‘çš„å®‰å…¨ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨åå‘ä»£ç†æä¾›WAFï¼ˆWeb Application Firewallï¼‰åŠŸèƒ½ï¼Œé˜»æ­¢webæ”»å‡» ã€‚\nè´Ÿè½½å‡è¡¡ï¼Œé€šè¿‡åå‘ä»£ç†æœåŠ¡å™¨æ¥ä¼˜åŒ–ç½‘ç«™çš„è´Ÿè½½ã€‚\n\né…ç½®æ–‡ä»¶ä»‹ç»nginx.confä¸ºæœ€ä¸»è¦çš„é…ç½®æ–‡ä»¶\nnginx æ–‡ä»¶ç»“æ„\n\nNginx é…ç½®è¯¦è§£ | èœé¸Ÿæ•™ç¨‹ (runoob.com)\n\n...              #å…¨å±€å—events &#123;         #eventså—   ...&#125;http      #httpå—&#123;    ...   #httpå…¨å±€å—    server        #serverå—    &#123;         ...       #serverå…¨å±€å—        location [PATTERN]   #locationå—        &#123;            ...        &#125;        location [PATTERN]         &#123;            ...        &#125;    &#125;    server    &#123;      ...    &#125;    ...     #httpå…¨å±€å—&#125;\n\n\nå…¨å±€å—ï¼šé…ç½®å½±å“nginxå…¨å±€çš„æŒ‡ä»¤ã€‚ä¸€èˆ¬æœ‰è¿è¡ŒnginxæœåŠ¡å™¨çš„ç”¨æˆ·ç»„ï¼Œnginxè¿›ç¨‹pidå­˜æ”¾è·¯å¾„ï¼Œæ—¥å¿—å­˜æ”¾è·¯å¾„ï¼Œé…ç½®æ–‡ä»¶å¼•å…¥ï¼Œå…è®¸ç”Ÿæˆworker processæ•°ç­‰ã€‚\neventså—ï¼šé…ç½®å½±å“nginxæœåŠ¡å™¨æˆ–ä¸ç”¨æˆ·çš„ç½‘ç»œè¿æ¥ã€‚æœ‰æ¯ä¸ªè¿›ç¨‹çš„æœ€å¤§è¿æ¥æ•°ï¼Œé€‰å–å“ªç§äº‹ä»¶é©±åŠ¨æ¨¡å‹å¤„ç†è¿æ¥è¯·æ±‚ï¼Œæ˜¯å¦å…è®¸åŒæ—¶æ¥å—å¤šä¸ªç½‘è·¯è¿æ¥ï¼Œå¼€å¯å¤šä¸ªç½‘ç»œè¿æ¥åºåˆ—åŒ–ç­‰ã€‚\nhttpå—ï¼šå¯ä»¥åµŒå¥—å¤šä¸ªserverï¼Œé…ç½®ä»£ç†ï¼Œç¼“å­˜ï¼Œæ—¥å¿—å®šä¹‰ç­‰ç»å¤§å¤šæ•°åŠŸèƒ½å’Œç¬¬ä¸‰æ–¹æ¨¡å—çš„é…ç½®ã€‚å¦‚æ–‡ä»¶å¼•å…¥ï¼Œ             4å®šä¹‰ï¼Œæ—¥å¿—è‡ªå®šä¹‰ï¼Œæ˜¯å¦ä½¿ç”¨sendfileä¼ è¾“æ–‡ä»¶ï¼Œè¿æ¥è¶…æ—¶æ—¶é—´ï¼Œå•è¿æ¥è¯·æ±‚æ•°ç­‰ã€‚\nserverå—ï¼šé…ç½®è™šæ‹Ÿä¸»æœºçš„ç›¸å…³å‚æ•°ï¼Œä¸€ä¸ªhttpä¸­å¯ä»¥æœ‰å¤šä¸ªserverã€‚\nlocationå—ï¼šé…ç½®è¯·æ±‚çš„è·¯ç”±ï¼Œä»¥åŠå„ç§é¡µé¢çš„å¤„ç†æƒ…å†µã€‚\n\nåº”ç”¨åå‘ä»£ç†+è´Ÿè½½å‡è¡¡å®ç°æ•ˆæœï¼šè®¿é—®nginx.yiiong.top:8000æ—¶ï¼Œå°†è¯·æ±‚å¹³å‡åˆ†é…åˆ°8881å’Œ8882ç«¯å£ã€‚\nnginx.yiiong.topè§£æåˆ°172.20.14.31\ndockerå¯åŠ¨ä¸¤ä¸ªnginxå®¹å™¨ï¼Œåˆ†åˆ«æ˜ å°„åˆ°å®¿ä¸»æœº8881ã€8882ç«¯å£\nä¸ºäº†åŒºåˆ†ï¼Œæˆ‘ä¿®æ”¹äº†ä¸»é¡µå†…å®¹ï¼ˆ/usr/share/nginx/html/index.htmlï¼‰\nåå‘ä»£ç†\nhttp &#123;\t\tserver &#123;                listen 8000;                server_name 172.20.14.31;                location / &#123;                        proxy_pass 172.20.14.31:8881; # åå‘ä»£ç†åˆ°8881                &#125;        &#125;\n\nåå‘ä»£ç†+è´Ÿè½½å‡è¡¡\nupstreamå¯ä»¥æä¾›è´Ÿè½½å‡è¡¡å’Œé«˜å¯ç”¨æ€§ã€‚\nweightï¼šweightä»£è¡¨æ¯ä¸ªæœåŠ¡å™¨çš„æƒé‡å€¼ï¼Œé»˜è®¤ä¸º1ï¼Œæƒé‡è¶Šé«˜ï¼Œè¢«åˆ†é…çš„ç”¨æˆ·æ•°å°±è¶Šå¤šã€‚è¿™ç§åˆ†é…æ–¹å¼ä¸»è¦ç”¨äºåç«¯æœåŠ¡å™¨æ€§èƒ½ä¸å‡çš„æƒ…å†µã€‚\næ­¤æ—¶ï¼Œè®¿é—®8882ç«¯å£çš„æ¬¡æ•°ä¼šæ˜¯8881ç«¯å£çš„ä¸¤å€ã€‚\nhttp &#123;        upstream web&#123;                server 172.20.14.31:8881 weight=5;                server 172.20.14.31:8882 weight=10;        &#125;                server &#123;                listen 8000;                server_name 172.20.14.31;                location / &#123;                        proxy_pass http://web; # åå‘ä»£ç†åˆ°8881æˆ–8882                &#125;        &#125;\n\næ–‡ä»¶æœåŠ¡å™¨server &#123;                listen 8888;                server_name localhost;                charset utf-8;                root /home; # æ˜¾ç¤ºè¯¥ç›®å½•ä¸‹çš„æ–‡ä»¶                location / &#123;                        autoindex on; # è‡ªåŠ¨ç”Ÿæˆç›®å½•ç´¢å¼•é¡µé¢                        autoindex_exact_size on; # æ˜¾ç¤ºæ–‡ä»¶å¤§å°                        autoindex_localtime on; # æ˜¾ç¤ºæ–‡ä»¶çš„æœ€åä¿®æ”¹æ—¶é—´                        &#125;        &#125;\n\næœ‰äº›ç±»å‹çš„æ–‡ä»¶é“¾æ¥åœ¨æµè§ˆå™¨é‡Œç‚¹å‡»åå¹¶ä¸ä¼šç›´æ¥ä¸‹è½½è€Œæ˜¯åªé¢„è§ˆï¼Œè¿™æ˜¯æˆ‘ä»¬åªéœ€è¦åœ¨mime.typesä¸­æ·»åŠ application/octet-stream  &lt;æ–‡ä»¶ç±»å‹&gt;å³å¯ã€‚\napplication/octet-stream æ˜¯ä¸€ç§ MIME ç±»å‹ï¼Œç”¨äºæŒ‡ç¤ºæœªçŸ¥ç±»å‹çš„æ–‡ä»¶ã€‚\n\nddnsç”±äºDHCPåˆ†é…ç»™ç”¨æˆ·è®¾å¤‡çš„IPåœ°å€å¹¶ä¸å›ºå®šï¼Œä¸ºäº†å°†è®¾å¤‡å½“å‰çš„IPåŠæ—¶æ˜ å°„åˆ°åŸŸåä¸Šï¼Œä½¿ç”¨æˆ·åœ¨ä»»ä½•æ—¶å€™éƒ½å¯ä»¥é€šè¿‡å›ºå®šçš„åœ°å€è®¿é—®åˆ°è®¾å¤‡ï¼Œäº§ç”Ÿäº†åŠ¨æ€åŸŸåè§£æDDNSæŠ€æœ¯ã€‚\nddns-go æ˜¯ä¸€ä¸ªè½»é‡çº§çš„åŠ¨æ€åŸŸåè§£ææœåŠ¡æ›´æ–°å™¨ï¼Œç”±Goè¯­è¨€ç¼–å†™ï¼Œå…¶ä¸»è¦åŠŸèƒ½æ˜¯ç›‘æµ‹ä½ çš„å…¬å…±IPåœ°å€å˜åŒ–ï¼Œå¹¶è‡ªåŠ¨å°†æ–°IPåŒæ­¥åˆ°æ”¯æŒè‡ªå®šä¹‰è„šæœ¬çš„DDNSæœåŠ¡å•†ã€‚\n\njeessy2&#x2F;ddns-go: Simple and easy to use DDNS. Support Aliyun, Tencent Cloud, Dnspod, Cloudflare, Callback, Huawei Cloud, Baidu Cloud, Porkbun, GoDaddy, Namecheap, NameSiloâ€¦ (github.com)\n\n\nå†…ç½‘ç©¿é€æ–¹æ³•æ€»ç»“\n\nSoftether VPNVPNï¼ˆVirtual Private Networkï¼Œè™šæ‹Ÿç§äººç½‘ç»œï¼‰\n\n7.3 åœ¨ Linux ä¸Šå®‰è£…å’Œåˆå§‹é…ç½® - SoftEther VPN é¡¹ç›®\nä¸‹è½½\n\nä»‹ç»Softether VPNæ˜¯ä¸€ä¸ªèƒ½å¤Ÿè™šæ‹Ÿç½‘å¡å’Œé›†çº¿å™¨ï¼ˆHUBï¼‰çš„å·¥å…·ï¼Œåªè¦å¯ä»¥è®¿é—®äº’è”ç½‘ï¼Œéƒ½å¯ä»¥ä½¿ç”¨å®ƒæ¥ç»„å»ºè¿œç¨‹å±€åŸŸç½‘ã€‚\nVPNç”¨é€”\nå®‰å…¨è¿œç¨‹è®¿é—®ï¼šVPNå…è®¸è¿œç¨‹ç”¨æˆ·é€šè¿‡å…¬å…±ç½‘ç»œå®‰å…¨åœ°è¿æ¥åˆ°å…¬å¸å†…éƒ¨ç½‘ç»œã€‚\nç»•è¿‡åœ°ç†é™åˆ¶ï¼šé€šè¿‡è¿æ¥åˆ°ä½äºå…¶ä»–åœ°åŒºçš„VPNæœåŠ¡å™¨ï¼Œç”¨æˆ·å¯ä»¥è®¿é—®è¢«åœ°ç†é™åˆ¶çš„ç½‘ç«™ã€å†…å®¹å’ŒæœåŠ¡ã€‚è¿™æ˜¯å› ä¸ºè¿æ¥åˆ°VPNåï¼Œæˆ‘ä»¬çš„IPåœ°å€ä¼šè¢«ä¼ªè£…ä¸ºVPNæœåŠ¡å™¨æ‰€åœ¨åœ°çš„IPåœ°å€ï¼Œä½¿å¾—æˆ‘ä»¬çœ‹èµ·æ¥å¥½åƒæ˜¯ä»è¯¥åœ°åŒºè®¿é—®ç½‘ç«™ã€‚\n\nå‰ææƒ³è¦ç§‘å­¦ä¸Šç½‘ï¼Œæˆ‘ä»¬å°±å¾—æœ‰ä¸€å°å…¬ç½‘æµ·å¤–æœåŠ¡å™¨ã€‚\nå°† VPN Server å®‰è£…åˆ° Linux æ“ä½œç³»ç»Ÿéœ€è¦ä»¥ä¸‹è½¯ä»¶å’Œåº“ã€‚æ£€æŸ¥ç³»ç»Ÿæ˜¯å¦å·²å®‰è£…å¹¶å¯ç”¨ä»¥ä¸‹è½¯ä»¶å’Œåº“ã€‚(makeå’Œgccä¸€å®šè¦æœ‰)\n\nmake\nGCCè½¯ä»¶\nBinutils è½¯ä»¶\ntarã€gzip æˆ–å…¶ä»–ç”¨äºæå–è½¯ä»¶åŒ…æ–‡ä»¶çš„è½¯ä»¶\nchkconfig ç³»ç»Ÿå®ç”¨ç¨‹åº\ncatã€cp æˆ–å…¶ä»–åŸºæœ¬æ–‡ä»¶æ“ä½œå®ç”¨ç¨‹åº\nEUC-JPã€UTF-8 æˆ–å…¶ä»–ä»£ç é¡µè¡¨ï¼Œç”¨äºæ—¥è¯­ç¯å¢ƒ\nlibc ï¼ˆglibcï¼‰ åº“\nzlib åº“\nOpenSSL åº“\nReadline åº“\nncurses åº“\npthread åº“\n\nå°†å‹ç¼©åŒ…è§£å‹ï¼Œå¹¶å°†å…¶ç§»åŠ¨è‡³/usr/local/vpnserverï¼Œç„¶åæ‰§è¡Œmakeè¿›è¡Œç¼–è¯‘ï¼Œå‡ºç°å¦‚ä¸‹å³æˆåŠŸã€‚\n\nå¯åŠ¨æœåŠ¡\nroot@RainYun-SJkdAk4z:/usr/local/vpnserver# ./vpnserver startThe SoftEther VPN Server service has been started.Let&#x27;s get started by accessing to the following URL from your PC:https://172.16.120.106:5555/  orhttps://172.16.120.106/Note: IP address may vary. Specify your server&#x27;s IP address.A TLS certificate warning will appear because the server uses self signed certificate by default. That is natural. Continue with ignoring the TLS warning.\n\nå¯ä»¥è®¿é—®åˆ°æˆ‘ä»¬çš„åå°ã€‚\n\næ£€æŸ¥æœåŠ¡è¿è¡ŒçŠ¶æ€root@RainYun-SJkdAk4z:/usr/local/vpnserver# ./vpncmdvpncmd command - SoftEther VPN Command Line Management UtilitySoftEther VPN Command Line Management Utility (vpncmd command)Version 4.43 Build 9799   (English)Compiled 2023/08/31 10:50:49 by buildsan at crosswin with OpenSSL 3.0.9Copyright (c) 2012-2023 SoftEther VPN Project. All Rights Reserved.By using vpncmd program, the following can be achieved. 1. Management of VPN Server or VPN Bridge 2. Management of VPN Client3. Use of VPN Tools (certificate creation and Network Traffic Speed Test Tool)Select 1, 2 or 3: 3VPN Tools has been launched. By inputting HELP, you can view a list of the commands that can be used.VPN Tools&gt;checkCheck command - Check whether SoftEther VPN Operation is Possible---------------------------------------------------SoftEther VPN Operation Environment Check ToolCopyright (c) SoftEther VPN Project.All Rights Reserved.If this operation environment check tool is run on a system and that system passes, it is most likely that SoftEther VPN software can operate on that system. This check may take a while. Please wait...Checking &#x27;Kernel System&#x27;...               PassChecking &#x27;Memory Operation System&#x27;...               PassChecking &#x27;ANSI / Unicode string processing system&#x27;...               PassChecking &#x27;File system&#x27;...               PassChecking &#x27;Thread processing system&#x27;...               PassChecking &#x27;Network system&#x27;...               PassAll checks passed. It is most likely that SoftEther VPN Server / Bridge can operate normally on this system.The command completed successfully.\n\nå‡ºç°successfullyåå°±å¯ä»¥å¼€å§‹æ­å»ºæˆ‘ä»¬çš„vpnserveräº†ã€‚\nå®‰è£…vpnserverroot@RainYun-SJkdAk4z:/usr/local/vpnserver# ./vpncmdvpncmd command - SoftEther VPN Command Line Management UtilitySoftEther VPN Command Line Management Utility (vpncmd command)Version 4.43 Build 9799   (English)Compiled 2023/08/31 10:50:49 by buildsan at crosswin with OpenSSL 3.0.9Copyright (c) 2012-2023 SoftEther VPN Project. All Rights Reserved.By using vpncmd program, the following can be achieved. 1. Management of VPN Server or VPN Bridge 2. Management of VPN Client3. Use of VPN Tools (certificate creation and Network Traffic Speed Test Tool)Select 1, 2 or 3: 1 // é€‰1ï¼Œå®‰è£…vpnserverSpecify the host name or IP address of the computer that the destination VPN Server or VPN Bridge is operating on. By specifying according to the format &#x27;host name:port number&#x27;, you can also specify the port number. (When the port number is unspecified, 443 is used.)If nothing is input and the Enter key is pressed, the connection will be made to the port number 8888 of localhost (this computer).Hostname of IP Address of Destination: 154.3.0.248 // å¡«å†™ä½ çš„å…¬ç½‘IPIf connecting to the server by Virtual Hub Admin Mode, please input the Virtual Hub name. If connecting by server admin mode, please press Enter without inputting anything.Specify Virtual Hub Name: // ä¸å¡«ï¼Œç›´æ¥å›è½¦Connection has been established with VPN Server &quot;154.3.0.248&quot; (port 443).You have administrator privileges for the entire VPN Server.\n\nä¸‹è½½Softether VPN Server ManagerSecureNATçš„ä½œç”¨æä¾›è™šæ‹ŸNATå’Œè™šæ‹ŸDHCPæœåŠ¡ã€‚\nå…·ä½“æµç¨‹ç±»ä¼¼wifiè·¯ç”±å™¨ä¸Šç½‘è¿‡ç¨‹ã€‚\nwifiè·¯ç”±å™¨ä¸Šç½‘è¿‡ç¨‹ï¼šå®¢æˆ·ç«¯é€šè¿‡è·¯ç”±å™¨DHCPåˆ°ä¸€ä¸ªå†…ç½‘IPï¼Œç„¶åé€šè¿‡è·¯ç”±å™¨çš„NATåŠŸèƒ½ï¼Œå°†å†…ç½‘IPæ˜ å°„åˆ°è·¯ç”±å™¨çš„å…¬ç½‘IPï¼Œé€šè¿‡è·¯ç”±å™¨çš„å…¬ç½‘IPè¿›è¡Œä¸Šç½‘ã€‚\nVPNï¼šå®¢æˆ·ç«¯è¿æ¥åˆ°VPN Serverï¼Œé€šè¿‡è™šæ‹ŸDHCPè·å¾—ä¸€ä¸ªè™šæ‹ŸIPï¼Œé€šè¿‡SecureNATï¼Œå°†è¿™ä¸ªè™šæ‹ŸIPæ˜ å°„åˆ°VPN Serverçš„IPï¼Œé€šè¿‡VPN Serverçš„IPä¸Šç½‘ã€‚\n\né€šè¿‡Clientä½¿ç”¨VPNPCç«¯é€šè¿‡SoftEther VPN Clientä½¿ç”¨\nç§»åŠ¨ç«¯(éœ€è¦æ”¯æŒL2TP-ä¸€ç§VPNåè®®)ä½¿ç”¨è‡ªå¸¦VPNç›´æ¥è¿æ¥å³å¯\nProxmox VE\nProxmox VE\n\nProxmoxè™šæ‹Ÿç¯å¢ƒï¼ˆç®€ç§°PVEï¼‰æ˜¯ç”¨äºæ“ä½œæ¥å®¾æ“ä½œç³»ç»Ÿçš„åŸºäºDebian Linuxå’ŒKVMçš„è™šæ‹ŸåŒ–å¹³å°ã€‚\nä½ å¯ä»¥æŠŠå®ƒç±»æ¯”ä¸ºVMwareï¼Œåªä¸è¿‡ä½¿ç”¨PVEçš„å‰ææ˜¯ä½ å¾—æœ‰ä¸€ä¸ªå°è¿·ä½ ä¸»æœºæˆ–é—²ç½®çš„ç”µè„‘ï¼Œå› ä¸ºPVEå®‰è£…æ—¶æ˜¯ä¸€ä¸ªç³»ç»Ÿé•œåƒã€‚\nåŒºåˆ«ï¼š\n\nVMwareåŸºäºè‡ªå®¶å¼€å‘çš„ ESXi è™šæ‹ŸåŒ–æŠ€æœ¯ï¼Œæ˜¯ä¸€ç§å®Œå…¨è™šæ‹ŸåŒ–ï¼Œæ•æ„ŸæŒ‡ä»¤åœ¨æ“ä½œç³»ç»Ÿå’Œç¡¬ä»¶ä¹‹é—´è¢«æ•æ‰å¤„ç†ï¼Œå®¢æˆ·æ“ä½œç³»ç»Ÿæ— éœ€ä¿®æ”¹ï¼Œä¸”æ‰€æœ‰è½¯ä»¶éƒ½èƒ½åœ¨è™šæ‹Ÿæœºä¸­è¿è¡Œã€‚\nPVEä¸»è¦åŸºäº KVMï¼Œæ˜¯ä¸€ç§åŸºäºå†…æ ¸çš„è™šæ‹Ÿæœºï¼Œå¯å°†Linuxå†…æ ¸è½¬åŒ–æˆè™šæ‹Ÿæœºç›‘è§†å™¨ã€‚åŒæ—¶å®ƒè¿˜æœ‰è£¸æœºå®‰è£…å™¨ã€ç½‘é¡µç‰ˆè¿œç¨‹ç®¡ç†ç•Œé¢ã€HAé›†ç¾¤å †æ ˆã€ç»Ÿä¸€å­˜å‚¨ã€æŸ”æ€§ç½‘ç»œåŠå¯é€‰çš„å•†ä¸šæ”¯æŒã€‚\n\nå±€é™æ€§ï¼š\nProxmoxç¾¤é›†çš„è™šæ‹ŸåŒ–å’Œå­˜å‚¨ä¸»æœºçš„æœ€å¤§æ•°é‡ä¸º32å°ç‰©ç†æœåŠ¡å™¨ã€‚\n\nä¸‹è½½ï¼šISO Installer - Proxmox Virtual Environment\n\nå®‰è£…CPUç±»åˆ«ï¼š\n\nhostï¼šæ€§èƒ½æœ€ä½³ä½†å…¼å®¹æ€§ä¸å¥½ï¼Œå¦‚æœæƒ³å°†è™šæ‹Ÿæœºä»ä¸€å°å®¿ä¸»æœºè¿ç§»åˆ°å¦ä¸€å° CPU å‹å·æˆ–æ¶æ„ä¸åŒçš„å®¿ä¸»æœºæ—¶ï¼Œå¯èƒ½ä¼šå‡ºç°å…¼å®¹æ€§é—®é¢˜ã€‚\nkvm64ï¼šå…¼å®¹æ€§å¥½ä½†æ€§èƒ½ä¸æ˜¯æœ€ä½³ï¼Œå®ƒå¯ä»¥è®©æˆ‘ä»¬åœ¨ä¸åŒçš„å®¿ä¸»æœºä¹‹é—´è¿ç§»è™šæ‹Ÿæœºã€‚\n\nLVMï¼ˆLogical Volume Managerï¼‰æ˜¯ä¸€ç§åœ¨ Linux æ“ä½œç³»ç»Ÿä¸Šä½¿ç”¨çš„é€»è¾‘å·ç®¡ç†å™¨ï¼Œå®ƒå…è®¸ç”¨æˆ·å¯¹å­˜å‚¨è®¾å¤‡è¿›è¡Œçµæ´»çš„ç®¡ç†ã€‚\n\nåŠ¨æ€è°ƒæ•´é€»è¾‘å·çš„å¤§å°ï¼Œè€Œæ— éœ€é‡æ–°åˆ†åŒºç£ç›˜ã€‚\nå®ç°æ•°æ®çš„å¿«é€Ÿå¤‡ä»½å’Œè¿˜åŸã€‚\næ”¯æŒæ•°æ®çš„å¿«é€Ÿè¿ç§»å’Œå¿«é€Ÿæ‰©å±•å­˜å‚¨å®¹é‡ã€‚\næé«˜æ•°æ®å®‰å…¨æ€§å’Œå¯é æ€§ï¼ŒåŒ…æ‹¬æ•°æ®å†—ä½™å’Œå¿«é€Ÿæ¢å¤èƒ½åŠ›ã€‚\n\n","categories":["æœåŠ¡å™¨è¿ç»´"],"tags":["æœåŠ¡å™¨è¿ç»´"]},{"title":"Redisä¸»ä»åŒæ­¥å®éªŒ","url":"/2025/12/08/redis/","content":"éœ€æ±‚\nAï¼šmasterï¼Œä¸åŠ å¯†ï¼ˆæ™®é€šç«¯å£ 6379ï¼‰\nBï¼šslaveï¼Œä» A åŒæ­¥ï¼Œä¸åŠ å¯†ï¼ˆç«¯å£ 16379ï¼‰ï¼ŒåŒæ—¶ç›‘å¬ TLS åŠ å¯†ç«¯å£ 16380\nCï¼šslaveï¼Œä» B åŒæ­¥ï¼Œé€šè¿‡ TLSï¼ˆç«¯å£ 16380ï¼‰\n\néƒ¨ç½²ç”Ÿæˆè‡ªç­¾åTLSè¯ä¹¦ ä½¿ç”¨opensslç”Ÿæˆè‡ªç­¾åè¯ä¹¦mkdir -p certs &amp;&amp; cd certs# åˆ›å»º CAopenssl genrsa -out ca.key 4096openssl req -x509 -new -nodes -key ca.key -sha256 -days 3650 -out ca.crt -subj &quot;/CN=Redis-CA&quot;# åˆ›å»º server key å’Œè¯ä¹¦ç­¾åè¯·æ±‚ï¼ˆCSRï¼‰openssl genrsa -out redis.key 2048openssl req -new -key redis.key -out redis.csr -subj &quot;/CN=redis-server&quot;# ä½¿ç”¨ CA ç­¾å‘ server è¯ä¹¦openssl x509 -req -in redis.csr -CA ca.crt -CAkey ca.key -CAcreateserial -out redis.crt -days 3650 -sha256# æƒé™è®¾ç½®chmod 644 redis.crt redis.key ca.crt\n\nCAç›¸å…³è¯ä¹¦\n\nca.keyï¼šCAçš„ç§é’¥ï¼Œç”¨æ¥ç­¾å‘è¯ä¹¦ï¼ˆç»™redis.crtç­¾åï¼‰\nca.crtï¼šCAçš„å…¬é’¥è¯ä¹¦ï¼Œç”¨æ¥è®©å®¢æˆ·ç«¯éªŒè¯æŸä¸ªè¯ä¹¦ï¼ˆæ¯”å¦‚redis.crtï¼‰æ˜¯ä¸æ˜¯CAç­¾å‘çš„ï¼Œå®¢æˆ·ç«¯æ‹¿redis.crtæ¥éªŒè¯æ—¶ï¼Œä¼šç”¨è¿™ä¸ªå…¬é’¥è§£ç­¾åã€‚\n\nRedisæœåŠ¡å™¨ç›¸å…³è¯ä¹¦\n\nredis.keyï¼šRedis æœåŠ¡ç«¯çš„ç§é’¥ï¼Œç”¨æ¥è§£å¯†å®¢æˆ·ç«¯å‘æ¥çš„æ•°æ®ã€ä»¥åŠåœ¨ TLS æ¡æ‰‹æ—¶è¯æ˜â€æˆ‘æ˜¯ Redis æœåŠ¡ç«¯â€ã€‚\nredis.csrï¼šè¯ä¹¦ç­¾åè¯·æ±‚ï¼ˆCertificate Signing Requestï¼‰åŒ…å« Redis æœåŠ¡å™¨çš„å…¬é’¥ + æœåŠ¡å™¨èº«ä»½ä¿¡æ¯ï¼ˆåŸŸåã€ç»„ç»‡ç­‰ï¼‰ï¼Œç”Ÿæˆ CSR çš„ç›®çš„æ˜¯äº¤ç»™ CA ç­¾åï¼Œç”Ÿæˆä¸€ä¸ªæ­£å¼è¯ä¹¦ã€‚\nredis.crtï¼šRedis æœåŠ¡å™¨çš„è¯ä¹¦\n\nRedis é…ç½®æ–‡ä»¶port 6379tls-port 6380tls-cert-file /certs/redis.crttls-key-file /certs/redis.keytls-ca-cert-file /certs/ca.crttls-auth-clients no# ä½œä¸ºslaveï¼ŒåŒæ­¥redis-areplicaof redis-a 6379\n\n# å…³é—­éåŠ å¯† TCP ç«¯å£port 0tls-port 6380tls-cert-file /certs/redis.crttls-key-file /certs/redis.keytls-ca-cert-file /certs/ca.crt# å•å‘TLStls-auth-clients no# ä»åŠ å¯†ç«¯å£åŒæ­¥ redis-breplicaof redis-b 6380# å…è®¸ä¸»ä»å¤åˆ¶ä¹Ÿèµ° TLS åŠ å¯†é€šé“tls-replication yes\n\ndocker-composeå¯åŠ¨ä¸‰ä¸ªrediså®¹å™¨\nredis-aä½œä¸ºmasterï¼Œæš´éœ²å®¹å™¨ç«¯å£6379åˆ°6379\nredis-bä½œä¸ºslaveï¼Œæš´éœ²å®¹å™¨ç«¯å£6379åˆ°16379ï¼Œå®¹å™¨ç«¯å£6380åˆ°16380ï¼ˆTLSï¼‰\nredis-cä½œä¸ºslaveï¼Œæš´éœ²å®¹å™¨ç«¯å£6380åˆ°26380ï¼ˆTLSï¼‰\nversion: &#x27;3.8&#x27;services:  redis-a:    image: redis:latest    container_name: redis-a    ports:      - &quot;6379:6379&quot;    volumes:      - ./data/redis-a:/data    command: [&quot;redis-server&quot;, &quot;--port&quot;, &quot;6379&quot;]    networks:      - redis-net  redis-b:    image: redis:latest    container_name: redis-b    ports:      - &quot;16379:6379&quot;      - &quot;16380:6380&quot;    volumes:      - ./data/redis-b:/data      - ./certs:/certs      - ./redis-b.conf:/usr/local/etc/redis/redis.conf    command: [&quot;redis-server&quot;, &quot;/usr/local/etc/redis/redis.conf&quot;]    networks:      - redis-net    depends_on:      - redis-a  redis-c:    image: redis:latest    container_name: redis-c    ports:      - &quot;26380:6380&quot;    volumes:      - ./data/redis-c:/data      - ./certs:/certs      - ./redis-b.conf:/usr/local/etc/redis/redis.conf    command: [&quot;redis-server&quot;, &quot;/usr/local/etc/redis/redis.conf&quot;]    networks:      - redis-net    depends_on:      - redis-bnetworks:  redis-net:    driver: bridge\n\néªŒè¯æŸ¥çœ‹ä¸»ä»çŠ¶æ€ç›®æ ‡ï¼š\n\nB æ˜¯ A çš„ä»èŠ‚ç‚¹\nC æ˜¯ B çš„ä»èŠ‚ç‚¹ï¼ˆé€šè¿‡ TLSï¼‰\n\næŸ¥çœ‹ Redis B æ˜¯å¦åŒæ­¥ Redis Aï¼ˆé TLSï¼‰å¯ä»¥çœ‹åˆ°bä»¥aä½œä¸ºmasterï¼Œmaster_link_status:up è¯´æ˜åŒæ­¥æ­£å¸¸\nroot@liyixiong01:~/redis# docker exec -it redis-b redis-cli -p 6379 info replication# Replicationrole:slavemaster_host:redis-amaster_port:6379master_link_status:up\n\næŸ¥çœ‹ Redis C æ˜¯å¦é€šè¿‡ TLS åŒæ­¥ Redis Broot@liyixiong01:~/redis# docker exec -it redis-c redis-cli   --tls   --cert /certs/redis.crt   --key /certs/redis.key   --cacert /certs/ca.crt   -p 6380 info replication# Replicationrole:slavemaster_host:redis-bmaster_port:6380master_link_status:up\n\néªŒè¯æ•°æ®åŒæ­¥é“¾è·¯æ˜¯å¦çœŸå®å·¥ä½œåœ¨ Redis A å†™å…¥æ•°æ®root@liyixiong01:~/redis# docker exec -it redis-a redis-cli -p 6379 set hello worldOK\n\nåœ¨ Redis B æŸ¥çœ‹æ˜¯å¦èƒ½è¯»åˆ°ï¼ˆéTLSï¼‰root@liyixiong01:~/redis# docker exec -it redis-b redis-cli -p 6379 get hello\\&quot;world&quot;\n\nåœ¨ Redis C æŸ¥çœ‹æ˜¯å¦èƒ½è¯»åˆ°ï¼ˆTLSï¼‰root@liyixiong01:~/redis# docker exec -it redis-c redis-cli \\  --tls \\  --cert /certs/redis.crt \\  --key /certs/redis.key \\  --cacert /certs/ca.crt \\  -p 6380 get hello&quot;world&quot;","categories":["æœåŠ¡å™¨è¿ç»´"],"tags":["æœåŠ¡å™¨è¿ç»´","Redis"]}]